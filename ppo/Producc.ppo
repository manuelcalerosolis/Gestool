#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 7 ".\Prg\Producc.prg"
memvar oDbf
memvar cDbf
memvar oDbfCol
memvar cDbfCol
memvar oDbfAlm
memvar cDbfAlm
memvar oDbfSec
memvar cDbfSec
memvar cPouDivPro
memvar cDetPro
memvar cDetMat
memvar cDetHPer
memvar cDetMaq
memvar oThis
memvar nPagina
memvar lEnd
memvar cTiempoEmp
memvar nProd
memvar nMat
memvar nPer
memvar nMaq
memvar nParte



Function StartTProduccion()

   local oProduccion := TProduccion():New( cPatEmp(), oWnd(), "04008" )

   if !Empty( oProduccion )
      oProduccion:Activate()
   end

Return nil



_HB_CLASS TProduccion ; UTILITY FUNCTION TProduccion(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TProduccion" , {TMasDet():classh} ) ) ; ;

   _HB_MEMBER { cMru} ; IIF( !.F., s_oClass:AddMultiData(, "Worker2_Form_Red_16", nScope + IIF( .F., 32, 0 ), { "cMru" }, .F., .F. ), )

   _HB_MEMBER { oArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArt" }, .F., .F. ), )
   _HB_MEMBER { oAlm} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlm" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvT" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvL" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvS" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvT" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvL" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvS" }, .F., .F. ), )
   _HB_MEMBER { oRctPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctPrvL" }, .F., .F. ), )
   _HB_MEMBER { oRctPrvS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctPrvS" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliT" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliL" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliS" }, .F., .F. ), )
   _HB_MEMBER { oFacCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliT" }, .F., .F. ), )
   _HB_MEMBER { oFacCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacCliS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliS" }, .F., .F. ), )
   _HB_MEMBER { oFacRecT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecT" }, .F., .F. ), )
   _HB_MEMBER { oFacRecL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecL" }, .F., .F. ), )
   _HB_MEMBER { oFacRecS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecS" }, .F., .F. ), )
   _HB_MEMBER { oTikCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliT" }, .F., .F. ), )
   _HB_MEMBER { oTikCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliL" }, .F., .F. ), )
   _HB_MEMBER { oTikCliS} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliS" }, .F., .F. ), )

   _HB_MEMBER { oHisMov} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oHisMov" }, .F., .F. ), )

   _HB_MEMBER { oStock} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oStock" }, .F., .F. ), )
   _HB_MEMBER { oPro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPro" }, .F., .F. ), )
   _HB_MEMBER { oTblPro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTblPro" }, .F., .F. ), )
   _HB_MEMBER { oFam} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFam" }, .F., .F. ), )
   _HB_MEMBER { oKitArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oKitArt" }, .F., .F. ), )
   _HB_MEMBER { oDbfDoc} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfDoc" }, .F., .F. ), )
   _HB_MEMBER { oDbfCount} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfCount" }, .F., .F. ), )
   _HB_MEMBER { oDbfEmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfEmp" }, .F., .F. ), )
   _HB_MEMBER { oDbfFilter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfFilter" }, .F., .F. ), )

   _HB_MEMBER { oDetProduccion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetProduccion" }, .F., .F. ), )
   _HB_MEMBER { oDetSeriesProduccion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetSeriesProduccion" }, .F., .F. ), )
   _HB_MEMBER { oDetMaterial} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetMaterial" }, .F., .F. ), )
   _HB_MEMBER { oDetSeriesMaterial} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetSeriesMaterial" }, .F., .F. ), )
   _HB_MEMBER { oDetHoras} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetHoras" }, .F., .F. ), )
   _HB_MEMBER { oDetHorasPersonal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetHorasPersonal" }, .F., .F. ), )
   _HB_MEMBER { oDetPersonal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetPersonal" }, .F., .F. ), )
   _HB_MEMBER { oDetMaquina} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDetMaquina" }, .F., .F. ), )

   _HB_MEMBER { oOperario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oOperario" }, .F., .F. ), )
   _HB_MEMBER { oSeccion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSeccion" }, .F., .F. ), )
   _HB_MEMBER { oOperacion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oOperacion" }, .F., .F. ), )
   _HB_MEMBER { oMaquina} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMaquina" }, .F., .F. ), )
   _HB_MEMBER { oHoras} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oHoras" }, .F., .F. ), )

   _HB_MEMBER { oGetTotalUnidades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oGetTotalUnidades" }, .F., .F. ), )
   _HB_MEMBER { nGetTotalUnidades} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nGetTotalUnidades" }, .F., .F. ), )

   _HB_MEMBER { cTmpEmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cTmpEmp" }, .F., .F. ), )
   _HB_MEMBER { cTiempoEmpleado} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "cTiempoEmpleado" }, .F., .F. ), )

   _HB_MEMBER { oTotProducido} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotProducido" }, .F., .F. ), )
   _HB_MEMBER { oTotMaterias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotMaterias" }, .F., .F. ), )
   _HB_MEMBER { oTotPersonal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotPersonal" }, .F., .F. ), )
   _HB_MEMBER { oTotMaquinaria} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotMaquinaria" }, .F., .F. ), )

   _HB_MEMBER { cOldCodSec} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cOldCodSec" }, .F., .F. ), )
   _HB_MEMBER { cOldCodOpe} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cOldCodOpe" }, .F., .F. ), )
   _HB_MEMBER { dOldFecIni} ; IIF( !.F., s_oClass:AddMultiData(, Ctod( "" ), nScope + IIF( .F., 32, 0 ), { "dOldFecIni" }, .F., .F. ), )
   _HB_MEMBER { dOldFecFin} ; IIF( !.F., s_oClass:AddMultiData(, Ctod( "" ), nScope + IIF( .F., 32, 0 ), { "dOldFecFin" }, .F., .F. ), )
   _HB_MEMBER { cOldHorIni} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cOldHorIni" }, .F., .F. ), )
   _HB_MEMBER { cOldHorFin} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cOldHorFin" }, .F., .F. ), )

   _HB_MEMBER { aCal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aCal" }, .F., .F. ), )
   _HB_MEMBER { cTime} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cTime" }, .F., .F. ), )

   _HB_MEMBER { oDbfTemporal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfTemporal" }, .F., .F. ), )

   _HB_MEMBER { cFileName} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFileName" }, .F., .F. ), )

   _HB_MEMBER New( cPath, oWndParent, oMenuItem); IIF( .F., s_oClass:ModMethod( "New", @TProduccion_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "New", @TProduccion_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Create( cPath, oWndParent); IIF( .F., s_oClass:ModMethod( "Create", @TProduccion_Create(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Create", @TProduccion_Create(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Activate(); IIF( .F., s_oClass:ModMethod( "Activate", @TProduccion_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Activate", @TProduccion_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OpenFiles( lExclusive); IIF( .F., s_oClass:ModMethod( "OpenFiles", @TProduccion_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenFiles", @TProduccion_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OpenService( lExclusive); IIF( .F., s_oClass:ModMethod( "OpenService", @TProduccion_OpenService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenService", @TProduccion_OpenService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CloseFiles(); IIF( .F., s_oClass:ModMethod( "CloseFiles", @TProduccion_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseFiles", @TProduccion_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CloseService(); IIF( .F., s_oClass:ModMethod( "CloseService", @TProduccion_CloseService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseService", @TProduccion_CloseService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DefineFiles(); IIF( .F., s_oClass:ModMethod( "DefineFiles", @TProduccion_DefineFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DefineFiles", @TProduccion_DefineFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Resource( nMode, aDatosAnterior); IIF( .F., s_oClass:ModMethod( "Resource", @TProduccion_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Resource", @TProduccion_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lPreSave( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode, oDlg); IIF( .F., s_oClass:ModMethod( "lPreSave", @TProduccion_lPreSave(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lPreSave", @TProduccion_lPreSave(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotUnidades(); IIF( .F., s_oClass:ModInline( "nTotUnidades", {|Self | Self, ( NotCaja( ::oDbf:nCajArt ) * ::oDbf:nUndArt ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotUnidades", {|Self | Self, ( NotCaja( ::oDbf:nCajArt ) * ::oDbf:nUndArt ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER lTotUnidades(); IIF( .F., s_oClass:ModInline( "lTotUnidades", {|Self | Self, ( ::oGetTotalUnidades:cText( Round( ::nTotUnidades(), ::nDouDiv ) ), .T. ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lTotUnidades", {|Self | Self, ( ::oGetTotalUnidades:cText( Round( ::nTotUnidades(), ::nDouDiv ) ), .T. ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER LoaArticulo( oGetArticulo, oGetNombre); IIF( .F., s_oClass:ModMethod( "LoaArticulo", @TProduccion_LoaArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "LoaArticulo", @TProduccion_LoaArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetNewCount(); IIF( .F., s_oClass:ModMethod( "GetNewCount", @TProduccion_GetNewCount(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetNewCount", @TProduccion_GetNewCount(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lTiempoEmpleado( oTmpEmp); IIF( .F., s_oClass:ModMethod( "lTiempoEmpleado", @TProduccion_lTiempoEmpleado(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lTiempoEmpleado", @TProduccion_lTiempoEmpleado(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lRecargaPersonal( oCodSec); IIF( .F., s_oClass:ModMethod( "lRecargaPersonal", @TProduccion_lRecargaPersonal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lRecargaPersonal", @TProduccion_lRecargaPersonal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GenParte( nDevice, cCaption, cCodDoc, cPrinter); IIF( .F., s_oClass:ModMethod( "GenParte", @TProduccion_GenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GenParte", @TProduccion_GenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EPage( oInf, cCodDoc); IIF( .F., s_oClass:ModMethod( "EPage", @TProduccion_EPage(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EPage", @TProduccion_EPage(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lGenParte( oBrw, oBtn, nDevice); IIF( .F., s_oClass:ModMethod( "lGenParte", @TProduccion_lGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lGenParte", @TProduccion_lGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER bGenParte( nDevice, cTitle, cCodDoc); IIF( .F., s_oClass:ModMethod( "bGenParte", @TProduccion_bGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bGenParte", @TProduccion_bGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nGenParte( nDevice, cTitle, cCodDoc, cPrinter, nCopy); IIF( .F., s_oClass:ModMethod( "nGenParte", @TProduccion_nGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nGenParte", @TProduccion_nGenParte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CreateTemporal( cNumeroParte); IIF( .F., s_oClass:ModMethod( "CreateTemporal", @TProduccion_CreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CreateTemporal", @TProduccion_CreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DefineTemporal(); IIF( .F., s_oClass:ModMethod( "DefineTemporal", @TProduccion_DefineTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DefineTemporal", @TProduccion_DefineTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DestroyTemporal(); IIF( .F., s_oClass:ModMethod( "DestroyTemporal", @TProduccion_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DestroyTemporal", @TProduccion_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DefineCalculate(); IIF( .F., s_oClass:ModMethod( "DefineCalculate", @TProduccion_DefineCalculate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DefineCalculate", @TProduccion_DefineCalculate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PrnSerie(); IIF( .F., s_oClass:ModMethod( "PrnSerie", @TProduccion_PrnSerie(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PrnSerie", @TProduccion_PrnSerie(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER StartPrint( cFmtDoc, cDocIni, cDocFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden); IIF( .F., s_oClass:ModMethod( "StartPrint", @TProduccion_StartPrint(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartPrint", @TProduccion_StartPrint(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER RecSiguente( oBrw); IIF( .F., s_oClass:ModMethod( "RecSiguente", @TProduccion_RecSiguente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "RecSiguente", @TProduccion_RecSiguente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaPersonalAnterior( aDatosAnterior); IIF( .F., s_oClass:ModMethod( "CargaPersonalAnterior", @TProduccion_CargaPersonalAnterior(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaPersonalAnterior", @TProduccion_CargaPersonalAnterior(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalProducido( cDocumento); IIF( .F., s_oClass:ModMethod( "nTotalProducido", @TProduccion_nTotalProducido(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalProducido", @TProduccion_nTotalProducido(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalMaterial( cDocumento); IIF( .F., s_oClass:ModMethod( "nTotalMaterial", @TProduccion_nTotalMaterial(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalMaterial", @TProduccion_nTotalMaterial(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalPersonal( cDocumento); IIF( .F., s_oClass:ModMethod( "nTotalPersonal", @TProduccion_nTotalPersonal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalPersonal", @TProduccion_nTotalPersonal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalMaquina( cDocumento); IIF( .F., s_oClass:ModMethod( "nTotalMaquina", @TProduccion_nTotalMaquina(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalMaquina", @TProduccion_nTotalMaquina(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalOperario( cDocOpe); IIF( .F., s_oClass:ModMethod( "nTotalOperario", @TProduccion_nTotalOperario(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalOperario", @TProduccion_nTotalOperario(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalVolumen( cDocumento); IIF( .F., s_oClass:ModMethod( "nTotalVolumen", @TProduccion_nTotalVolumen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalVolumen", @TProduccion_nTotalVolumen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DataReport( oFr); IIF( .F., s_oClass:ModMethod( "DataReport", @TProduccion_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DataReport", @TProduccion_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER VariableReport( oFr); IIF( .F., s_oClass:ModMethod( "VariableReport", @TProduccion_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "VariableReport", @TProduccion_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DesignReportProducc( oFr, dbfDoc); IIF( .F., s_oClass:ModMethod( "DesignReportProducc", @TProduccion_DesignReportProducc(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DesignReportProducc", @TProduccion_DesignReportProducc(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PrintReportProducc( nDevice, nCopies, cPrinter, dbfDoc); IIF( .F., s_oClass:ModMethod( "PrintReportProducc", @TProduccion_PrintReportProducc(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PrintReportProducc", @TProduccion_PrintReportProducc(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TProduccion ;



UTILITY STATIC function TProduccion_New( cPath, oWndParent, oMenuItem) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   IIF( cPath == nil, cPath := cPatEmp(), ) ;
   IIF( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   if oMenuItem <> nil .AND. ::nLevel == nil
      ::nLevel             := nLevelUsr( oMenuItem )
   else
      ::nLevel             := 0
   end

   if nAnd( ::nLevel, 1 ) <> 0
      msgStop( "Acceso no permitido." )
      return nil
   end

   ::cPath                 := cPath
   ::oWndParent            := oWndParent

   ::cTipoDocumento        := "30"

   ::bFirstKey             := {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd }

   ::oOperario             := TOperarios():Create()
   ::oOperacion            := TOperacion():CreateInit()
   ::oMaquina              := TMaquina():CreateInit()
   ::oSeccion              := TSeccion():Create()
   ::oHoras                := THoras():Create()

   ::oDetHoras             := TDetHoras():New( cPath, Self )

   ::oDetProduccion        := TDetProduccion():New( cPath, Self )
   ::AddDetail( ::oDetProduccion )

   ::oDetSeriesProduccion  := TDetSeriesProduccion():New( cPath, Self )
   ::AddDetail( ::oDetSeriesProduccion )

   ::oDetMaterial          := TDetMaterial():New( cPath, Self )
   ::AddDetail( ::oDetMaterial )

   ::oDetSeriesMaterial    := TDetSeriesMaterial():New( cPath, Self )
   ::AddDetail( ::oDetSeriesMaterial )

   ::oDetPersonal          := TDetPersonal():New( cPath, Self )
   ::AddDetail( ::oDetPersonal )

   ::oDetHorasPersonal     := TDetHorasPersonal():New( cPath, Self )
   ::AddDetail( ::oDetHorasPersonal )

   ::oDetMaquina           := TDetMaquina():New( cPath, Self )
   ::AddDetail( ::oDetMaquina )

   ::oStock                := TStock():Create( cPatGrp() )

RETURN ( Self )



UTILITY STATIC function TProduccion_Create( cPath, oWndParent) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   IIF( cPath == nil, cPath := cPatEmp(), ) ;
   IIF( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   ::cPath              := cPath
   ::oWndParent         := oWndParent

   ::oOperario          := TOperarios():Create( cPath )

   ::oOperacion         := TOperacion():CreateInit( cPath )

   ::oMaquina           := TMaquina():CreateInit( cPath )

   ::oSeccion           := TSeccion():Create( cPath )

   ::oHoras             := THoras():Create( cPath )

   ::oDetHoras          := TDetHoras():New( cPath, Self )

   ::oDetHorasPersonal  := TDetHorasPersonal():New( cPath, Self )
   ::AddDetail( ::oDetHorasPersonal )

   ::oDetProduccion     := TDetProduccion():New( cPath, Self )
   ::AddDetail( ::oDetProduccion )

   ::oDetSeriesProduccion  := TDetSeriesProduccion():New( cPath, Self )
   ::AddDetail( ::oDetSeriesProduccion )

   ::oDetMaterial       := TDetMaterial():New( cPath, Self )
   ::AddDetail( ::oDetMaterial )

   ::oDetSeriesMaterial := TDetSeriesMaterial():New( cPath, Self )
   ::AddDetail( ::oDetSeriesMaterial )

   ::oDetPersonal       := TDetPersonal():New( cPath, Self )
   ::AddDetail( ::oDetPersonal )

   ::oDetMaquina        := TDetMaquina():New( cPath, Self )
   ::AddDetail( ::oDetMaquina )

   ::oStock             := TStock():Create( cPatGrp() )

   ::bFirstKey          := {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd }

RETURN ( Self )



UTILITY STATIC function TProduccion_Activate() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oImp
   local oPrv
   local oPdf

   if ::oWndParent <> nil
      ::oWndParent:CloseAll()
   end

   if !::OpenFiles()
      return nil
   end
















   ::oWndBrw := TShell():New( 2, 10, 18, 70, "Partes de producción",, ::oWndParent,,, .F.,,, ( ::oDbf ),,,,, {"Número", "Fecha inicio", "Operación", "Sección", "Almacén"}, {||::Append()}, {||::Edit()}, {||::Del()}, {||::Dup()}, nil,, "Worker2_Form_Red_16", ( 250 + ( 161 * 256 ) + ( 52 * 65536 ) ),,, .T. )



      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Número"
         :cSortOrder       := "cNumOrd"
         :bEditValue       := {|| ::oDbf:cSerOrd + "/" + AllTrim( Str( ::oDbf:nNumOrd ) ) + "/" + ::oDbf:cSufOrd }
         :nWidth           := 100
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Fecha inicio"
         :cSortOrder       := "dFecOrd"
         :bEditValue       := {|| Dtoc( ::oDbf:dFecOrd ) + "-" + Trans( ::oDbf:cHorIni, "@R 99:99" ) }
         :nWidth           := 100
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Fecha fin"
         :bEditValue       := {|| Dtoc( ::oDbf:dFecFin ) + "-" + Trans( ::oDbf:cHorFin, "@R 99:99" ) }
         :nWidth           := 100
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Operación"
         :cSortOrder       := "cCodOpe"
         :bEditValue       := {|| ::oDbf:cCodOpe + " - " + oRetFld( ::oDbf:cCodOpe, ::oOperacion:oDbf ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Sección"
         :cSortOrder       := "cCodSec"
         :bEditValue       := {|| ::oDbf:cCodSec + " - " + oRetFld( ::oDbf:cCodSec, ::oSeccion:oDbf ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( ::oWndBrw:AddXCol() )
         :cHeader          := "Almacén"
         :cSortOrder       := "cAlmOrd"
         :bEditValue       := {|| ::oDbf:cAlmOrd + " - " + oRetFld( ::oDbf:cAlmOrd, ::oAlm ) }
         :nWidth           := 250
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | ::oWndBrw:ClickOnHeader( oCol ) }
      end

      ::oWndBrw:CreateXFromCode()






   ::oWndBrw:NewAt( "BUS",,, {||( ::oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )
      ::oWndBrw:AddSeaBar()








   ::oWndBrw:NewAt( "NEW",,, {||( ::oWndBrw:RecAdd() )}, "(A)ñadir", "A",,, 2,, .F. )






   ::oWndBrw:NewAt( "NEW",,, {||( ::RecSiguente( ::oWndBrw ) )}, "Si(g)uente", "G",,, 2,, .F. )






   ::oWndBrw:NewAt( "EDIT",,, {||( ::oWndBrw:RecEdit() )}, "(M)odificar", "M",,, 4,, .F. )






   ::oWndBrw:NewAt( "ZOOM",,, {||( ::Zoom() )}, "(Z)oom", "Z",,, 8,, .F. )






   ::oWndBrw:NewAt( "DEL",,, {||( ::oWndBrw:RecDel() )}, "(E)liminar", "E",,, 16,, .F. )






   oImp := ::oWndBrw:NewAt( "IMP",,, {||( ::nGenParte( 1 ) )}, "(I)mprimir", "I",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oImp, 1 )






   ::oWndBrw:NewAt( "SERIE1",,, {||( ::PrnSerie() )}, "Imp(r)imir series", "R",,, 32,, .F. )






   oPrv := ::oWndBrw:NewAt( "PREV1",,, {||( ::GenParte( 2 ) )}, "(P)revisualizar", "P",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oPrv, 2 )






   oPdf := ::oWndBrw:NewAt( "DOCLOCK",,, {||( ::GenParte( 3 ) )}, "Pd(f)", "F",,, 32,, .F. )

      ::lGenParte( ::oWndBrw:oBrw, oPdf, 3 )

   ::LoadFilter()





   ::oWndBrw:NewAt( "END",,, {||( ::oWndBrw:end() )}, "(S)alir", "S",,,,, .F. )

   if ::cHtmlHelp <> nil
      ::oWndBrw:cHtmlHelp  := ::cHtmlHelp
   end

   ::oWndBrw:Activate(, ::oWndBrw:bLClicked, ::oWndBrw:bRClicked, ::oWndBrw:bMoved, ::oWndBrw:bResized, ::oWndBrw:bPainted, ::oWndBrw:bKeyDown, ::oWndBrw:bInit,,,,,,,,, {|| ( ::CloseFiles() )},, ::oWndBrw:bLButtonUp )

RETURN ( Self )



UTILITY STATIC function TProduccion_OpenFiles( lExclusive) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lOpen          := .T.
   local oError
   local oBlock

   IIF( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if Empty( ::oDbf )
      ::DefineFiles()
   end

   ::oDbf:Activate( .F., !lExclusive )

   ::OpenDetails()

   ::oArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArt:AddBag( "ARTICULO.CDX" ) ; ::oArt:AddBag( ) ; ::oArt:AutoIndex()

   ::oAlm := DbfServer( "ALMACEN.DBF", ):NewOpen( "ALMACEN.DBF",, ( cDriver() ),, ( cPatAlm() ), .F., .T., .F., .F. ) ; ::oAlm:AddBag( "ALMACEN.CDX" ) ; ::oAlm:AddBag( ) ; ::oAlm:AutoIndex()

   ::oFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oFam:AddBag( "FAMILIAS.CDX" ) ; ::oFam:AddBag( ) ; ::oFam:AutoIndex()

   ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()
   ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()
   ::oAlbPrvL:OrdSetFocus( "cRef" )
   ::oAlbPrvS := DbfServer( "ALBPRVS.DBF", ):NewOpen( "ALBPRVS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvS:AddBag( "ALBPRVS.CDX" ) ; ::oAlbPrvS:AddBag( ) ; ::oAlbPrvS:AutoIndex()

   ::oFacPrvT := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FACPRVT.CDX" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()
   ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()
   ::oFacPrvL:OrdSetFocus( "cRef" )
   ::oFacPrvS := DbfServer( "FacPrvS.DBF", ):NewOpen( "FacPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvS:AddBag( "FacPrvS.CDX" ) ; ::oFacPrvS:AddBag( ) ; ::oFacPrvS:AutoIndex()

   ::oRctPrvL := DbfServer( "RctPrvL.DBF", ):NewOpen( "RctPrvL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RctPrvL.CDX" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()
   ::oRctPrvL:OrdSetFocus( "cRef" )
   ::oRctPrvS := DbfServer( "RctPrvS.DBF", ):NewOpen( "RctPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvS:AddBag( "RctPrvS.CDX" ) ; ::oRctPrvS:AddBag( ) ; ::oRctPrvS:AutoIndex()

   ::oAlbCliT := DbfServer( "AlbCliT.DBF", ):NewOpen( "AlbCliT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliT:AddBag( "AlbCliT.CDX" ) ; ::oAlbCliT:AddBag( ) ; ::oAlbCliT:AutoIndex()
   ::oAlbCliL := DbfServer( "AlbCliL.DBF", ):NewOpen( "AlbCliL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "AlbCliL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()
   ::oAlbCliS := DbfServer( "AlbCliS.DBF", ):NewOpen( "AlbCliS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliS:AddBag( "AlbCliS.CDX" ) ; ::oAlbCliS:AddBag( ) ; ::oAlbCliS:AutoIndex()

   ::oFacCliT := DbfServer( "FacCliT.DBF", ):NewOpen( "FacCliT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliT:AddBag( "FacCliT.CDX" ) ; ::oFacCliT:AddBag( ) ; ::oFacCliT:AutoIndex()
   ::oFacCliL := DbfServer( "FacCliL.DBF", ):NewOpen( "FacCliL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FacCliL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()
   ::oFacCliS := DbfServer( "FacCliS.DBF", ):NewOpen( "FacCliS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliS:AddBag( "FacCliS.CDX" ) ; ::oFacCliS:AddBag( ) ; ::oFacCliS:AutoIndex()

   ::oFacRecT := DbfServer( "FacRecT.DBF", ):NewOpen( "FacRecT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecT:AddBag( "FacRecT.CDX" ) ; ::oFacRecT:AddBag( ) ; ::oFacRecT:AutoIndex()
   ::oFacRecL := DbfServer( "FacRecL.DBF", ):NewOpen( "FacRecL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FacRecL.CDX" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()
   ::oFacRecS := DbfServer( "FacRecS.DBF", ):NewOpen( "FacRecS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecS:AddBag( "FacRecS.CDX" ) ; ::oFacRecS:AddBag( ) ; ::oFacRecS:AutoIndex()

   ::oTikCliT := DbfServer( "TikeT.DBF", ):NewOpen( "TikeT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TikeT.CDX" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()
   ::oTikCliL := DbfServer( "TikeL.DBF", ):NewOpen( "TikeL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TikeL.CDX" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()
   ::oTikCliS := DbfServer( "TikeS.DBF", ):NewOpen( "TikeS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliS:AddBag( "TikeS.CDX" ) ; ::oTikCliS:AddBag( ) ; ::oTikCliS:AutoIndex()

   ::oTblPro := DbfServer( "TblPro.DBF", ):NewOpen( "TblPro.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTblPro:AddBag( "TblPro.CDX" ) ; ::oTblPro:AddBag( ) ; ::oTblPro:AutoIndex()

   ::oPro := DbfServer( "Pro.DBF", ):NewOpen( "Pro.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oPro:AddBag( "Pro.CDX" ) ; ::oPro:AddBag( ) ; ::oPro:AutoIndex()

   ::oKitArt := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oKitArt:AddBag( "ARTKIT.CDX" ) ; ::oKitArt:AddBag( ) ; ::oKitArt:AutoIndex()

   ::oDbfDoc := DbfServer( "RDOCUMEN.DBF", ):NewOpen( "RDOCUMEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfDoc:AddBag( "RDOCUMEN.CDX" ) ; ::oDbfDoc:AddBag( ) ; ::oDbfDoc:AutoIndex()
   ::oDbfDoc:OrdSetFocus( "cTipo" )

   ::oDbfCount := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCount:AddBag( "NCOUNT.CDX" ) ; ::oDbfCount:AddBag( ) ; ::oDbfCount:AutoIndex()

   ::oDbfEmp := DbfServer( "EMPRESA.DBF", ):NewOpen( "EMPRESA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfEmp:AddBag( "EMPRESA.CDX" ) ; ::oDbfEmp:AddBag( ) ; ::oDbfEmp:AutoIndex()

   ::oDbfFilter := DbfServer( "CnfFlt.Dbf", ):NewOpen( "CnfFlt.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfFilter:AddBag( "CnfFlt.Cdx" ) ; ::oDbfFilter:AddBag( ) ; ::oDbfFilter:AutoIndex()

   ::oHisMov := DbfServer( "HISMOV.DBF", ):NewOpen( "HISMOV.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oHisMov:AddBag( "HISMOV.CDX" ) ; ::oHisMov:AddBag( ) ; ::oHisMov:AutoIndex()

   if Empty( ::oDbfTemporal )
      ::DefineTemporal()
   end

   ::oDbfTemporal:Activate( .F., .F. )

   if !::oDetHoras:OpenFiles()
      lOpen          := .F.
   end

   if !::oOperario:OpenFiles()
      lOpen          := .F.
   end

   if !::oSeccion:OpenFiles()
      lOpen          := .F.
   end

   if !::oOperacion:OpenFiles()
      lOpen          := .F.
   end

   if !::oMaquina:OpenFiles()
      lOpen          := .F.
   end

   if !::oHoras:OpenFiles()
      lOpen          := .F.
   end

   if !::oStock:lOpenFiles()
      lOpen          := .F.
   end

   ::oStock:cAlbPrvL   := ::oAlbPrvL:cAlias
   ::oStock:cAlbPrvS   := ::oAlbPrvS:cAlias

   ::oStock:cFacPrvL   := ::oFacPrvL:cAlias
   ::oStock:cFacPrvS   := ::oFacPrvS:cAlias

   ::oStock:cRctPrvL   := ::oRctPrvL:cAlias
   ::oStock:cRctPrvS   := ::oRctPrvS:cAlias

   ::oStock:cAlbCliT   := ::oAlbCliT:cAlias
   ::oStock:cAlbCliL   := ::oAlbCliL:cAlias
   ::oStock:cAlbCliS   := ::oAlbCliS:cAlias

   ::oStock:cFacCliT   := ::oFacCliT:cAlias
   ::oStock:cFacCliL   := ::oFacCliL:cAlias
   ::oStock:cFacCliS   := ::oFacCliS:cAlias

   ::oStock:cFacRecT   := ::oFacRecT:cAlias
   ::oStock:cFacRecL   := ::oFacRecL:cAlias
   ::oStock:cFacRecS   := ::oFacRecS:cAlias

   ::oStock:cTikT      := ::oTikCliT:cAlias
   ::oStock:cTikL      := ::oTikCliL:cAlias
   ::oStock:cTikS      := ::oTikCliS:cAlias

   ::oStock:cHisMov    := ::oHisMov:cAlias

   ::oStock:cProducL   := ::oDetProduccion:oDbf:cAlias
   ::oStock:cProducM   := ::oDetMaterial:oDbf:cAlias
   ::oStock:cProducS   := ::oDetSeriesProduccion:oDbf:cAlias
   ::oStock:cProducP   := ::oDetSeriesMaterial:oDbf:cAlias

   RECOVER USING oError

      lOpen          := .F.

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

   end

   ErrorBlock( oBlock )

   if !lOpen
      ::CloseFiles()
   end

RETURN ( lOpen )



UTILITY STATIC function TProduccion_OpenService( lExclusive) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lOpen          := .T.
   local oError
   local oBlock

   IIF( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if Empty( ::oDbf )
         ::DefineFiles()
      end

      ::oDbf:Activate( .F., !lExclusive )



   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Imposible abrir todas las bases de datos" )

      ::CloseService()

      lOpen             := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



UTILITY STATIC function TProduccion_CloseService() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   ::oDbf   := nil

   ::CloseDetails()

RETURN ( .T. )



UTILITY STATIC function TProduccion_CloseFiles() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::oDbf <> nil .AND. ::oDbf:Used()
      ::oDbf:End()
   end

   ::CloseDetails()

   if ::oArt <> nil .AND. ::oArt:Used()
      ::oArt:End()
   end

   if ::oAlm <> nil .AND. ::oAlm:Used()
      ::oAlm:End()
   end

   if ::oAlbPrvT <> nil .AND. ::oAlbPrvT:Used()
      ::oAlbPrvT:End()
   end

   if ::oAlbPrvL <> nil .AND. ::oAlbPrvL:Used()
      ::oAlbPrvL:End()
   end

   if ::oAlbPrvS <> nil .AND. ::oAlbPrvS:Used()
      ::oAlbPrvS:End()
   end

   if ::oFacPrvT <> nil .AND. ::oFacPrvT:Used()
      ::oFacPrvT:End()
   end

   if ::oFacPrvL <> nil .AND. ::oFacPrvL:Used()
      ::oFacPrvL:End()
   end

   if ::oFacPrvS <> nil .AND. ::oFacPrvS:Used()
      ::oFacPrvs:End()
   end

   if ::oRctPrvL <> nil .AND. ::oRctPrvL:Used()
      ::oRctPrvL:End()
   end

   if ::oRctPrvS <> nil .AND. ::oRctPrvS:Used()
      ::oRctPrvS:End()
   end

   if ::oAlbCliT <> nil .AND. ::oAlbCliT:Used()
      ::oAlbCliT:End()
   end

   if ::oAlbCliL <> nil .AND. ::oAlbCliL:Used()
      ::oAlbCliL:End()
   end

   if ::oAlbCliS <> nil .AND. ::oAlbCliS:Used()
      ::oAlbCliS:End()
   end

   if ::oFacCliT <> nil .AND. ::oFacCliT:Used()
      ::oFacCliT:End()
   end

   if ::oFacCliL <> nil .AND. ::oFacCliL:Used()
      ::oFacCliL:End()
   end

   if ::oFacCliS <> nil .AND. ::oFacCliS:Used()
      ::oFacClis:End()
   end

   if ::oFacRecT <> nil .AND. ::oFacRecT:Used()
      ::oFacRecT:End()
   end

   if ::oFacRecL <> nil .AND. ::oFacRecL:Used()
      ::oFacRecL:End()
   end

   if ::oFacRecS <> nil .AND. ::oFacRecS:Used()
      ::oFacRecs:End()
   end

   if ::oTikCliT <> nil .AND. ::oTikCliT:Used()
      ::oTikCliT:End()
   end

   if ::oTikCliL <> nil .AND. ::oTikCliL:Used()
      ::oTikCliL:End()
   end

   if ::oTikCliS <> nil .AND. ::oTikCliS:Used()
      ::oTikClis:End()
   end

   if ::oFam <> nil .AND. ::oFam:Used()
      ::oFam:End()
   end

   if ::oTblPro <> nil .AND. ::oTblPro:Used()
      ::oTblPro:End()
   end

   if ::oPro <> nil .AND. ::oPro:Used()
      ::oPro:End()
   end

   if ::oKitArt <> nil .AND. ::oKitArt:Used()
      ::oKitArt:End()
   end

   if ::oDbfDoc <> nil .AND. ::oDbfDoc:Used()
      ::oDbfDoc:End()
   end

   if ::oDbfCount <> nil .AND. ::oDbfCount:Used()
      ::oDbfCount:End()
   end

   if ::oDbfEmp <> nil .AND. ::oDbfEmp:Used()
      ::oDbfEmp:End()
   end

   if ::oHisMov <> nil .AND. ::oHisMov:Used()
      ::oHisMov:End()
   end

   if ::oDetHoras <> nil
      ::oDetHoras:End()
      ::oDetHoras    := nil
   end

   if ::oDetPersonal <> nil
      ::oDetPersonal:End()
      ::oDetPersonal := nil
   end

   if ::oOperario <> nil
      ::oOperario:End()
      ::oOperario    := nil
   end

   if ::oSeccion <> nil
      ::oSeccion:End()
      ::oSeccion     := nil
   end

   if ::oOperacion <> nil
      ::oOperacion:End()
      ::oOperacion   := nil
   end

   if ::oMaquina <> nil
      ::oMaquina:End()
      ::oMaquina     := nil
   end

   if ::oHoras <> nil
      ::oHoras:End()
      ::oHoras       := nil
   end

   if !Empty( ::oStock )
      ::oStock:end()
      ::oStock       := nil
   end

   if !Empty( ::oDbfDiv ) .AND. ::oDbfDiv:Used()
      ::oDbfDiv:End()
   end

   if ::oDbfFilter <> nil .AND. ::oDbfFilter:Used()
      ::oDbfFilter:End()
      ::oDbfFilter   := nil
   end

   ::DestroyTemporal()

   ::oDbfDiv   := nil

   ::oFam      := nil
   ::oTblPro   := nil
   ::oPro      := nil
   ::oKitArt   := nil
   ::oDbfDoc   := nil
   ::oDbfCount := nil
   ::oDbfEmp   := nil
   ::oHisMov   := nil

RETURN ( .T. )



UTILITY STATIC function TProduccion_DefineFiles( cPath, cDriver) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   IIF( cPath == nil, cPath := ::cPath, ) ;
   IIF( cDriver == nil, cDriver := cDriver(), ) ;

   ::oDbf := DbfServer( "ProCab.Dbf", "ProCab" ):New( "ProCab.Dbf", "ProCab", ( cDriver ), "Partes de producción", ( cPath ) )

      ::oDbf:AddField( "cSerOrd", "C", 01, 0,,,,, "Serie", .F.,, .F., {} )
      ::oDbf:AddField( "nNumOrd", "N", 09, 0,,,,, "Número", .F.,, .F., {} )
      ::oDbf:AddField( "cSufOrd", "C", 02, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::oDbf:AddField( "dFecOrd", "D", 08, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::oDbf:AddField( "dFecFin", "D", 08, 0,,,,, "Fecha fin", .F.,, .F., {} )
      ::oDbf:AddField( "cCodDiv", "C", 03, 0,,,,, "Divisa", .F.,, .F., {} )
      ::oDbf:AddField( "nVdvDiv", "N", 16, 6,,,,, "Valor divisa", .F.,, .F., {} )
      ::oDbf:AddField( "cAlmOrd", "C", 03, 0,,,,, "Almacén destino", .F.,, .F., {} )
      ::oDbf:AddField( "cCodSec", "C", 03, 0,,,,, "Sección", .F.,, .F., {} )
      ::oDbf:AddField( "cHorIni", "C", 05, 0, "@R 99:99",,,, "Hora de inicio", .F.,, .F., {} )
      ::oDbf:AddField( "cHorFin", "C", 05, 0, "@R 99:99",,,, "Hora de fin", .F.,, .F., {} )
      ::oDbf:AddField( "cCodOpe", "C", 03, 0,,,,, "Operación", .F.,, .F., {} )
      ::oDbf:AddField( "cAlmOrg", "C", 03, 0,,,,, "Almacen Origen", .F.,, .F., {} )

      ::oDbf:AddIndex( "cNumOrd", "ProCab.Cdx", "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd",,, .F., .F., "Número",,, .T., .F. )
      ::oDbf:AddIndex( "dFecOrd", "ProCab.Cdx", "dFecOrd",,, .F., .F., "Fecha inicio",,, .T., .F. )
      ::oDbf:AddIndex( "cCodOpe", "ProCab.Cdx", "cCodOpe",,, .F., .F., "Operación",,, .T., .F. )
      ::oDbf:AddIndex( "cCodSec", "ProCab.Cdx", "cCodSec",,, .F., .F., "Sección",,, .T., .F. )
      ::oDbf:AddIndex( "cAlmOrd", "ProCab.Cdx", "cAlmOrd",,, .F., .F., "Almacén",,, .T., .F. )



RETURN ( ::oDbf )



UTILITY STATIC function TProduccion_Resource( nMode, aDatosAnterior) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oFld
   local oDlg
   local oBrwMat
   local oBrwMatPri
   local oBrwPer
   local oBrwMaq
   local oGetSer
   local oGetAlm
   local oSayAlm
   local cSayAlm
   local oGetSec
   local oSaySec
   local cSaySec
   local oFntTot              := TFont():New( "Arial", 8, 26, .F., .T. )
   local oHorIni
   local oHorFin
   local oTmpEmp
   local oFecIni
   local oFecFin
   local oGetOpe
   local oSayOpe
   local cSayOpe
   local oAlmOrg
   local oSayOrg
   local cSayOrg
   local oBmpGeneral

   if nMode == 1

      if !Empty( cDefSer() )
         ::oDbf:cSerOrd       := cDefSer()
      else
         ::oDbf:cSerOrd       := "A"
      end

      ::oDbf:cAlmOrd       := oUser():cAlmacen()
      ::oDbf:cCodDiv       := cDivEmp()
      ::oDbf:nVdvDiv       := nChgDiv( cDivEmp() )

      if aDatosAnterior <> nil
         ::oDbf:dFecOrd    := aDatosAnterior[2]
         ::oDbf:dFecFin    := aDatosAnterior[2]
         ::oDbf:cHorIni    := aDatosAnterior[3]
         ::oDbf:cHorFin    := aDatosAnterior[3]
         ::oDbf:cCodSec    := aDatosAnterior[4]
         ::CargaPersonalAnterior( aDatosAnterior )
      else
         ::oDbf:dFecOrd    := GetSysDate()
         ::oDbf:dFecFin    := GetSysDate()
         ::oDbf:cHorIni    := uFieldEmpresa( "cIniJornada" )
         ::oDbf:cHorFin    := SubStr( Time(), 1, 2 ) + SubStr( Time(), 4, 2 )
      end


   end

   ::cOldCodSec            := ::oDbf:cCodSec
   ::cOldCodOpe            := ::oDbf:cCodOpe
   ::dOldFecIni            := ::oDbf:dFecOrd
   ::dOldFecFin            := ::oDbf:dFecFin
   ::cOldHorIni            := ::oDbf:cHorIni
   ::cOldHorFin            := ::oDbf:cHorFin

   ::lTiempoEmpleado()

   ::lLoadDivisa( ::oDbf:cCodDiv )

   cSayOrg                 := RetAlmacen( ::oDbf:cAlmOrg, ::oAlm )
   cSayAlm                 := RetAlmacen( ::oDbf:cAlmOrd, ::oAlm )
   cSaySec                 := oRetFld( ::oDbf:cCodSec, ::oSeccion:oDbf )
   cSayOpe                 := oRetFld( ::oDbf:cCodOpe, ::oOperacion:oDbf )

   oDlg = TDialog():New(,,,, LblTitle( nMode ) + "parte de producción", "Produccion",, .F.,,,,,, .F.,,,,,, .F., )





      oFld := TFolder():ReDefine( 400, {"&Producción", "&Materias primas", "P&ersonal", "Maquinaria"}, { "Produccion_1","Produccion_2","Produccion_3","Produccion_4" }, oDlg,,,,, .F., )









      oGetOpe := TGetHlp():ReDefine( 210, { | u | If( PCount()==0, ::oDbf:cCodOpe, ::oDbf:cCodOpe:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, )

         oGetOpe:bHelp     := {|| ::oOperacion:Buscar( oGetOpe ), ::lRecargaPersonal( , oGetOpe, , , , , oBrwPer, oBrwMaq ) }
         oGetOpe:bValid    := {|| ::oOperacion:Existe( oGetOpe, oSayOpe, "cDesOpe", .T., .T., "0" ), ::lRecargaPersonal( , oGetOpe, , , , , oBrwPer, oBrwMaq ) }




      oSayOpe := TGetHlp():ReDefine( 220, { | u | If( PCount()==0, cSayOpe, cSayOpe:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )









      oBmpGeneral := TBitmap():ReDefine( 990, "partes_producion_48_alpha",, oFld:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "cube_yellow_alpha_48",, oFld:aDialogs[2],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "worker_48_alpha",, oFld:aDialogs[3],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "robot_48_alpha",, oFld:aDialogs[4],,, .F., .F.,,, .F.,,, .T. )







      oAlmOrg := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::oDbf:cAlmOrg, ::oDbf:cAlmOrg:= u ) }, oFld:aDialogs[1],,, {||    ( cAlmacen( oAlmOrg, ::oAlm, oSayOrg ) )},,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,, {|Self|( BrwAlmacen( oAlmOrg, oSayOrg ) )}, nil, "LUPA",, )




      oSayOrg := TGetHlp():ReDefine( 231, { | u | If( PCount()==0, cSayOrg, cSayOrg:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )











      oGetAlm := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::oDbf:cAlmOrd, ::oDbf:cAlmOrd:= u ) }, oFld:aDialogs[1],,, {||    ( cAlmacen( oGetAlm, ::oAlm, oSayAlm ) )},,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,, {|Self|( BrwAlmacen( oGetAlm, oSayAlm ) )}, nil, "LUPA",, )




      oSayAlm := TGetHlp():ReDefine( 151, { | u | If( PCount()==0, cSayAlm, cSayAlm:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )









      oGetSec := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oDbf:cCodSec, ::oDbf:cCodSec:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil, "LUPA",, )

         oGetSec:bHelp     := {|| ::oSeccion:Buscar( oGetSec ), ::lRecargaPersonal( oGetSec, , , , , , oBrwPer, oBrwMaq ) }
         oGetSec:bValid    := {|| ::oSeccion:Existe( oGetSec, oSaySec, "cDesSec", .T., .T., "0" ), ::lRecargaPersonal( oGetSec, , , , , , oBrwPer, oBrwMaq ) }




      oSaySec := TGetHlp():ReDefine( 161, { | u | If( PCount()==0, cSaySec, cSaySec:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )





      ::oDefDiv( 140, 141, 142, oFld:aDialogs[1], nMode )













      oGetSer := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cSerOrd, ::oDbf:cSerOrd:= u ) }, oFld:aDialogs[1],, "@!", {||    ( ::oDbf:cSerOrd >= "A" .AND. ::oDbf:cSerOrd <= "Z" )},,,,,, .F., {||     ( nMode == 1 .OR. nMode == 4 )},, .F., .T., {||    ( UpSerie( oGetSer ) )}, {||  ( DwSerie( oGetSer ) )},,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:nNumOrd, ::oDbf:nNumOrd:= u ) }, oFld:aDialogs[1],, "999999999",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oDbf:cSufOrd, ::oDbf:cSufOrd:= u ) }, oFld:aDialogs[1],, "@!",,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )









      oFecIni := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oDbf:dFecOrd, ::oDbf:dFecOrd:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||         ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )

      oFecIni:bValid    := {|| ::lTiempoEmpleado( oTmpEmp ), ::lRecargaPersonal( , , oFecIni, , , , oBrwPer, oBrwMaq ) }
      oFecIni:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }





      oFecFin := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, ::oDbf:dFecFin, ::oDbf:dFecFin:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||         ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )

      oFecFin:bValid    := {|| ::lTiempoEmpleado( oTmpEmp ), ::lRecargaPersonal( , , , oFecFin, , , oBrwPer, oBrwMaq ) }
      oFecFin:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }













      oHorIni := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, ::oDbf:cHorIni, ::oDbf:cHorIni:= u ) }, oFld:aDialogs[1],, "@R 99:99",,,,,,, .F., {||     ( nMode <> 3 )},, .F., .T., {||    ( UpTime( oHorIni ) )}, {||  ( DwTime( oHorIni ) )},,,, nil,,, )

         oHorIni:bValid    := {|| if( ValidTime( oHorIni ), ::lTiempoEmpleado( oTmpEmp ), .F. ), ::lRecargaPersonal( , , , , oHorIni, , oBrwPer, oBrwMaq ) }
         oHorIni:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }









      oHorFin := TGetHlp():ReDefine( 180, { | u | If( PCount()==0, ::oDbf:cHorFin, ::oDbf:cHorFin:= u ) }, oFld:aDialogs[1],, "@R 99:99",,,,,,, .F., {||     ( nMode <> 3 )},, .F., .T., {||    ( UpTime( oHorFin ) )}, {||  ( DwTime( oHorFin ) )},,,, nil,,, )

         oHorFin:bValid    := {|| if( ValidTime( oHorFin ), ::lTiempoEmpleado( oTmpEmp ), .F. ), ::lRecargaPersonal( , , , , , oHorFin , oBrwPer, oBrwMaq ) }
         oHorFin:bChange   := {|| ::lTiempoEmpleado( oTmpEmp ) }





      oTmpEmp := TGetHlp():ReDefine( 190, { | u | If( PCount()==0, ::cTmpEmp, ::cTmpEmp:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )









        TButton():ReDefine( 500, {||( ::oDetProduccion:Append( oBrwMat ), ::oTotProducido:Refresh(), oBrwMat:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetProduccion:Edit( oBrwMat ), ::oTotProducido:Refresh(), oBrwMat:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetProduccion:Zoom(), oBrwMat:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[1],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetProduccion:Del( oBrwMat, oBrwMatPri ) )}, oFld:aDialogs[1],,, .F., {||     ( nMode <> 3 )},,, .F. )





      oBrwMat                 := IXBrowse():New( oFld:aDialogs[1] )

      oBrwMat:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwMat:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwMat:SetoDbf( ::oDetProduccion:oDbfVir )

      oBrwMat:nMarqueeStyle   := 6
      oBrwMat:cName           := "Lineas de partes de producción"

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Número"
         :bStrData         := {|| Trans( ::oDetProduccion:oDbfVir:nNumLin, "9999" ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Código"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:cCodArt }
         :nWidth           := 80
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Nombre"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:cNomArt }
         :nWidth           := 400
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Almacén"
         :bStrData         := {|| ::oDetProduccion:oDbfVir:cAlmOrd }
         :nWidth           := 55
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Total unidades"
         :bStrData         := {|| ::oDetProduccion:cTotUnidades( ::oDetProduccion:oDbfVir ) }
         :nWidth           := 82
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Precio"
         :bStrData         := {|| Trans( ::oDetProduccion:oDbfVir:nImpOrd, ::cPouDiv ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMat:AddCol() )
         :cHeader          := "Total"
         :bStrData         := {|| ::oDetProduccion:cTotPrecio( ::oDetProduccion:oDbfVir ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      oBrwMat:CreateFromResource( 200 )

      if nMode <> 3
         oBrwMat:bLDblClick   := {|| ::oDetProduccion:Edit( oBrwMat ), ::oTotProducido:Refresh(), oBrwMat:Refresh(), oBrwMatPri:Refresh() }
      else
         oBrwMat:bLDblClick   := {|| ::oDetProduccion:Zoom(), oBrwMat:Refresh(), oBrwMatPri:Refresh() }
      end









      TButton():ReDefine( 500, {||( ::oDetMaterial:Append( oBrwMatPri ), ::oTotMaterias:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetMaterial:Edit( oBrwMatPri ), ::oTotMaterias:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetMaterial:Zoom(), oBrwMatPri:Refresh() )}, oFld:aDialogs[2],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetMaterial:Del( oBrwMatPri ), ::oTotMaterias:Refresh(), oBrwMatPri:Refresh() )}, oFld:aDialogs[2],,, .F., {||     ( nMode <> 3 )},,, .F. )

      oBrwMatPri                 := IXBrowse():New( oFld:aDialogs[ 2 ] )

      oBrwMatPri:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwMatPri:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwMatPri:SetoDbf( ::oDetMaterial:oDbfVir )

      oBrwMatPri:nMarqueeStyle   := 6
      oBrwMatPri:cName           := "Materias primas produccion"

      oBrwMatPri:bLDblClick      := { || ::oDetMaterial:Edit( oBrwMatPri ), ::oTotMaterias:Refresh() }

      oBrwMatPri:CreateFromResource( 200 )

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Número"
         :bStrData         := {|| Trans( ::oDetMaterial:oDbfVir:FieldGetByName( "nNumLin" ), "9999" ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Código"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cCodArt" ) }
         :nWidth           := 85
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Nombre"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cNomArt" ) }
         :nWidth           := 395
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Almacén"
         :bStrData         := {|| ::oDetMaterial:oDbfVir:FieldGetByName( "cAlmOrd" ) }
         :nWidth           := 60
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Total unidades"
         :bStrData         := {|| ::oDetMaterial:cTotUnidades( ::oDetMaterial:oDbfVir ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Precio"
         :bStrData         := {|| Trans( ::oDetMaterial:oDbfVir:nImpOrd, ::cPouDiv ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwMatPri:AddCol() )
         :cHeader          := "Total"
         :bStrData         := {|| ::oDetMaterial:cTotPrecio( ::oDetMaterial:oDbfVir ) }
         :nWidth           := 85
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end









      TButton():ReDefine( 500, {||( ::oDetPersonal:Append( oBrwPer ), ::oTotPersonal:Refresh(), oBrwPer:Refresh() )}, oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )





        TButton():ReDefine( 501, {||( ::oDetPersonal:Edit( oBrwPer ), ::oTotPersonal:Refresh(), oBrwPer:Refresh() )}, oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 502, {||( ::oDetPersonal:Zoom(), oBrwPer:Refresh() )}, oFld:aDialogs[3],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetPersonal:Del( oBrwPer ), ::oTotPersonal:Refresh(), oBrwPer:Refresh() )}, oFld:aDialogs[3],,, .F., {||     ( nMode <> 3 )},,, .F. )

      oBrwPer                 := TXBrowse():New( oFld:aDialogs[3] )

      oBrwPer:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwPer:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwPer:SetoDbf( ::oDetPersonal:oDbfVir )

      oBrwPer:nMarqueeStyle   := 5

      oBrwPer:bLDblClick      := { || ::oDetPersonal:Edit( oBrwPer ), ::oTotPersonal:Refresh() }

      oBrwPer:CreateFromResource( 200 )

      with object ( oBrwPer:AddCol() )
         :cHeader          := "Personal"
         :bStrData         := {|| Rtrim( ::oDetPersonal:oDbfVir:cCodTra ) + " - " + oRetFld( ::oDetPersonal:oDbfVir:cCodTra, ::oOperario:oDbf ) }
         :nWidth           := 325
      end

      with object ( oBrwPer:AddCol() )
         :cHeader          := "Operación"
         :bStrData         := {|| ::oDetPersonal:oDbfVir:cCodOpe + " - " + oRetFld( ::oDetPersonal:oDbfVir:cCodOpe, ::oOperacion:oDbf ) }
         :nWidth           := 325
      end

      with object ( oBrwPer:AddCol() )
         :cHeader          := "Tiempo empleado"
         :bStrData         := {|| cTiempo( ::oDetPersonal:oDbfVir:dFecIni, ::oDetPersonal:oDbfVir:dFecFin, ::oDetPersonal:oDbfVir:cHorIni, ::oDetPersonal:oDbfVir:cHorFin ) }
         :nWidth           := 110
      end

      with object ( oBrwPer:AddCol() )
         :cHeader          := "Total"
         :bStrData         := {|| ::oDetPersonal:cTotal( ::oDetPersonal:oDbfVir:cCodTra, ::oDetHorasPersonal:oDbfVir ) }
         :nWidth           := 90
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end









      TButton():ReDefine( 500, {||( ::oDetMaquina:Append( oBrwMaq ), ::oTotMaquinaria:Refresh(), oBrwMaq:Refresh() )}, oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )





      TButton():ReDefine( 501, {||( ::oDetMaquina:Edit( oBrwMaq ), ::oTotMaquinaria:Refresh(), oBrwMaq:Refresh() )}, oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )




      TButton():ReDefine( 502, {||( ::oDetMaquina:Zoom() )}, oFld:aDialogs[4],,, .F.,,,, .F. )





      TButton():ReDefine( 503, {||( ::oDetMaquina:Del( oBrwMaq ), ::oTotMaquinaria:Refresh() )}, oFld:aDialogs[4],,, .F., {||     ( nMode <> 3 )},,, .F. )

      oBrwMaq                 := TXBrowse():New( oFld:aDialogs[4] )

      oBrwMaq:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwMaq:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwMaq:SetoDbf( ::oDetMaquina:oDbfVir )

      oBrwMaq:nMarqueeStyle   := 5

      oBrwMaq:bLDblClick      := { || ::oDetMaquina:Edit( oBrwPer ), ::oTotMaquinaria:Refresh() }

      oBrwMaq:CreateFromResource( 200 )

      with object ( oBrwMaq:AddCol() )
         :cHeader             := "Maquina"
         :bStrData            := {|| Rtrim( ::oDetMaquina:oDbfVir:cCodMaq ) + " - " + oRetFld( ::oDetMaquina:oDbfVir:cCodMaq, ::oMaquina:oDbf ) }
         :nWidth              := 645
      end

      with object ( oBrwMaq:AddCol() )
         :cHeader             := "Tiempo empleado"
         :bStrData            := {|| cTiempo( ::oDetMaquina:oDbfVir:dFecIni, ::oDetMaquina:oDbfVir:dFecFin, ::oDetMaquina:oDbfVir:cIniMaq, ::oDetMaquina:oDbfVir:cFinMaq ) }
         :nWidth              := 120
      end

      with object ( oBrwMaq:AddCol() )
         :cHeader             := "Total"
         :bStrData            := {|| Trans( ::oDetMaquina:nTotCosto( ::oDetMaquina:oDbfVir ), ::cPorDiv ) }
         :nWidth              := 90
         :nDataStrAlign       := 1
         :nHeadStrAlign       := 1
      end





      ::oTotProducido := TSay():ReDefine( 810, {|| ::oDetProduccion:cTotal( ::oDetProduccion:oDbfVir )}, oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )
      ::oTotMaterias := TSay():ReDefine( 811, {|| ::oDetMaterial:cTotal( ::oDetMaterial:oDbfVir )}, oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )
      ::oTotPersonal := TSay():ReDefine( 812, {|| ::oDetPersonal:nTotalTra( ::oDetPersonal:oDbfVir, ::oDetHorasPersonal:oDbfVir )}, oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )
      ::oTotMaquinaria := TSay():ReDefine( 813, {|| ::oDetMaquina:nTotal( ::oDetMaquina:oDbfVir )}, oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TButton():ReDefine( 1, {||( ::lPreSave( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode, oDlg ) )}, oDlg,,, .F., {||         ( nMode <> 3 )},,, .F. )




        TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 559, {||( MsgInfo( "Ayuda no definida", "Perdonen las molestias") )}, oDlg,,, .F.,,,, .F. )

      if nMode <> 3
      oFld:aDialogs[1]:AddFastKey( 113, {|| ::oDetProduccion:Append( oBrwMat ), ::oTotProducido:Refresh() } )
      oFld:aDialogs[1]:AddFastKey( 114, {|| ::oDetProduccion:Edit( oBrwMat ), ::oTotProducido:Refresh() } )
      oFld:aDialogs[1]:AddFastKey( 115, {|| ::oDetProduccion:Del( oBrwMat, oBrwMatPri ) } )
      oFld:aDialogs[2]:AddFastKey( 113, {|| ::oDetMaterial:Append( oBrwMatPri ), ::oTotMaterias:Refresh() } )
      oFld:aDialogs[2]:AddFastKey( 114, {|| ::oDetMaterial:Edit( oBrwMatPri ), ::oTotMaterias:Refresh() } )
      oFld:aDialogs[2]:AddFastKey( 115, {|| ::oDetMaterial:Del( oBrwMatPri ), ::oTotMaterias:Refresh() } )
      oFld:aDialogs[3]:AddFastKey( 113, {|| ::oDetPersonal:Append( oBrwPer ), ::oTotPersonal:Refresh() } )
      oFld:aDialogs[3]:AddFastKey( 114, {|| ::oDetPersonal:Edit( oBrwPer ), ::oTotPersonal:Refresh() } )
      oFld:aDialogs[3]:AddFastKey( 115, {|| ::oDetPersonal:Del( oBrwPer ), ::oTotPersonal:Refresh() } )
      oFld:aDialogs[4]:AddFastKey( 113, {|| ::oDetMaquina:Append( oBrwMaq ), ::oTotMaquinaria:Refresh() } )
      oFld:aDialogs[4]:AddFastKey( 114, {|| ::oDetMaquina:Edit( oBrwMaq ), ::oTotMaquinaria:Refresh() } )
      oFld:aDialogs[4]:AddFastKey( 115, {|| ::oDetMaquina:Del( oBrwMaq ), ::oTotMaquinaria:Refresh() } )
      oDlg:AddFastKey( 116, {|| ::lPreSave( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode, oDlg ) } )
      end

      oDlg:bStart := { || oBrwMat:Load(), oBrwMatPri:Load(), oFecIni:SetFocus() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   oFntTot:End()
   oBmpGeneral:End()

   oBrwMat:CloseData()
   oBrwMatPri:CloseData()

RETURN ( oDlg:nResult == 1 )



UTILITY STATIC function TProduccion_lPreSave( oGetAlm, oGetSec, oGetOpe, oHorFin, nMode, oDlg) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if Empty( ::oDbf:cAlmOrd )
      MsgStop( "Tiene que seleccionar un almacén." )
      oGetAlm:SetFocus()
      Return nil
   end

   if Empty( ::oDbf:cCodSec )
      MsgStop( "Tiene que seleccionar una sección." )
      oGetSec:SetFocus()
      Return nil
   end

   if Empty( ::oDbf:cCodOpe )
      MsgStop( "Tiene que seleccionar una operación." )
      oGetOpe:SetFocus()
      Return nil
   end

   if ::oDbf:dFecFin < ::oDbf:dFecOrd
      MsgStop( "La fecha de fin no puede ser menor que la fecha de inicio." )
      oHorFin:SetFocus()
      Return nil
   end

   oDlg:End( 1 )

Return ( .T. )



UTILITY STATIC function TProduccion_LoaArticulo( oGetArticulo, oGetNombre) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local cCodArt  := oGetArticulo:VarGet()

   if Empty( cCodArt )

      if lRetCodArt()
         MsgStop( "No se pueden añadir lineas sin codificar" )
         return .F.
      end

      return .T.

   else





      ::oArt:ordSetFocus( "CodeBar" )

      if ::oArt:Seek( cCodArt )
         cCodArt  := ::oArt:Codigo
      end

      ::oArt:ordSetFocus( "Codigo" )





      if ::oArt:Seek( cCodArt ) .OR. ::oArt:Seek( Upper( cCodArt ) )

         cCodArt  := ::oArt:Codigo

         oGetNombre:cText( ::oArt:Nombre )

         if ::oArt:nCajEnt <> 0
            ::oDbf:nCajArt := ::oArt:nCajEnt
         end

         if ::oArt:nUniCaja <> 0
            ::oDbf:nUndArt := ::oArt:nUniCaja
         end

         return .T.

      else

         MsgStop( "Artículo no encontrado" )
         return .F.

      end

   end

RETURN .T.



UTILITY STATIC function TProduccion_GetNewCount() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::oDbf:nNumOrd    := nNewDoc( ::oDbf:cSerOrd, ::oDbf:nArea, "nParPrd" )

RETURN ( .T. )



UTILITY STATIC function TProduccion_lTiempoEmpleado( oTmpEmp) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cTiempoEmpleado    := nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
   ::cTmpEmp            := cFormatoDDHHMM( ::cTiempoEmpleado )

   if oTmpEmp <> nil
      oTmpEmp:cText( ::cTmpEmp )
      oTmpEmp:Refresh()
   end

RETURN .T.



UTILITY STATIC function TProduccion_lRecargaPersonal( oCodSec, oCodOpe, oFecIni, oFecFin, oHorIni, oHorFin, oBrwPer, oBrwMaq) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nOrdAnt     := ::oOperario:oDbf:OrdSetFocus( "cCodSec" )
   local nOrdAntHora := ::oDetHoras:oDbf:OrdSetFocus( "cCodTra" )
   local nOrdAntMaq  := ::oMaquina:oDbf:OrdSetFocus( "cCodSec" )
   local cCodSec     := ""
   local cCodOpe     := ""
   local dFecIni     := Ctod( "" )
   local dFecFin     := Ctod( "" )
   local cHorIni     := ""
   local cHorFin     := ""





   if oCodSec <> nil
      cCodSec        := oCodSec:VarGet()
   end

   if oCodOpe <> nil
      cCodOpe        := oCodOpe:VarGet()
   end

   if oFecIni <> nil
      dFecIni        := oFecIni:VarGet()
   end

   if oFecFin <> nil
      dFecFin        := oFecFin:VarGet()
   end

   if oHorIni <> nil
      cHorIni        := oHorIni:VarGet()
   end

   if oHorFin <> nil
      cHorFin        := oHorFin:VarGet()
   end



   if !Empty( cCodSec ) .AND. ::cOldCodSec <> cCodSec





      ::oDetPersonal:oDbfVir:Zap()
      ::oDetHorasPersonal:oDbfVir:Zap()
      ::oDetMaquina:oDbfVir:Zap()





      if ::oOperario:oDbf:Seek( ::oDbf:cCodSec )

         while ::oOperario:oDbf:cCodSec == ::oDbf:cCodSec .AND. !::oOperario:oDbf:Eof()

            ::oDetPersonal:oDbfVir:Append()

            ::oDetPersonal:oDbfVir:cCodTra      := ::oOperario:oDbf:cCodTra
            ::oDetPersonal:oDbfVir:cCodSec      := ::oDbf:cCodSec
            ::oDetPersonal:oDbfVir:cCodOpe      := ::oDbf:cCodOpe
            ::oDetPersonal:oDbfVir:dFecIni      := ::oDbf:dFecOrd
            ::oDetPersonal:oDbfVir:dFecFin      := ::oDbf:dFecFin
            ::oDetPersonal:oDbfVir:cHorIni      := ::oDbf:cHorIni
            ::oDetPersonal:oDbfVir:cHorFin      := ::oDbf:cHorFin

            ::oDetPersonal:oDbfVir:Save()

            ::oDetHoras:oDbf:GoTop()

            if ::oDetHoras:oDbf:Seek( ::oOperario:oDbf:cCodTra )

               while ::oDetHoras:oDbf:cCodTra == ::oOperario:oDbf:cCodTra .AND. !::oDetHoras:oDbf:Eof()

                  if ::oDetHoras:oDbf:lDefHor

                     ::oDetHorasPersonal:oDbfVir:Append()

                     ::oDetHorasPersonal:oDbfVir:cCodTra := ::oOperario:oDbf:cCodTra
                     ::oDetHorasPersonal:oDbfVir:cCodHra := ::oDetHoras:oDbf:cCodHra
                     ::oDetHorasPersonal:oDbfVir:nCosHra := ::oDetHoras:oDbf:nCosHra
                     ::oDetHorasPersonal:oDbfVir:nNumHra := ::cTiempoEmpleado

                     ::oDetHorasPersonal:oDbfVir:Save()

                  end

                  ::oDetHoras:oDbf:Skip()

               end

            end

            ::oOperario:oDbf:Skip()

         end

      end





      if ::oMaquina:oDbf:Seek( ::oDbf:cCodSec )

         while ::oMaquina:oDbf:cCodSec == ::oDbf:cCodSec .AND. !::oMaquina:oDbf:Eof()

            ::oDetMaquina:oDbfVir:Append()

            ::oDetMaquina:oDbfVir:cCodSec   := ::oDbf:cCodSec
            ::oDetMaquina:oDbfVir:cCodMaq   := ::oMaquina:oDbf:cCodMaq
            ::oDetMaquina:oDbfVir:dFecIni   := ::oDbf:dFecOrd
            ::oDetMaquina:oDbfVir:dFecFin   := ::oDbf:dFecFin
            ::oDetMaquina:oDbfVir:cIniMaq   := ::oDbf:cHorIni
            ::oDetMaquina:oDbfVir:cFinMaq   := ::oDbf:cHorFin
            ::oDetMaquina:oDbfVir:nCosHra   := ::oMaquina:nTotalCosteHora( ::oMaquina:oDbf:cCodMaq )
            ::oDetMaquina:oDbfVir:nTotHra   := ::cTiempoEmpleado

            ::oDetMaquina:oDbfVir:Save()

            ::oMaquina:oDbf:Skip()

         end

      end

      ::cOldCodSec   := cCodSec

   end



   if !Empty( cCodOpe ) .AND. ::cOldCodOpe <> cCodOpe

      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()

         ::oDetPersonal:oDbfVir:Load()
         ::oDetPersonal:oDbfVir:cCodOpe   := cCodOpe
         ::oDetPersonal:oDbfVir:Save()
         ::oDetPersonal:oDbfVir:Skip()

      end

      ::cOldCodOpe   := cCodOpe

   end



   if !Empty( dFecIni ) .AND. ::dOldFecIni <> dFecIni



      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()

         ::oDetPersonal:oDbfVir:Load()
         ::oDetPersonal:oDbfVir:dFecIni      := dFecIni
         ::oDetPersonal:oDbfVir:Save()
         ::oDetPersonal:oDbfVir:Skip()

      end



      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()

         ::oDetHorasPersonal:oDbfVir:Load()
         ::oDetHorasPersonal:oDbfVir:nNumHra := ::cTiempoEmpleado
         ::oDetHorasPersonal:oDbfVir:Save()
         ::oDetHorasPersonal:oDbfVir:Skip()

      end




      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()

         ::oDetMaquina:oDbfVir:Load()
         ::oDetMaquina:oDbfVir:dFecIni       := dFecIni
         ::oDetMaquina:oDbfVir:nTotHra       := ::cTiempoEmpleado
         ::oDetMaquina:oDbfVir:Save()
         ::oDetMaquina:oDbfVir:Skip()

      end

      ::dOldFecIni   := dFecIni

   end



   if !Empty( dFecFin ) .AND. ::dOldFecFin <> dFecFin



      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()

         ::oDetPersonal:oDbfVir:Load()
         ::oDetPersonal:oDbfVir:dFecFin      := dFecFin
         ::oDetPersonal:oDbfVir:Save()
         ::oDetPersonal:oDbfVir:Skip()

      end



      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()

         ::oDetHorasPersonal:oDbfVir:Load()
         ::oDetHorasPersonal:oDbfVir:nNumHra := ::cTiempoEmpleado
         ::oDetHorasPersonal:oDbfVir:Save()
         ::oDetHorasPersonal:oDbfVir:Skip()

      end



      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()

         ::oDetMaquina:oDbfVir:Load()
         ::oDetMaquina:oDbfVir:dFecFin       := dFecFin
         ::oDetMaquina:oDbfVir:nTotHra       := ::cTiempoEmpleado
         ::oDetMaquina:oDbfVir:Save()
         ::oDetMaquina:oDbfVir:Skip()

      end

      ::dOldFecFin   := dFecFin

   end



   if !Empty( cHorIni ) .AND. ::cOldHorIni <> cHorIni



      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()

         ::oDetPersonal:oDbfVir:Load()
         ::oDetPersonal:oDbfVir:cHorIni      := cHorIni
         ::oDetPersonal:oDbfVir:Save()
         ::oDetPersonal:oDbfVir:Skip()

      end



      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()

         ::oDetHorasPersonal:oDbfVir:Load()
         ::oDetHorasPersonal:oDbfVir:nNumHra := ::cTiempoEmpleado
         ::oDetHorasPersonal:oDbfVir:Save()
         ::oDetHorasPersonal:oDbfVir:Skip()

      end



      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()

         ::oDetMaquina:oDbfVir:Load()
         ::oDetMaquina:oDbfVir:cIniMaq       := cHorIni
         ::oDetMaquina:oDbfVir:nTotHra       := ::cTiempoEmpleado
         ::oDetMaquina:oDbfVir:Save()
         ::oDetMaquina:oDbfVir:Skip()

      end

      ::cOldHorIni   := cHorIni

   end



   if !Empty( cHorFin ) .AND. ::cOldHorFin <> cHorFin



      ::oDetPersonal:oDbfVir:GoTop()

      while !::oDetPersonal:oDbfVir:Eof()

         ::oDetPersonal:oDbfVir:Load()
         ::oDetPersonal:oDbfVir:cHorFin         := cHorFin
         ::oDetPersonal:oDbfVir:Save()
         ::oDetPersonal:oDbfVir:Skip()

      end



      ::oDetHorasPersonal:oDbfVir:GoTop()

      while !::oDetHorasPersonal:oDbfVir:Eof()

         ::oDetHorasPersonal:oDbfVir:Load()
         ::oDetHorasPersonal:oDbfVir:nNumHra    := ::cTiempoEmpleado
         ::oDetHorasPersonal:oDbfVir:Save()
         ::oDetHorasPersonal:oDbfVir:Skip()

      end



      ::oDetMaquina:oDbfVir:GoTop()

      while !::oDetMaquina:oDbfVir:Eof()

         ::oDetMaquina:oDbfVir:Load()
         ::oDetMaquina:oDbfVir:cFinMaq          := cHorFin
         ::oDetMaquina:oDbfVir:nTotHra          := ::cTiempoEmpleado
         ::oDetMaquina:oDbfVir:Save()
         ::oDetMaquina:oDbfVir:Skip()

      end

      ::cOldHorFin   := cHorFin

   end

   ::oDetHoras:oDbf:OrdSetFocus( nOrdAntHora )
   ::oOperario:oDbf:OrdSetFocus( nOrdAnt )
   ::oMaquina:oDbf:OrdSetFocus( nOrdAntMaq )

   ::oDetPersonal:oDbfVir:GoTop()
   ::oDetHorasPersonal:oDbfVir:GoTop()
   ::oDetMaquina:oDbfVir:GoTop()

   ::oTotPersonal:Refresh()
   ::oTotMaquinaria:Refresh()

   if !Empty( oBrwPer )
      oBrwPer:Refresh()
   end

   if !Empty( oBrwMaq )
      oBrwMaq:Refresh()
   end

RETURN .T.



Function aDocPro()

   local aDoc        := {}

   aAdd( aDoc, { "Empresa",         "EM" } )
   aAdd( aDoc, { "Producción",      "PO" } )
   aAdd( aDoc, { "Almacen",         "AL" } )

RETURN ( aDoc )



UTILITY STATIC function TProduccion_GenParte( nDevice, cCaption, cCodDoc, cPrinter, nCopies) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oInf
   local oDevice
   local cNumeroParte

   IIF( nDevice == nil, nDevice := 1, ) ;
   IIF( cCaption == nil, cCaption := "Imprimiendo parte de producción", ) ;
   IIF( cCodDoc == nil, cCodDoc := cFormatoDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ), ) ;
   IIF( nCopies == nil, nCopies := nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ), ) ;

   if ::oDbf:Lastrec() == 0
      Return nil
   end

   if Empty( cCodDoc )
      cCodDoc           := if( ::oDbf:cSerOrd == "A", "PO1", "PO2" )
   end

   if !lExisteDocumento( cCodDoc, ::oDbfDoc:cAlias )
      return nil
   end

   cNumeroParte            := ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd

   ::CreateTemporal( cNumeroParte )

   ::oDbf:GetStatus( .T. )

   ::oDbf:Seek( cNumeroParte )

   if lVisualDocumento( cCodDoc, ::oDbfDoc:cAlias )

      public cTiempoEmp    := cTiempo( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
      public nProd         := nTotProd( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias )
      public nMat          := nTotMat( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaterial:oDbf:cAlias )
      public nPer          := nTotPer( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetHorasPersonal:oDbf:cAlias )
      public nMaq          := nTotMaq( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaquina:oDbf:cAlias )
      public nParte        := nTotParte( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias, ::oDetMaterial:oDbf:cAlias, ::oDetHorasPersonal:oDbf:cAlias, ::oDetMaquina:oDbf:cAlias )

      ::PrintReportProducc( nDevice, nCopies, cPrinter, ::oDbfDoc:cAlias )

   else

      private oDbf            := ::oDbf
      private cDbf            := ::oDbf:cAlias
      private oDbfCol         := ::oDbfTemporal
      private cDbfCol         := ::oDbfTemporal:cAlias
      private oThis           := Self
      private oDbfAlm         := ::oAlm
      private cDbfAlm         := ::oAlm:cAlias
      private oDbfSec         := ::oSeccion:oDbf
      private cDbfSec         := ::oSeccion:oDbf:cAlias
      private cPouDivPro      := ::cPouDiv
      private cDetPro         := ::oDetProduccion:oDbf:cAlias
      private cDetMat         := ::oDetMaterial:oDbf:cAlias
      private cDetHPer        := ::oDetHorasPersonal:oDbf:cAlias
      private cDetMaq         := ::oDetMaquina:oDbf:cAlias

      if !Empty( cPrinter )
         oDevice              := TPrinter():New( cCaption, .F., .T., cPrinter )
         oInf := RptBegin({}, {}, {}, {}, {}, .F.,,,, .F.,, oDevice, cCaption,,, )
      else
         oInf := RptBegin({}, {}, {}, {}, {}, .F.,,,, .T.,,, cCaption,,, )
      end

      if !Empty( oInf ) .AND. oInf:lCreated

         oInf:lAutoland       := .F.
         oInf:lFinish         := .F.
         oInf:lNoCancel       := .T.
         oInf:bSkip           := {|| ::oDbfTemporal:Skip() }

         oInf:oDevice:lPrvModal  := .T.

         do case
            case nDevice == 1
               oInf:bPreview  := {| oDevice | PrintPreview( oDevice ) }

            case nDevice == 3
               oInf:bPreview  := {| oDevice | PrintPdf( oDevice ) }

         end

         SetMargin(  cCodDoc, oInf )
         PrintColum( cCodDoc, oInf )

      end

      RptAddGroup( {|| Self:oDbfTemporal:cTipo }, {|| cNombreTipo( oInf:aGroups[1]:cValue ) }, {|| "" }, , .F. )

      RptEnd()

      if !Empty( oInf )



         oInf:Activate(, {||       ( !::oDbfTemporal:Eof() )},,,, {||  ::EPage( oInf, cCodDoc )},,,,,,,, )

            if nDevice == 1
               oInf:oDevice:end()
            end

      end

      oInf  := nil

   end

   ::oDbfTemporal:Zap()

   ::oDbf:SetStatus()

RETURN ( NIL )



UTILITY STATIC function TProduccion_EPage( oInf, cCodDoc) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

    private nPagina        := oInf:nPage
    private lEnd            := oInf:lFinish

   PrintItems( cCodDoc, oInf )

RETURN ( Self )



UTILITY STATIC function TProduccion_lGenParte( oBrw, oBtn, nDevice) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local bAction

   IIF( nDevice == nil, nDevice := 1, ) ;

   if !::oDbfDoc:Seek( "PO" )








      ::oWndBrw:NewAt( "DOCUMENT",,, {||( msgStop( "No hay documentos predefinidos" ) )}, "No hay documentos", "N",,, 4, oBtn, .F. )

   else

      while ::oDbfDoc:cTipo == "PO" .AND. !::oDbfDoc:eof()

         bAction  := ::bGenParte( nDevice, "Imprimiendo parte de producción", ::oDbfDoc:Codigo )

         ::oWndBrw:NewAt( "Document", , , bAction, Rtrim( ::oDbfDoc:cDescrip ) , , , , , oBtn )

         ::oDbfDoc:Skip()

      end

   end

RETURN nil



UTILITY STATIC function TProduccion_bGenParte( nDevice, cTitle, cCodDoc) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local bGen
   local nDev        := by( nDevice )
   local cTit        := by( cTitle    )
   local cCod        := by( cCodDoc   )

   bGen              := {|| ::GenParte( nDev, cTit, cCod ) }

RETURN ( bGen )



UTILITY STATIC function TProduccion_CreateTemporal( cNumeroParte) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nOrdPR      := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )
   local nOrdMP      := ::oDetMaterial:oDbf:OrdSetFocus( "cNumOrd" )
   local nOrdOP      := ::oDetPersonal:oDbf:OrdSetFocus( "cNumOrd" )
   local nOrdMQ      := ::oDetMaquina:oDbf:OrdSetFocus( "cNumOrd" )





   ::oDetProduccion:oDbf:GoTop()

   if ::oDetProduccion:oDbf:Seek( cNumeroParte )

      while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd == cNumeroParte .AND. !::oDetProduccion:oDbf:Eof()

      ::oDbfTemporal:Append()

      ::oDbfTemporal:cSerOrd     := ::oDbf:cSerOrd
      ::oDbfTemporal:nNumOrd     := ::oDbf:nNumOrd
      ::oDbfTemporal:cSufOrd     := ::oDbf:cSufOrd
      ::oDbfTemporal:cTipo       := "PR"
      ::oDbfTemporal:cCodigo     := ::oDetProduccion:oDbf:cCodArt
      ::oDbfTemporal:cNombre     := ::oDetProduccion:oDbf:cNomArt
      ::oDbfTemporal:cTxtSer     := SerialDescrip( ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd + Str( ::oDetProduccion:oDbf:nNumLin ), ::oDetSeriesProduccion:oDbf:cAlias )
      ::oDbfTemporal:cCodAlm     := ::oDetProduccion:oDbf:cAlmOrd
      ::oDbfTemporal:cCodSec     := Space(3)
      ::oDbfTemporal:cCodOpe     := Space(3)
      ::oDbfTemporal:dFecIni     := ::oDbf:dFecOrd
      ::oDbfTemporal:dFecFin     := ::oDbf:dFecFin
      ::oDbfTemporal:cHorIni     := ::oDbf:cHorIni
      ::oDbfTemporal:cHorFin     := ::oDbf:cHorFin
      ::oDbfTemporal:nCajas      := ::oDetProduccion:oDbf:nCajOrd
      ::oDbfTemporal:nUnidades   := ::oDetProduccion:oDbf:nUndOrd
      ::oDbfTemporal:nUndHra     := ::oDetProduccion:oDbf:nCajOrd * ::oDetProduccion:oDbf:nUndOrd
      ::oDbfTemporal:nImporte    := ::oDetProduccion:oDbf:nImpOrd
      ::oDbfTemporal:nTotLin     := ::oDbfTemporal:nUndHra * ::oDbfTemporal:nImporte
      ::oDbfTemporal:nPeso       := ::oDetProduccion:oDbf:nPeso
      ::oDbfTemporal:cUndPes     := ::oDetProduccion:oDbf:cUndPes
      ::oDbfTemporal:nVolumen    := ::oDetProduccion:oDbf:nVolumen
      ::oDbfTemporal:cUndVol     := ::oDetProduccion:oDbf:cUndVol
      ::oDbfTemporal:cCodPr1     := ::oDetProduccion:oDbf:cCodPr1
      ::oDbfTemporal:cCodPr2     := ::oDetProduccion:oDbf:cCodPr2
      ::oDbfTemporal:cValPr1     := ::oDetProduccion:oDbf:cValPr1
      ::oDbfTemporal:cValPr2     := ::oDetProduccion:oDbf:cValPr2
      ::oDbfTemporal:lLote       := ::oDetProduccion:oDbf:lLote
      ::oDbfTemporal:cLote       := ::oDetProduccion:oDbf:cLote

      ::oDbfTemporal:Save()

      ::oDetProduccion:oDbf:Skip()

      end

   end





   ::oDetMaterial:oDbf:GoTop()

   if ::oDetMaterial:oDbf:Seek( cNumeroParte )

      while ::oDetMaterial:oDbf:cSerOrd + Str( ::oDetMaterial:oDbf:nNumOrd ) + ::oDetMaterial:oDbf:cSufOrd == cNumeroParte .AND. !::oDetMaterial:oDbf:Eof()

      ::oDbfTemporal:Append()

      ::oDbfTemporal:cSerOrd     := ::oDbf:cSerOrd
      ::oDbfTemporal:nNumOrd     := ::oDbf:nNumOrd
      ::oDbfTemporal:cSufOrd     := ::oDbf:cSufOrd
      ::oDbfTemporal:cTipo       := "MP"
      ::oDbfTemporal:cCodigo     := ::oDetMaterial:oDbf:cCodArt
      ::oDbfTemporal:cNombre     := ::oDetMaterial:oDbf:cNomArt
      ::oDbfTemporal:cCodAlm     := ::oDetMaterial:oDbf:cAlmOrd
      ::oDbfTemporal:cCodSec     := Space(3)
      ::oDbfTemporal:cCodOpe     := Space(3)
      ::oDbfTemporal:dFecIni     := ::oDbf:dFecOrd
      ::oDbfTemporal:dFecFin     := ::oDbf:dFecFin
      ::oDbfTemporal:cHorIni     := ::oDbf:cHorIni
      ::oDbfTemporal:cHorFin     := ::oDbf:cHorFin
      ::oDbfTemporal:nCajas      := ::oDetMaterial:oDbf:nCajOrd
      ::oDbfTemporal:nUnidades   := ::oDetMaterial:oDbf:nUndOrd
      ::oDbfTemporal:nUndHra     := ::oDetMaterial:oDbf:nCajOrd * ::oDetMaterial:oDbf:nUndOrd
      ::oDbfTemporal:nImporte    := ::oDetMaterial:oDbf:nImpOrd
      ::oDbfTemporal:nTotLin     := ::oDbfTemporal:nUndHra * ::oDbfTemporal:nImporte
      ::oDbfTemporal:nPeso       := ::oDetMaterial:oDbf:nPeso
      ::oDbfTemporal:cUndPes     := ::oDetMaterial:oDbf:cUndPes
      ::oDbfTemporal:nVolumen    := ::oDetMaterial:oDbf:nVolumen
      ::oDbfTemporal:cUndVol     := ::oDetMaterial:oDbf:cUndVol
      ::oDbfTemporal:cCodPr1     := ::oDetMaterial:oDbf:cCodPr1
      ::oDbfTemporal:cCodPr2     := ::oDetMaterial:oDbf:cCodPr2
      ::oDbfTemporal:cValPr1     := ::oDetMaterial:oDbf:cValPr1
      ::oDbfTemporal:cValPr2     := ::oDetMaterial:oDbf:cValPr2
      ::oDbfTemporal:lLote       := ::oDetMaterial:oDbf:lLote
      ::oDbfTemporal:cLote       := ::oDetMaterial:oDbf:cLote

      ::oDbfTemporal:Save()

      ::oDetMaterial:oDbf:Skip()

      end

   end





   ::oDetPersonal:oDbf:GoTop()

   if ::oDetPersonal:oDbf:Seek( cNumeroParte )

      while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd == cNumeroParte .AND. !::oDetPersonal:oDbf:Eof()

      ::oDbfTemporal:Append()

      ::oDbfTemporal:cSerOrd     := ::oDbf:cSerOrd
      ::oDbfTemporal:nNumOrd     := ::oDbf:nNumOrd
      ::oDbfTemporal:cSufOrd     := ::oDbf:cSufOrd
      ::oDbfTemporal:cTipo       := "OP"
      ::oDbfTemporal:cCodigo     := ::oDetPersonal:oDbf:cCodTra
      ::oDbfTemporal:cNombre     := oRetFld( ::oDetPersonal:oDbf:cCodTra, ::oOperario:oDbf )
      ::oDbfTemporal:cCodAlm     := Space(3)
      ::oDbfTemporal:cCodSec     := ::oDetPersonal:oDbf:cCodSec
      ::oDbfTemporal:cCodOpe     := ::oDetPersonal:oDbf:cCodOpe
      ::oDbfTemporal:dFecIni     := ::oDetPersonal:oDbf:dFecIni
      ::oDbfTemporal:dFecFin     := ::oDetPersonal:oDbf:dFecFin
      ::oDbfTemporal:cHorIni     := ::oDetPersonal:oDbf:cHorIni
      ::oDbfTemporal:cHorFin     := ::oDetPersonal:oDbf:cHorFin
      ::oDbfTemporal:nCajas      := 0
      ::oDbfTemporal:nUnidades   := 0
      ::oDbfTemporal:nUndHra     := nTiempoEntreFechas( ::oDetPersonal:oDbf:dFecIni, ::oDetPersonal:oDbf:dFecFin, ::oDetPersonal:oDbf:cHorIni, ::oDetPersonal:oDbf:cHorFin )
      ::oDbfTemporal:nImporte    := ::oDetPersonal:nTotal( ::oDetPersonal:oDbf:cCodTra, ::oDetHorasPersonal:oDbf )
      ::oDbfTemporal:nTotLin     := ::oDbfTemporal:nUndHra * ::oDbfTemporal:nImporte
      ::oDbfTemporal:nPeso       := 0
      ::oDbfTemporal:cUndPes     := Space(2)
      ::oDbfTemporal:nVolumen    := 0
      ::oDbfTemporal:cUndVol     := Space(2)
      ::oDbfTemporal:cCodPr1     := Space(5)
      ::oDbfTemporal:cCodPr2     := Space(5)
      ::oDbfTemporal:cValPr1     := Space(5)
      ::oDbfTemporal:cValPr2     := Space(5)
      ::oDbfTemporal:lLote       := .F.
      ::oDbfTemporal:cLote       := Space(12)

      ::oDbfTemporal:Save()

      ::oDetPersonal:oDbf:Skip()

      end

   end





   ::oDetMaquina:oDbf:GoTop()

   if ::oDetMaquina:oDbf:Seek( cNumeroParte )

      while ::oDetMaquina:oDbf:cSerOrd + Str( ::oDetMaquina:oDbf:nNumOrd ) + ::oDetMaquina:oDbf:cSufOrd == cNumeroParte .AND. !::oDetMaquina:oDbf:Eof()

      ::oDbfTemporal:Append()

      ::oDbfTemporal:cSerOrd     := ::oDbf:cSerOrd
      ::oDbfTemporal:nNumOrd     := ::oDbf:nNumOrd
      ::oDbfTemporal:cSufOrd     := ::oDbf:cSufOrd
      ::oDbfTemporal:cTipo       := "MQ"
      ::oDbfTemporal:cCodigo     := ::oDetMaquina:oDbf:cCodMaq
      ::oDbfTemporal:cNombre     := oRetFld( ::oDetMaquina:oDbf:cCodMaq, ::oMaquina:oDbf )
      ::oDbfTemporal:cCodAlm     := Space(3)
      ::oDbfTemporal:cCodSec     := ::oDetMaquina:oDbf:cCodSec
      ::oDbfTemporal:cCodOpe     := Space(3)
      ::oDbfTemporal:dFecIni     := ::oDetMaquina:oDbf:dFecIni
      ::oDbfTemporal:dFecFin     := ::oDetMaquina:oDbf:dFecFin
      ::oDbfTemporal:cHorIni     := ::oDetMaquina:oDbf:cIniMaq
      ::oDbfTemporal:cHorFin     := ::oDetMaquina:oDbf:cFinMaq
      ::oDbfTemporal:nCajas      := 0
      ::oDbfTemporal:nUnidades   := 0
      ::oDbfTemporal:nUndHra     := ::oDetMaquina:oDbf:nTotHra
      ::oDbfTemporal:nImporte    := ::oDetMaquina:oDbf:nCosHra
      ::oDbfTemporal:nTotLin     := ::oDbfTemporal:nUndHra * ::oDbfTemporal:nImporte
      ::oDbfTemporal:nPeso       := 0
      ::oDbfTemporal:cUndPes     := Space(2)
      ::oDbfTemporal:nVolumen    := 0
      ::oDbfTemporal:cUndVol     := Space(2)
      ::oDbfTemporal:cCodPr1     := Space(5)
      ::oDbfTemporal:cCodPr2     := Space(5)
      ::oDbfTemporal:cValPr1     := Space(5)
      ::oDbfTemporal:cValPr2     := Space(5)
      ::oDbfTemporal:lLote       := .F.
      ::oDbfTemporal:cLote       := Space(12)

      ::oDbfTemporal:Save()

      ::oDetMaquina:oDbf:Skip()

      end

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdPR )
   ::oDetMaterial:oDbf:OrdSetFocus( nOrdMP )
   ::oDetPersonal:oDbf:OrdSetFocus( nOrdOP )
   ::oDetMaquina:oDbf:OrdSetFocus( nOrdMQ )

   ::oDbfTemporal:GoTop()

RETURN ( Self )



UTILITY STATIC function TProduccion_DefineTemporal() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::cFileName      := cGetNewFileName( cPatTmp() + "TPro" )

   ::oDbfTemporal := DbfServer( ( ::cFileName ), "TPro" ):New( ( ::cFileName ), "TPro", ( cLocalDriver() ), "líneas de producción", ( cPatTmp() ) )

      ::oDbfTemporal:AddField( "cSerOrd", "C", 01, 0,,,,, "Serie", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nNumOrd", "N", 09, 0,,,,, "Número", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cSufOrd", "C", 02, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cTipo", "C", 02, 0,,,,, "Tipo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodigo", "C", 18, 0,,,,, "Código", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cNombre", "C", 100, 0,,,,, "Nombre", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cTxtSer", "M", 10, 0,,,,, "Series", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodAlm", "C", 03, 0,,,,, "Almacén", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodSec", "C", 03, 0,,,,, "Sección", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodOpe", "C", 03, 0,,,,, "Operación", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "dFecIni", "D", 08, 0,,,,, "Fecha inicio", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "dFecFin", "D", 08, 0,,,,, "Fecha fin", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cHorIni", "C", 05, 0, "@R 99:99",,,, "Hora de inicio", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cHorFin", "C", 05, 0, "@R 99:99",,,, "Hora de fin", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nCajas", "N", 16, 6,,,,, "Cajas", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nUnidades", "N", 16, 6,,,,, "Unidades", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nUndHra", "N", 16, 6,,,,, "Tot. und/hra", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nImporte", "N", 16, 6,,,,, "Importe", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nTotLin", "N", 16, 6,,,,, "Total línea", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nPeso", "N", 16, 6,,,,, "Peso del artículo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cUndPes", "C", 02, 0,,,,, "Unidad del peso", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nVolumen", "N", 16, 6,,,,, "Volumen del artículo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cUndVol", "C", 02, 0,,,,, "Unidad del volumen", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodPr1", "C", 10, 0,,,,, "Código de primera propiedad", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cCodPr2", "C", 10, 0,,,,, "Código de segunda propiedad", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cValPr1", "C", 10, 0,,,,, "Valor de primera propiedad", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cValPr2", "C", 10, 0,,,,, "Valor de segunda propiedad", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "lLote", "L", 01, 0,,,,, "Lógico lote", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cLote", "C", 12, 0,,,,, "Lote", .F.,, .F., {} )

      ::oDbfTemporal:AddIndex( "cNumOrd", ( ::cFileName ), "cSerOrd + Str( nNumOrd, 9 ) + cSufOrd",,, .F., .F., "Número",,, .T., .F. )



RETURN ( ::oDbfTemporal )



UTILITY STATIC function TProduccion_DestroyTemporal() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if !Empty( ::oDbfTemporal ) .AND. ::oDbfTemporal:Used()
      ::oDbfTemporal:End()
   end

   dbfErase( ::cFileName )

   ::oDbfTemporal := nil

RETURN ( Self )



UTILITY STATIC function TProduccion_PrnSerie() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

    local oDlg
   local oFmtDoc
   local cFmtDoc     := cSelPrimerDoc( "PO" )
   local oSayFmt
   local cSayFmt
   local oSerIni
   local oSerFin
   local nRecno      := ::oDbf:Recno()
   local nOrdAnt     := ::oDbf:OrdSetFocus( "cNumOrd" )
   local cSerIni     := ::oDbf:cSerOrd
   local cSerFin     := ::oDbf:cSerOrd
   local nDocIni     := ::oDbf:nNumOrd
   local nDocFin     := ::oDbf:nNumOrd
   local cSufIni     := ::oDbf:cSufOrd
   local cSufFin     := ::oDbf:cSufOrd
   local oPrinter
   local cPrinter    := PrnGetName()
   local lCopiasPre  := .T.
   local lInvOrden   := .F.
   local oNumCop
   local nNumCop     := nCopiasDocumento( ::oDbf:cSerOrd, "nParPrd", ::oDbfCount:cAlias )

   IIF( cPrinter == nil, cPrinter := PrnGetName(), ) ;

   cSayFmt           := cNombreDoc( cFmtDoc )

   oDlg = TDialog():New(,,,, "Imprimir series de partes de producción", "IMPSERDOC",, .F.,,,,,, .F.,,,,,, .F., )









   oSerIni := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, cSerIni, cSerIni:= u ) }, oDlg,, "@!", {||    ( cSerIni >= "A" .AND. cSerIni <= "Z"  )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( oSerIni ) )}, {||  ( DwSerie( oSerIni ) )},,,, nil,,, )









   oSerFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, cSerFin, cSerFin:= u ) }, oDlg,, "@!", {||    ( cSerFin >= "A" .AND. cSerFin <= "Z"  )},,,,,, .T.,,, .F., .T., {||    ( UpSerie( oSerFin ) )}, {||  ( DwSerie( oSerFin ) )},,,, nil,,, )





   TGetHlp():ReDefine( 120, { | u | If( PCount()==0, nDocIni, nDocIni:= u ) }, oDlg,, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





   TGetHlp():ReDefine( 130, { | u | If( PCount()==0, nDocFin, nDocFin:= u ) }, oDlg,, "999999999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




   TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cSufIni, cSufIni:= u ) }, oDlg,, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )




   TGetHlp():ReDefine( 150, { | u | If( PCount()==0, cSufFin, cSufFin:= u ) }, oDlg,, "##",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )



   TCheckBox():ReDefine( 500, { | u | If( PCount()==0, lInvOrden, lInvOrden:= u ) }, oDlg,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 170, { | u | If( PCount()==0, lCopiasPre, lCopiasPre:= u ) }, oDlg,,,,,,, .F.,, .F. )









   oNumCop := TGetHlp():ReDefine( 180, { | u | If( PCount()==0, nNumCop, nNumCop:= u ) }, oDlg,, "999999999", {||    nNumCop > 0},,,,,, .F., {||     !lCopiasPre},, .F., .T.,,, {||      1}, {||      99999},, nil,,, )







   oFmtDoc := TGetHlp():ReDefine( 90, { | u | If( PCount()==0, cFmtDoc, cFmtDoc:= u ) }, oDlg,,, {||    ( cDocumento( oFmtDoc, oSayFmt, ::oDbfDoc:cAlias ) )}, "N/W*",,,,, .F.,,, .F., .F.,,,,, {|Self|( BrwDocumento( oFmtDoc, oSayFmt, "PO" ) )}, nil, "LUPA",, )





   oSayFmt := TGetHlp():ReDefine( 91, { | u | If( PCount()==0, cSayFmt, cSayFmt:= u ) }, oDlg,,,, "N/W*",,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   TBtnBmp():ReDefine( 92, "Printer_pencil_16",,,,,{|| EdtDocumento( cFmtDoc ) }, oDlg, .F., , .F.,  )




   oPrinter := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, cPrinter, cPrinter:= u ) }, oDlg,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   TBtnBmp():ReDefine( 161, "Printer_preferences_16",,,,,{|| PrinterPreferences( oPrinter ) }, oDlg, .F., , .F.,  )





   TButton():ReDefine( 1, {||(  ::StartPrint( SubStr( cFmtDoc, 1, 3 ), cSerIni + Str( nDocIni, 9 ) + cSufIni, cSerFin + Str( nDocFin, 9 ) + cSufFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden ), oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




   TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )

   oDlg:bStart := { || oSerIni:SetFocus() }

   oDlg:AddFastKey( 116, {|| ::StartPrint( SubStr( cFmtDoc, 1, 3 ), cSerIni + Str( nDocIni, 9 ) + cSufIni, cSerFin + Str( nDocFin, 9 ) + cSufFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden ), oDlg:end( 1 ) } )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   ::oDbf:GoTo( nRecNo )
   ::oDbf:OrdSetFocus( nOrdAnt )

RETURN NIL



UTILITY STATIC function TProduccion_StartPrint( cFmtDoc, cDocIni, cDocFin, oDlg, cPrinter, lCopiasPre, nNumCop, lInvOrden) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   oDlg:disable()

   if !lInvOrden

      ::oDbf:Seek( cDocIni, .T. )


      while ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd >= cDocIni .AND.  ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd <= cDocFin

         if lCopiasPre

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ) )

         else

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nNumCop )

         end

         ::oDbf:Skip( 1 )

      end

   else

      ::oDbf:Seek( cDocFin )



      while ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd >= cDocIni .AND. ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd <= cDocFin .AND. !::oDbf:Bof()

         if lCopiasPre

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nCopiasDocumento( ::oDbf:cSerOrd, "NPARPRD", ::oDbfCount:cAlias ) )

         else

            ::nGenParte( 1, "Imprimiendo documento : " + ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, cFmtDoc, cPrinter, nNumCop )

         end

         ::oDbf:Skip( -1 )

      end

   end

   oDlg:enable()

RETURN NIL



UTILITY STATIC function TProduccion_nGenParte( nDevice, cTitle, cCodDoc, cPrinter, nCopy) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nImpYet     := 1

   IIF( nDevice == nil, nDevice := 1, ) ;
   IIF( nCopy == nil, nCopy := nCopiasDocumento( , "NPARPRD", ::oDbfCount:cAlias ), ) ;

   nCopy             := Max( nCopy, 1 )

   while nImpYet <= nCopy
      ::GenParte( nDevice, cTitle, cCodDoc, cPrinter )
      nImpYet++
   end

return nil



UTILITY STATIC function TProduccion_DefineCalculate() ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   ::aCal  := {}

   aAdd( ::aCal, { "cTiempo( (cDbf)->dFecOrd, (cDbf)->dFecFin, (cDbf)->cHorIni, (cDbf)->cHorFin )",   "C", 50, 0, "Tiempo empleado",      "",           "" } )
   aAdd( ::aCal, { "nTotProd( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetPro )",   "N", 16, 6, "Total producido",      "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotMat( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetMat )",    "N", 16, 6, "Total materias primas","cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotPer( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetHPer )",   "N", 16, 6, "Total personal",       "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotMaq( (cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd, cDetMaq )",    "N", 16, 6, "Total maquinaria",     "cPouDivPro", "" } )
   aAdd( ::aCal, { "nTotParte((cDbf)->cSerOrd + Str((cDbf)->nNumOrd) + (cDbf)->cSufOrd,cDetPro,cDetMat,cDethPer,cDetMaq)", "N", 16, 6, "Total Parte",     "cPouDivPro", "" } )

RETURN ( ::aCal )



UTILITY STATIC function TProduccion_RecSiguente( oBrw) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local lAppend
   local lTrigger
   local aAnterior   := { ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDbf:dFecFin, ::oDbf:cHorFin, ::oDbf:cCodSec }

   IIF( ::oWndBrw <> nil, ::oWndBrw:Maximize(), )

   if ::bOnPreAppend <> nil
      lTrigger := Eval( ::bOnPreAppend, Self )
      if Valtype( lTrigger ) == "L" .AND. !lTrigger
         return .F.
      end
   end

   ::oDbf:Blank()
   ::oDbf:SetDefault()

   ::LoadDetails( .F. )

   lAppend       := ::Resource( 1, aAnterior )

   if lAppend

      ::GetNewCount()

      ::oDbf:Insert()

      ::SaveDetails( 1 )

      IIF( ::oWndBrw <> nil, ::oWndBrw:Refresh(), )

   else

      ::oDbf:Cancel()

      IIF( ::oWndBrw <> nil, ::oWndBrw:Refresh(), )

   end

   ::CancelDetails()

   if ::bOnPostAppend <> nil
      Eval( ::bOnPostAppend, Self )
   end

   oBrw:Refresh()

RETURN ( lAppend )



UTILITY STATIC function TProduccion_CargaPersonalAnterior( aDatosAnterior) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nOrdAnt     := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumOrd" )



   ::oDetPersonal:oDbf:GoTop()

   if ::oDetPersonal:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetPersonal:oDbf:Eof()

         ::oDetPersonal:oDbfVir:Append()

         ::oDetPersonal:oDbfVir:cCodTra   := ::oDetPersonal:oDbf:cCodTra
         ::oDetPersonal:oDbfVir:cCodSec   := ::oDbf:cCodSec
         ::oDetPersonal:oDbfVir:cCodOpe   := ::oDbf:cCodOpe
         ::oDetPersonal:oDbfVir:dFecIni   := ::oDbf:dFecOrd
         ::oDetPersonal:oDbfVir:dFecFin   := ::oDbf:dFecFin
         ::oDetPersonal:oDbfVir:cHorIni   := ::oDbf:cHorIni
         ::oDetPersonal:oDbfVir:cHorFin   := ::oDbf:cHorFin

         ::oDetPersonal:oDbfVir:Save()

         ::oDetPersonal:oDbf:Skip()

      end

   end



   ::oDetHorasPersonal:oDbf:GoTop()

   if ::oDetHorasPersonal:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetHorasPersonal:oDbf:Eof()

         ::oDetHorasPersonal:oDbfVir:Append()

         ::oDetHorasPersonal:oDbfVir:cCodTra    :=  ::oDetHorasPersonal:oDbf:cCodTra
         ::oDetHorasPersonal:oDbfVir:cCodHra    :=  ::oDetHorasPersonal:oDbf:cCodHra
         ::oDetHorasPersonal:oDbfVir:nNumHra    :=  nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
         ::oDetHorasPersonal:oDbfVir:nCosHra    :=  ::oDetHorasPersonal:oDbf:nCosHra

         ::oDetHorasPersonal:oDbfVir:Save()

         ::oDetHorasPersonal:oDbf:Skip()

      end

   end



   ::oDetMaquina:oDbf:GoTop()

   if ::oDetMaquina:oDbf:Seek( aDatosAnterior[1] )


      while ::oDetMaquina:oDbf:cSerOrd + Str( ::oDetMaquina:oDbf:nNumOrd ) + ::oDetMaquina:oDbf:cSufOrd == aDatosAnterior[1] .AND. !::oDetMaquina:oDbf:Eof()

         ::oDetMaquina:oDbfVir:Append()

         ::oDetMaquina:oDbfVir:cCodSec    := ::oDbf:cCodSec
         ::oDetMaquina:oDbfVir:cCodMaq    := ::oDetMaquina:oDbf:cCodMaq
         ::oDetMaquina:oDbfVir:dFecIni    := ::oDbf:dFecOrd
         ::oDetMaquina:oDbfVir:dFecFin    := ::oDbf:dFecFin
         ::oDetMaquina:oDbfVir:cIniMaq    := ::oDbf:cHorIni
         ::oDetMaquina:oDbfVir:cFinMaq    := ::oDbf:cHorFin
         ::oDetMaquina:oDbfVir:nCosHra    := ::oDetMaquina:oDbf:nCosHra
         ::oDetMaquina:oDbfVir:nTotHra    := nTiempoEntreFechas( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )

         ::oDetMaquina:oDbfVir:Save()

         ::oDetMaquina:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdAnt )

   ::oDetPersonal:oDbfVir:GoTop()
   ::oDetHorasPersonal:oDbfVir:GoTop()
   ::oDetMaquina:oDbfVir:GoTop()

RETURN( Self )






function nTotProd( cNumParte, cDetPro )

   local nTotal := 0

   ( cDetPro )->( dbGoTop() )

   if ( cDetPro )->( dbSeek( cNumParte ) )

      while ( cDetPro )->cSerOrd + Str( ( cDetPro )->nNumOrd ) + ( cDetPro )->cSufOrd == cNumParte .AND. !( cDetPro )->( Eof() )

         nTotal += ( NotCaja( ( cDetPro )->nCajOrd ) * ( cDetPro )->nUndOrd ) * ( cDetPro )->nImpOrd

         ( cDetPro )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotMat( cNumParte, cDetMat )

   local nTotal := 0

   ( cDetMat )->( dbGoTop() )

   if ( cDetMat )->( dbSeek( cNumParte ) )

      while ( cDetMat )->cSerOrd + Str( ( cDetMat )->nNumOrd ) + ( cDetMat )->cSufOrd == cNumParte .AND. !( cDetMat )->( Eof() )

         nTotal += ( NotCaja( ( cDetMat )->nCajOrd ) * ( cDetMat )->nUndOrd ) * ( cDetMat )->nImpOrd

         ( cDetMat )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotPer( cNumParte, cDetHPer )

   local nTotal   := 0

   ( cDetHPer )->( dbGoTop() )

   if ( cDetHPer )->( dbSeek( cNumParte ) )

      while ( cDetHPer )->cSerOrd + Str( ( cDetHPer )->nNumOrd ) + ( cDetHPer )->cSufOrd == cNumParte .AND. !( cDetHPer )->( Eof() )

         nTotal += ( cDetHPer )->nNumHra * ( cDetHPer )->nCosHra

         ( cDetHPer )->( dbSkip() )

      end

   end


Return nTotal






function nTotMaq( cNumParte, cDetMaq )

   local nTotal := 0

   ( cDetMaq )->( dbGoTop() )

   if ( cDetMaq )->( dbSeek( cNumParte ) )

      while ( cDetMaq )->cSerOrd + Str( ( cDetMaq )->nNumOrd ) + ( cDetMaq )->cSufOrd == cNumParte .AND. !( cDetMaq )->( Eof() )

         nTotal += ( cDetMaq )->nTotHra * ( cDetMaq )->nCosHra

         ( cDetMaq )->( dbSkip() )

      end

   end

RETURN nTotal






function nTotParte( cNumParte, cDetPro, cDetMat, cDetHPer, cDetMaq )

   local nToTal := 0

   nTotal   += nTotProd( cNumParte, cDetPro )
   nTotal   += nTotMat( cNumParte, cDetMat )
   nTotal   += nTotPer( cNumParte, cDetHPer )
   nTotal   += nTotMaq( cNumParte, cDetMaq )

RETURN nTotal



Function cNombreTipo( cCodTipo )

   local cNombreTipo := ""

   do case
      case cCodTipo == "PR"
         cNombreTipo := "Artículos producidos"
      case cCodTipo == "MP"
         cNombreTipo := "Materias primas"
      case cCodTipo == "OP"
         cNombreTipo := "Operarios"
      case cCodTipo == "MQ"
         cNombreTipo := "Maquinaria"
   end

RETURN ( cNombreTipo )



Function cTiempo( dFecIni, dFecFin, cHorIni, cHorFin )

Return cFormatoDDHHMM( nTiempoEntreFechas( dFecIni, dFecFin, cHorIni, cHorFin ) )



UTILITY STATIC function TProduccion_nTotalProducido( cDocumento) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetProduccion:oDbf:Recno()
   local nOrdAnt  := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )

   ::oDetProduccion:oDbf:GoTop()

   while !::oDetProduccion:oDbf:Eof()

      if ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd == cDocumento

         nTotal   += ( NotCaja( ::oDetProduccion:oDbf:nCajOrd ) * ::oDetProduccion:oDbf:nUndOrd ) * ::oDetProduccion:oDbf:nImpOrd

      end

      ::oDetProduccion:oDbf:Skip()

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetProduccion:oDbf:GoTo( nRec )

RETURN ( nTotal )



UTILITY STATIC function TProduccion_nTotalMaterial( cDocumento) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetMaterial:oDbf:Recno()
   local nOrdAnt  := ::oDetMaterial:oDbf:OrdSetFocus( "cNumOrd" )

   ::oDetMaterial:oDbf:GoTop()

   while !::oDetMaterial:oDbf:Eof()

      if ::oDetMaterial:oDbf:cSerOrd + Str( ::oDetMaterial:oDbf:nNumOrd ) + ::oDetMaterial:oDbf:cSufOrd == cDocumento

         nTotal   += ( NotCaja( ::oDetMaterial:oDbf:nCajOrd ) * ::oDetMaterial:oDbf:nUndOrd ) * ::oDetMaterial:oDbf:nImpOrd

      end

      ::oDetMaterial:oDbf:Skip()

   end

   ::oDetMaterial:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetMaterial:oDbf:GoTo( nRec )

RETURN ( nTotal )



UTILITY STATIC function TProduccion_nTotalPersonal( cDocumento) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetPersonal:oDbf:Recno()
   local nOrdAnt  := ::oDetPersonal:oDbf:OrdSetFocus( "cNumOrd" )
   local nRecLin  := ::oDetHorasPersonal:oDbf:Recno()
   local nOrdLin  := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumTra" )

   ::oDetPersonal:oDbf:GoTop()
   ::oDetHorasPersonal:oDbf:GoTop()

   if ::oDetPersonal:oDbf:Seek( cDocumento )

      while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd == cDocumento .AND. !::oDetPersonal:oDbf:Eof()

         if ::oDetHorasPersonal:oDbf:Seek( ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd + ::oDetPersonal:oDbf:cCodTra )


            while ::oDetPersonal:oDbf:cSerOrd + Str( ::oDetPersonal:oDbf:nNumOrd ) + ::oDetPersonal:oDbf:cSufOrd + ::oDetPersonal:oDbf:cCodTra == ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd + ::oDetHorasPersonal:oDbf:cCodTra .AND.  !::oDetHorasPersonal:oDbf:Eof()

                  nTotal   += ::oDetHorasPersonal:oDbf:nNumHra * ::oDetHorasPersonal:oDbf:nCosHra

               ::oDetHorasPersonal:oDbf:Skip()

            end

         end

         ::oDetPersonal:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdLin )
   ::oDetHorasPersonal:oDbf:GoTo( nRecLin )
   ::oDetPersonal:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetPersonal:oDbf:GoTo( nRec )

RETURN ( nTotal )



UTILITY STATIC function TProduccion_nTotalMaquina( cDocumento) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetMaquina:oDbf:Recno()
   local nOrdAnt  := ::oDetMaquina:oDbf:OrdSetFocus( "cNumOrd" )

   ::oDetMaquina:oDbf:GoTop()

   while !::oDetMaquina:oDbf:Eof()

      if ::oDetMaquina:oDbf:cSerOrd + Str( ::oDetMaquina:oDbf:nNumOrd ) + ::oDetMaquina:oDbf:cSufOrd == cDocumento

         nTotal   += ::oDetMaquina:oDbf:nTotHra * ::oDetMaquina:oDbf:nCosHra

      end

      ::oDetMaquina:oDbf:Skip()

   end

   ::oDetMaquina:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetMaquina:oDbf:GoTo( nRec )

RETURN ( nTotal )



UTILITY STATIC function TProduccion_nTotalOperario( cDocOpe) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetHorasPersonal:oDbf:Recno()
   local nOrdAnt  := ::oDetHorasPersonal:oDbf:OrdSetFocus( "cNumTra" )

   ::oDetHorasPersonal:oDbf:GoTop()

   if ::oDetHorasPersonal:oDbf:Seek( cDocOpe )

      while ::oDetHorasPersonal:oDbf:cSerOrd + Str( ::oDetHorasPersonal:oDbf:nNumOrd ) + ::oDetHorasPersonal:oDbf:cSufOrd + ::oDetHorasPersonal:oDbf:cCodTra == cDocOpe .AND. !::oDetHorasPersonal:oDbf:Eof()

         nTotal   += ::oDetHorasPersonal:oDbf:nNumHra * ::oDetHorasPersonal:oDbf:nCosHra

         ::oDetHorasPersonal:oDbf:Skip()

      end

   end

   ::oDetHorasPersonal:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetHorasPersonal:oDbf:GoTo( nRec )

RETURN ( nTotal )



UTILITY STATIC function TProduccion_nTotalVolumen( cDocumento) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local nTotal   := 0
   local nRec     := ::oDetProduccion:oDbf:Recno()
   local nOrdAnt  := ::oDetProduccion:oDbf:OrdSetFocus( "cNumOrd" )

   ::oDetProduccion:oDbf:GoTop()

   if ::oDetProduccion:oDbf:Seek( cDocumento )


      while ::oDetProduccion:oDbf:cSerOrd + Str( ::oDetProduccion:oDbf:nNumOrd ) + ::oDetProduccion:oDbf:cSufOrd == cDocumento .AND. !::oDetProduccion:oDbf:Eof()

         nTotal   += ( NotCaja( ::oDetProduccion:oDbf:nCajOrd ) * ::oDetProduccion:oDbf:nUndOrd ) * ::oDetProduccion:oDbf:nVolumen

         ::oDetProduccion:oDbf:Skip()

      end

   end

   ::oDetProduccion:oDbf:OrdSetFocus( nOrdAnt )
   ::oDetProduccion:oDbf:GoTo( nRec )

RETURN ( nTotal )




function EditProduccion( cNumParte, oBrw )

   local oProduccion

   oProduccion    :=  TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Edit( oBrw )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function ZoomProduccion( cNumParte, oBrw )

   local oProduccion

   oProduccion    :=  TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Zoom( oBrw )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function DelProduccion( cNumParte, oBrw )

   local oProduccion

   oProduccion    :=  TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:Del( oBrw )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.




function PrnProduccion( cNumParte )

   local oProduccion

   oProduccion    :=  TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:GenParte( 1 )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

RETURN ( .T. )






function VisProduccion( cNumParte )

   local oProduccion

   oProduccion    :=  TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      if oProduccion:oDbf:SeekInOrd( cNumParte, "cNumOrd" )

         oProduccion:GenParte( 2 )

      end

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

RETURN ( .T. )
#line 3328 ".\Prg\Producc.prg"
UTILITY STATIC function TProduccion_DataReport( oFr) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion





   oFr:ClearDataSets()

   oFr:SetWorkArea(     "Producción", ::oDbf:nArea, .F., { 1, 1, 0 } )
   oFr:SetFieldAliases( "Producción", cObjectsToReport( ::oDbf ) )

   oFr:SetWorkArea(     "Lineas de producción", ::oDbfTemporal:nArea )
   oFr:SetFieldAliases( "Lineas de producción", cObjectsToReport( ::oDbfTemporal ) )

   oFr:SetWorkArea(     "Empresa", ::oDbfEmp:nArea )
   oFr:SetFieldAliases( "Empresa", cItemsToReport( aItmEmp() ) )

   oFr:SetWorkArea(     "Almacenes", ::oAlm:nArea )
   oFr:SetFieldAliases( "Almacenes", cItemsToReport( aItmAlm() ) )

   oFr:SetWorkArea(     "Sección", ::oSeccion:oDbf:nArea )
   oFr:SetFieldAliases( "Sección", cObjectsToReport( ::oSeccion:oDbf ) )

   oFr:SetWorkArea(     "Operación", ::oOperacion:oDbf:nArea )
   oFr:SetFieldAliases( "Operación", cObjectsToReport( ::oOperacion:oDbf ) )

   oFr:SetMasterDetail( "Producción", "Lineas de producción", {|| ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd } )
   oFr:SetMasterDetail( "Producción", "Empresa",              {|| cCodigoEmpresaEnUso() } )
   oFr:SetMasterDetail( "Producción", "Almacenes",            {|| ::oDbf:cAlmOrd } )
   oFr:SetMasterDetail( "Producción", "Sección",              {|| ::oDbf:cCodSec } )
   oFr:SetMasterDetail( "Producción", "Operación",            {|| ::oDbf:cCodOpe } )

   oFr:SetResyncPair(   "Producción", "Lineas de producción" )
   oFr:SetResyncPair(   "Producción", "Empresa" )
   oFr:SetResyncPair(   "Producción", "Almacenes" )
   oFr:SetResyncPair(   "Producción", "Sección" )
   oFr:SetResyncPair(   "Producción", "Operación" )

Return nil



UTILITY STATIC function TProduccion_VariableReport( oFr) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   oFr:DeleteCategory(  "Producción" )





   oFr:AddVariable(     "Producción",   "Tiempo empleado",          "GetHbVar('cTiempoEmp')" )
   oFr:AddVariable(     "Producción",   "Total producido",          "GetHbVar('nProd')" )
   oFr:AddVariable(     "Producción",   "Total materias primas",    "GetHbVar('nMat')" )
   oFr:AddVariable(     "Producción",   "Total personal",           "GetHbVar('nPer')" )
   oFr:AddVariable(     "Producción",   "Total maquinaria",         "GetHbVar('nMaq')" )
   oFr:AddVariable(     "Producción",   "Total parte de trabajo",   "GetHbVar('nParte')" )

Return nil



UTILITY STATIC function TProduccion_DesignReportProducc( oFr, dbfDoc) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   if ::OpenFiles()

      ::CreateTemporal( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd )

      public cTiempoEmp    := cTiempo( ::oDbf:dFecOrd, ::oDbf:dFecFin, ::oDbf:cHorIni, ::oDbf:cHorFin )
      public nProd         := nTotProd( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias )
      public nMat          := nTotMat( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaterial:oDbf:cAlias )
      public nPer          := nTotPer( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetHorasPersonal:oDbf:cAlias )
      public nMaq          := nTotMaq( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetMaquina:oDbf:cAlias )
      public nParte        := nTotParte( ::oDbf:cSerOrd + Str( ::oDbf:nNumOrd ) + ::oDbf:cSufOrd, ::oDetProduccion:oDbf:cAlias, ::oDetMaterial:oDbf:cAlias, ::oDetHorasPersonal:oDbf:cAlias, ::oDetMaquina:oDbf:cAlias )





      ::DataReport( oFr )





      if !Empty( ( dbfDoc )->mReport )

         oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

      else

         oFr:SetProperty(     "Report",            "ScriptLanguage", "PascalScript" )

         oFr:AddPage(         "MainPage" )

         oFr:AddBand(         "CabeceraDocumento", "MainPage", 2 )
         oFr:SetProperty(     "CabeceraDocumento", "Top", 0 )
         oFr:SetProperty(     "CabeceraDocumento", "Height", 200 )

         oFr:AddBand(         "CabeceraColumnas",  "MainPage", 6 )
         oFr:SetProperty(     "CabeceraColumnas",  "Top", 200 )
         oFr:SetProperty(     "CabeceraColumnas",  "Height", 0 )
         oFr:SetProperty(     "CabeceraColumnas",  "StartNewPage", .T. )
         oFr:SetObjProperty(  "CabeceraColumnas",  "DataSet", "Producción" )

         oFr:AddBand(         "DetalleColumnas",   "MainPage", 7  )
         oFr:SetProperty(     "DetalleColumnas",   "Top", 230 )
         oFr:SetProperty(     "DetalleColumnas",   "Height", 28 )
         oFr:SetObjProperty(  "DetalleColumnas",   "DataSet", "Lineas de producción" )
         oFr:SetProperty(     "DetalleColumnas",   "OnMasterDetail", "DetalleOnMasterDetail" )

         oFr:AddBand(         "PieDocumento",      "MainPage", 3 )
         oFr:SetProperty(     "PieDocumento",      "Top", 930 )
         oFr:SetProperty(     "PieDocumento",      "Height", 110 )

      end





      ::VariableReport( oFr )





      oFr:DesignReport()





      oFr:DestroyFr()





      ::oDbfTemporal:Zap()

      ::CloseFiles()

   else

      Return .F.

   end

Return .T.



UTILITY STATIC function TProduccion_PrintReportProducc( nDevice, nCopies, cPrinter, dbfDoc) ; local Self AS CLASS TProduccion := QSelf() AS CLASS TProduccion

   local oFr

   IIF( nDevice == nil, nDevice := 2, ) ;
   IIF( nCopies == nil, nCopies := 1, ) ;
   IIF( cPrinter == nil, cPrinter := PrnGetName(), ) ;

   SysRefresh()

   oFr                  := frReportManager():New()

   oFr:LoadLangRes(     "Spanish.Xml" )

   oFr:SetIcon( 1 )

   oFr:SetTitle(        "Diseñador de documentos" )





   oFr:SetEventHandler( "Designer", "OnSaveReport", {|| oFr:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   ::DataReport( oFr )





   if !Empty( ( dbfDoc )->mReport )

      oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      ::VariableReport( oFr )





      oFr:PrepareReport()





      do case
         case nDevice == 2
            oFr:ShowPreparedReport()

         case nDevice == 1
            oFr:PrintOptions:SetPrinter( cPrinter )
            oFr:PrintOptions:SetCopies( nCopies )
            oFr:PrintOptions:SetShowDialog( .F. )
            oFr:Print()

         case nDevice == 3
            oFr:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            oFr:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            oFr:SetProperty(  "PDFExport", "Outline",          .T. )
            oFr:DoExport(     "PDFExport" )

      end

   end





   oFr:DestroyFr()

Return .T.



Function AppProduccion()

   local oProduccion

   oProduccion           := TProduccion():New( cPatEmp() )

   if oProduccion:OpenFiles()

      oProduccion:Append()

      oProduccion:CloseFiles()

   end

   if oProduccion <> nil
      oProduccion:End()
   end

return .T.
