#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 55 ".\Prg\Turno.prg"
memvar nTotAlbCliContadores
memvar nTotAlbCliVentas
memvar nTotPedCliEntregas
memvar nTotAlbCliEntregas

memvar nTotEntregas

memvar nTotFacCliContadores
memvar nTotFacCliVentas
memvar nTotRctCliVentas

memvar nTotTikCliContadores
memvar nTotTikCliVentas

memvar nTotChkCliVentas
memvar nTotChkCliContadores

memvar nTotDevCliContadores
memvar nTotDevCliVentas
memvar nTotValCliContadores
memvar nTotValCliVentas
memvar nTotValCliLiquidados
memvar nTotAlbPrvCompras
memvar nTotFacPrvCompras
memvar nTotRctPrvCompras
memvar nTotAntCliVentas
memvar nTotAntCliLiquidados
memvar nTotEntradas
memvar nTotVentas
memvar nTotContadores
memvar nTotVentaCredito
memvar nTotVentaContado
memvar nTotCompras

memvar nTotTikCliCobros
memvar nTotFacCliCobros
memvar nTotValCliCobros
memvar nTotChkCliCobros

memvar nTotFacPrvPagos
memvar nTotRctPrvPagos

memvar nTotCobroEfectivo
memvar nTotCobroNoEfectivo
memvar nTotCobroTarjeta
memvar nTotCobroMedios

memvar nTotPagoEfectivo
memvar nTotPagoNoEfectivo
memvar nTotPagoTarjeta
memvar nTotPagoMedios

memvar nTotCajaEfectivo
memvar nTotCajaNoEfectivo
memvar nTotCajaTarjeta
memvar nTotCajaObjetivo

memvar nTotCaja

memvar nTotCobros
memvar nDifCobros
memvar nDifTotal
memvar nTotVentaSesion
memvar nTotCobroSesion

memvar nTotNumeroAlbaranes
memvar nTotNumeroFacturas
memvar nTotNumeroTikets
memvar nTotNumeroVales
memvar nTotNumeroCheques
memvar nTotNumeroDevoluciones
memvar nTotNumeroAptCajon

memvar nTicketMedio

memvar aMonedasEfe
memvar aMonedasRet
memvar nTarjetaEnCaja
memvar nEfectivoEnCaja
memvar nRetiradoEnCaja

memvar nTotSaldoEfectivo
memvar nTotSaldoNoEfectivo
memvar nTotSaldoTarjeta












_HB_CLASS TTurno ; UTILITY FUNCTION TTurno(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TTurno" , {TMasDet():classh} ) ) ; ;

   _HB_MEMBER { oDbfCaj} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfCaj" }, .F., .F. ), )
   _HB_MEMBER { oDbfCnt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfCnt" }, .F., .F. ), )
   _HB_MEMBER { oDbfEmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfEmp" }, .F., .F. ), )
   _HB_MEMBER { oDbfDoc} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfDoc" }, .F., .F. ), )
   _HB_MEMBER { oDbfUsr} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfUsr" }, .F., .F. ), )
   _HB_MEMBER { oDbfTemporal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfTemporal" }, .F., .F. ), )

   _HB_MEMBER { cFileTemporal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFileTemporal" }, .F., .F. ), )

   _HB_MEMBER { oUser} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oUser" }, .F., .F. ), )
   _HB_MEMBER { oTikT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikT" }, .F., .F. ), )
   _HB_MEMBER { oTikP} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikP" }, .F., .F. ), )
   _HB_MEMBER { oTikL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikL" }, .F., .F. ), )
   _HB_MEMBER { oPreCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPreCliL" }, .F., .F. ), )
   _HB_MEMBER { oPreCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPreCliT" }, .F., .F. ), )
   _HB_MEMBER { oFacCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliT" }, .F., .F. ), )
   _HB_MEMBER { oFacCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacCliP} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliP" }, .F., .F. ), )
   _HB_MEMBER { oRctCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctCliT" }, .F., .F. ), )
   _HB_MEMBER { oRctCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctCliL" }, .F., .F. ), )
   _HB_MEMBER { oAntCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAntCliT" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliT" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliL" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliP} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliP" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvT" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvL" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvP} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvP" }, .F., .F. ), )
   _HB_MEMBER { oRctPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctPrvT" }, .F., .F. ), )
   _HB_MEMBER { oRctPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctPrvL" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvT" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvL" }, .F., .F. ), )
   _HB_MEMBER { oPedCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliT" }, .F., .F. ), )
   _HB_MEMBER { oPedCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliL" }, .F., .F. ), )
   _HB_MEMBER { oPedCliP} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliP" }, .F., .F. ), )
   _HB_MEMBER { oPedPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedPrvT" }, .F., .F. ), )
   _HB_MEMBER { oIvaImp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oIvaImp" }, .F., .F. ), )
   _HB_MEMBER { oImpTik} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImpTik" }, .F., .F. ), )
   _HB_MEMBER { oArticulo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArticulo" }, .F., .F. ), )
   _HB_MEMBER { oClient} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oClient" }, .F., .F. ), )
   _HB_MEMBER { oProvee} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oProvee" }, .F., .F. ), )
   _HB_MEMBER { oCaja} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCaja" }, .F., .F. ), )
   _HB_MEMBER { oFPago} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFPago" }, .F., .F. ), )
   _HB_MEMBER { oFamilia} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFamilia" }, .F., .F. ), )
   _HB_MEMBER { oTemporada} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTemporada" }, .F., .F. ), )
   _HB_MEMBER { oCategoria} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCategoria" }, .F., .F. ), )
   _HB_MEMBER { oFabricante} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFabricante" }, .F., .F. ), )
   _HB_MEMBER { oCuentasBancarias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCuentasBancarias" }, .F., .F. ), )
   _HB_MEMBER { oTipArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipArt" }, .F., .F. ), )
   _HB_MEMBER { oTipInv} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipInv" }, .F., .F. ), )
   _HB_MEMBER { oEntSal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oEntSal" }, .F., .F. ), )
   _HB_MEMBER { oEmpBnc} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oEmpBnc" }, .F., .F. ), )
   _HB_MEMBER { oLogPorta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oLogPorta" }, .F., .F. ), )

   _HB_MEMBER { lZoom} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lZoom" }, .F., .F. ), )
   _HB_MEMBER { dFecTur} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "dFecTur" }, .F., .F. ), )
   _HB_MEMBER { cHorTur} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cHorTur" }, .F., .F. ), )
   _HB_MEMBER { oCodCaj} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCodCaj" }, .F., .F. ), )
   _HB_MEMBER { cCodCaj} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cCodCaj" }, .F., .F. ), )
   _HB_MEMBER { cOldCaj} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cOldCaj" }, .F., .F. ), )
   _HB_MEMBER { cCajTur} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cCajTur" }, .F., .F. ), )

   _HB_MEMBER { oFechaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFechaInicio" }, .F., .F. ), )
   _HB_MEMBER { dFechaInicio} ; IIF( !.F., s_oClass:AddMultiData(, CtoD( "01/01/" + Str( Year( Date() ) ) ), nScope + IIF( .F., 32, 0 ), { "dFechaInicio" }, .F., .F. ), )
   _HB_MEMBER { oFechaFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFechaFin" }, .F., .F. ), )

   _HB_MEMBER { dFechaFin} ; IIF( !.F., s_oClass:AddMultiData(, Date(), nScope + IIF( .F., 32, 0 ), { "dFechaFin" }, .F., .F. ), )
   _HB_MEMBER { oDiferenciaEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDiferenciaEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oDiferenciaTarjeta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDiferenciaTarjeta" }, .F., .F. ), )
   _HB_MEMBER { oDiferenciaTotal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDiferenciaTotal" }, .F., .F. ), )

   _HB_MEMBER { cComentario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cComentario" }, .F., .F. ), )

   _HB_MEMBER { oTreeImpresion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTreeImpresion" }, .F., .F. ), )
   _HB_MEMBER { oTreeGeneral} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTreeGeneral" }, .F., .F. ), )

   _HB_MEMBER {AS ARRAY aOpcionImp} ; IIF( !.F., s_oClass:AddMultiData( "ARRAY", ( aFill( Array( 19 ), .T. ) ), nScope + IIF( .F., 32, 0 ), { "aOpcionImp" }, .F., .F. ), )
   _HB_MEMBER {AS OBJECT oIniArqueo} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oIniArqueo" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lNoImprimirArqueo} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .F., nScope + IIF( .F., 32, 0 ), { "lNoImprimirArqueo" }, .F., .F. ), )
   _HB_MEMBER {AS LOGIC lCerrado} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .F., nScope + IIF( .F., 32, 0 ), { "lCerrado" }, .F., .F. ), )

   _HB_MEMBER { oBtnPrv} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnPrv" }, .F., .F. ), )
   _HB_MEMBER { oBtnNxt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnNxt" }, .F., .F. ), )
   _HB_MEMBER { oBtnRecalcular} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnRecalcular" }, .F., .F. ), )

   _HB_MEMBER { oBtnCancelContabilizacion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCancelContabilizacion" }, .F., .F. ), )

   _HB_MEMBER { oAni} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAni" }, .F., .F. ), )
   _HB_MEMBER { oTxt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTxt" }, .F., .F. ), )
   _HB_MEMBER {AS ARRAY aSimula} ; IIF( !.F., s_oClass:AddMultiData( "ARRAY", {}, nScope + IIF( .F., 32, 0 ), { "aSimula" }, .F., .F. ), )
   _HB_MEMBER {AS NUMERIC nAsiento} ; IIF( !.F., s_oClass:AddMultiData( "NUMERIC", 0, nScope + IIF( .F., 32, 0 ), { "nAsiento" }, .F., .F. ), )
   _HB_MEMBER {AS ARRAY aFac} ; IIF( !.F., s_oClass:AddMultiData( "ARRAY", {}, nScope + IIF( .F., 32, 0 ), { "aFac" }, .F., .F. ), )
   _HB_MEMBER { aMsg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aMsg" }, .F., .F. ), )
   _HB_MEMBER {AS OBJECT oMeter} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oMeter" }, .F., .F. ), )
   _HB_MEMBER {AS NUMERIC nMeter} ; IIF( !.F., s_oClass:AddMultiData( "NUMERIC", 0, nScope + IIF( .F., 32, 0 ), { "nMeter" }, .F., .F. ), )
   _HB_MEMBER { oPrnTiket} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPrnTiket" }, .F., .F. ), )
   _HB_MEMBER {AS OBJECT oNewImp} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oNewImp" }, .F., .F. ), )

   _HB_MEMBER {AS OBJECT oTotales} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oTotales" }, .F., .F. ), )

   _HB_MEMBER { oPrnArq} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPrnArq" }, .F., .F. ), )
   _HB_MEMBER { cPrnArq} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPrnArq" }, .F., .F. ), )
   _HB_MEMBER { cWinArq} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cWinArq" }, .F., .F. ), )

   _HB_MEMBER { oCmbReport} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCmbReport" }, .F., .F. ), )
   _HB_MEMBER { cCmbReport} ; IIF( !.F., s_oClass:AddMultiData(, "Visualizar", nScope + IIF( .F., 32, 0 ), { "cCmbReport" }, .F., .F. ), )
   _HB_MEMBER { aCmbReport} ; IIF( !.F., s_oClass:AddMultiData(, { "Visualizar", "Imprimir",    "Adobe PDF",   "Excel",    "HTML" }, nScope + IIF( .F., 32, 0 ), { "aCmbReport" }, .F., .F. ), )
   _HB_MEMBER { aBmpReport} ; IIF( !.F., s_oClass:AddMultiData(, { "Prev116",    "ImpButton",   "DocLock",     "Table",    "SndInt16" }, nScope + IIF( .F., 32, 0 ), { "aBmpReport" }, .F., .F. ), )
   _HB_MEMBER { aBmpReportTactil} ; IIF( !.F., s_oClass:AddMultiData(, { "Prev124",    "ImpButton24", "DocLock24",   "Table24",  "SndInt24" }, nScope + IIF( .F., 32, 0 ), { "aBmpReportTactil" }, .F., .F. ), )
   _HB_MEMBER { nCmbReport} ; IIF( !.F., s_oClass:AddMultiData(, 1, nScope + IIF( .F., 32, 0 ), { "nCmbReport" }, .F., .F. ), )

   _HB_MEMBER { cText} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cText" }, .F., .F. ), )
   _HB_MEMBER { oSender} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSender" }, .F., .F. ), )
   _HB_MEMBER { lSelectSend} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lSelectSend" }, .F., .F. ), )
   _HB_MEMBER { lSelectRecive} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lSelectRecive" }, .F., .F. ), )
   _HB_MEMBER { cIniFile} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cIniFile" }, .F., .F. ), )

   _HB_MEMBER { lSuccesfullSend} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lSuccesfullSend" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lTikAbiertos} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .F., nScope + IIF( .F., 32, 0 ), { "lTikAbiertos" }, .F., .F. ), )
   _HB_MEMBER { cTikAbiertos} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cTikAbiertos" }, .F., .F. ), )

   _HB_MEMBER { nNumberSend} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nNumberSend" }, .F., .F. ), )
   _HB_MEMBER { nNumberRecive} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nNumberRecive" }, .F., .F. ), )

   _HB_MEMBER { dOpenTurno} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "dOpenTurno" }, .F., .F. ), )
   _HB_MEMBER { cHoraTurno} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cHoraTurno" }, .F., .F. ), )
   _HB_MEMBER { cCajeroTurno} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cCajeroTurno" }, .F., .F. ), )
   _HB_MEMBER { cDescripcionTurno} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cDescripcionTurno" }, .F., .F. ), )

   _HB_MEMBER { nImporteTurno} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteTurno" }, .F., .F. ), )
   _HB_MEMBER { nObjetivoTurno} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nObjetivoTurno" }, .F., .F. ), )

   _HB_MEMBER { oTotalEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oTotalNoEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalNoEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oTotalTarjeta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalTarjeta" }, .F., .F. ), )
   _HB_MEMBER { oTotalCobros} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalCobros" }, .F., .F. ), )
   _HB_MEMBER { oTotalCaja} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalCaja" }, .F., .F. ), )

   _HB_MEMBER { oImporteEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImporteEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oImporteNoEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImporteNoEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oImporteTarjeta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImporteTarjeta" }, .F., .F. ), )
   _HB_MEMBER { oImporteRetirado} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImporteRetirado" }, .F., .F. ), )
   _HB_MEMBER { oImporteCambio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImporteCambio" }, .F., .F. ), )

   _HB_MEMBER { nImporteEfectivo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteEfectivo" }, .F., .F. ), )
   _HB_MEMBER { nImporteNoEfectivo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteNoEfectivo" }, .F., .F. ), )
   _HB_MEMBER { nImporteTarjeta} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteTarjeta" }, .F., .F. ), )
   _HB_MEMBER { nImporteRetirado} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteRetirado" }, .F., .F. ), )
   _HB_MEMBER { nImporteCambio} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImporteCambio" }, .F., .F. ), )
   _HB_MEMBER { nImportePresupuesto} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nImportePresupuesto" }, .F., .F. ), )

   _HB_MEMBER {AS ARRAY aFilesProcessed} ; IIF( !.F., s_oClass:AddMultiData( "ARRAY", {}, nScope + IIF( .F., 32, 0 ), { "aFilesProcessed" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lEnvioInformacion} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .T., nScope + IIF( .F., 32, 0 ), { "lEnvioInformacion" }, .F., .F. ), )
   _HB_MEMBER {AS LOGIC lImprimirEnvio} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .T., nScope + IIF( .F., 32, 0 ), { "lImprimirEnvio" }, .F., .F. ), )

   _HB_MEMBER {AS OBJECT oEnvioInformacion} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oEnvioInformacion" }, .F., .F. ), )
   _HB_MEMBER {AS OBJECT oImprimirEnvio} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oImprimirEnvio" }, .F., .F. ), )
   _HB_MEMBER {AS OBJECT oEnviarMail} ; IIF( !.F., s_oClass:AddMultiData( "OBJECT",, nScope + IIF( .F., 32, 0 ), { "oEnviarMail" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lEnviarMail} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .F., nScope + IIF( .F., 32, 0 ), { "lEnviarMail" }, .F., .F. ), )
   _HB_MEMBER { cEnviarMail} ; IIF( !.F., s_oClass:AddMultiData(, Space( 200 ), nScope + IIF( .F., 32, 0 ), { "cEnviarMail" }, .F., .F. ), )
   _HB_MEMBER { cMensajeMail} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cMensajeMail" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lDefaultPrinter} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .T., nScope + IIF( .F., 32, 0 ), { "lDefaultPrinter" }, .F., .F. ), )
   _HB_MEMBER { cPrinter} ; IIF( !.F., s_oClass:AddMultiData(, PrnGetName(), nScope + IIF( .F., 32, 0 ), { "cPrinter" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lPdfShowDialog} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .T., nScope + IIF( .F., 32, 0 ), { "lPdfShowDialog" }, .F., .F. ), )
   _HB_MEMBER { cPdfDefaultPath} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cPdfDefaultPath" }, .F., .F. ), )
   _HB_MEMBER { cPdfFileName} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cPdfFileName" }, .F., .F. ), )
   _HB_MEMBER { cHtmlFileName} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cHtmlFileName" }, .F., .F. ), )

   _HB_MEMBER { cCurTurno} ; IIF( !.F., s_oClass:AddMultiClsData(, "", nScope + IIF( .F., 32, 0 ) + 64, { "cCurTurno" }, .F. ), )

   _HB_MEMBER { cGrupoEnUso} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cGrupoEnUso" }, .F., .F. ), )
   _HB_MEMBER { nGrupoPeso} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nGrupoPeso" }, .F., .F. ), )

   _HB_MEMBER {AS LOGIC lCreated} ; IIF( !.F., s_oClass:AddMultiData( "LOGIC", .F., nScope + IIF( .F., 32, 0 ), { "lCreated" }, .F., .F. ), )
   _HB_MEMBER { oBandera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBandera" }, .F., .F. ), )

   _HB_MEMBER {AS ARRAY aTipIva} ; IIF( !.F., s_oClass:AddMultiData( "ARRAY", {}, nScope + IIF( .F., 32, 0 ), { "aTipIva" }, .F., .F. ), )

   _HB_MEMBER { oBrwTotales} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwTotales" }, .F., .F. ), )

   _HB_MEMBER { oMoneyEfectivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMoneyEfectivo" }, .F., .F. ), )
   _HB_MEMBER { oMoneyRetirado} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMoneyRetirado" }, .F., .F. ), )

   _HB_MEMBER { oChkSimula} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oChkSimula" }, .F., .F. ), )
   _HB_MEMBER { lChkSimula} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lChkSimula" }, .F., .F. ), )

   _HB_MEMBER { lAllSesions} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lAllSesions" }, .F., .F. ), )

   _HB_MEMBER { lChkContabilizarFacturasProveedores} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarFacturasProveedores" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarRectificativasProveedores} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarRectificativasProveedores" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarPagosProveedores} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarPagosProveedores" }, .F., .F. ), )

   _HB_MEMBER { lChkContabilizarContadores} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarContadores" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarTicket} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarTicket" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarFactura} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarFactura" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarRectificativa} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarRectificativa" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarCobros} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarCobros" }, .F., .F. ), )
   _HB_MEMBER { lChkContabilizarAnticipos} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lChkContabilizarAnticipos" }, .F., .F. ), )

   _HB_MEMBER { lBreak} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lBreak" }, .F., .F. ), )

   _HB_MEMBER { cGetProjectoContaplus} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cGetProjectoContaplus" }, .F., .F. ), )
   _HB_MEMBER { cGetEmpresaContaplus} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cGetEmpresaContaplus" }, .F., .F. ), )

   _HB_MEMBER { oSer} ; IIF( !.F., s_oClass:AddMultiData(, Array( 26 ), nScope + IIF( .F., 32, 0 ), { "oSer" }, .F., .F. ), )
   _HB_MEMBER { aSer} ; IIF( !.F., s_oClass:AddMultiData(, Afill( Array( 26 ), .T. ), nScope + IIF( .F., 32, 0 ), { "aSer" }, .F., .F. ), )

   _HB_MEMBER { lArqueoParcial} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lArqueoParcial" }, .F., .F. ), )
   _HB_MEMBER { lArqueoTactil} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lArqueoTactil" }, .F., .F. ), )

   _HB_MEMBER { OpenTurno} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "OpenTurno" }, .F., .F. ), )
   _HB_MEMBER { OpenCaja} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "OpenCaja" }, .F., .F. ), )

   _HB_MEMBER { oMtrProcess} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMtrProcess" }, .F., .F. ), )

   _HB_MEMBER { nScreenHorzRes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nScreenHorzRes" }, .F., .F. ), )
   _HB_MEMBER { nScreenVertRes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nScreenVertRes" }, .F., .F. ), )

   _HB_MEMBER { oFastReport} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFastReport" }, .F., .F. ), )

   _HB_MEMBER { lDestroyFastReport} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lDestroyFastReport" }, .F., .F. ), )

   _HB_MEMBER New( cPath, oWndParent, oMenuItem); IIF( .F., s_oClass:ModMethod( "New", @TTurno_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "New", @TTurno_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Initiate( cText, oSender) AS CLASS TTurno; IIF( .F., s_oClass:ModMethod( "Initiate", @TTurno_Initiate(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Initiate", @TTurno_Initiate(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Build( cPath, oWndParent, oMenuItem) AS CLASS TTurno; IIF( .F., s_oClass:ModMethod( "Build", @TTurno_Build(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Build", @TTurno_Build(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OpenFiles( lExclusive); IIF( .F., s_oClass:ModMethod( "OpenFiles", @TTurno_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenFiles", @TTurno_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OpenService( lExclusive); IIF( .F., s_oClass:ModMethod( "OpenService", @TTurno_OpenService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenService", @TTurno_OpenService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CloseFiles(); IIF( .F., s_oClass:ModMethod( "CloseFiles", @TTurno_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseFiles", @TTurno_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CloseService(); IIF( .F., s_oClass:ModMethod( "CloseService", @TTurno_CloseService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseService", @TTurno_CloseService(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER DefineFiles(); IIF( .F., s_oClass:ModMethod( "DefineFiles", @TTurno_DefineFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DefineFiles", @TTurno_DefineFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CheckFiles(); IIF( .F., s_oClass:ModMethod( "CheckFiles", @TTurno_CheckFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CheckFiles", @TTurno_CheckFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Resource( nMode); IIF( .F., s_oClass:ModMethod( "Resource", @TTurno_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Resource", @TTurno_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Activate(); IIF( .F., s_oClass:ModMethod( "Activate", @TTurno_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Activate", @TTurno_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lOpenTurno(); IIF( .F., s_oClass:ModMethod( "lOpenTurno", @TTurno_lOpenTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lOpenTurno", @TTurno_lOpenTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lOpenCaja(); IIF( .F., s_oClass:ModMethod( "lOpenCaja", @TTurno_lOpenCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lOpenCaja", @TTurno_lOpenCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lCloseCaja(); IIF( .F., s_oClass:ModMethod( "lCloseCaja", @TTurno_lCloseCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloseCaja", @TTurno_lCloseCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloseTurno(); IIF( .F., s_oClass:ModMethod( "lCloseTurno", @TTurno_lCloseTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloseTurno", @TTurno_lCloseTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloseSesion( oDlg); IIF( .F., s_oClass:ModMethod( "lCloseSesion", @TTurno_lCloseSesion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloseSesion", @TTurno_lCloseSesion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lCreateTurno(); IIF( .F., s_oClass:ModMethod( "lCreateTurno", @TTurno_lCreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCreateTurno", @TTurno_lCreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CreateTurno( oDlg); IIF( .F., s_oClass:ModMethod( "CreateTurno", @TTurno_CreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CreateTurno", @TTurno_CreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER StartCreateTurno( oImporte, oDivisa, oBmpDiv, oCodUsr); IIF( .F., s_oClass:ModMethod( "StartCreateTurno", @TTurno_StartCreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartCreateTurno", @TTurno_StartCreateTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cNombreUser(); IIF( .F., s_oClass:ModMethod( "cNombreUser", @TTurno_cNombreUser(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "cNombreUser", @TTurno_cNombreUser(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CurTurno(); IIF( .F., s_oClass:ModMethod( "CurTurno", @TTurno_CurTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CurTurno", @TTurno_CurTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cValidTurno(); IIF( .F., s_oClass:ModMethod( "cValidTurno", @TTurno_cValidTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "cValidTurno", @TTurno_cValidTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lSelectTurno( lSel); IIF( .F., s_oClass:ModMethod( "lSelectTurno", @TTurno_lSelectTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lSelectTurno", @TTurno_lSelectTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lSelectAll( lSel); IIF( .F., s_oClass:ModMethod( "lSelectAll", @TTurno_lSelectAll(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lSelectAll", @TTurno_lSelectAll(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER MarkTurno( lMark); IIF( .F., s_oClass:ModMethod( "MarkTurno", @TTurno_MarkTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MarkTurno", @TTurno_MarkTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lInvCierre(); IIF( .F., s_oClass:ModMethod( "lInvCierre", @TTurno_lInvCierre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lInvCierre", @TTurno_lInvCierre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER InvCierre( oAni, oMsg); IIF( .F., s_oClass:ModMethod( "InvCierre", @TTurno_InvCierre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "InvCierre", @TTurno_InvCierre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lArqueoTurno( lZoom, lTactil, lParcial); IIF( .F., s_oClass:ModMethod( "lArqueoTurno", @TTurno_lArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lArqueoTurno", @TTurno_lArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lIsContadores(); IIF( .F., s_oClass:ModMethod( "lIsContadores", @TTurno_lIsContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lIsContadores", @TTurno_lIsContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER LoadContadores(); IIF( .F., s_oClass:ModMethod( "LoadContadores", @TTurno_LoadContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "LoadContadores", @TTurno_LoadContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotContadores(); IIF( .F., s_oClass:ModMethod( "TotContadores", @TTurno_TotContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotContadores", @TTurno_TotContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER LoadCaja(); IIF( .F., s_oClass:ModMethod( "LoadCaja", @TTurno_LoadCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "LoadCaja", @TTurno_LoadCaja(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SelCajas(); IIF( .F., s_oClass:ModMethod( "SelCajas", @TTurno_SelCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelCajas", @TTurno_SelCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SelAllCajas(); IIF( .F., s_oClass:ModMethod( "SelAllCajas", @TTurno_SelAllCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelAllCajas", @TTurno_SelAllCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lValidCajas(); IIF( .F., s_oClass:ModMethod( "lValidCajas", @TTurno_lValidCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lValidCajas", @TTurno_lValidCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lChangeCajas(); IIF( .F., s_oClass:ModMethod( "lChangeCajas", @TTurno_lChangeCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lChangeCajas", @TTurno_lChangeCajas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lAnyCajaSelect(); IIF( .F., s_oClass:ModMethod( "lAnyCajaSelect", @TTurno_lAnyCajaSelect(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lAnyCajaSelect", @TTurno_lAnyCajaSelect(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lOneCajaSelect(); IIF( .F., s_oClass:ModMethod( "lOneCajaSelect", @TTurno_lOneCajaSelect(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lOneCajaSelect", @TTurno_lOneCajaSelect(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER TotVenta( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotVenta", @TTurno_TotVenta(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotVenta", @TTurno_TotVenta(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotEntrada( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotEntrada", @TTurno_TotEntrada(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotEntrada", @TTurno_TotEntrada(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotCompra( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotCompra", @TTurno_TotCompra(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotCompra", @TTurno_TotCompra(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotCobro( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotCobro", @TTurno_TotCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotCobro", @TTurno_TotCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotPago( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotPago", @TTurno_TotPago(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotPago", @TTurno_TotPago(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER TotTipoIva( cTurno, cCaja); IIF( .F., s_oClass:ModMethod( "TotTipoIva", @TTurno_TotTipoIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "TotTipoIva", @TTurno_TotTipoIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lCalTurno(); IIF( .F., s_oClass:ModMethod( "lCalTurno", @TTurno_lCalTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCalTurno", @TTurno_lCalTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ClickBrwTotales(); IIF( .F., s_oClass:ModMethod( "ClickBrwTotales", @TTurno_ClickBrwTotales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ClickBrwTotales", @TTurno_ClickBrwTotales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetLastOpen(); IIF( .F., s_oClass:ModMethod( "GetLastOpen", @TTurno_GetLastOpen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetLastOpen", @TTurno_GetLastOpen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetLastClose(); IIF( .F., s_oClass:ModMethod( "GetLastClose", @TTurno_GetLastClose(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetLastClose", @TTurno_GetLastClose(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetLastEfectivo(); IIF( .F., s_oClass:ModMethod( "GetLastEfectivo", @TTurno_GetLastEfectivo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetLastEfectivo", @TTurno_GetLastEfectivo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EdtCol( oLbx); IIF( .F., s_oClass:ModMethod( "EdtCol", @TTurno_EdtCol(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EdtCol", @TTurno_EdtCol(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EdtAnt( oLbx); IIF( .F., s_oClass:ModMethod( "EdtAnt", @TTurno_EdtAnt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EdtAnt", @TTurno_EdtAnt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EdtLine( oLbx); IIF( .F., s_oClass:ModMethod( "EdtLine", @TTurno_EdtLine(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EdtLine", @TTurno_EdtLine(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GoPrev( oFld, oDlg, oBrwCnt, oBrwCaj); IIF( .F., s_oClass:ModMethod( "GoPrev", @TTurno_GoPrev(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GoPrev", @TTurno_GoPrev(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GoNext( oFld, oDlg); IIF( .F., s_oClass:ModMethod( "GoNext", @TTurno_GoNext(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GoNext", @TTurno_GoNext(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SyncAllDbf(); IIF( .F., s_oClass:ModMethod( "SyncAllDbf", @TTurno_SyncAllDbf(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SyncAllDbf", @TTurno_SyncAllDbf(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Reindexa( oMeter); IIF( .F., s_oClass:ModMethod( "Reindexa", @TTurno_Reindexa(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Reindexa", @TTurno_Reindexa(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER MixApunte( aApunte); IIF( .F., s_oClass:ModMethod( "MixApunte", @TTurno_MixApunte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MixApunte", @TTurno_MixApunte(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Asiento(); IIF( .F., s_oClass:ModMethod( "Asiento", @TTurno_Asiento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Asiento", @TTurno_Asiento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DlgImprimir(); IIF( .F., s_oClass:ModMethod( "DlgImprimir", @TTurno_DlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DlgImprimir", @TTurno_DlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER StartDlgImprimir(); IIF( .F., s_oClass:ModMethod( "StartDlgImprimir", @TTurno_StartDlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartDlgImprimir", @TTurno_StartDlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ExecuteDlgImprimir(); IIF( .F., s_oClass:ModMethod( "ExecuteDlgImprimir", @TTurno_ExecuteDlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ExecuteDlgImprimir", @TTurno_ExecuteDlgImprimir(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PrintArqueo( cCodCaj, nDevice, cCaption, cCodDoc, cPrinter, nCopies); IIF( .F., s_oClass:ModMethod( "PrintArqueo", @TTurno_PrintArqueo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PrintArqueo", @TTurno_PrintArqueo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DefineTemporal(); IIF( .F., s_oClass:ModMethod( "DefineTemporal", @TTurno_DefineTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DefineTemporal", @TTurno_DefineTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER DestroyTemporal(); IIF( .F., s_oClass:ModMethod( "DestroyTemporal", @TTurno_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DestroyTemporal", @TTurno_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendInTemporal( cGrupo, cKey, cNaturaleza, nImporte); IIF( .F., s_oClass:ModMethod( "AppendInTemporal", @TTurno_AppendInTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendInTemporal", @TTurno_AppendInTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER FillTemporal( cCodCaj); IIF( .F., s_oClass:ModMethod( "FillTemporal", @TTurno_FillTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "FillTemporal", @TTurno_FillTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lNowOpen( oWnd); IIF( .F., s_oClass:ModMethod( "lNowOpen", @TTurno_lNowOpen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lNowOpen", @TTurno_lNowOpen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER RellenaIva(); IIF( .F., s_oClass:ModMethod( "RellenaIva", @TTurno_RellenaIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "RellenaIva", @TTurno_RellenaIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER RollBack( ); IIF( !.F., s_oClass:AddVirtual( "RollBack" ), )

   _HB_MEMBER lCloTiket( lClose); IIF( .F., s_oClass:ModMethod( "lCloTiket", @TTurno_lCloTiket(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloTiket", @TTurno_lCloTiket(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloEntSal( lClose); IIF( .F., s_oClass:ModMethod( "lCloEntSal", @TTurno_lCloEntSal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloEntSal", @TTurno_lCloEntSal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloPgoTik( lClose); IIF( .F., s_oClass:ModMethod( "lCloPgoTik", @TTurno_lCloPgoTik(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloPgoTik", @TTurno_lCloPgoTik(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloPedPrv( lClose); IIF( .F., s_oClass:ModMethod( "lCloPedPrv", @TTurno_lCloPedPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloPedPrv", @TTurno_lCloPedPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloAlbPrv( lClose); IIF( .F., s_oClass:ModMethod( "lCloAlbPrv", @TTurno_lCloAlbPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloAlbPrv", @TTurno_lCloAlbPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloFacPrv( lClose); IIF( .F., s_oClass:ModMethod( "lCloFacPrv", @TTurno_lCloFacPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloFacPrv", @TTurno_lCloFacPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloRctPrv( lClose); IIF( .F., s_oClass:ModMethod( "lCloRctPrv", @TTurno_lCloRctPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloRctPrv", @TTurno_lCloRctPrv(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloPreCli( lClose); IIF( .F., s_oClass:ModMethod( "lCloPreCli", @TTurno_lCloPreCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloPreCli", @TTurno_lCloPreCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloPedCli( lClose); IIF( .F., s_oClass:ModMethod( "lCloPedCli", @TTurno_lCloPedCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloPedCli", @TTurno_lCloPedCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloAlbCli( lClose); IIF( .F., s_oClass:ModMethod( "lCloAlbCli", @TTurno_lCloAlbCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloAlbCli", @TTurno_lCloAlbCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lCloFacCli( lClose); IIF( .F., s_oClass:ModMethod( "lCloFacCli", @TTurno_lCloFacCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCloFacCli", @TTurno_lCloFacCli(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ActTactil(); IIF( .F., s_oClass:ModMethod( "ActTactil", @TTurno_ActTactil(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ActTactil", @TTurno_ActTactil(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CreateData(); IIF( .F., s_oClass:ModMethod( "CreateData", @TTurno_CreateData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CreateData", @TTurno_CreateData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER RestoreData(); IIF( .F., s_oClass:ModMethod( "RestoreData", @TTurno_RestoreData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "RestoreData", @TTurno_RestoreData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SendData(); IIF( .F., s_oClass:ModMethod( "SendData", @TTurno_SendData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SendData", @TTurno_SendData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ReciveData(); IIF( .F., s_oClass:ModMethod( "ReciveData", @TTurno_ReciveData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ReciveData", @TTurno_ReciveData(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER nGetNumberToSend(); IIF( .F., s_oClass:ModMethod( "nGetNumberToSend", @TTurno_nGetNumberToSend(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nGetNumberToSend", @TTurno_nGetNumberToSend(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SetNumberToSend(); IIF( .F., s_oClass:ModInline( "SetNumberToSend", {|Self | Self, WritePProString( "Numero", ::cText, cValToChar( ::nNumberSend ), ::cIniFile ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetNumberToSend", {|Self | Self, WritePProString( "Numero", ::cText, cValToChar( ::nNumberSend ), ::cIniFile ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER IncNumberToSend(); IIF( .F., s_oClass:ModInline( "IncNumberToSend", {|Self | Self, WritePProString( "Numero", ::cText, cValToChar( ++::nNumberSend ), ::cIniFile ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "IncNumberToSend", {|Self | Self, WritePProString( "Numero", ::cText, cValToChar( ++::nNumberSend ), ::cIniFile ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER lContaTiket( ); IIF( !.F., s_oClass:AddVirtual( "lContaTiket" ), )

   _HB_MEMBER SetBigUsr( oSayUsr); IIF( .F., s_oClass:ModMethod( "SetBigUsr", @TTurno_SetBigUsr(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetBigUsr", @TTurno_SetBigUsr(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Process(); IIF( .F., s_oClass:ModMethod( "Process", @TTurno_Process(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Process", @TTurno_Process(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Save(); IIF( .F., s_oClass:ModMethod( "Save", @TTurno_Save(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Save", @TTurno_Save(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Load(); IIF( .F., s_oClass:ModMethod( "Load", @TTurno_Load(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Load", @TTurno_Load(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ChangedTreeImpresion( ); IIF( !.F., s_oClass:AddVirtual( "ChangedTreeImpresion" ), )

   _HB_MEMBER InitArqueoTurno(); IIF( .F., s_oClass:ModMethod( "InitArqueoTurno", @TTurno_InitArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "InitArqueoTurno", @TTurno_InitArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER StartArqueoTurno( oFld, oBtnMod, oCajTur); IIF( .F., s_oClass:ModMethod( "StartArqueoTurno", @TTurno_StartArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartArqueoTurno", @TTurno_StartArqueoTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DataReport( oFastReport); IIF( .F., s_oClass:ModMethod( "DataReport", @TTurno_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DataReport", @TTurno_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER VariableReport( oFastReport); IIF( .F., s_oClass:ModMethod( "VariableReport", @TTurno_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "VariableReport", @TTurno_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER DesignReport( dbfDoc); IIF( .F., s_oClass:ModMethod( "DesignReport", @TTurno_DesignReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DesignReport", @TTurno_DesignReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER PrintReport( nDevice, nCopies, cPrinter, dbfDoc); IIF( .F., s_oClass:ModMethod( "PrintReport", @TTurno_PrintReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PrintReport", @TTurno_PrintReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtAlbaranCliente(); IIF( .F., s_oClass:ModInline( "cTxtAlbaranCliente", {|Self | Self, ( ::oAlbCliT:cSerAlb + "/" + Alltrim( Str( ::oAlbCliT:nNumAlb ) ) + "/" + Alltrim( ::oAlbCliT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliT:dFecAlb ) + Space( 1 ) + ( ::oAlbCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oAlbCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAlbCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtAlbaranCliente", {|Self | Self, ( ::oAlbCliT:cSerAlb + "/" + Alltrim( Str( ::oAlbCliT:nNumAlb ) ) + "/" + Alltrim( ::oAlbCliT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliT:dFecAlb ) + Space( 1 ) + ( ::oAlbCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oAlbCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAlbCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotAlbaranCliente(); IIF( .F., s_oClass:ModInline( "nTotAlbaranCliente", {|Self | Self, ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotAlbaranCliente", {|Self | Self, ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nCntAlbaranCliente(); IIF( .F., s_oClass:ModInline( "nCntAlbaranCliente", {|Self | Self, ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nCntAlbaranCliente", {|Self | Self, ( nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtAlbaranCliente(); IIF( .F., s_oClass:ModMethod( "bEdtAlbaranCliente", @TTurno_bEdtAlbaranCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtAlbaranCliente", @TTurno_bEdtAlbaranCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtFacturaCliente(); IIF( .F., s_oClass:ModInline( "cTxtFacturaCliente", {|Self | Self, ( ::oFacCliT:cSerie + "/" + Alltrim( Str( ::oFacCliT:nNumFac ) ) + "/" + Alltrim( ::oFacCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacCliT:dFecFac ) + Space( 1 ) + ( ::oFacCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oFacCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oFacCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaCliente", {|Self | Self, ( ::oFacCliT:cSerie + "/" + Alltrim( Str( ::oFacCliT:nNumFac ) ) + "/" + Alltrim( ::oFacCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacCliT:dFecFac ) + Space( 1 ) + ( ::oFacCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oFacCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oFacCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotFacturaCliente(); IIF( .F., s_oClass:ModInline( "nTotFacturaCliente", {|Self | Self, ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaCliente", {|Self | Self, ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nCntFacturaCliente(); IIF( .F., s_oClass:ModInline( "nCntFacturaCliente", {|Self | Self, ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nCntFacturaCliente", {|Self | Self, ( nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaCliente(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaCliente", @TTurno_bEdtFacturaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaCliente", @TTurno_bEdtFacturaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtFacturaRectificativaCliente(); IIF( .F., s_oClass:ModInline( "cTxtFacturaRectificativaCliente", {|Self | Self, ( ::oRctCliT:cSerie + "/" + Alltrim( Str( ::oRctCliT:nNumFac ) ) + "/" + Alltrim( ::oRctCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctCliT:dFecFac ) + Space( 1 ) + ( ::oRctCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oRctCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oRctCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaRectificativaCliente", {|Self | Self, ( ::oRctCliT:cSerie + "/" + Alltrim( Str( ::oRctCliT:nNumFac ) ) + "/" + Alltrim( ::oRctCliT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctCliT:dFecFac ) + Space( 1 ) + ( ::oRctCliT:cTimCre ) + Space( 1 ) + Rtrim( ::oRctCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oRctCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotFacturaRectificativaCliente(); IIF( .F., s_oClass:ModInline( "nTotFacturaRectificativaCliente", {|Self | Self, ( nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaRectificativaCliente", {|Self | Self, ( nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nCntFacturaRectificativaCliente(); IIF( .F., s_oClass:ModInline( "nCntFacturaRectificativaCliente", {|Self | Self, ( nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nCntFacturaRectificativaCliente", {|Self | Self, ( nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaRectificativaCliente(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaRectificativaCliente", @TTurno_bEdtFacturaRectificativaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaRectificativaCliente", @TTurno_bEdtFacturaRectificativaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtTiketCliente(); IIF( .F., s_oClass:ModInline( "cTxtTiketCliente", {|Self | Self, ( ::oTikT:cSerTik + "/" + Alltrim( ::oTikT:cNumTik ) + "/" + Alltrim( ::oTikT:cSufTik )+ Space( 1 ) + Dtoc( ::oTikT:dFecTik ) + Space( 1 ) + ( ::oTikT:cHorTik ) + Space( 1 ) + Rtrim( ::oTikT:cCliTik ) + Space( 1 ) + Rtrim( ::oTikT:cNomTik ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtTiketCliente", {|Self | Self, ( ::oTikT:cSerTik + "/" + Alltrim( ::oTikT:cNumTik ) + "/" + Alltrim( ::oTikT:cSufTik )+ Space( 1 ) + Dtoc( ::oTikT:dFecTik ) + Space( 1 ) + ( ::oTikT:cHorTik ) + Space( 1 ) + Rtrim( ::oTikT:cCliTik ) + Space( 1 ) + Rtrim( ::oTikT:cNomTik ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotTiketCliente(); IIF( .F., s_oClass:ModInline( "nTotTiketCliente", {|Self | Self, ( nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotTiketCliente", {|Self | Self, ( nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nCntTiketCliente(); IIF( .F., s_oClass:ModInline( "nCntTiketCliente", {|Self | Self, ( nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nCntTiketCliente", {|Self | Self, ( nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtTiketCliente(); IIF( .F., s_oClass:ModMethod( "bEdtTiketCliente", @TTurno_bEdtTiketCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtTiketCliente", @TTurno_bEdtTiketCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER bZooTiketCliente(); IIF( .F., s_oClass:ModMethod( "bZooTiketCliente", @TTurno_bZooTiketCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bZooTiketCliente", @TTurno_bZooTiketCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtAnticipoCliente(); IIF( .F., s_oClass:ModInline( "cTxtAnticipoCliente", {|Self | Self, ( ::oAntCliT:cSerAnt + "/" + Alltrim( Str( ::oAntCliT:nNumAnt ) ) + "/" + Alltrim( ::oAntCliT:cSufAnt ) + Space( 1 ) + Dtoc( ::oAntCliT:dFecAnt ) + Space( 1 ) + ( ::oAntCliT:cTimCre ) + Space( 1 ) +  Rtrim( ::oAntCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAntCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtAnticipoCliente", {|Self | Self, ( ::oAntCliT:cSerAnt + "/" + Alltrim( Str( ::oAntCliT:nNumAnt ) ) + "/" + Alltrim( ::oAntCliT:cSufAnt ) + Space( 1 ) + Dtoc( ::oAntCliT:dFecAnt ) + Space( 1 ) + ( ::oAntCliT:cTimCre ) + Space( 1 ) +  Rtrim( ::oAntCliT:cCodCli ) + Space( 1 ) + Rtrim( ::oAntCliT:cNomCli ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotAnticipoCliente(); IIF( .F., s_oClass:ModInline( "nTotAnticipoCliente", {|Self | Self, ( nTotAntCli( ::oAntCliT:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotAnticipoCliente", {|Self | Self, ( nTotAntCli( ::oAntCliT:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtAnticipoCliente(); IIF( .F., s_oClass:ModMethod( "bEdtAnticipoCliente", @TTurno_bEdtAnticipoCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtAnticipoCliente", @TTurno_bEdtAnticipoCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtAlbaranProveedor(); IIF( .F., s_oClass:ModInline( "cTxtAlbaranProveedor", {|Self | Self, ( ::oAlbPrvT:cSerAlb + "/" + Alltrim( Str( ::oAlbPrvT:nNumAlb ) ) + "/" + Alltrim( ::oAlbPrvT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbPrvT:dFecAlb ) + Space( 1 ) + ( ::oAlbPrvT:cTimChg ) + Space( 1 ) + Rtrim( ::oAlbPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oAlbPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtAlbaranProveedor", {|Self | Self, ( ::oAlbPrvT:cSerAlb + "/" + Alltrim( Str( ::oAlbPrvT:nNumAlb ) ) + "/" + Alltrim( ::oAlbPrvT:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbPrvT:dFecAlb ) + Space( 1 ) + ( ::oAlbPrvT:cTimChg ) + Space( 1 ) + Rtrim( ::oAlbPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oAlbPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotAlbaranProveedor(); IIF( .F., s_oClass:ModInline( "nTotAlbaranProveedor", {|Self | Self, ( nTotAlbPrv( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb, ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotAlbaranProveedor", {|Self | Self, ( nTotAlbPrv( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb, ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtAlbaranProveedor(); IIF( .F., s_oClass:ModMethod( "bEdtAlbaranProveedor", @TTurno_bEdtAlbaranProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtAlbaranProveedor", @TTurno_bEdtAlbaranProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtFacturaProveedor(); IIF( .F., s_oClass:ModInline( "cTxtFacturaProveedor", {|Self | Self, ( ::oFacPrvT:cSerFac + "/" + Alltrim( Str( ::oFacPrvT:nNumFac ) ) + "/" + Alltrim( ::oFacPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvT:dFecFac ) + Space( 1 ) + ( ::oFacPrvT:cTimChg ) + Space( 1 ) +Rtrim( ::oFacPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oFacPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaProveedor", {|Self | Self, ( ::oFacPrvT:cSerFac + "/" + Alltrim( Str( ::oFacPrvT:nNumFac ) ) + "/" + Alltrim( ::oFacPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvT:dFecFac ) + Space( 1 ) + ( ::oFacPrvT:cTimChg ) + Space( 1 ) +Rtrim( ::oFacPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oFacPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotFacturaProveedor(); IIF( .F., s_oClass:ModInline( "nTotFacturaProveedor", {|Self | Self, ( nTotFacPrv( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac, ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacPrvP:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaProveedor", {|Self | Self, ( nTotFacPrv( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac, ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacPrvP:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaProveedor(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaProveedor", @TTurno_bEdtFacturaProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaProveedor", @TTurno_bEdtFacturaProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cTxtFacturaRectificativaProveedor(); IIF( .F., s_oClass:ModInline( "cTxtFacturaRectificativaProveedor", {|Self | Self, ( ::oRctPrvT:cSerFac + "/" + Alltrim( Str( ::oRctPrvT:nNumFac ) ) + "/" + Alltrim( ::oRctPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctPrvT:dFecFac ) + Space( 1 ) + ( ::oRctPrvT:cTimChg ) + Space( 1 ) +Rtrim( ::oRctPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oRctPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaRectificativaProveedor", {|Self | Self, ( ::oRctPrvT:cSerFac + "/" + Alltrim( Str( ::oRctPrvT:nNumFac ) ) + "/" + Alltrim( ::oRctPrvT:cSufFac ) + Space( 1 ) + Dtoc( ::oRctPrvT:dFecFac ) + Space( 1 ) + ( ::oRctPrvT:cTimChg ) + Space( 1 ) +Rtrim( ::oRctPrvT:cCodPrv ) + Space( 1 ) + Rtrim( ::oRctPrvT:cNomPrv ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotFacturaRectificativaProveedor(); IIF( .F., s_oClass:ModInline( "nTotFacturaRectificativaProveedor", {|Self | Self, ( nTotRctPrv( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac, ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaRectificativaProveedor", {|Self | Self, ( nTotRctPrv( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac, ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaRectificativaProveedor(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaRectificativaProveedor", @TTurno_bEdtFacturaRectificativaProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaRectificativaProveedor", @TTurno_bEdtFacturaRectificativaProveedor(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotTiketCobro(); IIF( .F., s_oClass:ModInline( "nTotTiketCobro", {|Self | Self, ( nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotTiketCobro", {|Self | Self, ( nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nTotValTikCobro(); IIF( .F., s_oClass:ModInline( "nTotValTikCobro", {|Self | Self, ( nTotValTik( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv, cDivEmp() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotValTikCobro", {|Self | Self, ( nTotValTik( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv, cDivEmp() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtTiketCobro(); IIF( .F., s_oClass:ModInline( "cTxtTiketCobro", {|Self | Self, ( ::oTikP:cSerTik + "/" + Alltrim( ::oTikP:cNumTik ) + "/" + Rtrim( ::oTikP:cSufTik ) + Space( 1 ) + Dtoc( ::oTikP:dPgoTik ) + Space( 1 ) + ( ::oTikP:cTimTik ) + Space( 1 ) + ::oTikP:cFpgPgo + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cCliTik", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cNomTik", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtTiketCobro", {|Self | Self, ( ::oTikP:cSerTik + "/" + Alltrim( ::oTikP:cNumTik ) + "/" + Rtrim( ::oTikP:cSufTik ) + Space( 1 ) + Dtoc( ::oTikP:dPgoTik ) + Space( 1 ) + ( ::oTikP:cTimTik ) + Space( 1 ) + ::oTikP:cFpgPgo + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cCliTik", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cNomTik", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtTiketCobro(); IIF( .F., s_oClass:ModMethod( "bEdtTiketCobro", @TTurno_bEdtTiketCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtTiketCobro", @TTurno_bEdtTiketCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER bZooTiketCobro(); IIF( .F., s_oClass:ModMethod( "bZooTiketCobro", @TTurno_bZooTiketCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bZooTiketCobro", @TTurno_bZooTiketCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotFacturaCobro(); IIF( .F., s_oClass:ModInline( "nTotFacturaCobro", {|Self | Self, ( nTotCobCli( ::oFacCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaCobro", {|Self | Self, ( nTotCobCli( ::oFacCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtFacturaCobro(); IIF( .F., s_oClass:ModInline( "cTxtFacturaCobro", {|Self | Self, ( ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac ) + Space( 1 ) + Dtoc( ::oFacCliP:dEntrada ) + Space( 1 ) + ::oFacCliP:cCodPgo + Space( 1 ) + Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cCodCli", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cNomCli", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaCobro", {|Self | Self, ( ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac ) + Space( 1 ) + Dtoc( ::oFacCliP:dEntrada ) + Space( 1 ) + ::oFacCliP:cCodPgo + Space( 1 ) + Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cCodCli", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac, ::oFacCliT, "cNomCli", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaCobro(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaCobro", @TTurno_bEdtFacturaCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaCobro", @TTurno_bEdtFacturaCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotPedidoEntrega(); IIF( .F., s_oClass:ModInline( "nTotPedidoEntrega", {|Self | Self, ( nEntPedCli( ::oPedCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotPedidoEntrega", {|Self | Self, ( nEntPedCli( ::oPedCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtPedidoEntrega(); IIF( .F., s_oClass:ModInline( "cTxtPedidoEntrega", {|Self | Self, ( ::oPedCliT:cSerPed + "/" + Alltrim( Str( ::oPedCliP:nNumPed ) ) + "/" + Rtrim( ::oPedCliP:cSufPed ) + Space( 1 ) + Dtoc( ::oPedCliP:dEntrega ) + Space( 1 ) + ::oPedCliP:cCodPgo + Space( 1 ) + Rtrim( ::oPedCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oPedCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtPedidoEntrega", {|Self | Self, ( ::oPedCliT:cSerPed + "/" + Alltrim( Str( ::oPedCliP:nNumPed ) ) + "/" + Rtrim( ::oPedCliP:cSufPed ) + Space( 1 ) + Dtoc( ::oPedCliP:dEntrega ) + Space( 1 ) + ::oPedCliP:cCodPgo + Space( 1 ) + Rtrim( ::oPedCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oPedCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtPedidoEntrega(); IIF( .F., s_oClass:ModMethod( "bEdtPedidoEntrega", @TTurno_bEdtPedidoEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtPedidoEntrega", @TTurno_bEdtPedidoEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotAlbaranEntrega(); IIF( .F., s_oClass:ModInline( "nTotAlbaranEntrega", {|Self | Self, ( nEntAlbCli( ::oAlbCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotAlbaranEntrega", {|Self | Self, ( nEntAlbCli( ::oAlbCliP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtAlbaranEntrega(); IIF( .F., s_oClass:ModInline( "cTxtAlbaranEntrega", {|Self | Self, ( ::oAlbCliP:cSerAlb + "/" + Alltrim( Str( ::oAlbCliP:nNumAlb ) ) + "/" + Rtrim( ::oAlbCliP:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliP:dEntrega ) + Space( 1 ) + ::oAlbCliP:cCodPgo + Space( 1 ) + Rtrim( ::oAlbCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oAlbCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtAlbaranEntrega", {|Self | Self, ( ::oAlbCliP:cSerAlb + "/" + Alltrim( Str( ::oAlbCliP:nNumAlb ) ) + "/" + Rtrim( ::oAlbCliP:cSufAlb ) + Space( 1 ) + Dtoc( ::oAlbCliP:dEntrega ) + Space( 1 ) + ::oAlbCliP:cCodPgo + Space( 1 ) + Rtrim( ::oAlbCliP:cCodCli ) + Space( 1 ) + oRetFld( ::oAlbCliP:cCodCli, ::oClient, "Titulo" ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtAlbaranEntrega(); IIF( .F., s_oClass:ModMethod( "bEdtAlbaranEntrega", @TTurno_bEdtAlbaranEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtAlbaranEntrega", @TTurno_bEdtAlbaranEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotEntradasSalidas(); IIF( .F., s_oClass:ModInline( "nTotEntradasSalidas", {|Self | Self, ( if( ::oEntSal:nTipEnt == 1, nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ), - nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotEntradasSalidas", {|Self | Self, ( if( ::oEntSal:nTipEnt == 1, nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ), - nTotES( nil, ::oEntSal:cAlias, ::oDbfDiv, cDivEmp(), .F. ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtEntradasSalidas(); IIF( .F., s_oClass:ModInline( "cTxtEntradasSalidas", {|Self | Self, ( Dtoc( ::oEntSal:dFecEnt ) + Space( 1 ) + Space( 1 ) + Rtrim( ::oEntSal:cDesEnt ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtEntradasSalidas", {|Self | Self, ( Dtoc( ::oEntSal:dFecEnt ) + Space( 1 ) + Space( 1 ) + Rtrim( ::oEntSal:cDesEnt ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtEntradasSalidas(); IIF( .F., s_oClass:ModMethod( "bEdtEntradasSalidas", @TTurno_bEdtEntradasSalidas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtEntradasSalidas", @TTurno_bEdtEntradasSalidas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotFacturaPago(); IIF( .F., s_oClass:ModInline( "nTotFacturaPago", {|Self | Self, ( nTotRecPrv( ::oFacPrvP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nTotFacturaPago", {|Self | Self, ( nTotRecPrv( ::oFacPrvP, ::oDbfDiv, cDivEmp(), .F. ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cTxtFacturaPago(); IIF( .F., s_oClass:ModInline( "cTxtFacturaPago", {|Self | Self, ( ::oFacPrvP:cSerFac + "/" + Alltrim( Str( ::oFacPrvP:nNumFac ) ) + "/" + Rtrim( ::oFacPrvP:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvP:dEntrada ) + Space( 1 ) + ::oFacPrvP:cCodPgo + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cCodPrv", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cNomPrv", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtFacturaPago", {|Self | Self, ( ::oFacPrvP:cSerFac + "/" + Alltrim( Str( ::oFacPrvP:nNumFac ) ) + "/" + Rtrim( ::oFacPrvP:cSufFac ) + Space( 1 ) + Dtoc( ::oFacPrvP:dEntrada ) + Space( 1 ) + ::oFacPrvP:cCodPgo + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cCodPrv", 1 ) ) + Space( 1 ) + Rtrim( oRetfld( ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac, ::oFacPrvT, "cNomPrv", 1 ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER bEdtFacturaPago(); IIF( .F., s_oClass:ModMethod( "bEdtFacturaPago", @TTurno_bEdtFacturaPago(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "bEdtFacturaPago", @TTurno_bEdtFacturaPago(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Contabiliza(); IIF( .F., s_oClass:ModMethod( "Contabiliza", @TTurno_Contabiliza(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Contabiliza", @TTurno_Contabiliza(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ContabilizaContadores(); IIF( .F., s_oClass:ModMethod( "ContabilizaContadores", @TTurno_ContabilizaContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ContabilizaContadores", @TTurno_ContabilizaContadores(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ContabilizaSesiones(); IIF( .F., s_oClass:ModMethod( "ContabilizaSesiones", @TTurno_ContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ContabilizaSesiones", @TTurno_ContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER StartContabilizaSesiones( oImageList); IIF( .F., s_oClass:ModMethod( "StartContabilizaSesiones", @TTurno_StartContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartContabilizaSesiones", @TTurno_StartContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EvalContabilizaSesiones(); IIF( .F., s_oClass:ModMethod( "EvalContabilizaSesiones", @TTurno_EvalContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EvalContabilizaSesiones", @TTurno_EvalContabilizaSesiones(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CambiaEstado(); IIF( .F., s_oClass:ModMethod( "CambiaEstado", @TTurno_CambiaEstado(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CambiaEstado", @TTurno_CambiaEstado(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER MailArqueo(); IIF( .F., s_oClass:ModMethod( "MailArqueo", @TTurno_MailArqueo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MailArqueo", @TTurno_MailArqueo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SetFastReport(oFastReport); IIF( .F., s_oClass:ModInline( "SetFastReport", {|Self,oFastReport | Self, ( ::oFastReport := oFastReport ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetFastReport", {|Self,oFastReport | Self, ( ::oFastReport := oFastReport ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER End(); IIF( .F., s_oClass:ModMethod( "End", @TTurno_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "End", @TTurno_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));







   WITH OBJECT <|Self, cTurno, cCaja|;

      ::TotVenta(    cTurno, cCaja )
      ::TotEntrada(  cTurno, cCaja )
      ::TotCompra(   cTurno, cCaja )
      ::TotCobro(    cTurno, cCaja )
      ::TotPago(     cTurno, cCaja )
      ::TotTipoIva(  cTurno, cCaja  )

      if ::oDbfCaj:SeekInOrd( cTurno + cCaja, "cCajTur" )
         ::oTotales:addTotCajaEfectivo(   cCaja, ::oDbfCaj:nCanEfe )
         ::oTotales:addTotCajaNoEfectivo( cCaja, ::oDbfCaj:nCanEfe )
         ::oTotales:addTotCajaTarjeta(    cCaja, ::oDbfCaj:nCanTar )
         ::oTotales:addTotCajaObjetivo(   cCaja, ::oDbfCaj:nCanPre )
      end

   >; _HB_MEMBER TotSesion(); IIF( .F., s_oClass:ModInline( "TotSesion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "TotSesion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, aItems|;

      local oItem

      for each oItem in aItems

         sysrefresh()

         tvSetCheckState( ::oTreeImpresion:hWnd, oItem:hItem, ::oIniArqueo:Get( "Arqueo.Impresion", oItem:cPrompt, .T. ) )

         if len( oItem:aItems ) > 0
            ::GetTreeState( oItem:aItems )
         end

      next

   >; _HB_MEMBER GetTreeState(); IIF( .F., s_oClass:ModInline( "GetTreeState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GetTreeState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, aItems|;

      local oItem

      for each oItem in aItems

         sysrefresh()

         ::oIniArqueo:Set( "Arqueo.Impresion", oItem:cPrompt, tvGetCheckState( ::oTreeImpresion:hWnd, oItem:hItem ) )

         if len( oItem:aItems ) > 0
            ::SetTreeState( oItem:aItems )
         end

      next

   >; _HB_MEMBER SetTreeState(); IIF( .F., s_oClass:ModInline( "SetTreeState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetTreeState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, cCodCaj|;

      ::oDbfCaj:GetRecno()

      if ::oDbfCaj:SeekInOrd( ::cCurTurno + cCodCaj, "cCajTur" )
         ::oDbfCaj:Load()
         ::oDbfCaj:nCanEfe := ::nImporteEfectivo
         ::oDbfCaj:nCanTar := ::nImporteTarjeta
         ::oDbfCaj:nCanRet := ::nImporteRetirado
         ::oDbfCaj:cMonEfe := ::oMoneyEfectivo:GetStream()
         ::oDbfCaj:cMonRet := ::oMoneyRetirado:GetStream()
         ::oDbfCaj:Save()
      end

      ::oDbfCaj:SetRecno()

   >; _HB_MEMBER SaveImporte(); IIF( .F., s_oClass:ModInline( "SaveImporte", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SaveImporte", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, cCodCaj|;

      ::oDbfCaj:GetRecno()

      if ::oDbfCaj:SeekInOrd( ::cCurTurno + cCodCaj, "cCajTur" )
         ::oImporteTarjeta:cText(      ::oDbfCaj:nCanTar )
         ::oImporteEfectivo:cText(     ::oDbfCaj:nCanEfe )
         ::oImporteRetirado:cText(     ::oDbfCaj:nCanRet )
         ::oMoneyEfectivo:SetStream(   ::oDbfCaj:cMonEfe )
         ::oMoneyRetirado:SetStream(   ::oDbfCaj:cMonRet )
      else
         ::oImporteTarjeta:cText(      0 )
         ::oImporteEfectivo:cText(     0 )
         ::oImporteRetirado:cText(     0 )
         ::oMoneyEfectivo:SetStream(   "" )
         ::oMoneyRetirado:SetStream(   "" )
      end

      ::oDbfCaj:SetRecno()

   >; _HB_MEMBER LoadImporte(); IIF( .F., s_oClass:ModInline( "LoadImporte", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "LoadImporte", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, cPrompt|;

      local lState      := .T.

      lState            := ::oIniArqueo:Get( "Arqueo.Impresion", cPrompt, .T. )

      if lState

         if !Empty( ::oTxt )
            ::oTxt:SetText( "Aadiendo a temporal " + Lower( cPrompt ) )
         end

         ::cGrupoEnUso  := Padr( cPrompt, 60 )
         ::nGrupoPeso++

      end

      Return ( lState )

   >; _HB_MEMBER GetItemCheckState(); IIF( .F., s_oClass:ModInline( "GetItemCheckState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GetItemCheckState", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      if !Empty( ::oTotalEfectivo )
         ::oTotalEfectivo:Refresh()
      end

      if !Empty( ::oTotalNoEfectivo )
         ::oTotalNoEfectivo:Refresh()
      end

      if !Empty( ::oTotalTarjeta )
         ::oTotalTarjeta:Refresh()
      end

      if !Empty( ::oTotalCobros )
         ::oTotalCobros:Refresh()
      end

      if !Empty( ::oTotalCaja )
         ::oTotalCaja:Refresh()
      end

      if !Empty( ::oDiferenciaEfectivo )

         if Eval( ::oDiferenciaEfectivo:bSetGet ) > 0
            ::oDiferenciaEfectivo:SetColor( 8388608, GetSysColor( 15 ) )
         else
            ::oDiferenciaEfectivo:SetColor( 128, GetSysColor( 15 ) )
         end

         ::oDiferenciaEfectivo:Refresh()

      end

      if !Empty( ::oDiferenciaTarjeta )

         if Eval( ::oDiferenciaTarjeta:bSetGet ) > 0
            ::oDiferenciaTarjeta:SetColor( 8388608, GetSysColor( 15 ) )
         else
            ::oDiferenciaTarjeta:SetColor( 128, GetSysColor( 15 ) )
         end

         ::oDiferenciaTarjeta:Refresh()

      end

      if !Empty( ::oDiferenciaTotal )

         if Eval( ::oDiferenciaTotal:bSetGet ) > 0
            ::oDiferenciaTotal:SetColor( 8388608, GetSysColor( 15 ) )
         else
            ::oDiferenciaTotal:SetColor( 128, GetSysColor( 15 ) )
         end

         ::oDiferenciaTotal:Refresh()

      end

      if !Empty( ::oImporteCambio )
         ::oImporteCambio:SetText( ::nImporteEfectivo - ::nImporteRetirado )
      end

      Return ( .T. )

   >; _HB_MEMBER RefreshTurno(); IIF( .F., s_oClass:ModInline( "RefreshTurno", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "RefreshTurno", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, uRctCli|;

      local cBanco      := ""
      local cCuenta     := ""

      IIF( uRctCli == nil, uRctCli := ::oFacCliP, ) ;

      cCuenta           := cCuentaEmpresaRecibo( uRctCli )

      if !Empty( cCuenta )
         cBanco         := oRetFld( cCodEmp() + cCuenta, ::oEmpBnc, "cCodBnc", "cCtaBnc" )
         if !Empty( cBanco )
            cCuenta     := Rtrim( cBanco ) + Space( 1 ) + Trans( cCuenta, "@R ####-####-##-##########" )
         end
      end

      Return ( cCuenta )

   >; _HB_MEMBER cBancoCuenta(); IIF( .F., s_oClass:ModInline( "cBancoCuenta", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cBancoCuenta", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TTurno ;



UTILITY STATIC function TTurno_New( cPath, oWndParent, oMenuItem) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cPath == nil, cPath := cPatEmp(), ) ;
   IIF( oWndParent == nil, oWndParent := GetWndFrame(), ) ;

   if oMenuItem <> nil
      ::nLevel          := nLevelUsr( oMenuItem )
   end

   if IsNum( ::nLevel ) .AND. nAnd( ::nLevel, 1 ) <> 0
      ::lAccess         := .F.
      msgStop( "Acceso no permitido." )
      Return ( nil )
   end

   ::cPath              := cPath
   ::oWndParent         := oWndParent

   ::oDbf               := nil

   ::cCodCaj            := Space( 3 )
   ::cOldCaj            := Space( 3 )

   ::lAutoButtons       := .T.
   ::lCreateShell       := .F.
   ::lChkSimula         := .F.
   ::lNoImprimirArqueo  := .F.
   ::lEnviarMail        := .F.
   ::lAllSesions        := .F.

   ::aTipIva            := {}

   ::cMru               := "Stopwatch_16"

   ::cIniFile           := cPatEmp() + "Empresa.Ini"
   ::oIniArqueo         := TIni():New( cPatEmp() + "Empresa.Ini" )
   ::oTotales           := TTotalTurno():New( Self )

   ::nScreenHorzRes     := GetSysMetrics( 0 )
   ::nScreenVertRes     := GetSysMetrics( 1 )





   ::cNumDocKey         := "cNumTur"
   ::cSufDocKey         := "cSufTur"

   ::lCreated           := .T.

   ::cBitmap            := ( 104 + ( 0 * 256 ) + ( 63 * 65536 ) )

RETURN ( Self )



UTILITY STATIC function TTurno_Initiate( cText, oSender) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cText              := cText
   ::oSender            := oSender
   ::lSuccesfullSend    := .F.

   ::oIniArqueo         := TIni():New( cPatEmp() + "Empresa.Ini" )

RETURN ( Self )



UTILITY STATIC function TTurno_Build( cPath, oWnd, oMenuItem) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cPath == nil, cPath := cPatEmp(), ) ;
   IIF( oWnd == nil, oWnd := GetWndFrame(), ) ;

   if !Empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end

   if oMenuItem <> nil
      ::nLevel          := nLevelUsr( oMenuItem )
   else
      ::nLevel          := 0
   end

   if nAnd( ::nLevel, 1 ) <> 0
      ::lAccess         := .F.
      msgStop( "Acceso no permitido." )
      Return ( Self )
   end

   ::cPath              := cPath
   ::oWndParent         := oWnd
   ::oDbf               := nil

   ::lChkSimula         := .F.
   ::lAllSesions        := .T.





   ::cNumDocKey         := "cNumTur"
   ::cSufDocKey         := "cSufTur"

   ::lCreated           := .T.

   if ::OpenFiles()
      ::ContabilizaSesiones()
      ::CloseFiles()
   end

RETURN ( Self )



UTILITY STATIC function TTurno_OpenFiles( lExclusive) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lOpen          := .F.
   local oError
   local oBlock

   IIF( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      lOpen             := .T.

      ::DefineFiles()

      ::oDbf:Activate(        .F., !( lExclusive ) )

      ::oDbfCaj:Activate(     .F., !( lExclusive ) )

      ::oDbfDet:Activate(     .F., !( lExclusive ) )

      ::oUser := DbfServer( "USERS.DBF", ):NewOpen( "USERS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oUser:AddBag( "USERS.CDX" ) ; ::oUser:AddBag( ) ; ::oUser:AutoIndex()

      ::oDbfDiv := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfDiv:AddBag( "DIVISAS.CDX" ) ; ::oDbfDiv:AddBag( ) ; ::oDbfDiv:AutoIndex()

      ::oIvaImp := DbfServer( "TIVA.DBF", ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oIvaImp:AddBag( "TIVA.CDX" ) ; ::oIvaImp:AddBag( ) ; ::oIvaImp:AutoIndex()

      ::oImpTik := DbfServer( "ImpTik.Dbf", ):NewOpen( "ImpTik.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oImpTik:AddBag( "ImpTik.Cdx" ) ; ::oImpTik:AddBag( ) ; ::oImpTik:AutoIndex()

      ::oCaja := DbfServer( "Cajas.Dbf", ):NewOpen( "Cajas.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCaja:AddBag( "Cajas.Cdx" ) ; ::oCaja:AddBag( ) ; ::oCaja:AutoIndex()

      ::oDbfUsr := DbfServer( "Users.Dbf", ):NewOpen( "Users.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfUsr:AddBag( "Users.Cdx" ) ; ::oDbfUsr:AddBag( ) ; ::oDbfUsr:AutoIndex()

      ::oEntSal := DbfServer( "EntSal.Dbf", ):NewOpen( "EntSal.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oEntSal:AddBag( "EntSal.Cdx" ) ; ::oEntSal:AddBag( ) ; ::oEntSal:AutoIndex()
      ::oEntSal:OrdSetFocus( "cTurEnt" )

      ::oTikT := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikT:AddBag( "TIKET.CDX" ) ; ::oTikT:AddBag( ) ; ::oTikT:AutoIndex()
      ::oTikT:OrdSetFocus( "cTurTik" )

      ::oTikL := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikL:AddBag( "TIKEL.CDX" ) ; ::oTikL:AddBag( ) ; ::oTikL:AutoIndex()

      ::oTikP := DbfServer( "TIKEP.DBF", ):NewOpen( "TIKEP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikP:AddBag( "TIKEP.CDX" ) ; ::oTikP:AddBag( ) ; ::oTikP:AutoIndex()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      ::oPreCliT := DbfServer( "PRECLIT.DBF", ):NewOpen( "PRECLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliT:AddBag( "PRECLIT.CDX" ) ; ::oPreCliT:AddBag( ) ; ::oPreCliT:AutoIndex()
      ::oPreCliT:OrdSetFocus( "CTURPRE" )

      ::oPreCliL := DbfServer( "PRECLIL.DBF", ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliL:AddBag( "PRECLIL.CDX" ) ; ::oPreCliL:AddBag( ) ; ::oPreCliL:AutoIndex()

      ::oPedCliT := DbfServer( "PEDCLIT.DBF", ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliT:AddBag( "PEDCLIT.CDX" ) ; ::oPedCliT:AddBag( ) ; ::oPedCliT:AutoIndex()
      ::oPedCliT:OrdSetFocus( "CTURPED" )

      ::oPedCliL := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PEDCLIL.CDX" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()

      ::oPedCliP := DbfServer( "PEDCLIP.DBF", ):NewOpen( "PEDCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliP:AddBag( "PEDCLIP.CDX" ) ; ::oPedCliP:AddBag( ) ; ::oPedCliP:AutoIndex()
      ::oPedCliP:OrdSetFocus( "cTurRec" )

      ::oFacCliT := DbfServer( "FACCLIT.DBF", ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliT:AddBag( "FACCLIT.CDX" ) ; ::oFacCliT:AddBag( ) ; ::oFacCliT:AutoIndex()
      ::oFacCliT:OrdSetFocus( "CTURFAC" )

      ::oFacCliL := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FACCLIL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()

      ::oFacCliP := DbfServer( "FACCLIP.DBF", ):NewOpen( "FACCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliP:AddBag( "FACCLIP.CDX" ) ; ::oFacCliP:AddBag( ) ; ::oFacCliP:AutoIndex()

      ::oRctCliT := DbfServer( "FacRecT.DBF", ):NewOpen( "FacRecT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctCliT:AddBag( "FacRecT.CDX" ) ; ::oRctCliT:AddBag( ) ; ::oRctCliT:AutoIndex()
      ::oRctCliT:OrdSetFocus( "cTurFac" )

      ::oRctCliL := DbfServer( "FacRecL.DBF", ):NewOpen( "FacRecL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctCliL:AddBag( "FacRecL.CDX" ) ; ::oRctCliL:AddBag( ) ; ::oRctCliL:AutoIndex()

      ::oAlbCliT := DbfServer( "ALBCLIT.DBF", ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliT:AddBag( "ALBCLIT.CDX" ) ; ::oAlbCliT:AddBag( ) ; ::oAlbCliT:AutoIndex()
      ::oAlbCliT:OrdSetFocus( "cTurAlb" )

      ::oAlbCliL := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "ALBCLIL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()

      ::oAlbCliP := DbfServer( "ALBCLIP.DBF", ):NewOpen( "ALBCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliP:AddBag( "ALBCLIP.CDX" ) ; ::oAlbCliP:AddBag( ) ; ::oAlbCliP:AutoIndex()
      ::oAlbCliP:OrdSetFocus( "cTurRec" )

      ::oArticulo := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArticulo:AddBag( "ARTICULO.CDX" ) ; ::oArticulo:AddBag( ) ; ::oArticulo:AutoIndex()

      ::oClient := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oClient:AddBag( "CLIENT.CDX" ) ; ::oClient:AddBag( ) ; ::oClient:AutoIndex()

      ::oProvee := DbfServer( "Provee.Dbf", ):NewOpen( "Provee.Dbf",, ( cDriver() ),, ( cPatPrv() ), .F., .T., .F., .F. ) ; ::oProvee:AddBag( "Provee.Cdx" ) ; ::oProvee:AddBag( ) ; ::oProvee:AutoIndex()

      ::oFPago := DbfServer( "FPAGO.DBF", ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oFPago:AddBag( "FPAGO.CDX" ) ; ::oFPago:AddBag( ) ; ::oFPago:AutoIndex()

      ::oFacPrvT := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FACPRVT.CDX" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()
      ::oFacPrvT:OrdSetFocus( "CTURFAC" )

      ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()

      ::oFacPrvP := DbfServer( "FACPRVP.DBF", ):NewOpen( "FACPRVP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvP:AddBag( "FACPRVP.CDX" ) ; ::oFacPrvP:AddBag( ) ; ::oFacPrvP:AutoIndex()

      ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()
      ::oAlbPrvT:OrdSetFocus( "CTURALB" )

      ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()

      ::oPedPrvT := DbfServer( "PEDPROVT.DBF", ):NewOpen( "PEDPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvT:AddBag( "PEDPROVT.CDX" ) ; ::oPedPrvT:AddBag( ) ; ::oPedPrvT:AutoIndex()
      ::oPedPrvT:OrdSetFocus( "CTURPED" )

      ::oRctPrvT := DbfServer( "RctPrvT.Dbf", ):NewOpen( "RctPrvT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvT:AddBag( "RctPrvT.Cdx" ) ; ::oRctPrvT:AddBag( ) ; ::oRctPrvT:AutoIndex()
      ::oRctPrvT:OrdSetFocus( "cTurFac" )

      ::oRctPrvL := DbfServer( "RctPrvL.Dbf", ):NewOpen( "RctPrvL.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RctPrvL.Cdx" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()

      ::oAntCliT := DbfServer( "AntCliT.Dbf", ):NewOpen( "AntCliT.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAntCliT:AddBag( "AntCliT.Cdx" ) ; ::oAntCliT:AddBag( ) ; ::oAntCliT:AutoIndex()

      ::oFamilia := DbfServer( "Familias.Dbf", ):NewOpen( "Familias.Dbf",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oFamilia:AddBag( "Familias.Cdx" ) ; ::oFamilia:AddBag( ) ; ::oFamilia:AutoIndex()

      ::oTemporada := DbfServer( "Temporadas.Dbf", ):NewOpen( "Temporadas.Dbf",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTemporada:AddBag( "Temporadas.Cdx" ) ; ::oTemporada:AddBag( ) ; ::oTemporada:AutoIndex()

      ::oCategoria := DbfServer( "Categorias.DBF", ):NewOpen( "Categorias.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oCategoria:AddBag( "Categorias.CDX" ) ; ::oCategoria:AddBag( ) ; ::oCategoria:AutoIndex()

      ::oDbfCnt := DbfServer( "nCount.Dbf", ):NewOpen( "nCount.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfCnt:AddBag( "nCount.Cdx" ) ; ::oDbfCnt:AddBag( ) ; ::oDbfCnt:AutoIndex()

      ::oDbfEmp := DbfServer( "Empresa.Dbf", ):NewOpen( "Empresa.Dbf",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDbfEmp:AddBag( "Empresa.Cdx" ) ; ::oDbfEmp:AddBag( ) ; ::oDbfEmp:AutoIndex()

      ::oDbfDoc := DbfServer( "RDocumen.Dbf", ):NewOpen( "RDocumen.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDbfDoc:AddBag( "RDocumen.Cdx" ) ; ::oDbfDoc:AddBag( ) ; ::oDbfDoc:AutoIndex()
      ::oDbfDoc:OrdSetFocus( "cTipo" )

      ::oEmpBnc := DbfServer( "EmpBnc.Dbf", ):NewOpen( "EmpBnc.Dbf",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oEmpBnc:AddBag( "EmpBnc.Cdx" ) ; ::oEmpBnc:AddBag( ) ; ::oEmpBnc:AutoIndex()

      ::oLogPorta := DbfServer( "LogPorta.Dbf", ):NewOpen( "LogPorta.Dbf",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oLogPorta:AddBag( "LogPorta.Cdx" ) ; ::oLogPorta:AddBag( ) ; ::oLogPorta:AutoIndex()

      ::oTipInv         := TInvitacion():Create( cPatGrp() )
      if !::oTipInv:OpenFiles( .F. )
         lOpen          := .F.
      end

      ::oBandera        := TBandera():New()

      ::oNewImp         := TNewImp():Create( cPatEmp() )
      if !::oNewImp:OpenFiles( .F. )
         lOpen          := .F.
      end

      ::oTipArt         := TTipArt():Create( cPatArt() )
      if !::oTipArt:OpenFiles()
         lOpen          := .F.
      end

      ::oFabricante        := TFabricantes():Create( cPatArt() )
      if !::oFabricante:OpenFiles()
         lOpen             := .F.
      end

      ::oCuentasBancarias  := TCuentasBancarias():Create( cPatEmp() )
      if !::oCuentasBancarias:OpenFiles()
         lOpen             := .F.
      end

      ::lLoadDivisa()

   RECOVER USING oError

      lOpen             := .F.
      msgStop( "Imposible abrir todas las bases de datos de sesiones" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   if !lOpen
      ::CloseFiles()
   end

RETURN ( lOpen )



UTILITY STATIC function TTurno_OpenService( lExclusive) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lOpen          := .T.
   local oError
   local oBlock

   IIF( lExclusive == nil, lExclusive := .F., ) ;

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      ::DefineFiles()

      ::oDbf:Activate(        .F., !( lExclusive ) )
      ::oDbfCaj:Activate(     .F., !( lExclusive ) )
      ::oDbfDet:Activate(     .F., !( lExclusive ) )

   RECOVER USING oError

      msgStop( "Imposible abrir todas las bases de datos de turnos" + Chr(13)+Chr(10) + Chr(13)+Chr(10) + ErrorMessage( oError ) )

      ::CloseService()

      lOpen             := .F.

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



UTILITY STATIC function TTurno_DefineFiles( cPath) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbf := DbfServer( "TURNO.DBF", "TurnoT" ):New( "TURNO.DBF", "TurnoT", ( cDriver() ), "Sesiones", ( ::cPath ) )

      ::oDbf:AddField( "LSNDTUR", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "BSNDTUR", "B", 14, 0,,,, {|| ::oDbf:lSndTur }, { "Envio", "Lbl16" , 3 }, .F., 20, .F., {"Sel16", "Nil16"} )
      ::oDbf:AddField( "LCLOTUR", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "LCONTUR", "L", 1, 0,,,,, "Cn", .F.,, .T., {} )
      ::oDbf:AddField( "BCLOTUR", "B", 14, 0,,,, {|| ::oDbf:lConTur }, { "Contabilizado", "BmpConta16" , 3 }, .F., 20, .F., {"Sel16", "Nil16"} )
      ::oDbf:AddField( "CCLOTUR", "B", 20, 0,,,, {|| if( ::oDbf:lCloTur, "Cerrado", "Abierto" ) }, "Estado", .F., 60, .F., {} )
      ::oDbf:AddField( "CNUMTUR", "C", 6, 0,,,,, "Nmero", .T., 60, .F., {} )
      ::oDbf:AddField( "CSUFTUR", "C", 2, 0,,,,, "Delegacin", .F., 40, .F., {} )
      ::oDbf:AddField( "DOPNTUR", "D", 8, 0,,,,, "Fecha inicio", .F., 80, .F., {} )
      ::oDbf:AddField( "CHOROPN", "C", 5, 0,,,,, "Hora inicio", .F., 60, .F., {} )
      ::oDbf:AddField( "DCLOTUR", "D", 8, 0,,,,, "Fecha fin", .F., 80, .F., {} )
      ::oDbf:AddField( "CHORCLO", "C", 5, 0,,,,, "Hora fin", .F., 60, .F., {} )
      ::oDbf:AddField( "CCAJTUR", "C", 3, 0,,,,, "Usuario", .F., 50, .F., {} )
      ::oDbf:AddField( "CNCJTUR", "B", 150, 0,,,, {|| ::cNombreUser() }, "Nombre", .F., 180, .F., {} )
      ::oDbf:AddField( "LBEFCLO", "L", 1, 0,,,,, "", .F.,, .T., {} )
      ::oDbf:AddField( "MCOMTUR", "M", 10, 0,,,,, "Comentarios", .F., 300, .F., {} )

      ::oDbf:AddIndex( "cNumTur", "TURNO.CDX", "cNumTur + cSufTur", "!Deleted()",, .F., .F., "Nmero",,, .F., .F. )
      ::oDbf:AddIndex( "lCloTur", "TURNO.CDX", "lCloTur", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbf:AddIndex( "dOpnTur", "TURNO.CDX", "dOpnTur", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbf:AddIndex( "lSndTur", "TURNO.CDX", "lSndTur", "!Deleted()",, .F., .F.,,,, .F., .F. )



   ::oDbfCaj := DbfServer( "TURNOC.DBF", "TurnoC" ):New( "TURNOC.DBF", "TurnoC", ( cDriver() ), "Cajas por sesiones", ( ::cPath ) )

      ::oDbfCaj:AddField( "cNumTur", "C", 6, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cSufTur", "C", 2, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cCodCaj", "C", 3, 0,,,,, "Caja", .F.,, .F., {} )
      ::oDbfCaj:AddField( "lCajClo", "L", 1, 0,,,,, "Caja cerrada", .F.,, .F., {} )
      ::oDbfCaj:AddField( "lCajSel", "L", 1, 0,,,,, "Caja seleccionada", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cCajTur", "C", 3, 0,,,,, "Usuario", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cNcjTur", "B", 150, 0,,,, {|| ::cNombreUser() }, "Nombre", .F.,, .F., {} )
      ::oDbfCaj:AddField( "dFecClo", "D", 8, 0,,,,, "Fecha Fin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cHorClo", "C", 5, 0,,,,, "Hora Fin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivEfe", "C", 3, 0,,,,, "Divisa de efectivo", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanEfe", "N", 16, 6,,,,, "Importe de efectivo", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cMonEfe", "C", 200, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivTar", "C", 3, 0,,,,, "Divisa de tarjeta", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanTar", "N", 16, 6,,,,, "Importe de tarjeta", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanRet", "N", 16, 6,,,,, "Importe retirado", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cMonRet", "C", 200, 0,,,,, "", .F.,, .F., {} )
      ::oDbfCaj:AddField( "nCanPre", "N", 16, 6,,,,, "Objetivo de la sesin", .F.,, .F., {} )
      ::oDbfCaj:AddField( "cDivPre", "C", 3, 0,,,,, "Divisa del objetivo de la sesin", .F.,, .F., {} )

      ::oDbfCaj:AddIndex( "cNumTur", "TURNOC.CDX", "cNumTur + cSufTur", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "cCajTur", "TURNOC.CDX", "cNumTur + cSufTur + cCodCaj", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "lCajClo", "TURNOC.CDX", "lCajClo", "!Deleted()",, .F., .F.,,,, .F., .F. )
      ::oDbfCaj:AddIndex( "dFecClo", "TURNOC.CDX", "dFecClo", "!Deleted()",, .F., .F.,,,, .F., .F. )







   ::oDbfDet := DbfServer( "TURNOL.DBF", "TurnoL" ):New( "TURNOL.DBF", "TurnoL", ( cDriver() ), "Lineas de contadores en turnos de venta", ( ::cPath ) )

      ::oDbfDet:AddField( "CNUMTUR", "C", 6, 0, "######",,,, "Nmero", .F.,, .F., {} )
      ::oDbfDet:AddField( "CSUFTUR", "C", 2, 0,,,,, "Sufijo", .F.,, .F., {} )
      ::oDbfDet:AddField( "CCODART", "C", 18, 0,,,,, "Cdigo del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "CNOMART", "C", 50, 0,,,,, "Nombre del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "NCANANT", "N", 16, 6,,,,, "Cantidad anterior del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "NCANACT", "N", 16, 6,,,,, "Cantidad posterior del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "NPVPART", "N", 16, 6,,,,, "Importe de venta del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "NIVAART", "N", 5, 2,,,,, "Porcentaje de " + cImp() + " del artculo", .F.,, .F., {} )
      ::oDbfDet:AddField( "nValImp", "N", 16, 6, ::cPouDiv,,,, "Importe de impuesto especial", .F.,, .F., {} )

      ::oDbfDet:AddIndex( "CNUMTUR", "TURNOL.CDX", "cNumTur + cSufTur + cCodArt", "!Deleted()",, .F., .F.,,,, .F., .F. )



RETURN ( ::oDbf )



UTILITY STATIC function TTurno_CloseService() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::oDbf:Used()
      ::oDbf:end()
   end

   if ::oDbfCaj:Used()
      ::oDbfCaj:end()
   end

   if ::oDbfDet:Used()
      ::oDbfDet:end()
   end

   ::oDbf         := nil
   ::oDbfCaj      := nil
   ::oDbfDet      := nil

RETURN ( Self )



UTILITY STATIC function TTurno_Activate() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSnd

   ::CreateShell()






   ::oWndBrw:NewAt( "BUS",,, {||( ::oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )
      ::oWndBrw:AddSeaBar()






   ::oWndBrw:NewAt( "EDIT",,, {||( ::oWndBrw:SetOnProcess(), if( ::oDbf:lCloTur, ::lArqueoTurno( .T. ), MsgStop( "Sesin no cerrada." ) ), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "(Z)oom", "Z",,, 4,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_REFRESH_",,, {||( ::oWndBrw:SetOnProcess(), ::lArqueoTurno( .F., .F., .T. ), ::oWndBrw:QuitOnProcess() )}, "(A)rqueo parcial", "A",,, 8,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_STOP_",,, {||( ::oWndBrw:SetOnProcess(), ::lArqueoTurno( .F. ), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "(C)errar sesin", "C",,, 8,, .F. )






   ::oWndBrw:NewAt( "STOPWATCH_RESET_",,, {||( ::oWndBrw:SetOnProcess(), ::lInvCierre(), ::oWndBrw:QuitOnProcess(), ::oWndBrw:SetFocus() )}, "I(n)vertir cierre", "N",,, 2,, .F. )






   ::oWndBrw:NewAt( "IMP",,, {||( ::DlgImprimir( 1 ), ::oWndBrw:SetFocus() )}, "(I)mprimir", "I",,, 32,, .F. )






   ::oWndBrw:NewAt( "Prev1",,, {||( ::DlgImprimir( 2 ), ::oWndBrw:SetFocus() )}, "(P)revisualizar", "P",,, 32,, .F. )






   ::oWndBrw:NewAt( "BmpConta",,, {||( ::oWndBrw:SetOnProcess(), ::ContabilizaSesiones(), ::oWndBrw:QuitOnProcess(),::oWndBrw:Refresh() )}, "C(o)ntabilizar", "O",,, 4,, .F. )






   ::oWndBrw:NewAt( "CHGSTATE",,, {||( ::SelectRec( {|| ::CambiaEstado() }, "Cambiar estado", "Contabilizado" ), ::oWndBrw:Refresh() )}, "Cambiar es(t)ado", "T",,, 4,, .F. )







   oSnd := ::oWndBrw:NewAt( "Lbl",,, {||( ::SelectRec( {| lSel | ::lSelectTurno( lSel ) }, "Seleccionar sesiones para enviar", "Enviar" ), ::oWndBrw:Refresh() )}, "En(v)iar", "V",, {|This|This:Toggle()},,, .F. )





   ::oWndBrw:NewAt( "BFILTER",,, {||( ::Filter() )}, "(F)iltrar", "F",,, 2,, .F. )





   ::oWndBrw:NewAt( "END1",,, {||( ::End() )}, "(S)alir", "S",,,,, .F. )

   ::oWndBrw:cHtmlHelp  := "Sesin"
   ::oWndBrw:bEdit      := {|| ( if( ::oDbf:lCloTur, ::lArqueoTurno( .T. ), MsgStop( "Sesin no cerrada." ) ), .T. ) }

   ::oWndBrw:Activate(  , , , , , , , , , , , , , , , , {|| ::CloseFiles() } )

Return ( .T. )



UTILITY STATIC function TTurno_Resource( nMode) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg

   oDlg = TDialog():New(,,,, "Sesin", "TURNOS",, .F.,,,,,, .F.,,,,,, .F., )





      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:cNumTur, ::oDbf:cNumTur:= u ) }, oDlg,, "######",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cCloTur, ::oDbf:cCloTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .T.,,,,,, nil,,, )




      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::oDbf:cCajTur, ::oDbf:cCajTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 121, { | u | If( PCount()==0, ::oDbf:cNcjTur, ::oDbf:cNcjTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::oDbf:dOpnTur, ::oDbf:dOpnTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::oDbf:cHorOpn, ::oDbf:cHorOpn:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::oDbf:dCloTur, ::oDbf:dCloTur:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::oDbf:cHorClo, ::oDbf:cHorClo:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TButton():ReDefine( 1, {||( oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN ( oDlg:nResult == 1 )



UTILITY STATIC function TTurno_CloseFiles() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !Empty( ::oDbf ) .AND.::oDbf:Used()
      ::oDbf:end()
   end

   if !Empty( ::oDbfCaj ) .AND.::oDbfCaj:Used()
      ::oDbfCaj:end()
   end

   if !Empty( ::oDbfDet ) .AND.::oDbfDet:Used()
      ::oDbfDet:end()
   end

   if !Empty( ::oEntSal ) .AND. ::oEntSal:Used()
      ::oEntSal:end()
   end

   if !Empty( ::oTikT ) .AND. ::oTikT:Used()
      ::oTikT:end()
   end

   if !Empty( ::oTikL ) .AND. ::oTikL:Used()
      ::oTikL:end()
   end

   if !Empty( ::oTikP ) .AND. ::oTikP:Used()
      ::oTikP:end()
   end

   if !Empty( ::oPreCliT ) .AND. ::oPreCliT:Used()
      ::oPreCliT:end()
   end

   if !Empty( ::oPreCliL ) .AND. ::oPreCliL:Used()
      ::oPreCliL:end()
   end

   if !Empty( ::oPedCliT ) .AND. ::oPedCliT:Used()
      ::oPedCliT:end()
   end

   if !Empty( ::oPedCliL ) .AND. ::oPedCliL:Used()
      ::oPedCliL:end()
   end

   if !Empty( ::oPedCliP ) .AND. ::oPedCliP:Used()
      ::oPedCliP:end()
   end

   if !Empty( ::oFacCliT ) .AND. ::oFacCliT:Used()
      ::oFacCliT:end()
   end

   if !Empty( ::oFacCliL ) .AND. ::oFacCliL:Used()
      ::oFacCliL:end()
   end

   if !Empty( ::oFacCliP ) .AND. ::oFacCliP:Used()
      ::oFacCliP:end()
   end

   if !Empty( ::oRctCliT ) .AND. ::oRctCliT:Used()
      ::oRctCliT:end()
   end

   if !Empty( ::oRctCliL ) .AND. ::oRctCliL:Used()
      ::oRctCliL:end()
   end

   if !Empty( ::oAlbCliT ) .AND. ::oAlbCliT:Used()
      ::oAlbCliT:end()
   end

   if !Empty( ::oAlbCliL ) .AND. ::oAlbCliL:Used()
      ::oAlbCliL:end()
   end

   if !Empty( ::oAlbCliP ) .AND. ::oAlbCliP:Used()
      ::oAlbCliP:end()
   end

   if !Empty( ::oArticulo ) .AND. ::oArticulo:Used()
      ::oArticulo:end()
   end

   if !Empty( ::oUser ) .AND. ::oUser:Used()
      ::oUser:end()
   end

   if !Empty( ::oDbfCnt ) .AND. ::oDbfCnt:Used()
      ::oDbfCnt:end()
   end

   if !Empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:end()
   end

   if !Empty( ::oDbfCaj ) .AND. ::oDbfCaj:Used()
      ::oDbfCaj:end()
   end

   if !Empty( ::oDbfDet ) .AND. ::oDbfDet:Used()
      ::oDbfDet:end()
   end

   if !Empty( ::oDbfDiv ) .AND. ::oDbfDiv:Used()
      ::oDbfDiv:end()
   end

   if !Empty( ::oIvaImp ) .AND. ::oIvaImp:Used()
      ::oIvaImp:end()
   end

   if !Empty( ::oClient ) .AND. ::oClient:Used()
      ::oClient:end()
   end

   if !Empty( ::oProvee ) .AND. ::oProvee:Used()
      ::oProvee:end()
   end

   if !Empty( ::oFPago ) .AND. ::oFPago:Used()
      ::oFPago:end()
   end

   if !Empty( ::oFacPrvT ) .AND. ::oFacPrvT:Used()
      ::oFacPrvT:end()
   end

   if !Empty( ::oRctPrvT ) .AND. ::oRctPrvT:Used()
      ::oRctPrvT:end()
   end

   if !Empty( ::oPedPrvT ) .AND. ::oPedPrvT:Used()
      ::oPedPrvT:end()
   end

   if !Empty( ::oAlbPrvT ) .AND. ::oAlbPrvT:Used()
      ::oAlbPrvT:end()
   end

   if !Empty( ::oAlbPrvL ) .AND. ::oAlbPrvL:Used()
      ::oAlbPrvL:end()
   end

   if !Empty( ::oFacPrvL ) .AND. ::oFacPrvL:Used()
      ::oFacPrvL:end()
   end

   if !Empty( ::oRctPrvL ) .AND. ::oRctPrvL:Used()
      ::oRctPrvL:end()
   end

   if !Empty( ::oFacPrvP ) .AND. ::oFacPrvP:Used()
      ::oFacPrvP:end()
   end

   if !Empty( ::oAntCliT ) .AND. ::oAntCliT:Used()
      ::oAntCliT:end()
   end

   if !Empty( ::oCaja ) .AND. ::oCaja:Used()
      ::oCaja:end()
   end

   if !Empty( ::oImpTik ) .AND. ::oImpTik:Used()
      ::oImpTik:end()
   end

   if !Empty( ::oEmpBnc ) .AND. ::oEmpBnc:Used()
      ::oEmpBnc:end()
   end

   if !Empty( ::oFamilia ) .AND. ::oFamilia:Used()
      ::oFamilia:end()
   end

   if !Empty( ::oTemporada ) .AND. ::oTemporada:Used()
      ::oTemporada:end()
   end

   if !Empty( ::oCategoria ) .AND. ::oCategoria:Used()
      ::oCategoria:end()
   end

   if !Empty( ::oDbfEmp ) .AND. ::oDbfEmp:Used()
      ::oDbfEmp:end()
   end

   if !Empty( ::oDbfDoc ) .AND. ::oDbfDoc:Used()
      ::oDbfDoc:End()
   end

   if !Empty( ::oDbfUsr ) .AND. ::oDbfUsr:Used()
      ::oDbfUsr:End()
   end

   if !Empty( ::oLogPorta ) .AND. ::oLogPorta:Used()
      ::oLogPorta:End()
   end

   if !Empty( ::oDbfTemporal )
      ::DestroyTemporal()
   end

   if !Empty( ::oBandera )
      ::oBandera:end()
   end

   if !Empty( ::oTipArt )
      ::oTipArt:end()
   end

   if !Empty( ::oFabricante )
      ::oFabricante:end()
   end

   if !Empty( ::oCuentasBancarias )
      ::oCuentasBancarias:End()
   end

   if !Empty( ::oNewImp )
      ::oNewImp:end()
   end

   if !Empty( ::oTipInv )
      ::oTipInv:end()
   end

RETURN ( .T. )






UTILITY STATIC function TTurno_lOpenTurno() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::OpenTurno    := .F.





   if Empty( ::oDbf ) .AND. ::oDbf:Used()
      Return( ::OpenTurno )
   end

   if !::oDbf:Used()
      Return( ::OpenTurno )
   end

   if ::oDbf:RecCount() == 0
      Return( ::OpenTurno )
   end

   ::OpenTurno    := ::oDbf:SeekInOrd( .F., "lCloTur" )

RETURN ( ::OpenTurno )







UTILITY STATIC function TTurno_lOpenCaja() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::OpenCaja     := .F.

   if ::oDbfCaj:RecCount() == 0
      Return ( ::OpenCaja )
   end

   ::OpenCaja     := ::oDbfCaj:SeekInOrd( ::oDbf:cNumTur + ::oDbf:cSufTur +  oUser():cCaja(), "cCajTur" )

RETURN ( ::OpenCaja )






UTILITY STATIC function TTurno_lCloseSesion( oDlg) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oInternet
   local nCajasCerradas := 0
   local nTotalCajas    := 0
   local cCurrentTruno  := ::cCurTurno





   oDlg:Disable()





   if !Empty( ::oAni )
      ::oAni:Show()
   end





   if !::lArqueoParcial
      if ::oDbf:Seek( cCurrentTruno )
         ::oDbf:FieldPutByName( "mComTur", ::cComentario )
      end
   end





   if !::lArqueoParcial





      ::oDbfCaj:GetStatus( .T. )
      if ::oDbfCaj:Seek( cCurrentTruno )

         while ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur == cCurrentTruno .AND. !::oDbfCaj:Eof()

            nTotalCajas++

            if ::oDbfCaj:lCajSel





               ::lCloseCaja( .T., ::oDbfCaj:cCodCaj )





               ::lCloEntSal( .T., ::oDbfCaj:cCodCaj )





               nCajasCerradas++

            elseif ::oDbfCaj:lCajClo

               nCajasCerradas++

            end





            ::oDbfCaj:Skip()

            SysRefresh()

         end

      end





      if nCajasCerradas >= nTotalCajas
         ::lCloseTurno()
      end

   end





   if ::oDbfCaj:Seek( cCurrentTruno )

      while ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur == cCurrentTruno .AND. !::oDbfCaj:Eof()

         if ::oDbfCaj:lCajSel





            if !::lArqueoParcial .AND. ::lEnviarMail .AND. !Empty( ::cEnviarMail )

               if !Empty( ::oTxt )
                  ::oTxt:SetText( "Enviando mail..." )
               end

               ::MailArqueo( cCurrentTruno )

            end





            if !::lNoImprimirArqueo

               if !Empty( ::oTxt )
                  ::oTxt:SetText( "Imprimiendo..." )
               end

               ::PrintArqueo( cCurrentTruno, ::oDbfCaj:cCodCaj, ::cCmbReport, "", ::cPrnArq, ::cWinArq )

            end

         end





         ::oDbfCaj:Skip()

         SysRefresh()

      end

   end

   ::oDbfCaj:SetStatus()

   ::oDbf:SetStatus()





   if ::lEnvioInformacion .AND. !::lArqueoParcial

      if !Empty( ::oTxt )
         ::oTxt:SetText( "Enviando informacin a servidores..." )
      end

      oInternet   := TSndRecInf():New():LoadFromIni():Activate( nil, .T. )

   end

   if !Empty( ::oAni )
      ::oAni:Hide()
   end

   oDlg:Enable()

RETURN ( .T. )



UTILITY STATIC function TTurno_lCloseCaja( lClose, cCodCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nProcc         := 0

   IIF( lClose == nil, lClose := .T., ) ;





   if ::oMeter <> nil
      ::oMeter:Show()
      ::oMeter:nTotal   := 8
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pedidos de proveedor" )
   end

   ::lCloPedPrv( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando albaranes de proveedor" )
   end

   ::lCloAlbPrv( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando facturas de proveedor" )
   end

   ::lCloFacPrv( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando presupuestos de proveedor" )
   end

   ::lCloPreCli( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pedidos de clientes" )
   end

   ::lCloPedCli( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando albaranes de clientes" )
   end

   ::lCloAlbCli( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando facturas de clientes" )
   end

   ::lCloFacCli( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando tikets" )
   end

   ::lCloTiket( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando pagos" )
   end

   ::lCloPgoTik( lClose, cCodCaja )





   if ::oMeter <> nil
      ::oMeter:Set( ++nProcc )
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Cerrando cajas" )
   end

   ::oDbfCaj:Load()
   ::oDbfCaj:lCajClo    := lClose
   ::oDbfCaj:dFecClo    := ::dFecTur
   ::oDbfCaj:cHorClo    := ::cHorTur
   ::oDbfCaj:Save()

RETURN ( .T. )



UTILITY STATIC function TTurno_lCloseTurno() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbf:GetStatus()
   ::oDbf:OrdSetFocus( "cNumTur" )

   if ::oDbf:Seek( ::cCurTurno )

      ::oDbf:Load()

      ::oDbf:dCloTur       := ::dFecTur
      ::oDbf:cHorClo       := ::cHorTur
      ::oDbf:cCajTur       := ::cCajTur

      ::oDbf:lCloTur       := .T.
      ::oDbf:lSndTur       := .T.





      if !::oDbf:lBefClo
         ::oDbf:lBefClo    := .T.
      end

      ::oDbf:Save()





      ::oMeter:Show()
      ::oMeter:Refresh()

      if !Empty( ::oTxt )
         ::oTxt:SetText( "Escribiendo contadores" )
      end

      if ::oDbfDet:Seek( ::cCurTurno )

         while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::cCurTurno .AND. !::oDbfDet:eof()

            if ::oArticulo:Seek( ::oDbfDet:cCodArt )

               ::oArticulo:Load()
               ::oArticulo:nCntAct  := ::oDbfDet:nCanAct
               ::oArticulo:Save()

            end

            ::oDbfDet:Skip()
            SysRefresh()

         end

      end





      ::oMeter:Set( 0 )

      if !Empty( ::oTxt )
         ::oTxt:SetText( "Cerrando la sesin" )
      end

      CloSesion()

   else

      MsgStop( "La sesin " + Trans( ::cCurTurno, "@R ######/##" ) + " no existe", "Imposible cerrar" )

   end

   ::oDbf:SetStatus()

Return ( .T. )



UTILITY STATIC function TTurno_lCreateTurno() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg
   local oBmp
   local oCodUsr
   local oNomUsr
   local cNomUsr
   local nNumTur        := 0
   local oImporte
   local oObjetivo
   local oDescripcion
   local cPicImp        := cPorDiv( cDivEmp(), ::oDbfDiv )
   local oDivisa
   local cDivisa        := cDivEmp()
   local oBmpDiv
   local oBtnOk
   local oSayUsr
   local cSayUsr        := Capitalize( RetFld( cCurUsr(), ::oUser:cAlias ) )
   local oBtnUser
   local oDivObjetivo
   local cDivObjetivo   := cDivEmp()
   local oBmpObjetivo
   local oCaja
   local cCaja          := oUser():cCaja()
   local cNombreCaja    := oRetFld( cCaja, ::oCaja )
   local cResource      := "ApTurnoTCT"





   if Empty( ::oDbf:dOpnTur )
      ::dOpenTurno      := GetSysDate()
   else
      ::dOpenTurno      := ::oDbf:dOpnTur
   end

   if Empty( ::oDbf:cHorOpn )
      ::cHoraTurno      := SubStr( Time(), 1, 5 )
   else
      ::cHoraTurno      := ::oDbf:cHorOpn
   end

   if Empty( ::oDbf:cCajTur )
      ::cCajeroTurno    := cCurUsr()
   else
      ::cCajeroTurno    := ::oDbf:cCajTur
   end

   ::nObjetivoTurno     := 0
   ::nImporteTurno      := ::GetLastEfectivo()
   ::cDescripcionTurno  := "APERTURA DE SESIN"





   if ::lArqueoTactil
      if GetSysMetrics( 1 ) == 560
         cResource      := "ApTurnoTCT_1024x560"
      end
   else
      cResource         := "ApTurno"
   end

   oDlg = TDialog():New(,,,,, cResource,, .F.,,,,,, .F.,,,,,, .F., )





      oBmp := TBitmap():ReDefine( 600, "Clock_run_48_alpha",, oDlg,,, .F., .F.,,, .F.,,, .T. )





      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, nNumTur, nNumTur:= u ) }, oDlg,, "######",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::dOpenTurno, ::dOpenTurno:= u ) }, oDlg,, "@!",,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cHoraTurno, ::cHoraTurno:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )






      oCaja := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, cCaja, cCaja:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 171, { | u | If( PCount()==0, cNombreCaja, cNombreCaja:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

    if ::lArqueoTactil






      oCodUsr := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cCajeroTurno, ::cCajeroTurno:= u ) }, oDlg,,, {||    cUser( oCodUsr, , oNomUsr )},,,,,, .T.,,, .F., .F.,,,,, {|Self|( BrwUserTactil( oCodUsr, , oNomUsr ) )}, nil, "LUPA_24",, )

      oCodusr:nMargin   := 25

    else






      oCodUsr := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cCajeroTurno, ::cCajeroTurno:= u ) }, oDlg,,, {||    cUser( oCodUsr, , oNomUsr )},,,,,, .T.,,, .F., .F.,,,,, {|Self|( BrwUser( oCodUsr, , oNomUsr ) )}, nil, "LUPA",, )

    end




      oNomUsr := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, cNomUsr, cNomUsr:= u ) }, oDlg,,,,,,,,, .T., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      oImporte := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nImporteTurno, ::nImporteTurno:= u ) }, oDlg,, ( cPicImp ),,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )






      oDivisa := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cDivisa, cDivisa:= u ) }, oDlg,, "@!", {||    ( cDiv( oDivisa, oBmpDiv, , , , ::oDbfDiv:cAlias, ::oBandera ) )},,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )




      oDescripcion := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::cDescripcionTurno, ::cDescripcionTurno:= u ) }, oDlg,, "@!",,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )




      oObjetivo := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::nObjetivoTurno, ::nObjetivoTurno:= u ) }, oDlg,, ( cPicImp ),,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )






      oDivObjetivo := TGetHlp():ReDefine( 161, { | u | If( PCount()==0, cDivObjetivo, cDivObjetivo:= u ) }, oDlg,, "@!", {||    ( cDiv( oDivObjetivo, oBmpObjetivo, , , , ::oDbfDiv:cAlias, ::oBandera ) )},,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )










































      oBtnOk := TButton():ReDefine( 1, {||( ::CreateTurno( oDlg ) )}, oDlg,,, .F.,,,, .F. )





      TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )

   oDlg:AddFastKey( 116, {|| ::CreateTurno( oDlg ) } )

   oDlg:AddFastKey( 112, {|| ChmHelp( "Iniciar_Sesin" ) } )

   if !lTactilMode() .AND. !lTpvMode()
      oDlg:bStart := {|| ::StartCreateTurno( oDivisa, oDivObjetivo, oCodUsr ) }
   else
      oDlg:bStart := {|| ::SetBigUsr( oBtnUser, oSayUsr ) }
   end

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if !Empty( oBmp )
      oBmp:End()
   end

RETURN ( oDlg:nResult == 1 )



UTILITY STATIC function TTurno_StartCreateTurno( oDivisa, oDivObjetivo, oCodUsr) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oDivisa:lValid()

   oDivObjetivo:lValid()

   oCodUsr:lValid()
   oCodUsr:SetFocus()

Return ( Self )



UTILITY STATIC function TTurno_SetBigUsr( oBtnUser, oSayUsr) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !Empty( oUser():cImagen() )
      oBtnUser:lTransparent := .F.
      oBtnUser:ReLoadBitmap( cFileBmpName( oUser():cImagen() ) )
   else
      oBtnUser:lTransparent := .T.
      oBtnUser:ReLoadBitmap( if( oUser():lAdministrador(), "Big_Admin", "Big_User" ) )
   end

   oBtnUser:Refresh()

   oSayUsr:SetText( Capitalize( oUser():cNombre() ) )

RETURN ( .T. )



UTILITY STATIC function TTurno_CreateTurno( oDlg) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if Empty( ::cCajeroTurno )
      MsgStop( "Debe de cumplimentar el usuario", "Imposible realizar apertura" )
      Return .F.
   end





   if !::OpenTurno
      ::oDbf:Append()
      ::oDbf:cNumTur    := ::cValidTurno()
      ::oDbf:cSufTur    := RetSufEmp()
      ::oDbf:dOpnTur    := ::dOpenTurno
      ::oDbf:cHorOpn    := ::cHoraTurno
      ::oDbf:cCajTur    := ::cCajeroTurno
      ::oDbf:lCloTur    := .F.
      ::oDbf:lConTur    := .F.
      ::oDbf:lSndTur    := .F.
      ::oDbf:mComTur    := ""
      ::oDbf:Save()
   end





   ::LoadCaja( ::oDbf:cNumTur + ::oDbf:cSufTur )





   if !Empty( ::nImporteTurno )
      ::oEntSal:Append()
      ::oEntSal:cTurEnt := ::oDbf:cNumTur
      ::oEntSal:cSufEnt := ::oDbf:cSufTur
      ::oEntSal:dFecEnt := ::dOpenTurno
      ::oEntSal:cHora   := ::cHoraTurno
      ::oEntSal:cCodUsr := ::cCajeroTurno
      ::oEntSal:cCodCaj := oUser():cCaja()
      ::oEntSal:nTipEnt := 1
      ::oEntSal:cDesEnt := ::cDescripcionTurno
      ::oEntSal:nImpEnt := ::nImporteTurno
      ::oEntSal:lCloEnt := .F.
      ::oEntSal:lSndEnt := .T.
      ::oEntSal:cCodDiv := cDivEmp()
      ::oEntSal:nVdvDiv := nValDiv( cDivEmp(), ::oDbfDiv:cAlias  )
      ::oEntSal:Save()
   end

   oDlg:end( 1 )

Return ( .T. )



UTILITY STATIC function TTurno_cNombreUser() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cRet  := ""

   if ::oUser <> nil .AND. ::oUser:Seek( ::oDbf:cCajTur )
      cRet     := Rtrim( ::oUser:cNbrUse )
   end

RETURN ( cRet )



UTILITY STATIC function TTurno_cValidTurno() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno





   local nCurTur  := nNewDoc( nil, ::oDbf:nArea, "nSesion", 6, ::oDbfCnt:nArea )











RETURN ( Str( nCurTur, 6 ) )



UTILITY STATIC function TTurno_MarkTurno( lMark) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cCurTur  := ::oDbf:cNumTur

   IIF( lMark == nil, lMark := .T., ) ;

   CursorWait()





   if ::oTikT:Seek( cCurTur )

      while ::oTikT:cTurTik == cCurTur .AND. !::oTikT:eof()

         SndTikCli( lMark, ::oTikT:nArea, ::oFacCliT:nArea, ::oAlbCliT:nArea )
         ::oTikT:Skip()
         SysRefresh()

      end

   end





   if ::oTikP:Seek( cCurTur )

      while ::oTikP:cTurPgo == cCurTur .AND. !::oTikP:eof()

         ::oTikP:Load()
         ::oTikP:lSndPgo := lMark
         ::oTikP:Save()

         ::oTikP:Skip()
         SysRefresh()

      end

   end





   if ::oEntSal:Seek( cCurTur )

      while ::oEntSal:cTurEnt == cCurTur .AND. !::oEntSal:eof()

         ::oEntSal:Load()
         ::oEntSal:lSndEnt := lMark
         ::oEntSal:Save()

         ::oEntSal:Skip()
         SysRefresh()

      end

   end





   if ::oAlbCliT:Seek( cCurTur )

      while ::oAlbCliT:cTurAlb == cCurTur .AND. !::oAlbCliT:eof()

         ::oAlbCliT:Load()
         ::oAlbCliT:lSndDoc   := lMark
         ::oAlbCliT:Save()

         ::oAlbCliT:Skip()
         SysRefresh()

      end

   end





   if ::oFacCliT:Seek( cCurTur )

      while ::oFacCliT:cTurFac == cCurTur .AND. !::oFacCliT:eof()

         ::oFacCliT:Load()
         ::oFacCliT:lSndDoc   := lMark
         ::oFacCliT:Save()

         ::oFacCliT:Skip()
         SysRefresh()

      end

   end

   CursorWe()

return ( Self )



UTILITY STATIC function TTurno_End() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::oWndBrw <> nil
      ::oWndBrw:end()
      ::oWndBrw  := nil
   end

   if !Empty( ::oTotales )
      ::oTotales:end()
   end

RETURN NIL



UTILITY STATIC function TTurno_lInvCierre() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oBmp
   local oBtn
   local oDlgWat
   local lVal     := .F.
   local oMsg

   if !lUsrMaster()
      MsgStop( "Solo puede invertir el cierre el usuario Administrador." )
      Return .F.
   end

   if nUsrInUse() > 1
      msgStop( "Hay ms de un usuario conectado a la aplicacin", "Atencin" )
      return .F.
   end

   ::oDbf:GetStatus()

   ::cCurTurno    := ::GetLastClose()

   if Empty( ::cCurTurno )
      MsgStop( "No hay sesiones para invertir el cierre" )
      return .F.
   end

   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

   oDlgWat = TDialog():New(,,,, "Invirtiendo sesin " + Trans( ::cCurTurno, "@R ######/##" ), "INVTURNO",, .F.,,,,,, .F.,,,,,, .F., )




      oBmp := TBitmap():ReDefine( 500, "InvertirTurno",, oDlgWat,,, .F., .F.,,, .F.,,, .F. )

      ::oAni      := TAnimat():Redefine( oDlgWat, 100, { "BAR_01" }, 1 )



      oMsg := TSay():ReDefine( 110, {|| ""}, oDlgWat,,,, .F.,, .F., .F. )




      oBtn := TButton():ReDefine( 1, {||( ::InvCierre( oDlgWat, oMsg ), oDlgWat:bValid := {|| .T. }, oDlgWat:End() )}, oDlgWat,,, .F.,,,, .F. )





      TButton():ReDefine( 2, {||( oDlgWat:bValid := {|| .T. }, oDlgWat:End() )}, oDlgWat,,, .F.,,,, .F. )
      oDlgWat:AddFastKey( 116, {|| oBtn:Click() } )
      oDlgWat:AddFastKey( 112, {|| ChmHelp( "Invertir_Cierre" ) } )

      oDlgWat:bStart := {|| if( !Empty( ::oAni ), ::oAni:Hide(), ) }

   oDlgWat:Activate( oDlgWat:bLClicked, oDlgWat:bMoved, oDlgWat:bPainted, .T., {|Self|( lVal )},,, oDlgWat:bRClicked,,, )

   if !Empty( ::oAni )
      ::oAni:End()
   end

   oBmp:End()

   ::oDbf:SetStatus()

   ::oWndBrw:Refresh()

RETURN ( .T. )



UTILITY STATIC function TTurno_InvCierre( oDlg, oMsg) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   CursorWait()

   oDlg:Disable()

   if !Empty( ::oAni )
      ::oAni:Show()
   end




   oMsg:SetText( "Abriendo cajas..." )

   if ::oDbfCaj:Seek( ::cCurTurno )

      while ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur == ::cCurTurno .AND. !::oDbfCaj:Eof()

         ::lCloseCaja( .F., ::oDbfCaj:cCodCaj )

         ::lCloEntSal( .F., ::oDbfCaj:cCodCaj )

         ::oDbfCaj:Skip()

         SysRefresh()

      end

   end





   oMsg:SetText( "Reestableciendo contadores" )

   if ::oDbfDet:Seek( ::cCurTurno )

      while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::cCurTurno .AND. !::oDbfDet:eof()

         if ::oArticulo:Seek( ::oDbfDet:cCodArt )

            ::oArticulo:Load()
            ::oArticulo:nCntAct  := ::oDbfDet:nCanAnt
            ::oArticulo:Save()

         end

         ::oDbfDet:Skip()
         SysRefresh()

      end

   end

   oMsg:SetText( "Reestableciendo turnos" )

   if ::oDbf:Seek( ::cCurTurno )
      ::oDbf:Load()
      ::oDbf:lSndTur := .F.
      ::oDbf:lCloTur := .F.
      ::oDbf:Save()
   end





   oMsg:SetText( "Estableciendo la nueva sesin" )
   cCurSesion( SubStr( ::cCurTurno, 1, 6 ) )

   oMsg:SetText( "Escribiendo contadores" )
   SetFieldEmpresa( Val( SubStr( ::cCurTurno, 1, 6 ) ), "nNumTur" )

   oMsg:SetText( "Chequeando el estado de las sesiones" )

   ::lNowOpen()

   if oMsgSesion() <> nil
      oMsgSesion():SetText( "Sesin : " + Transform( ::cCurTurno, "######" ) )
   end





   if !Empty( ::oAni )
      ::oAni:Hide()
   end

   oDlg:Enable()

   CursorWe()

RETURN ( nil )



UTILITY STATIC function TTurno_lCloEntSal( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;





   if ::oEntSal:Seek( ::cCurTurno + cCodCaj )

      while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oEntSal:eof()

         ::oEntSal:Load()
         ::oEntSal:lCloEnt := lClose
         ::oEntSal:Save()

         ::oEntSal:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloTiket( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oTikT:Seek( ::cCurTurno + cCodCaj )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == ::cCurTurno + cCodCaj .AND. !::oTikT:eof()

         ::ActTactil()

         if ::oTikT:nUbiTik == 4 .AND. ::oTikT:lAbierto
            ::oTikT:FieldPutByName( "lCloTik", .F. )
         else
            ::oTikT:FieldPutByName( "lCloTik", lClose )
         end

         ::oTikT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloPgoTik( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oTikP:Seek( ::cCurTurno + cCodCaj )

      while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oTikP:eof()

         ::oTikP:FieldPutByName( "lCloPgo", lClose )

         ::oTikP:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloPedPrv( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oPedPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oPedPrvT:cTurPed + ::oPedPrvT:cSufPed + ::oPedPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oPedPrvT:eof()

         ::oPedPrvT:FieldPutByName( "lCloPed", lClose )

         ::oPedPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloAlbPrv( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oAlbPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oAlbPrvT:eof()

         ::oAlbPrvT:FieldPutByName( "lCloAlb", lClose )

         ::oAlbPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloFacPrv( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oFacPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oFacPrvT:eof()

         ::oFacPrvT:FieldPutByName( "lCloFac", lClose )

         ::oFacPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloRctPrv( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oRctPrvT:Seek( ::cCurTurno + cCodCaj )

      while ::oRctPrvT:cTurRct + ::oRctPrvT:cSufRct + ::oRctPrvT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oRctPrvT:eof()

         ::oRctPrvT:FieldPutByName( "lCloFac", lClose )

         ::oRctPrvT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloPreCli( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oPreCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oPreCliT:cTurPre + ::oPreCliT:cSufPre + ::oPreCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oPreCliT:eof()

         ::oPreCliT:FieldPutByName( "lCloPre", lClose )

         ::oPreCliT:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloPedCli( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;
















   if ::oPedCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oPedCliP:eof()

         ::oPedCliP:Load()
         ::oPedCliP:lCloPgo   := lClose
         ::oPedCliP:Save()

         ::oPedCliP:Skip()
         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloAlbCli( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oAlbCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. ! ::oAlbCliT:eof()

         ::oAlbCliT:FieldPutByName( "lCloAlb", lClose )

         ::oAlbCliT:Skip()

         SysRefresh()

      end

   end

   if ::oAlbCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oAlbCliP:eof()

         ::oAlbCliP:FieldPutByName( "lCloPgo", lClose )

         ::oAlbCliP:Skip()

         SysRefresh()

      end

   end

RETURN ( nil )



UTILITY STATIC function TTurno_lCloFacCli( lClose, cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nRec     := ::oFacCliP:Recno()
   local nOrdAnt  := ::oFacCliP:OrdSetFocus( "CTURREC" )

   IIF( lClose == nil, lClose := .T., ) ;

   if ::oFacCliT:Seek( ::cCurTurno + cCodCaj )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oFacCliT:eof()

         ::oFacCliT:FieldPutByName( "lCloFac", lClose )

         ::oFacCliT:Skip()

         SysRefresh()

      end

   end

   if ::oFacCliP:Seek( ::cCurTurno + cCodCaj )

      while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == ::cCurTurno + cCodCaj .AND. !::oFacCliP:eof()

         if ::oFacCliP:lCobrado
            ::oFacCliP:FieldPutByName( "lCloPgo", lClose )
         end

         ::oFacCliP:Skip()

         SysRefresh()

      end

   end

   ::oFacCliP:OrdSetFocus( nOrdAnt )
   ::oFacCliP:GoTo( nRec )

RETURN ( nil )



UTILITY STATIC function TTurno_GetLastClose() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cLasTur  := ""

   ::oDbf:GetRecno()

   ::oDbf:GoBottom()
   while !::oDbf:bof()

      if ::oDbf:lCloTur
         cLasTur  := ::oDbf:cNumTur + ::oDbf:cSufTur
         exit
      else
         ::oDbf:Skip( -1 )
      end

   end

   ::oDbf:SetRecno()

RETURN ( cLasTur )



UTILITY STATIC function TTurno_GetLastEfectivo() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nEfectivo   := 0
   local cNumeroCaja := ::GetLastClose() + oUser():cCaja()

   if ::oDbfCaj:SeekInOrd( cNumeroCaja, "cCajTur" )
      nEfectivo      := ( ::oDbfCaj:nCanEfe - ::oDbfCaj:nCanRet )
   end

RETURN ( nEfectivo )



UTILITY STATIC function TTurno_lArqueoTurno( lZoom, lTactil, lParcial) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg
   local oFld
   local oFnt
   local oFntSay
   local oFntBrw
   local oCol
   local oError
   local oBlock
   local oBrwCnt
   local oBrwCaj
   local oBtnMod
   local oCajTur
   local oNomCaj
   local cNomCaj
   local oCajNbr
   local cCajNbr         := "Todas"
   local aPrnCaj
   local oPrinter
   local oComentario
   local oEnvMail
   local oSayGeneral
   local oBmpGeneral
   local oSayGeneral2

   IIF( lZoom == nil, lZoom := .F., ) ;
   IIF( lTactil == nil, lTactil := .F., ) ;
   IIF( lParcial == nil, lParcial := .F., ) ;

   ::lZoom           := lZoom
   ::lArqueoTactil   := lTactil
   ::lArqueoParcial  := lParcial
   ::nMeter          := 0

   aPrnCaj           := GetPrinters()





   if ::lZoom

      ::cCurTurno    := ::oDbf:cNumTur + ::oDbf:cSufTur
      ::dFecTur      := ::oDbf:dOpnTur
      ::cHorTur      := ::oDbf:cHorOpn
      ::cCajTur      := ::oDbf:cCajTur

      if Empty( ::cCodCaj )
         ::cCodCaj   := oUser():cCaja()
      end

   else

      ::cCurTurno    := ::GetLastOpen()

      if Empty( ::dFecTur )
         ::dFecTur   := GetSysDate()
      end

      if Empty( ::cHorTur )
         ::cHorTur   := Substr( Time(), 1, 5 )
      end

      if Empty( ::cCajTur )
         ::cCajTur   := cCurUsr()
      end

      if Empty( ::cCodCaj ) .AND. !oUser():lAdministrador()
         ::cCodCaj   := oUser():cCaja()
      end

   end

   if !::lZoom .AND. Empty( ::cCurTurno )
      MsgStop( "No hay sesiones para cerrar" )
      return .F.
   end






   oBlock            := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::cComentario     := ::oDbf:mComTur
   ::lCerrado        := ::oDbf:lCloTur

   ::LoadCaja( ::cCurTurno )

   ::oDbf:GetStatus()

   ::oDbfDet:OrdScope( ::cCurTurno )

   ::oDbfCaj:OrdScope( ::cCurTurno )



   if !::lArqueoParcial
      ::cWinArq         := cPrinterArqueo( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )
      ::cPrnArq         := cFormatoArqueoEnCaja( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )
   else
      ::cWinArq         := cPrinterArqueoParcial( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )
      ::cPrnArq         := cFormatoArqueoParcialEnCaja( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )
   end



   ::lEnvioInformacion  := ::oIniArqueo:Get( "Arqueo", "EnvioInformacion", .T.,           ::lEnvioInformacion )

   ::lNoImprimirArqueo  := ::oIniArqueo:Get( "Arqueo", "ImprimirArqueo",   .T.,           ::lNoImprimirArqueo )
   ::cCmbReport         := ::oIniArqueo:Get( "Arqueo", "SalidaArqueo",     "Visualizar",  ::cCmbReport )

   ::lImprimirEnvio     := ::oIniArqueo:Get( "Arqueo", "ImprimirEnvio",    .T.,           ::lImprimirEnvio )

   ::lEnviarMail        := ::oIniArqueo:Get( "Arqueo", "EnviarMail",       .T.,           ::lEnviarMail )
   ::cEnviarMail        := ::oIniArqueo:Get( "Arqueo", "Mail",             "",            ::cEnviarMail )
   ::cEnviarMail        := Padr( ::cEnviarMail, 200 )

   ::oMoneyEfectivo     := TVirtualMoney():New()
   ::oMoneyRetirado     := TVirtualMoney():New()



   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

   if ::lArqueoTactil

      oFnt              := TFont():New( "Segoe UI", 0, 22, .F., .F. )
      oFntSay           := TFont():New( "Segoe UI", 0, 30, .F., .T. )
      oFntBrw           := TFont():New( "Segoe UI", 0, 17, .F., .F. )

      do case
         case ::nScreenVertRes == 560



           oDlg = TDialog():New(,,,, "Arqueo " + if( ::lArqueoParcial, "parcial ", " " ) + "de caja, sesin : " + Trans( ::cCurTurno, "@R ######" ), "ARQUEO_TCT_1024x576",, .F.,,,,,, .F.,,,,,, .F., )








           oFld := TPages():Redefine( 200, oDlg, {"ARQUEO_1_TCT_1024x576", "ARQUEO_2_TCT_1024x576", "ARQUEO_3_TCT_1024x576", "ARQUEO_4_TCT_1024x576"},,, oFnt, )

         otherwise



           oDlg = TDialog():New(,,,, "Arqueo " + if( ::lArqueoParcial, "parcial ", " " ) + "de caja, sesin : " + Trans( ::cCurTurno, "@R ######" ), "ARQUEO_TCT",, .F.,,,,,, .F.,,,,,, .F., )








           oFld := TPages():Redefine( 200, oDlg, {"ARQUEO_1_TCT", "ARQUEO_2_TCT", "ARQUEO_3_TCT", "ARQUEO_4_TCT"},,, oFnt, )

      end

   else



      oDlg = TDialog():New(,,,, "Arqueo " + if( ::lArqueoParcial, "parcial ", " " ) + "de caja, sesin : " + Trans( ::cCurTurno, "@R ######" ), "ARQUEO",, .F.,,,,,, .F.,,,,,, .F., )







      oFld := TPages():Redefine( 200, oDlg, {"ARQUEO_1", "ARQUEO_2", "ARQUEO_3", "ARQUEO_4"},,,, )

   end















      TGetHlp():ReDefine( 80, { | u | If( PCount()==0, ::oDbf:dOpnTur, ::oDbf:dOpnTur:= u ) }, oFld:aDialogs[1],,,,,,,,, .T., {||     .F.},, .F., .F.,,,,,, nil,,, )





      TGetHlp():ReDefine( 90, { | u | If( PCount()==0, ::oDbf:cHorOpn, ::oDbf:cHorOpn:= u ) }, oFld:aDialogs[1],,,,,,,,, .T., {||     .F.},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::oDbf:dCloTur, ::oDbf:dCloTur:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )




      TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::oDbf:cHorClo, ::oDbf:cHorClo:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      if !::lArqueoTactil  .AND. ::lArqueoParcial





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_refresh_48_alpha",, oFld:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_refresh_48_alpha",, oFld:aDialogs[2],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_refresh_48_alpha",, oFld:aDialogs[3],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_refresh_48_alpha",, oFld:aDialogs[4],,, .F., .F.,,, .F.,,, .T. )

      end

      if !::lArqueoTactil  .AND. !::lArqueoParcial





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_stop_48_alpha",, oFld:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_stop_48_alpha",, oFld:aDialogs[2],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_stop_48_alpha",, oFld:aDialogs[3],,, .F., .F.,,, .F.,,, .T. )





      oBmpGeneral := TBitmap():ReDefine( 990, "clock_stop_48_alpha",, oFld:aDialogs[4],,, .F., .F.,,, .F.,,, .T. )

      end

      if !::lArqueoTactil







      oCajTur := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cCajTur, ::cCajTur:= u ) }, oFld:aDialogs[1],,, {||    ( !Empty( ::cCajTur ) .AND. cUser( oCajTur, nil, oNomCaj ) )},,,,,, .F., {||     ( !lZoom )},, .F., .F.,,,,, {|Self|( BrwUser( oCajTur, nil, oNomCaj ) )}, nil, "LUPA",, )

      else





      oBmpGeneral := TBitmap():ReDefine( 500, if ( lParcial, "clock_refresh_48_alpha", "clock_stop_48_alpha" ),, oDlg,,, .F., .F.,,, .F.,,, .T. )







      oCajTur := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::cCajTur, ::cCajTur:= u ) }, oFld:aDialogs[1],,, {||    ( !Empty( ::cCajTur ) .AND. cUser( oCajTur, nil, oNomCaj ) )},,,,,, .F., {||     ( !lZoom )},, .F., .F.,,,,, {|Self|( BrwUserTactil( oCajTur, nil, oNomCaj ) )}, nil, "LUPA_24",, )

      oCajTur:nMargin   := 25








      end




      oNomCaj := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, cNomCaj, cNomCaj:= u ) }, oFld:aDialogs[1],,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )





      TButton():ReDefine( 501, {||( ::SelCajas( .T., oBrwCaj ) )}, oFld:aDialogs[1],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )





      TButton():ReDefine( 502, {||( ::SelCajas( .F., oBrwCaj ) )}, oFld:aDialogs[1],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )





      TButton():ReDefine( 503, {||( ::SelAllCajas( .T., oBrwCaj ) )}, oFld:aDialogs[1],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )





      TButton():ReDefine( 504, {||( ::SelAllCajas( .F., oBrwCaj ) )}, oFld:aDialogs[1],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )

      if !::lArqueoTactil





      TButton():ReDefine( 505, {||( oBrwCaj:GoUp() )}, oFld:aDialogs[ 1 ],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )





      TButton():ReDefine( 506, {||( oBrwCaj:GoDown() )}, oFld:aDialogs[ 1 ],,, .F., {||     ( oUser():lAdministrador() )},,, .F. )

      end



      oBrwCaj                 := IXBrowse():New( oFld:aDialogs[1] )

      oBrwCaj:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwCaj:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwCaj:lHScroll        := .F.
      oBrwCaj:lVScroll        := .F.
      oBrwCaj:nMarqueeStyle   := 6
      oBrwCaj:cName           := "Turno.Cajas"

      oBrwCaj:SetoDbf( ::oDbfCaj )

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Estado"
         :bStrData         := {|| if( ::oDbfCaj:lCajClo, "Cerrada", "Abierta" ) }
         :bEditValue       := {|| ::oDbfCaj:lCajClo }
         :nWidth           := 100
         :SetCheck( { "Cnt16", "Nil16" } )
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Seleccionada"
         :nHeadBmpNo       := 3
         :bStrData         := {|| "" }
         :bEditValue       := {|| ::oDbfCaj:lCajSel }
         :nWidth           := 25
         :SetCheck( { "Sel16", "Nil16" } )
         :AddResource( "cashier_Selet_16" )
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Cdigo"
         :bEditValue       := {|| ::oDbfCaj:cCodCaj }
         :nWidth           := 70
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Nombre"
         :bEditValue       := {|| oRetFld( ::oDbfCaj:cCodCaj, ::oCaja ) }
         :nWidth           := 330
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "Ojetivo"
         :bEditValue       := {|| ::oDbfCaj:nCanPre }
         :nWidth           := 100
         :cEditPicture     := cPorDiv( cDivEmp(), ::oDbfDiv )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nEditType        := 1
         :bOnPostEdit      := {|o,x| ::oDbfCaj:FieldPutByName( "nCanPre", x ) }
      end

      with object ( oBrwCaj:AddCol() )
         :cHeader          := "N usuarios"
         :bEditValue       := {|| nUserCaja( ::oDbfCaj:cCodCaj ) }
         :cEditPicture     := "9999"
         :nWidth           := 130
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      if ::lArqueoTactil
         oBrwCaj:nRowHeight   := 36
      end

      oBrwCaj:bRClicked       := {| nRow, nCol, nFlags | oBrwCaj:RButtonDown( nRow, nCol, nFlags ) }

      oBrwCaj:CreateFromResource( 160 )







      oBtnMod := TButton():ReDefine( 501, {||( oCol:Edit() )}, oFld:aDialogs[2],,, .F., {||     !::lArqueoParcial},,, .F. )

      ::oDbfDet:lCount        := .T.

      oBrwCnt                 := IXBrowse():New( oFld:aDialogs[2] )

      oBrwCnt:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwCnt:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwCnt:nMarqueeStyle   := 5
      oBrwCnt:lFooter         := .T.
      oBrwCnt:cName           := "Turno.Contadores"

      oBrwCnt:SetoDbf( ::oDbfDet )

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Cdigo"
         :bEditValue       := {|| ::oDbfDet:cCodArt }
         :nWidth           := 50
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Nombre"
         :bEditValue       := {|| ::oDbfDet:cNomArt }
         :nWidth           := 120
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "N anterior"
         :bEditValue       := {|| ::oDbfDet:nCanAnt }
         :cEditPicture     := ::cPicUnd
         :bOnPostEdit      := {|o,u,n| ::EdtAnt( o, u, n ), ::TotContadores(), oCol:RefreshFooter(), .T. }
         :nWidth           := 75
         :nEditType        := if( !::lCerrado, 1, 0 )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oCol   := oBrwCnt:AddCol() )
         :cHeader          := "N actual"
         :bEditValue       := {|| ::oDbfDet:nCanAct }
         :cEditPicture     := ::cPicUnd
         :bOnPostEdit      := {|o,u,n| ::EdtCol( o, u, n ), ::TotContadores(), oCol:RefreshFooter(), .T. }
         :nWidth           := 75
         :nEditType        := if( !::lCerrado, 1, 0 )
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Und. venta"
         :bEditValue       := {|| ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) }
         :cEditPicture     := ::cPicUnd
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Precio"
         :bEditValue       := {|| ::oDbfDet:nPvpArt }
         :cEditPicture     := ::cPouDiv
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oBrwCnt:AddCol() )
         :cHeader          := "Total"
         :bEditValue       := {|| ( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) ) }
         :bFooter          := {|| ( ::oTotales:nTotContadores( ::cCodCaj ) ) }
         :cEditPicture     := ::cPorDiv
         :nWidth           := 75
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
         :nFootStrAlign    := 1
      end

      if ::lArqueoTactil
         oBrwCnt:nRowHeight   := 36
      end

      oBrwCnt:bRClicked       := {| nRow, nCol, nFlags | oBrwCnt:RButtonDown( nRow, nCol, nFlags ) }

      oBrwCnt:CreateFromResource( 140 )








      ::oBrwTotales := TWBrowse():ReDefine( 800,, oFld:aDialogs[ 3 ], {"", "Importes"},,,,,,,,,,,,, .F.,,,,, )

         ::oBrwTotales:oFont        := oFntBrw
         ::oBrwTotales:bKeyChar     := { | nKey, nFlags | if( nKey == 13, ( ::oBrwTotales:Cargo:Toggle(), ::oBrwTotales:Refresh() ), ) }



      if ::lArqueoTactil




      ::oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cCodCaj, ::cCodCaj:= u ) }, oFld:aDialogs[ 3 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )

         ::oCodCaj:bHelp   := {|| BrwCajaTactil( ::oCodCaj, oCajNbr ) }
         ::oCodCaj:bChange := {|| ::lChangeCajas( oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oFld:aDialogs[ 3 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      else





      ::oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cCodCaj, ::cCodCaj:= u ) }, oFld:aDialogs[ 3 ],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

         ::oCodCaj:bHelp   := {|| BrwCajas( ::oCodCaj, oCajNbr ) }
         ::oCodCaj:bChange := {|| ::lChangeCajas( oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oFld:aDialogs[ 3 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

      end

      if lZoom
         ::oCodCaj:bWhen   := {|| .F. }
      else
         ::oCodCaj:bWhen   := {|| oUser():lAdministrador() }
      end



      if ::lArqueoTactil






         ::oTotalEfectivo := TSay():ReDefine( 400, {||      ::oTotales:nTotSaldoEfectivo( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F. )






         ::oTotalTarjeta := TSay():ReDefine( 410, {||      ::oTotales:nTotSaldoTarjeta( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F. )






         ::oTotalNoEfectivo := TSay():ReDefine( 411, {||      ::oTotales:nTotSaldoNoEfectivo( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F. )






         ::oTotalCobros := TSay():ReDefine( 415, {||      ( ::oTotales:nTotSaldoEfectivo( ::cCodCaj ) + ::oTotales:nTotSaldoTarjeta( ::cCodCaj ) )}, oFld:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F. )

      else





         ::oTotalEfectivo := TSay():ReDefine( 400, {||      ::oTotales:nTotSaldoEfectivo( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F. )





         ::oTotalTarjeta := TSay():ReDefine( 410, {||      ::oTotales:nTotSaldoTarjeta( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F. )





         ::oTotalNoEfectivo := TSay():ReDefine( 411, {||      ::oTotales:nTotSaldoNoEfectivo( ::cCodCaj )}, oFld:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F. )





         ::oTotalCobros := TSay():ReDefine( 415, {||      ( ::oTotales:nTotSaldoEfectivo( ::cCodCaj ) + ::oTotales:nTotSaldoTarjeta( ::cCodCaj ) )}, oFld:aDialogs[3], ::cPorDiv,,, .F.,, .F., .F. )

      end

      if ::lArqueoTactil





      TButtonBmp():ReDefine( 220, {||( ::oMoneyEfectivo:Dialog( ::oImporteEfectivo ), ::RefreshTurno() )}, oFld:aDialogs[ 3 ],,, .F.,,,, .F., "Money2_32",, )

      else

      TBtnBmp():ReDefine( 220, "Money2_16",,,,,{|| ::oMoneyEfectivo:Dialog( ::oImporteEfectivo ), ::RefreshTurno() }, oFld:aDialogs[ 3 ], .F., , .F., "Conteo de efectivo" )

      end







      ::oImporteEfectivo := TGetHlp():ReDefine( 420, { | u | If( PCount()==0, ::nImporteEfectivo, ::nImporteEfectivo:= u ) }, oFld:aDialogs[ 3 ],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteEfectivo:bChange    := {|| ::RefreshTurno() }

      if ::lArqueoTactil





      TButtonBmp():ReDefine( 230, {||( Calculadora( 0, ::oImporteTarjeta ), ::RefreshTurno() )}, oFld:aDialogs[ 3 ],,, .F.,,,, .F., "Calculator_32",, )

      else

      TBtnBmp():ReDefine( 230, "Calculator_16" ,,,,, {|| Calculadora( 0, ::oImporteTarjeta ), ::RefreshTurno() }, oFld:aDialogs[ 3 ], .F., , .F., "Calculo de tarjetas" )

      end



      if ::lArqueoTactil





      TButtonBmp():ReDefine( 235, {||( ::oMoneyRetirado:Dialog( ::oImporteRetirado ), ::RefreshTurno() )}, oFld:aDialogs[ 3 ],,, .F.,,,, .F., "Money2_32",, )

      else

         TBtnBmp():ReDefine( 235, "Money2_16",,,,,{|| ::oMoneyRetirado:Dialog( ::oImporteRetirado ), ::RefreshTurno() }, oFld:aDialogs[ 3 ], .F., , .F., "Conteo de retirado" )

      end







      ::oImporteRetirado := TGetHlp():ReDefine( 460, { | u | If( PCount()==0, ::nImporteRetirado, ::nImporteRetirado:= u ) }, oFld:aDialogs[3],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteRetirado:bChange    := {|| ::RefreshTurno() }






      ::oImporteCambio := TSay():ReDefine( 465, {||   ::nImporteCambio}, oFld:aDialogs[3], ::cPorDiv,,, .F., oFntSay, .F., .F. )









      ::oImporteTarjeta := TGetHlp():ReDefine( 430, { | u | If( PCount()==0, ::nImporteTarjeta, ::nImporteTarjeta:= u ) }, oFld:aDialogs[ 3 ],, ::cPorDiv,,,, oFntSay,,, .F., {||     !::lCerrado},, .F., .F.,,,,,, nil,,, )

      ::oImporteTarjeta:bChange     := {|| ::oDiferenciaTarjeta:Refresh(), ::RefreshTurno() }






      ::oDiferenciaEfectivo := TSay():ReDefine( 440, {|| ( ::nImporteEfectivo - ::oTotales:nTotSaldoEfectivo( ::cCodCaj )  )}, oFld:aDialogs[ 3 ], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F. )






      ::oDiferenciaTarjeta := TSay():ReDefine( 450, {|| ( ::nImporteTarjeta - ::oTotales:nTotCobroTarjeta( ::cCodCaj ) )}, oFld:aDialogs[ 3 ], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F. )






      ::oDiferenciaTotal := TSay():ReDefine( 470, {|| ( ::oDiferenciaEfectivo:VarGet() + ::oDiferenciaTarjeta:VarGet() )}, oFld:aDialogs[3], ::cPorDiv, 8388608, GetSysColor( 15 ), .F., oFntSay, .F., .F. )








      oComentario := TMultiGet():ReDefine( 200, { | u | If( PCount()==0, ::cComentario, ::cComentario:= u ) }, oFld:aDialogs[4],,,,,,, .F., {||     !::lArqueoParcial}, .F.,, )





      TCheckBox():ReDefine( 600, { | u | If( PCount()==0, ::lNoImprimirArqueo, ::lNoImprimirArqueo:= u ) }, oFld:aDialogs[ 4 ],,,,,,, .F.,, .F. )

     if ::lArqueoTactil







      ::oCmbReport := TComboBox():ReDefine( 620, { | u | If( PCount()==0, ::cCmbReport, ::cCmbReport:= u ) }, ::aCmbReport, oFld:aDialogs[ 4 ],,,,,,, .F., {||     ( !::lNoImprimirArqueo )}, ::aBmpReportTactil,,,, )

     else







      ::oCmbReport := TComboBox():ReDefine( 620, { | u | If( PCount()==0, ::cCmbReport, ::cCmbReport:= u ) }, ::aCmbReport, oFld:aDialogs[ 4 ],,,,,,, .F., {||     ( !::lNoImprimirArqueo )}, ::aBmpReport,,,, )

     end

     if ::lArqueoTactil





      TButton():ReDefine( 610, {||( ::DlgImprimir( , .T.) )}, oFld:aDialogs[ 4 ],,, .F., {||     ( !::lNoImprimirArqueo )},,, .F. )

     else





      TButton():ReDefine( 610, {||( ::DlgImprimir() )}, oFld:aDialogs[ 4 ],,, .F., {||     ( !::lNoImprimirArqueo )},,, .F. )

     end




      ::oEnvioInformacion := TCheckBox():ReDefine( 700, { | u | If( PCount()==0, ::lEnvioInformacion, ::lEnvioInformacion:= u ) }, oFld:aDialogs[ 4 ],,,,,,, .F., {||     !::lArqueoParcial}, .F. )




      ::oImprimirEnvio := TCheckBox():ReDefine( 710, { | u | If( PCount()==0, ::lImprimirEnvio, ::lImprimirEnvio:= u ) }, oFld:aDialogs[ 4 ],,,,,,, .F., {||     ::lEnvioInformacion}, .F. )




      ::oEnviarMail := TCheckBox():ReDefine( 720, { | u | If( PCount()==0, ::lEnviarMail, ::lEnviarMail:= u ) }, oFld:aDialogs[ 4 ],,,,,,, .F., {||     lUsrMaster() .AND. !::lArqueoParcial}, .F. )





      oEnvMail := TGetHlp():ReDefine( 730, { | u | If( PCount()==0, ::cEnviarMail, ::cEnviarMail:= u ) }, oFld:aDialogs[ 4 ],,,,,,,,, .F., {||     ( ::lEnviarMail .AND. lUsrMaster() )},, .F., .F.,,,,,, nil,,, )



      ::oMeter    := TMeter():ReDefine( 130, { | u | if( pCount() == 0, ::nMeter, ::nMeter := u ) }, 10, oDlg, .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )




      ::oTxt := TSay():ReDefine( 140, {||   ""}, oDlg,,,, .F.,, .F., .F. )




      ::oBtnRecalcular := TButton():ReDefine( 300, {||( ::lCalTurno( nil, ::cCodCaj, oDlg ) )}, oDlg,,, .F.,,,, .F. )




      ::oBtnPrv := TButton():ReDefine( 100, {||::GoPrev( oFld, oDlg, oBrwCnt, oBrwCaj )}, oDlg,,, .F.,,,, .F. )




      ::oBtnNxt := TButton():ReDefine( 110, {||::GoNext( oFld, oDlg, oCajTur, oBrwCnt )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 120, {||oDlg:End()}, oDlg,,, .F.,,,, .F. )

      oDlg:bStart := {||  ::StartArqueoTurno( oFld, oBtnMod, oCajTur, oBrwCaj, oBrwCnt, oComentario ) }

      oFld:aDialogs[ 2 ]:AddFastKey( 113, {|| ::EdtAnt( oBrwCnt ) } )
      oFld:aDialogs[ 2 ]:AddFastKey( 114, {|| ::EdtCol( oBrwCnt ) } )

   oDlg:Activate( , , , .T. )





   if !Empty( ::oDbf ) .AND. ::oDbf:Used()
      ::oDbf:SetStatus()
   end

   if !Empty( ::oDbfDet ) .AND. ::oDbfDet:Used()
      ::oDbfDet:OrdClearScope()
   end

   if !Empty( ::oDbfCaj ) .AND. ::oDbfCaj:Used()
      ::oDbfCaj:OrdClearScope()
   end





   if oDlg:nResult == 1

      ::lNowOpen()

      if oMsgSesion() <> nil
         oMsgSesion():SetText( "Sesin : " + Transform( ::cCurTurno, "######" ) )
      end





      ::oIniArqueo:Set( "Arqueo", "EnvioInformacion", ::lEnvioInformacion  )
      ::oIniArqueo:Set( "Arqueo", "ImprimirArqueo",   ::lNoImprimirArqueo  )
      ::oIniArqueo:Set( "Arqueo", "SalidaArqueo",     ::cCmbReport         )
      ::oIniArqueo:Set( "Arqueo", "ImprimirEnvio",    ::lImprimirEnvio     )
      ::oIniArqueo:Set( "Arqueo", "EnviarMail",       ::lEnviarMail        )
      ::oIniArqueo:Set( "Arqueo", "Mail",             ::cEnviarMail        )









   end





   ::lArqueoParcial        := .F.

   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

   RECOVER USING oError

      if !Empty( oDlg )
         oDlg:End()
      end

      msgStop( "Error al iniciar el proceso de cierre." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )





   ::nImporteEfectivo   := 0
   ::nImporteTarjeta    := 0
   ::nImporteRetirado   := 0
   ::cComentario        := ""





   if !Empty( oBrwCaj )
      oBrwCaj:CloseData()
   end

   if !Empty( oBrwCnt )
      oBrwCnt:CloseData()
   end





   if !Empty( oFnt )
      oFnt:End()
   end

   if !Empty( oFntSay )
      oFntSay:End()
   end

   if !Empty( oFntBrw )
      oFntBrw:End()
   end

Return ( oDlg:nResult == 1 )



UTILITY STATIC function TTurno_InitArqueoTurno() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSubTree





   ::oTreeGeneral := ::oTreeImpresion:Add( "General" )
                     ::oTreeGeneral:Add( "Entradas y salidas de cajas" )

   oSubTree       := ::oTreeImpresion:Add( "Ventas" )
                     oSubTree:Add( "Albaranes de clientes" )
                     oSubTree:Add( "Facturas de clientes" )
                     oSubTree:Add( "Facturas rectificativas de clientes" )
                     oSubTree:Add( "Anticipos de clientes" )
                     oSubTree:Add( "Tickets" )
                     oSubTree:Add( "Contadores" )
                     oSubTree:Add( "Devoluciones de clientes" )
                     oSubTree:Add( "Vales a clientes" )

   oSubTree       := ::oTreeImpresion:Add( "Compras" )
                     oSubTree:Add( "Albaranes de proveedores" )
                     oSubTree:Add( "Facturas de proveedores" )
                     oSubTree:Add( "Facturas rectificativas de proveedores" )

   oSubTree       := ::oTreeImpresion:Add( "Liquidaciones" )
                     oSubTree:Add( "Vales liquidados de clientes" )
                     oSubTree:Add( "Anticipos liquidados de clientes" )

   oSubTree       := ::oTreeImpresion:Add( "Cobros" )
                     oSubTree:Add( "Entregas a cuenta en pedidos de clientes" )
                     oSubTree:Add( "Entregas a cuenta en albaranes de clientes" )
                     oSubTree:Add( "Cobros en facturas de clientes" )
                     oSubTree:Add( "Cobros efectivo en facturas a proveedores" )
                     oSubTree:Add( "Cobros no efectivo en facturas a proveedores" )
                     oSubTree:Add( "Cobros tarjeta en facturas a proveedores" )
                     oSubTree:Add( "Cobros en tickets de clientes" )
                     oSubTree:Add( "Cobros por formas de pago" )

   oSubTree       := ::oTreeImpresion:Add( "Pagos" )
                     oSubTree:Add( "Pagos en facturas a proveedores" )
                     oSubTree:Add( "Pagos efectivo en facturas a proveedores" )
                     oSubTree:Add( "Pagos no efectivo en facturas a proveedores" )
                     oSubTree:Add( "Pagos tarjeta en facturas a proveedores" )
                     oSubTree:Add( "Pagos por formas de pago" )

   oSubTree       := ::oTreeImpresion:Add( "Bancos" )
                     oSubTree:Add( "Operaciones bancarias en cuentas de empresa" )
                     oSubTree:Add( "Saldos bancarios en cuentas de empresa" )

   oSubTree       := ::oTreeImpresion:Add( "Estadisticas" )
                     oSubTree:Add( "Compras por artculos" )
                     oSubTree:Add( "Ventas por artculos" )
                     oSubTree:Add( "Ventas por tipo de artculos" )
                     oSubTree:Add( "Ventas por familias" )
                     oSubTree:Add( "Ventas por categora" )
                     oSubTree:Add( "Ventas por fabricante" )
                     oSubTree:Add( "Ventas por temporada" )
                     oSubTree:Add( "Ventas por usuarios" )
                     oSubTree:Add( "Ventas por tipos de " + cImp() )
                     oSubTree:Add( "Ventas por tipo de invitaciones" )

   ::oTreeImpresion:ExpandAll()

Return ( Self )



UTILITY STATIC function TTurno_StartArqueoTurno( oFld, oBtnMod, oCajTur, oBrwCaj, oBrwCnt, oComentario) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oBtnPrv:Hide()

   ::oMeter:Hide()

   ::oBtnRecalcular:Hide()

   ::oCodCaj:lValid()

   oCajTur:lValid()

   if ::lZoom
      oFld:SetOption( 1 )
      oBtnMod:Hide()
   end

   oBrwCaj:Load()
   oBrwCaj:Refresh()

   oBrwCnt:Load()
   oBrwCnt:Refresh()

   if ::lArqueoParcial
      ::lEnvioInformacion     := .F.
      ::lImprimirEnvio        := .F.
      ::lEnviarMail           := .F.
   end

   SysRefresh()

Return ( Self )



UTILITY STATIC function TTurno_GoPrev( oFld, oDlg, oBrw, oBrwCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   do case
      case oFld:nOption == 2

         ::oBtnPrv:Hide()

         ::oBtnRecalcular:Hide()

         oBrwCaj:Refresh()

      case oFld:nOption == 3

         if !::lIsContadores()
            oFld:GoPrev()
            ::oBtnPrv:Hide()
         end

         ::oBtnRecalcular:Hide()

      case oFld:nOption == 4

         SetWindowText( ::oBtnNxt:hWnd, "S&iguiente >" )

         ::oBtnRecalcular:Show()

   end

   oFld:GoPrev()

return nil



UTILITY STATIC function TTurno_GoNext( oFld, oDlg, oCajTur, oBrwCnt) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oItem

   do case
      case oFld:nOption == 1

         ::oBtnPrv:Show()

         if !::lZoom .AND. Empty( ::cCajTur )
            MsgStop( "Es necesario codificar un usuario." )
            oCajTur:SetFocus()
            return nil
         end

         if !::lZoom .AND. !::lAnyCajaSelect()
            MsgStop( "Es necesario seleccionar una caja." )
            return nil
         end

         if !::lZoom .AND. !::lValidCajas()
            return nil
         end

         if ::lZoom .AND. !::lOneCajaSelect()
            MsgStop( "Seleccione solo una caja." )
            return nil
         end

         if ::lIsContadores()

            oFld:GoNext()

            ::LoadContadores()

            oBrwCnt:GoTop()
            oBrwCnt:Refresh()

         else

            ::lCalTurno( nil, nil, oDlg )

            ::LoadImporte( ::cCodCaj )

            ::oBtnRecalcular:Show()

            if ::lTikAbiertos .AND. !::lArqueoParcial
               MsgStop( "Existen tickets abiertos: " + Chr(13)+Chr(10) + ::cTikAbiertos )
            else
               oFld:GoNext(); oFld:GoNext()
            end

         end





         ::oDbfCaj:GetRecno()

         ::oDbfCaj:GoTop()
         while !::oDbfCaj:Eof()

            if ( ::oDbfCaj:lCajSel )

               if ( ::lZoom .OR. ::cCodCaj == Space( 3 ) )

                  ::oCodCaj:cText( ::oDbfCaj:cCodCaj )
                  ::oCodCaj:lValid()

                  ::cOldCaj   := ::oDbfCaj:cCodCaj

               end

            end

            ::oDbfCaj:Skip()

         end

         ::oDbfCaj:SetRecno()

         ::RefreshTurno()

      case oFld:nOption == 2

         ::lCalTurno( nil, ::cCodCaj, oDlg )

         ::oBtnRecalcular:Show()

         if ::lTikAbiertos .AND. !::lArqueoParcial
            MsgStop( "Existen tickets abiertos: " + Chr(13)+Chr(10) + ::cTikAbiertos )
         else
            oFld:GoNext()
         end

         ::RefreshTurno()

      case oFld:nOption == 3

         ::oBtnRecalcular:Hide()

         ::SaveImporte( ::cCodCaj )

         oFld:GoNext()

         SetWindowText( ::oBtnNxt:hWnd, "&Terminar" )

         ::oBrwTotales:SetFocus()
         ::oBrwTotales:Refresh()

      case oFld:nOption == 4

         if !::lZoom

            if ::lCloseSesion( oDlg )
               oDlg:end( 1 )
            end

         else

            oDlg:end()

         end

   end

return nil









































UTILITY STATIC function TTurno_lIsContadores() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lIsContadores  := .F.

   ::oArticulo:GetStatus()
   ::oArticulo:OrdSetFocus( "nCtlStock" )

   lIsContadores        := ::oArticulo:Seek( 2 )

   ::oArticulo:SetStatus()

Return ( lIsContadores )



UTILITY STATIC function TTurno_LoadContadores( lReLoad) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nIva

   IIF( lReload == nil, lReload := .F., ) ;





   if !::lZoom

      ::oArticulo:GetStatus()
      ::oArticulo:OrdSetFocus( "nCtlStock" )

      if ::oArticulo:Seek( 2 )
         while ::oArticulo:nCtlStock == 2 .AND. !::oArticulo:Eof()

            nIva                    := nIva( ::oIvaImp:cAlias, ::oArticulo:TipoIva )

            if ::oDbfDet:Seek( ::cCurTurno + ::oArticulo:Codigo )

               ::oDbfDet:Load()

               if Empty( ::oDbfDet:nCanAnt )
                  ::oDbfDet:nCanAnt := ::oArticulo:nCntAct
               end





               if !::oDbf:lBefClo
                  ::oDbfDet:nPvpArt := ::oArticulo:PvtaIva1
               end

               ::oDbfDet:nIvaArt    := nIva
               ::oDbfDet:nValImp    := ::oNewImp:nValImp( ::oArticulo:cCodImp, ::oArticulo:lIvaInc, nIva )

               ::oDbfDet:Save()

            else

               if ::oDbfDet:Append()
                  ::oDbfDet:Blank()
                  ::oDbfDet:cNumTur    := SubStr( ::cCurTurno, 1, 6 )
                  ::oDbfDet:cSufTur    := SubStr( ::cCurTurno, -2 )
                  ::oDbfDet:cCodArt    := ::oArticulo:Codigo
                  ::oDbfDet:cNomArt    := ::oArticulo:Nombre
                  ::oDbfDet:nCanAnt    := ::oArticulo:nCntAct
                  ::oDbfDet:nCanAct    := ::oArticulo:nCntAct
                  ::oDbfDet:nPvpArt    := ::oArticulo:PvtaIva1
                  ::oDbfDet:nIvaArt    := nIva
                  ::oDbfDet:nValImp    := ::oNewImp:nValImp( ::oArticulo:cCodImp, ::oArticulo:lIvaInc, nIva )
                  ::oDbfDet:Save()
               end

            end

            ::oArticulo:Skip()
            SysRefresh()

         end
      end

      ::oArticulo:SetStatus()

      ::oDbfDet:GoTop()

   end

Return Nil



UTILITY STATIC function TTurno_LoadCaja( cCurTurno) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock
   local lOpenCaja      := .F.

   IIF( cCurTurno == nil, cCurTurno := ::cCurTurno, ) ;

   oBlock               := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::oDbfCaj:GetStatus()
   ::oDbfCaj:OrdSetFocus( "cCajTur" )


   if !::oDbfCaj:Seek( cCurTurno + oUser():cCaja() ) .AND. !oRetFld( oUser():cCaja(), ::oCaja, "lNoArq" )

      if ::oDbfCaj:Append()
         ::oDbfCaj:Blank()
         ::oDbfCaj:lCajSel    := .T.
         ::oDbfCaj:cNumTur    := SubStr( cCurTurno, 1, 6 )
         ::oDbfCaj:cSufTur    := SubStr( cCurTurno, -2 )
         ::oDbfCaj:cCodCaj    := oUser():cCaja()
         ::oDbfCaj:nCanPre    := ::nObjetivoTurno
         ::oDbfCaj:cDivEfe    := cDivEmp()
         ::oDbfCaj:cDivTar    := cDivEmp()
         ::oDbfCaj:cDivPre    := cDivEmp()
         ::oDbfCaj:Save()
      end

   end

   ::oDbfCaj:SetStatus()

   RECOVER USING oError

      msgStop( "Imposible crear la sesin para la caja actual." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return Nil



UTILITY STATIC function TTurno_SelCajas( lSelect, oBrw) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfCaj:Load()
   ::oDbfCaj:lCajSel    := lSelect
   ::oDbfCaj:Save()

   if oBrw <> nil
      oBrw:Refresh()
   end

Return Nil



UTILITY STATIC function TTurno_SelAllCajas( lSelect, oBrw) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()
      ::SelCajas( lSelect )
      ::oDbfCaj:Skip()
      SysRefresh()
   end

   ::oDbfCaj:SetRecno()

   if oBrw <> nil
      oBrw:Refresh()
   end

Return Nil






UTILITY STATIC function TTurno_lAnyCajaSelect() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lAny  := .F.

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()

      if ::oDbfCaj:lCajSel
         lAny  := .T.
      end

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

Return ( lAny )






UTILITY STATIC function TTurno_lOneCajaSelect() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nOne  := 0

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()

      if ::oDbfCaj:lCajSel
         nOne++
      end

      ::oDbfCaj:Skip()

      SysRefresh()

   end

   ::oDbfCaj:SetRecno()

Return ( nOne == 1 )




UTILITY STATIC function TTurno_lValidCajas() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nUsrCaj
   local lValidCajas    := .T.

   ::oDbfCaj:GetRecno()

   ::oDbfCaj:GoTop()
   while !::oDbfCaj:Eof()
      if ::oDbfCaj:lCajSel
         nUsrCaj  := nUserCaja( ::oDbfCaj:cCodCaj )
         if !( nUsrCaj == 0 .OR. ( nUsrCaj == 1 .AND. ::oDbfCaj:cCodCaj == oUser():cCaja() ) )
            if !ApoloMsgNoYes( "Hay usuarios trabajando en la caja " + ::oDbfCaj:cCodCaj, "Desea continuar con el cierre?" )
               lValidCajas := .F.
               exit
            end
         end
      end
      ::oDbfCaj:Skip()
      SysRefresh()
   end

   ::oDbfCaj:SetRecno()

Return ( lValidCajas )



UTILITY STATIC function TTurno_lChangeCajas( oNomCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cCodCaj     := ::oCodCaj:VarGet()





   if !cCajas( ::oCodCaj, ::oCaja:cAlias, oNomCaj )
      Return .F.
   end





   if Empty( cCodCaj )

      oNomCaj:cText( "Todas" )

   else

      if ( ::cOldCaj <> cCodCaj )

         ::SaveImporte( ::cOldCaj )

         ::cOldCaj   := cCodCaj

         ::LoadImporte( ::cOldCaj )

      end

   end





   ::lCalTurno( nil, ::cCodCaj )





   ::RefreshTurno()

Return ( .T. )






UTILITY STATIC function TTurno_lCalTurno( cTurno, cCaja, oDlg) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oError
   local oBlock
   local aCajas                  := {}
   local aStream                 := {}

   IIF( cTurno == nil, cTurno := ::cCurTurno, ) ;

   CursorWait()

   oBlock                        := ErrorBlock( { | oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      if !Empty( oDlg )
         oDlg:Disable()
      end

      if !Empty( ::oMeter )
         ::oMeter:Show()
      end

      ::oDbfCaj:GetRecno()





      if Empty( ::oTotales )
         ::oTotales                 := TTotalTurno():New()
      end
      ::oTotales:Initiate()





      ::lTikAbiertos                := .F.
      ::cTikAbiertos                := ""





      ::TotContadores( cTurno )





      if Empty( cCaja )

         if ::oDbfCaj:Seek( cTurno )

            while ::oDbfCaj:cNumTur + ::oDbfCaj:cSufTur == cTurno .AND. !::oDbfCaj:Eof()

               if aScan( aCajas, ::oDbfCaj:cCodCaj ) == 0

                  aAdd( aCajas, ::oDbfCaj:cCodCaj )

                  if ::oDbfCaj:lCajSel
                     ::TotSesion( cTurno, ::oDbfCaj:cCodCaj )
                  end

               end

               ::oDbfCaj:Skip()

               SysRefresh()

            end

         end

      else

         ::TotSesion( cTurno, cCaja )

      end





      ::RefreshTurno()





      if !Empty( ::oBrwTotales )

         ::oBrwTotales:SetTree( ::oTotales:CreateTree( cCaja, cTurno ) )

         ::oBrwTotales:lDrawHeaders := .F.
         ::oBrwTotales:bLine        := {|| { if( ::oBrwTotales:Cargo:lOpened, ::oBrwTotales:Cargo:hBmpOpen, ::oBrwTotales:Cargo:hBmpClose ), if( len( ::oBrwTotales:Cargo:Cargo ) >= 4, ::oBrwTotales:Cargo:Cargo[ 4 ], 0 ), ::oBrwTotales:Cargo:Cargo[ 1 ], if( ::oBrwTotales:Cargo:cPrompt == "Espacio", "", Trans( ::oBrwTotales:Cargo:Cargo[ 2 ], ::cPorDiv ) ) } }
         ::oBrwTotales:aHeaders     := { "", "", "", "Importes" }
         ::oBrwTotales:aColSizes    := { 18, 18, if( ::lArqueoTactil, 350, 450 ), 150 }
         ::oBrwTotales:aJustify     := { .F., .F., .F., .T. }
         ::oBrwTotales:nClrPane     := {|| if( Empty( ::oBrwTotales:Cargo:cPrompt ), ( 192 + ( 192 * 256 ) + ( 192 * 65536 ) ), 16777215 ) }
         ::oBrwTotales:bLDblClick   := {|| ::ClickBrwTotales() }
         ::oBrwTotales:bKeyChar     := {|| ::ClickBrwTotales() }
         ::oBrwTotales:aLinActions  := { {|| ::ClickBrwTotales() }, , }

         ::oBrwTotales:Refresh()

      end





      public nTotAlbCliContadores   := ::oTotales:nTotAlbCliContadores(   cCaja  )
      public nTotAlbCliVentas       := ::oTotales:nTotAlbCliVentas(       cCaja  )
      public nTotPedCliEntregas     := ::oTotales:nTotPedCliEntregas(     cCaja  )
      public nTotAlbCliEntregas     := ::oTotales:nTotAlbCliEntregas(     cCaja  )
      public nTotEntregas           := ::oTotales:nTotEntregas(           cCaja  )
      public nTotFacCliContadores   := ::oTotales:nTotFacCliContadores(   cCaja  )
      public nTotFacCliVentas       := ::oTotales:nTotFacCliVentas(       cCaja  )
      public nTotRctCliVentas       := ::oTotales:nTotRctCliVentas(       cCaja  )
      public nTotTikCliContadores   := ::oTotales:nTotTikCliContadores(   cCaja  )
      public nTotChkCliContadores   := ::oTotales:nTotChkCliContadores(   cCaja  )
      public nTotTikCliVentas       := ::oTotales:nTotTikCliVentas(       cCaja  )
      public nTotChkCliVentas       := ::oTotales:nTotChkCliVentas(       cCaja  )
      public nTotDevCliContadores   := ::oTotales:nTotDevCliContadores(   cCaja  )
      public nTotDevCliVentas       := ::oTotales:nTotDevCliVentas(       cCaja  )
      public nTotValCliContadores   := ::oTotales:nTotValCliContadores(   cCaja  )
      public nTotValCliVentas       := ::oTotales:nTotValCliVentas(       cCaja  )
      public nTotValCliLiquidados   := ::oTotales:nTotValCliLiquidados(   cCaja  )
      public nTotAlbPrvCompras      := ::oTotales:nTotAlbPrvCompras(      cCaja  )
      public nTotFacPrvCompras      := ::oTotales:nTotFacPrvCompras(      cCaja  )
      public nTotRctPrvCompras      := ::oTotales:nTotRctPrvCompras(      cCaja  )
      public nTotAntCliVentas       := ::oTotales:nTotAntCliVentas(       cCaja  )
      public nTotAntCliLiquidados   := ::oTotales:nTotAntCliLiquidados(   cCaja  )
      public nTotEntradas           := ::oTotales:nTotEntradas(           cCaja  )
      public nTotVentas             := ::oTotales:nTotVentas(             cCaja  )
      public nTotContadores         := ::oTotales:nTotContadores(         cCaja  )
      public nTotVentaCredito       := ::oTotales:nTotVentaCredito(       cCaja  )
      public nTotVentaContado       := ::oTotales:nTotVentaContado(       cCaja  )
      public nTotCompras            := ::oTotales:nTotCompras(            cCaja  )
      public nTotTikCliCobros       := ::oTotales:nTotTikCliCobros(       cCaja  )
      public nTotFacCliCobros       := ::oTotales:nTotFacCliCobros(       cCaja  )
      public nTotValCliCobros       := ::oTotales:nTotValCliCobros(       cCaja  )
      public nTotChkCliCobros       := ::oTotales:nTotChkCliCobros(       cCaja  )
      public nTotFacPrvPagos        := ::oTotales:nTotFacPrvPagos(        cCaja  )

      public nTotCobroEfectivo      := ::oTotales:nTotCobroEfectivo(      cCaja  )
      public nTotCobroNoEfectivo    := ::oTotales:nTotCobroNoEfectivo(    cCaja  )
      public nTotCobroTarjeta       := ::oTotales:nTotCobroTarjeta(       cCaja  )
      public nTotCobroMedios        := ::oTotales:nTotCobroMedios(        cCaja  )

      public nTotPagoEfectivo       := ::oTotales:nTotPagoEfectivo(       cCaja  )
      public nTotPagoNoEfectivo     := ::oTotales:nTotPagoNoEfectivo(     cCaja  )
      public nTotPagoTarjeta        := ::oTotales:nTotPagoTarjeta(        cCaja  )
      public nTotPagoMedios         := ::oTotales:nTotPagoMedios(         cCaja  )

      public nTotCobros             := ::oTotales:nTotCobros(             cCaja  )
      public nDifCobros             := ::oTotales:nDifCobros(             cCaja  )
      public nDifTotal              := ::oTotales:nDifTotal(              cCaja  )
      public nTotVentaSesion        := ::oTotales:nTotVentaSesion(        cCaja  )
      public nTotCobroSesion        := ::oTotales:nTotCobroSesion(        cCaja  )
      public nTotNumeroAlbaranes    := ::oTotales:nTotNumeroAlbaranes(    cCaja  )
      public nTotNumeroFacturas     := ::oTotales:nTotNumeroFacturas(     cCaja  )
      public nTotNumeroTikets       := ::oTotales:nTotNumeroTikets(       cCaja  )
      public nTotNumeroVales        := ::oTotales:nTotNumeroVales(        cCaja  )
      public nTotNumeroCheques      := ::oTotales:nTotNumeroCheques(      cCaja  )
      public nTotNumeroDevoluciones := ::oTotales:nTotNumeroDevoluciones( cCaja  )
      public nTotNumeroAptCajon     := ::oTotales:nTotNumeroAptCajon(     cTurno )
      public nTotCaja               := ::oTotales:nTotCaja(               cCaja  )
      public nTotCajaEfectivo       := ::oTotales:nTotCajaEfectivo(       cCaja  )
      public nTotCajaNoEfectivo     := ::oTotales:nTotCajaNoEfectivo(     cCaja  )
      public nTotCajaTarjeta        := ::oTotales:nTotCajaTarjeta(        cCaja  )
      public nTotCajaObjetivo       := ::oTotales:nTotCajaObjetivo(       cCaja  )
      public nTicketMedio           := ::oTotales:nTiketMedio(            cCaja  )

      public nTotSaldoEfectivo      := ::oTotales:nTotSaldoEfectivo(      cCaja  )
      public nTotSaldoNoEfectivo    := ::oTotales:nTotSaldoNoEfectivo(    cCaja  )
      public nTotSaldoTarjeta       := ::oTotales:nTotSaldoTarjeta(       cCaja  )





      if !Empty( cCaja )

         if ::oDbfCaj:SeekInOrd( cTurno + cCaja, "cCajTur" )





            aStream                 := hb_aTokens( ::oDbfCaj:cMonEfe, ";" )

            if len( aStream ) >= 15

               aStream[1]           := Val( aStream[1] )
               aStream[2]           := Val( aStream[2] )
               aStream[3]           := Val( aStream[3] )
               aStream[4]           := Val( aStream[4] )
               aStream[5]           := Val( aStream[5] )
               aStream[6]           := Val( aStream[6] )
               aStream[7]           := Val( aStream[7] )
               aStream[8]           := Val( aStream[8] )
               aStream[9]           := Val( aStream[9] )
               aStream[10]          := Val( aStream[10] )
               aStream[11]          := Val( aStream[11] )
               aStream[12]          := Val( aStream[12] )
               aStream[13]          := Val( aStream[13] )
               aStream[14]          := Val( aStream[14] )
               aStream[15]          := Val( aStream[15] )

            end

            public aMonedasEfe      := aStream
            public nEfectivoEnCaja  := ::oDbfCaj:nCanEfe





            public nTarjetaEnCaja   := ::oDbfCaj:nCanTar





            aStream                 := hb_aTokens( ::oDbfCaj:cMonRet, ";" )

            if len( aStream ) >= 15

               aStream[1]           := Val( aStream[1] )
               aStream[2]           := Val( aStream[2] )
               aStream[3]           := Val( aStream[3] )
               aStream[4]           := Val( aStream[4] )
               aStream[5]           := Val( aStream[5] )
               aStream[6]           := Val( aStream[6] )
               aStream[7]           := Val( aStream[7] )
               aStream[8]           := Val( aStream[8] )
               aStream[9]           := Val( aStream[9] )
               aStream[10]          := Val( aStream[10] )
               aStream[11]          := Val( aStream[11] )
               aStream[12]          := Val( aStream[12] )
               aStream[13]          := Val( aStream[13] )
               aStream[14]          := Val( aStream[14] )
               aStream[15]          := Val( aStream[15] )

            end

            public aMonedasRet      := aStream
            public nRetiradoEnCaja  := ::oDbfCaj:nCanRet

         else

            public aMonedasEfe      := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
            public aMonedasRet      := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
            public nTarjetaEnCaja   := 0
            public nEfectivoEnCaja  := 0
            public nRetiradoEnCaja  := 0

         end

      else

         public aMonedasEfe         := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
         public aMonedasRet         := { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 }
         public nTarjetaEnCaja      := 0
         public nEfectivoEnCaja     := 0
         public nRetiradoEnCaja     := 0

      end

   RECOVER USING oError

      msgStop( "Error al calcular caja." + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

   CursorWE()

   if !Empty( ::oDbfCaj )
      ::oDbfCaj:SetRecno()
   end

   if !Empty( ::oMeter )
      ::oMeter:Hide()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "" )
   end





   if !Empty( oDlg )
      oDlg:Enable()
   end

RETURN ( .T. )



UTILITY STATIC function TTurno_ClickBrwTotales() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if len( ::oBrwTotales:Cargo:Cargo ) >= 3 .AND. !Empty( ::oBrwTotales:Cargo:Cargo[ 3 ] )
      Eval( ::oBrwTotales:Cargo:Cargo[ 3 ] )
   else
      if ::oBrwTotales:Cargo:oTree <> nil
         ::oBrwTotales:Cargo:Toggle()
         ::oBrwTotales:Refresh()
      end
   end

Return ( Self )






UTILITY STATIC function TTurno_TotContadores( cTurno) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cTurno == nil, cTurno := ::cCurTurno, ) ;

   if ::oMeter <> nil
      ::oMeter:Refresh()
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando contadores" )
   end

   ::oDbfDet:GetStatus()

   ::oTotales:InitContadores()

   if ::oDbfDet:Seek( cTurno )
      while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == cTurno .AND. !::oDbfDet:Eof()
         ::oTotales:addContadores( Round( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv ) )
         ::oDbfDet:Skip()
         SysRefresh()
      end
   end

   ::oDbfDet:SetStatus()

return ( ::oTotales:nContadores )



UTILITY STATIC function TTurno_TotVenta( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cTurno == nil, cTurno := ::cCurTurno, ) ;





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando tikets" )
   end

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND.  !::oTikT:eof()





         if ::oTikT:lAbierto .AND. ::oTikT:nUbiTik <> 4
            ::lTikAbiertos    := .T.
            if !Empty( ::cTikAbiertos )
               ::cTikAbiertos += ", "
            else
               ::cTikAbiertos += ::oTikT:cSerTik + "/" + Alltrim( ::oTikT:cNumTik ) + "/" + Rtrim( ::oTikT:cSufTik )
            end
         end

         do case
            case ::oTikT:cTipTik == "1" .OR. ::oTikT:cTipTik == "7"

               ::oTotales:addTotTikCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addTotTikCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addNumeroTikets(         cCaja )

            case ::oTikT:cTipTik == "4"

               ::oTotales:addTotDevCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addTotDevCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addNumeroDevoluciones(   cCaja )

            case ::oTikT:cTipTik == "6" .AND. !::oTikT:lFreTik

               ::oTotales:addTotValCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addTotValCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bEdtTiketCliente() )
               ::oTotales:addNumeroVales(          cCaja )

            case ::oTikT:cTipTik == "6" .AND. ::oTikT:lFreTik

               ::oTotales:addTotChkCliContadores(  cCaja, ::oTikT:cSerTik, ::nCntTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
               ::oTotales:addTotChkCliVentas(      cCaja, ::oTikT:cSerTik, ::nTotTiketCliente(), ::cTxtTiketCliente(), ::bZooTiketCliente() )
               ::oTotales:addNumeroCheques(        cCaja )

         end

         ::oTikT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando vales" )
   end

   ::oTikT:OrdSetFocus( "cTurVal" )

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurVal + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         ::oTotales:addTotValCliLiquidados( cCaja, ::oTikT:cSerTik, nTotValLiq( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )
         ::oTotales:addTotValCliLiquidados( cCaja, ::oTikT:cSerTik, nTotValLiq( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .F. ) )

         ::oTikT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oTikT:OrdSetFocus( "cTurTik" )





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAlbCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando albaranes" )
   end

   if ::oAlbCliT:Seek( cTurno + cCaja )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliT:eof()
         ::oTotales:addTotAlbCliContadores(  cCaja, ::oAlbCliT:cSerAlb, ::nCntAlbaranCliente(), ::cTxtAlbaranCliente(), ::bEdtAlbaranCliente() )
         ::oTotales:addTotAlbCliVentas(      cCaja, ::oAlbCliT:cSerAlb, ::nTotAlbaranCliente(), ::cTxtAlbaranCliente(), ::bEdtAlbaranCliente() )
         ::oTotales:addNumeroAlbaranes(      cCaja )

         ::oAlbCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oPedCliP:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando entregas a cuenta" )
   end

   if ::oPedCliP:Seek( cTurno + cCaja )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurno + cCaja  .AND. !::oPedCliP:Eof()

         if !::oPedCliP:lPasado

            ::oTotales:addTotPedCliEntregas( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega() )

         end

         ::oPedCliP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAlbCliP:LastRec() )
   end

   if ::oAlbCliP:Seek( cTurno + cCaja )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliP:Eof()

         if !::oAlbCliP:lPasado

            ::oTotales:addTotAlbCliEntregas( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega() )

         end

         ::oAlbCliP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oFacCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas" )
   end

   if ::oFacCliT:Seek( cTurno + cCaja )
      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurno + cCaja .AND. !::oFacCliT:eof()

         ::oTotales:addTotFacCliContadores(  cCaja, ::oFacCliT:cSerie, ::nCntFacturaCliente(), ::cTxtFacturaCliente(), ::bEdtFacturaCliente() )
         ::oTotales:addTotFacCliVentas(      cCaja, ::oFacCliT:cSerie, ::nTotFacturaCliente(), ::cTxtFacturaCliente(), ::bEdtFacturaCliente() )
         ::oTotales:addNumeroFacturas(       cCaja )

         ::oFacCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oRctCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas" )
   end

   if ::oRctCliT:Seek( cTurno + cCaja )
      while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurno + cCaja .AND. !::oRctCliT:eof()

         ::oTotales:addTotRctCliContadores(  cCaja, ::oRctCliT:cSerie, ::nCntFacturaRectificativaCliente(), ::cTxtFacturaRectificativaCliente(), ::bEdtFacturaRectificativaCliente() )
         ::oTotales:addTotRctCliVentas(      cCaja, ::oRctCliT:cSerie, ::nTotFacturaRectificativaCliente(), ::cTxtFacturaRectificativaCliente(), ::bEdtFacturaRectificativaCliente() )
         ::oTotales:addNumeroFacturas(       cCaja )

         ::oRctCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAntCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando anticipos" )
   end

   ::oAntCliT:OrdSetFocus( "cTurAnt" )
   if ::oAntCliT:Seek( cTurno + cCaja )

      while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurno + cCaja .AND. !::oAntCliT:eof()

         ::oTotales:AddTotAntCliVentas( cCaja, ::oAntCliT:cSerAnt, ::nTotAnticipoCliente(), ::cTxtAnticipoCliente(), ::bEdtAnticipoCliente() )

         ::oAntCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAntCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando anticipos liquidados" )
   end

   ::oAntCliT:OrdSetFocus( "cTurLiq" )
   if ::oAntCliT:Seek( cTurno + cCaja )

      while ::oAntCliT:cTurLiq + ::oAntCliT:cSufAnt + ::oAntCliT:cCajLiq == cTurno + cCaja .AND. !::oAntCliT:eof()

         ::oTotales:AddTotAntCliLiquidados( cCaja, ::oAntCliT:cSerAnt, ::nTotAnticipoCliente(), ::cTxtAnticipoCliente(), ::bEdtAnticipoCliente() )

         ::oAntCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oAntCliT:OrdSetFocus( "nNumAnt" )

RETURN ( Self )



UTILITY STATIC function TTurno_TotEntrada( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cTurno == nil, cTurno := ::cCurTruno, ) ;

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oEntSal:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando entradas" )
   end





   if ::oEntSal:Seek( cTurno + cCaja )

      while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == cTurno + cCaja .AND. !::oEntSal:Eof()

         ::oTotales:addTotEntradas( ::oEntSal:cCodCaj, ::nTotEntradasSalidas(), ::cTxtEntradasSalidas(), ::bEdtEntradasSalidas() )

         ::oEntSal:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



UTILITY STATIC function TTurno_TotCompra( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cTurno == nil, cTurno := ::cCurTruno, ) ;





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAlbPrvT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando compras" )
   end

   if ::oAlbPrvT:Seek( cTurno + cCaja )

      while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurno + cCaja .AND. !::oAlbPrvT:Eof()

         if !::oAlbPrvT:lFacturado
            ::oTotales:addTotAlbPrvCompras( cCaja, ::oAlbPrvT:cSerAlb, ::nTotAlbaranProveedor(), ::cTxtAlbaranProveedor(), ::bEdtAlbaranProveedor() )
         end

         ::oAlbPrvT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oFacPrvT:LastRec() )
   end

   if ::oFacPrvT:Seek( cTurno + cCaja )

      while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurno + cCaja .AND. !::oFacPrvT:Eof()

         ::oTotales:addTotFacPrvCompras( cCaja, ::oFacPrvT:cSerFac, ::nTotFacturaProveedor(), ::cTxtFacturaProveedor(), ::bEdtFacturaProveedor() )

         ::oFacPrvT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oRctPrvT:LastRec() )
   end

   if ::oRctPrvT:Seek( cTurno + cCaja )

      while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurno + cCaja .AND. !::oRctPrvT:Eof()

         ::oTotales:addTotRctPrvCompras( cCaja, ::oRctPrvT:cSerFac, ::nTotFacturaRectificativaProveedor(), ::cTxtFacturaRectificativaProveedor(), ::bEdtFacturaRectificativaProveedor() )

         ::oRctPrvT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



UTILITY STATIC function TTurno_TotCobro( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cTipTik
   local nTotPgo
   local cFpgPgo
   local nTipoPgo
   local cTxtPgo
   local lFreTik

   IIF( cTurno == nil, cTurno := ::cCurTruno, ) ;





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oTikP:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oTikP:GetStatus()
   ::oTikP:OrdSetFocus( "cTurPgo" )

   if ::oTikP:Seek( cTurno + cCaja )

      while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurno + cCaja .AND. !::oTikP:eof()

         cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )
         nTipoPgo       := nTipoPago( ::oTikP:cFpgPgo, ::oFPago )

         do case
            case ( cTipTik == "1" ) .OR. ( cTipTik == "7" )

               ::oTotales:addTotTikCliCobros( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

               do case
                  case nTipoPgo < 2
                     ::oTotales:addTotCobroEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 2
                     ::oTotales:addTotCobroNoEfectivo( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 3
                     ::oTotales:addTotCobroTarjeta( cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
               end

            case ( cTiptik == "6" ) .AND. oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "lFreTik", 1 )

               ::oTotales:addTotTikCliCobros(      cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

               do case
                  case nTipoPgo < 2
                     ::oTotales:addTotCobroEfectivo(  cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 2
                     ::oTotales:addTotCobroNoEfectivo(  cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 3
                     ::oTotales:addTotCobroTarjeta(   cCaja, ::oTikP:cSerTik, ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bZooTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
               end

            case ( cTipTik == "4" )

               ::oTotales:addTotTikCliCobros(      cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )

               do case
                  case nTipoPgo < 2
                     ::oTotales:addTotCobroEfectivo(  cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 2
                     ::oTotales:addTotCobroNoEfectivo(  cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
                  case nTipoPgo == 3
                     ::oTotales:addTotCobroTarjeta(   cCaja, ::oTikP:cSerTik, - ::nTotTiketCobro(), ::cTxtTiketCobro(), ::bEdtTiketCobro(), ::oTotales:hBmpDoc[ "TiketCliente" ] )
               end

         end

         ::oTikP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oTikP:SetStatus()





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oFacCliP:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oFacCliP:GetStatus()
   ::oFacCliP:OrdSetFocus( "cTurRec" )

   if ::oFacCliP:Seek( cTurno + cCaja )

      while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurno + cCaja .AND. !::oFacCliP:eof()

         if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo

            ::oTotales:addTotRctCliCobros( cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro() )

            nTipoPgo    := nTipoPago( ::oFacCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo(     cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo(   cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(      cCaja, ::oFacCliP:cSerie, ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
            end

            if !Empty( cCuentaEmpresaRecibo( ::oFacCliP ) )
               ::oTotales:addTotBancos( cCaja, ::cBancoCuenta( ::oFacCliP ), ::nTotFacturaCobro(), ::cTxtFacturaCobro(), ::bEdtFacturaCobro(), ::oTotales:hBmpDoc[ "ReciboClientes" ] )
            end

         end

         ::oFacCliP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oFacCliP:SetStatus()





   if ::oPedCliP:Seek( cTurno + cCaja )

      while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurno + cCaja  .AND. !::oPedCliP:Eof()

         if !::oPedCliP:lPasado

            nTipoPgo    := nTipoPago( ::oPedCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo( cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(  cCaja, ::oPedCliP:cSerPed, ::nTotPedidoEntrega(), ::cTxtPedidoEntrega(), ::bEdtPedidoEntrega(), ::oTotales:hBmpDoc[ "PedidoCliente" ] )
            end

         end

         ::oPedCliP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oAlbCliP:Seek( cTurno + cCaja )

      while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurno + cCaja  .AND. !::oAlbCliP:Eof()

         if !::oAlbCliP:lPasado

            nTipoPgo    := nTipoPago( ::oAlbCliP:cCodPgo, ::oFPago )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotCobroEfectivo( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
               case nTipoPgo == 2
                  ::oTotales:addTotCobroNoEfectivo( cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
               case nTipoPgo == 3
                  ::oTotales:addTotCobroTarjeta(  cCaja, ::oAlbCliP:cSerAlb, ::nTotAlbaranEntrega(), ::cTxtAlbaranEntrega(), ::bEdtAlbaranEntrega(), ::oTotales:hBmpDoc[ "AlbaranCliente" ] )
            end

         end

         ::oAlbCliP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando cobros" )
   end

   ::oTikT:GetStatus()
   ::oTikT:OrdSetFocus( "cTurVal" )

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurVal + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         if ::oTikT:cTipTik == "6" .AND. ::oTikT:lLiqTik
            ::oTotales:addTotValCliCobros( cCaja, ::oTikT:cSerTik, nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., nil ) )
         end

         ::oTikT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oTikT:SetStatus()

RETURN ( Self )



UTILITY STATIC function TTurno_TotPago( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nTipoPgo

   IIF( cTurno == nil, cTurno := ::cCurTruno, ) ;





   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oFacPrvP:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando pagos" )
   end

   ::oFacPrvP:GetStatus()
   ::oFacPrvP:OrdSetFocus( "cTurRec" )

   if ::oFacPrvP:Seek( cTurno + cCaja )

      while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurno + cCaja .AND. !::oFacPrvP:eof()

         if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo

            nTipoPgo    := nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago )

            ::oTotales:addTotFacPrvPagos( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago(), ::bEdtFacturaPago() )

            do case
               case nTipoPgo < 2
                  ::oTotales:addTotPagoEfectivo( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
               case nTipoPgo == 2
                  ::oTotales:addTotPagoNoEfectivo( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
               case nTipoPgo == 3
                  ::oTotales:addTotPagoTarjeta( cCaja, ::oFacPrvP:cSerFac, ::nTotFacturaPago(), ::cTxtFacturaPago() )
            end

            if !Empty( cCuentaEmpresaRecibo( ::oFacPrvP ) )
               ::oTotales:addTotBancos( cCaja, ::cBancoCuenta( ::oFacPrvP ), - ::nTotFacturaPago(), ::cTxtFacturaPago(), ::bEdtFacturaPago(), ::oTotales:hBmpDoc[ "PagoProveedor" ] )
            end

         end

         ::oFacPrvP:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   ::oFacPrvP:SetStatus()

RETURN ( Self )



UTILITY STATIC function TTurno_TotTipoIva( cTurno, cCaja) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local nPos           := 0
   local nBasLin        := 0
   local nIvaLin        := 0
   local nTotLin        := 0

   IIF( cTurno == nil, cTurno := ::cCurTruno, ) ;

   ::aTipIva            := {}

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oAlbCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando albaranes" )
   end

   if ::oAlbCliT:Seek( cTurno + cCaja )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurno + cCaja .AND. !::oAlbCliT:eof()


         if !::oAlbCliT:lFacturado        .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

            while ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb == ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb .AND. !::oAlbCliL:Eof()

            nBasLin     := nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nIvaLin     := nIvaLAlbCli( ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nTotLin     := nBasLin + nIvaLin

            nPos        := aScan( ::aTipIva, {|x| x[1] == ::oAlbCliL:nIva } )
            if nPos <> 0
               ::aTipIva[ nPos, 2 ] += nBasLin
               ::aTipIva[ nPos, 3 ] += nIvaLin
               ::aTipIva[ nPos, 4 ] += nTotLin
            else
               aAdd( ::aTipIva, { ::oAlbCliL:nIva, nBasLin, nIvaLin, nTotLin } )
            end

            ::oAlbCliL:Skip()

            end

         end

         ::oAlbCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oFacCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando facturas" )
   end

   if ::oFacCliT:Seek( cTurno + cCaja )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurno + cCaja .AND. !::oFacCliT:eof()

         if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

            while ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac == ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac .AND. !::oFacCliL:Eof()

            nBasLin     := nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nIvaLin     := nIvaLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nTotLin     := nBasLin + nIvaLin

            nPos        := aScan( ::aTipIva, {|x| x[1] == ::oFacCliL:nIva } )
            if nPos <> 0
               ::aTipIva[ nPos, 2 ] += nBasLin
               ::aTipIva[ nPos, 3 ] += nIvaLin
               ::aTipIva[ nPos, 4 ] += nTotLin
            else
               aAdd( ::aTipIva, { ::oFacCliL:nIva, nBasLin, nIvaLin, nTotLin } )
            end

            ::oFacCliL:Skip()

            end

         end

         ::oFacCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oRctCliT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando rectificativas" )
   end

   if ::oRctCliT:Seek( cTurno + cCaja )

      while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurno + cCaja .AND. !::oRctCliT:eof()

         if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

            while ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac == ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac .AND. !::oRctCliL:Eof()

            nBasLin     := nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nIvaLin     := nIvaLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
            nTotLin     := nBasLin + nIvaLin

            nPos        := aScan( ::aTipIva, {|x| x[1] == ::oRctCliL:nIva } )
            if nPos <> 0
               ::aTipIva[ nPos, 2 ] += nBasLin
               ::aTipIva[ nPos, 3 ] += nIvaLin
               ::aTipIva[ nPos, 4 ] += nTotLin
            else
               aAdd( ::aTipIva, { ::oRctCliL:nIva, nBasLin, nIvaLin, nTotLin } )
            end

            ::oRctCliL:Skip()

            end

         end

         ::oRctCliT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

   if ::oMeter <> nil
      ::oMeter:SetTotal( ::oTikT:LastRec() )
   end

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Calculando tickets" )
   end

   if ::oTikT:Seek( cTurno + cCaja )

      while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurno + cCaja .AND. !::oTikT:eof()

         if ( ::oTikT:cTipTik == "1" .OR. ::oTikT:cTipTik == "4" )

            if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

               while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

                  nBasLin     := nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
                  nIvaLin     := nIvaLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv, ::nVdvDiv )
                  nTotLin     := nBasLin + nIvaLin

                  nPos        := aScan( ::aTipIva, {|x| x[1] == ::oTikL:nIvaTil } )
                  if nPos <> 0
                     ::aTipIva[ nPos, 2 ] += nBasLin
                     ::aTipIva[ nPos, 3 ] += nIvaLin
                     ::aTipIva[ nPos, 4 ] += nTotLin
                  else
                     aAdd( ::aTipIva, { ::oTikL:nIvaTil, nBasLin, nIvaLin, nTotLin } )
                  end

               ::oTikL:Skip()

               end

            end

         end

         ::oTikT:Skip()

         if ::oMeter <> nil
            ::oMeter:AutoInc()
         end

         SysRefresh()

      end

   end

RETURN ( Self )



UTILITY STATIC function TTurno_EdtCol( oCol, xValue, nLastKey) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if nLastKey == 13
      ::oDbfDet:FieldPutByName( "nCanAct", xValue )
   endif

return ( .T. )



UTILITY STATIC function TTurno_EdtAnt( oCol, xValue, nLastKey) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if nLastKey == 13
      ::oDbfDet:FieldPutByName( "nCanAnt", xValue )
   endif

return ( .T. )



UTILITY STATIC function TTurno_DlgImprimir( nDevice, lTactil) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oDlg
   local oCodCaj
   local oCajNbr
   local cCodCaj     := oUser():cCaja()
   local cCajNbr     := oRetFld( cCodCaj, ::oCaja, "cNomCaj" )
   local cBtnPrompt
   local bBtnAction
   local oPrinter

   IIF( lTactil == nil, lTactil := .F., ) ;

   ::cWinArq         := cPrinterArqueo( cCodCaj, ::oCaja:cAlias )
   ::cPrnArq         := cFormatoArqueoEnCaja( ::oDbfCaj:cCodCaj, ::oCaja:cAlias )

   do case
      case nDevice == nil
         cBtnPrompt  := "&Aceptar"
         bBtnAction  := {|| ::SetTreeState( ::oTreeImpresion:aItems ), oDlg:End( 1 ) }
      case nDevice == 2
         cBtnPrompt  := "&Previsualizar"
         bBtnAction  := {|| ::ExecuteDlgImprimir( cCodCaj, nDevice, oDlg ) }
      case nDevice == 1
         cBtnPrompt  := "&Imprimir"
         bBtnAction  := {|| ::ExecuteDlgImprimir( cCodCaj, nDevice, oDlg ) }
   end

   if lTactil

      do case

         case ::nScreenVertRes == 560
              oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMP_1024x576",, .F.,,,,,, .F.,,,,,, .F., )

         case ::nScreenVertRes <> 560
              oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMPBIG",, .F.,,,,,, .F.,,,,,, .F., )

      end

   else

      oDlg = TDialog():New(,,,, "Sesin : " + ::oDbf:cNumTur, "ARQUEOIMP",, .F.,,,,,, .F.,,,,,, .F., )

   end

      ::cCurTurno    := ::oDbf:cNumTur + ::oDbf:cSufTur





   if lTactil




      oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cCodCaj, cCodCaj:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA_24",, )

      oCodCaj:nMargin   := 25
      oCodCaj:bWhen     := {|| oUser():lAdministrador() }
      oCodCaj:bValid    := {|| cCajas( oCodCaj, ::oCaja:cAlias, oCajNbr )  }
      oCodCaj:bHelp     := {|| BrwCajaTactil( oCodCaj, ::oCaja:cAlias, oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   else




      oCodCaj := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, cCodCaj, cCodCaj:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oCodCaj:bWhen  := {|| oUser():lAdministrador() }
      oCodCaj:bValid := {|| cCajas( oCodCaj, ::oCaja:cAlias, oCajNbr )  }
      oCodCaj:bHelp  := {|| BrwCajas( oCodCaj, oCajNbr ) }




      oCajNbr := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cCajNbr, cCajNbr:= u ) }, oDlg,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   end

      ::oTreeImpresion           := TTreeView():Redefine( 400, oDlg )
      ::oTreeImpresion:bChanged  := {|| ::ChangedTreeImpresion() }





   if lTactil






      ::oPrnArq := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::cPrnArq, ::cPrnArq:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA_24",, 231 )

      ::oPrnArq:nMargin := 25
      ::oPrnArq:bValid  := {|| cDocumento( ::oPrnArq, ::oPrnArq:oHelpText ) }
      ::oPrnArq:bHelp   := {|| BrwDocumento( ::oPrnArq, ::oPrnArq:oHelpText, "AQ" ) }





      TButtonBmp():ReDefine( 232, {||( EdtDocumento( ::cPrnArq ) )}, oDlg,,, .F.,,,, .F., "Printer_pencil_16",, )

   else






      ::oPrnArq := TGetHlp():ReDefine( 230, { | u | If( PCount()==0, ::cPrnArq, ::cPrnArq:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 231 )

      ::oPrnArq:bValid  := {|| cDocumento( ::oPrnArq, ::oPrnArq:oHelpText ) }
      ::oPrnArq:bHelp   := {|| BrwDocumento( ::oPrnArq, ::oPrnArq:oHelpText, "AQ" ) }

      TBtnBmp():ReDefine( 232, "Printer_pencil_16",,,,,{|| EdtDocumento( ::cPrnArq ) }, oDlg, .F., , .F.,  )

   end








      oPrinter := TGetHlp():ReDefine( 370, { | u | If( PCount()==0, ::cWinArq, ::cWinArq:= u ) }, oDlg,,,,,,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )

   if lTactil





      TButtonBmp():ReDefine( 371, {||( PrinterPreferences( oPrinter ) )}, oDlg,,, .F.,,,, .F., "Printer_preferences_16",, )

   else

      TBtnBmp():ReDefine( 371, "Printer_preferences_16",,,,,{|| PrinterPreferences( oPrinter ) }, oDlg, .F., , .F.,  )

   end





      TButton():ReDefine( 560, bBtnAction, oDlg,,, .F.,,, cBtnPrompt, .F. )

      TButton():ReDefine( 570, {|| oDlg:End( 1 ) }, oDlg,,, .F.,,,, .F. )

      oDlg:bStart := {|| ::StartDlgImprimir() }

   oDlg:Activate( , , , .T., {|| .T. }, , {|| ::InitArqueoTurno() } )

Return ( Self )



UTILITY STATIC function TTurno_StartDlgImprimir() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oPrnArq:oHelpText:cText( oRetFld( ::cPrnArq, ::oDbfDoc, "cDescrip", 1 ) )





   ::GetTreeState( ::oTreeImpresion:aItems )

   ::oTreeImpresion:Select( ::oTreeGeneral )

RETURN ( Self )



UTILITY STATIC function TTurno_ExecuteDlgImprimir( cCodCaj, nDevice, oDlg) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oDlg:Disable()

   ::SetTreeState( ::oTreeImpresion:aItems )

   ::PrintArqueo( ::oDbf:cNumTur + ::oDbf:cSufTur, cCodCaj, nDevice, "Imprimiendo arqueo", ::cPrnArq, ::cWinArq )

   oDlg:Enable()

RETURN ( .T. )



UTILITY STATIC function TTurno_PrintArqueo( cTurno, cCaja, nDevice, cCaption, cDocumento, cPrinter, nCopies) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( cTurno == nil, cTurno := ::oDbf:cNumTur + ::oDbf:cSufTur, ) ;
   IIF( cCaja == nil, cCaja := oUser():cCaja(), ) ;
   IIF( nDevice == nil, nDevice := 1, ) ;
   IIF( cCaption == nil, cCaption := "Imprimiendo arqueo", ) ;
   IIF( cDocumento == nil, cDocumento := cFormatoArqueoEnCaja( oUser():cCaja(), ::oCaja:cAlias ), ) ;
   IIF( nCopies == nil, nCopies := nCopiasArqueosEnCaja( oUser():cCaja(), ::oCaja:cAlias ), ) ;
   IIF( cPrinter == nil, cPrinter := cPrinterArqueo( oUser():cCaja(), ::oCaja:cAlias ), ) ;

   if ::oDbf:Lastrec() == 0
      return nil
   end

   if !lExisteDocumento( cDocumento, ::oDbfDoc:cAlias )
      return nil
   end

   if lVisualDocumento( cDocumento, ::oDbfDoc:cAlias )

      ::lCalTurno( cTurno, cCaja, .F., .T. )

      ::FillTemporal( cCaja )

      ::PrintReport( nDevice, nCopies, cPrinter, ::oDbfDoc:cAlias )

      ::DestroyTemporal()

   end

RETURN ( Self )










FUNCTION Turnos( oMenuItem, oWnd )

   local oTurno

   IIF( oMenuItem == nil, oMenuItem := "01002", ) ;
   IIF( oWnd == nil, oWnd := oWnd(), ) ;





   if !Empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
      oWnd:Disable()
   end

   oTurno               := TTurno():New( cPatEmp(), oWnd, oMenuItem )
   if !Empty( oTurno ) .AND. oTurno:lAccess
      if oTurno:OpenFiles()
         oTurno:Activate()
      else
         oTurno:CloseFiles()
      end
   end

   if !Empty( oWnd )
      oWnd:Enable()
   end

   if oTurno <> nil
      oTurno:SetFocus()
   end

RETURN NIL






FUNCTION CloseTurno( oMenuItem, oWnd, lTactil, lParcial )

   local oTurno

   IIF( oMenuItem == nil, oMenuItem := "01001", ) ;
   IIF( oWnd == nil, oWnd := oWnd(), ) ;
   IIF( lTactil == nil, lTactil := .F., ) ;
   IIF( lParcial == nil, lParcial := .F., ) ;





   if !lTactilMode() .AND. !lTpvMode() .AND. !Empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end

   DisableMainWnd( oWnd )

   oTurno               := TTurno():New( cPatEmp(), oWnd, oMenuItem )

   if !Empty( oTurno ) .AND. oTurno:lCreated

      if oTurno:OpenFiles()

         if !lTactilMode() .AND. !lTpvMode()
            oTurno:Activate()
         end

         oTurno:lArqueoTurno( .F., lTactil, lParcial )

      else

         oTurno:CloseFiles()

      end

   end

   EnableMainWnd( oWnd )

   if !Empty( oTurno ) .AND. oTurno:lCreated
      oTurno:SetFocus()
   end

RETURN ( .T. )



FUNCTION Arqueos( oMenuItem, oWnd )

   local oTurno

   IIF( oMenuItem == nil, oMenuItem := "01040", ) ;
   IIF( oWnd == nil, oWnd := oWnd(), ) ;





   if !Empty( oWnd )
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
      oWnd:Disable()
   end

   oTurno               := TTurno():New( cPatEmp(), oWnd, oMenuItem )

   if !Empty( oTurno ) .AND. oTurno:lCreated
      if oTurno:OpenFiles()
         oTurno:lArqueoTurno( .F. )
      end
      oTurno:End()
   end

   oWnd:Enable()

   if !Empty( oTurno ) .AND. oTurno:lCreated
      oTurno:SetFocus()
   end

RETURN NIL



UTILITY STATIC function TTurno_Reindexa( oMeter) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::DefineFiles()

   if !Empty( ::oDbf )
      ::oDbf:IdxFDel()
      ::oDbf:Activate( .F., .T., .F. )
      ::oDbf:Pack()
      ::oDbf:End()
   end

   if !Empty( ::oDbfCaj )
      ::oDbfCaj:IdxFDel()
      ::oDbfCaj:Activate( .F., .T., .F. )
      ::oDbfCaj:Pack()
      ::oDbfCaj:End()
   end

   if !Empty( ::oDbfDet )
      ::oDbfDet:IdxFDel()
      ::oDbfDet:Activate( .F., .T., .F. )
      ::oDbfDet:Pack()
      ::oDbfDet:End()
   end

RETURN ( Self )



UTILITY STATIC function TTurno_Contabiliza() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno





   if !::oDbf:lCloTur .AND. !::lAllSesions
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " no cerrada", 0 )
      Return ( Self )
   end

   if ::oDbf:lConTur .AND. !::lAllSesions
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " ya contabilizada", 0 )
      Return ( Self )
   end

   ::oMtrSelect:SetTotal( 8 )






   if OpenDiario( cRutCnt(), ::cGetEmpresaContaplus )
      ::nAsiento  := RetLastAsi()
      CloseDiario()
   else
      ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " imposible abrir ficheros de contaplus", 0 )
      return .F.
   end






   ::oDbf:GetStatus()

   if ::lChkSimula
      ::aSimula      := {}
   else
      ::aSimula      := nil
   end






   ::oMtrSelect:Set( 1 )

   if ::lChkContabilizarFacturasProveedores

      ::oTreeSelect:Add( "Contabilizando factura de proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oFacPrvT:OrdKeyCount() )

      ::oFacPrvT:GoTop()

      if ::lAllSesions .OR. ::oFacPrvT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oFacPrvT:eof()

            if ::oFacPrvT:dFecFac >= ::dFechaInicio .AND. ::oFacPrvT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oFacPrvT:cSerFac, ::aSer )

               CntFacPrv( ::lChkSimula, ::lChkContabilizarPagosProveedores, .F., ::oTreeSelect, nil, ::aSimula, ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias )

            end

            ::oFacPrvT:Skip()

            ::oMtrProcess:Set( ::oFacPrvT:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oFacPrvT:OrdKeyNo() )






   ::oMtrSelect:Set( 2 )

   if ::lChkContabilizarRectificativasProveedores

      ::oTreeSelect:Add( "Contabilizando factura rectificativa de proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oRctPrvT:OrdKeyCount() )

      ::oRctPrvT:GoTop()

      if ::lAllSesions .OR. ::oRctPrvT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oRctPrvT:eof()

            if ::oRctPrvT:dFecFac >= ::dFechaInicio .AND. ::oRctPrvT:dFecFac <= ::dFechaFin .AND. lChkSer( ::oRctPrvT:cSerFac, ::aSer )

               CntRctPrv( ::lChkSimula, ::lChkContabilizarPagosProveedores, .F., ::oTreeSelect, nil, ::aSimula, ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias )

            end

            ::oRctPrvT:Skip()

            ::oMtrProcess:Set( ::oRctPrvT:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oRctPrvT:OrdKeyNo() )






   ::oMtrSelect:Set( 3 )

   if ::lChkContabilizarPagosProveedores .AND. !::lChkContabilizarFacturasProveedores

      ::oTreeSelect:Add( "Contabilizando pagos a proveedores", 1 )

      ::oMtrProcess:SetTotal( ::oFacPrvP:OrdKeyCount() )

      ::oFacPrvP:GoTop()

      if ::lAllSesions .OR. ::oFacPrvP:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacPrvP:cTurFac + ::oFacPrvP:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak  .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:dPreCob >= ::dFechaInicio .AND. ::oFacPrvP:dPreCob <= ::dFechaFin .AND. lChkSer( ::oFacPrvP:cSerFac, ::aSer )

               CntRecPrv( ::lChkSimula, ::oTreeSelect, nil, ::aSimula, .F., ::oFacPrvT:cAlias, ::oFacPrvP:cAlias, ::oProvee:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

            end

            ::oFacPrvP:Skip()

            ::oMtrProcess:Set( ::oFacPrvP:OrdKeyNo() )

         end

      end

   end

   ::oMtrProcess:Set( ::oFacPrvP:OrdKeyCount() )






   ::oMtrSelect:Set( 4 )

   if !::lAllSesions .AND. ::lChkContabilizarContadores

      ::oTreeSelect:Add( "Contabilizando contadores", 1 )

      if ::oDbfDet:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::lBreak  .AND. !::oDbfDet:eof()

            ::ContabilizaContadores()

            ::oDbfDet:Skip()

         end

      end

   end






   ::oMtrSelect:Set( 5 )

   if ::lChkContabilizarTicket

      ::oTreeSelect:Add( "Contabilizando tickets", 1 )

      ::oMtrProcess:SetTotal( ::oTikT:OrdKeyCount() )

      ::oTikT:GoTop()

      if ::lAllSesions .OR. ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oTikT:eof()

            if ::oTikT:dFecTik >= ::dFechaInicio .AND. ::oTikT:dFecTik <= ::dFechaFin .AND. lChkSer( ::oTikT:cSerTik, ::aSer )

               do case
               case ::oTikT:cTipTik == "1"

                  CntTiket( ::lChkSimula, .T., .F., .F., ::oTreeSelect, nil, ::aSimula, ::oTikT:cAlias, ::oTikL:cAlias, ::oTikP:cAlias, ::oClient:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

               case ::oTikT:cTipTik == "4"

                  CntTiket( ::lChkSimula, .T., .F., .F., ::oTreeSelect, nil, ::aSimula, ::oTikT:cAlias, ::oTikL:cAlias, ::oTikP:cAlias, ::oClient:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oDbfDiv:cAlias )

               end

            end

            ::oTikT:Skip()

            ::oMtrProcess:Set( ::oTikT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oTikT:OrdKeyCount() )

   end






   ::oMtrSelect:Set( 6 )

   if ::lChkContabilizarFactura

      ::oTreeSelect:Add( "Contabilizando facturas de clientes", 1 )

      ::oMtrProcess:SetTotal( ::oFacCliT:OrdKeyCount() )

      ::oFacCliT:GoTop()

      if ::lAllSesions .OR. ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oFacCliT:eof()

            CntFacCli( ::lChkSimula, .T., nil, .F., ::oTreeSelect, nil, ::aSimula, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, ::oAlbCliT:cAlias, ::oClient:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias, ::oNewImp )

            ::oFacCliT:Skip()

            ::oMtrProcess:Set( ::oFacCliT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oFacCliT:OrdKeyCount() )

   end






   ::oMtrSelect:Set( 7 )

   if ::lChkContabilizarRectificativa

      ::oTreeSelect:Add( "Contabilizando facturas rectificativas de clientes", 1 )

      ::oMtrProcess:SetTotal( ::oRctCliT:OrdKeyCount() )

      ::oRctCliT:GoTop()

      if ::lAllSesions .OR. ::oRctCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

         while ( ::lAllSesions .OR. ::oRctCliT:cTurFac + ::oRctCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur ) .AND. !::lBreak .AND. !::oRctCliT:eof()

            CntFacRec( ::lChkSimula, .T., nil, .F., ::oTreeSelect, nil, ::aSimula, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oFacCliP:cAlias, ::oClient:cAlias, ::oDbfDiv:cAlias, ::oArticulo:cAlias, ::oFPago:cAlias, ::oIvaImp:cAlias, ::oNewImp )

            ::oRctCliT:Skip()

            ::oMtrProcess:Set( ::oRctCliT:OrdKeyNo() )

         end

      end

      ::oMtrProcess:Set( ::oRctCliT:OrdKeyCount() )

   end

   ::oMtrSelect:Set( 8 )



   if !::lChkSimula

      ::Asiento( .T. )

   else

      if !Empty( ::aSimula )
         if OpenDiario( cRutCnt(), ::cGetEmpresaContaplus )
            msgTblCon( ::aSimula, cDivEmp(), ::oDbfDiv:cAlias )
            CloseDiario()
         end
      else
         MsgStop( "El asiento est vaco" )
      end

   end

   ::oTreeSelect:Add( "Proceso finalizado", 1 )

   ::oDbf:SetStatus()

RETURN ( Self )



UTILITY STATIC function TTurno_MixApunte() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local nLen
   local nScan
   local cApunte
   local aApunte  := aClone( ::aSimula )

   nLen           := len( aApunte )
   ::aSimula      := {}

   for n := 1 to nLen

      cApunte     := aApunte[ n ]






      if cApunte[ 5  ] <> 0 .OR.  cApunte[ 7 ] <> 0 .OR.  cApunte[ 28 ] <> 0 .OR.  cApunte[ 29] <> 0 .OR.  cApunte[ 30 ] <> 0 .OR.  cApunte[ 9 ] <> 0





         nScan    := aScan( ::aSimula, {| cSimula |cApunte[ 3   ] == cSimula[ 3   ] .AND.  cApunte[ 4   ] == cSimula[ 4   ] .AND.  cApunte[ 10      ] == cSimula[ 10      ] .AND.  cApunte[ 11 ] == cSimula[ 11 ] .AND.  cApunte[ 6 ] == cSimula[ 6 ] } )
         if nScan <> 0
            ::aSimula[ nScan, 5  ]     += cApunte[ 5  ]
            ::aSimula[ nScan, 7 ]     += cApunte[ 7 ]
            ::aSimula[ nScan, 28 ]     += cApunte[ 28 ]
            ::aSimula[ nScan, 29]     += cApunte[ 29]
            ::aSimula[ nScan, 30 ]     += cApunte[ 30 ]
            ::aSimula[ nScan, 9 ]     += cApunte[ 9 ]
         else
            aAdd( ::aSimula, cApunte )
         end

      end

   next

Return nil



UTILITY STATIC function TTurno_ContabilizaContadores() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local m
   local aCli        := {}
   local aVta        := {}
   local aIva        := {}
   local aIvm        := {}
   local aPgo        := {}
   local nPos        := 0
   local nTotCon     := 0
   local nImpDet     := 0
   local nImpIvm     := 0
   local nIvaDet     := 0
   local nDouDiv     := 0
   local nRouDiv     := 0
   local cCtaIva     := ""
   local cOrdAnt     := ""
   local cCtaPgo     := cCtaCob()
   local cCtaCli     := cCtaSin()
   local cRutCnt     := cRutCnt()
   local cCodDiv     := cDivEmp()
   local cCtaIvm     := cCtaVta() + RetGrpVta( ::oDbfDet:cCodArt, cRutCnt, ::cGetEmpresaContaplus, ::oArticulo:cAlias )
   local cCtaVen     := RetCtaVta( ::oDbfDet:cCodArt, ::oArticulo:cAlias )
   local cDesAsi     := "N/Sesin " + lTrim( ::oDbf:cNumTur ) + "/" + ::oDbf:cSufTur
   local cPgoAsi     := "C/Sesin " + lTrim( ::oDbf:cNumTur ) + "/" + ::oDbf:cSufTur
   local dFecha      := ::oDbf:dCloTur
   local cTerNif     := Space(1)
   local cTerNom     := Space(1)

   nTotCon           := Round( ::oDbfDet:nPvpArt * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv )






   cOrdAnt           := ::oAlbCliL:ordSetFocus( "cNumRef" )

   if ::oAlbCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oAlbCliT:eof()

         nDouDiv     := nDouDiv( ::oAlbCliT:cDivAlb, ::oDbfDiv:cAlias )
         nRouDiv     := nRouDiv( ::oAlbCliT:cDivAlb, ::oDbfDiv:cAlias )

         if ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb + ::oDbfDet:cCodArt )

            while ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb + ::oDbfDet:cCodArt == ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb + ::oAlbCliL:cRef .AND. !::oAlbCliL:eof()

               nTotCon  -= nTotLAlbCli( ::oAlbCliL:cAlias, nDouDiv, nRouDiv, nil, .T., .F., .F. )

               ::oAlbCliL:Skip()

            end

         end

         ::oAlbCliT:Skip()

      end

   end

   ::oAlbCliL:ordSetFocus( cOrdAnt )






   cOrdAnt           := ::oFacCliL:ordSetFocus( "cNumRef" )

   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         nDouDiv     := nDouDiv( ::oFacCliT:cDivFac, ::oDbfDiv:cAlias )
         nRouDiv     := nRouDiv( ::oFacCliT:cDivFac, ::oDbfDiv:cAlias )

         if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac + ::oDbfDet:cCodArt )

            while ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac + ::oDbfDet:cCodArt == ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac + ::oFacCliL:cRef .AND. !::oFacCliL:eof()

               nTotCon  -= nTotLFacCli( ::oFacCliL:cAlias, nDouDiv, nRouDiv, nil, .T., .F., .F. )

               ::oFacCliL:Skip()

            end

         end

         ::oFacCliT:Skip()

      end

   end

   ::oFacCliL:ordSetFocus( cOrdAnt )






   if nTotCon == 0
      Return ( ::aSimula )
   end






   nImpDet           := Round( nTotCon / ( ( ::oDbfDet:nIvaArt / 100 ) + 1 ), ::nDorDiv )
   nImpIvm           := Round( ::oDbfDet:nValImp * ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ), ::nDorDiv )
   nIvaDet           := nTotCon - nImpDet - nImpIvm






   if Empty( cCtaVen )
      cCtaVen        := cCtaCli() + RetGrpVta( ::oDbfDet:cCodArt, cRutCnt, ::cGetEmpresaContaplus, ::oArticulo:cAlias )
   end






   if nTotCon <> 0

      nPos           := aScan( aCli, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaCli } )
      if nPos == 0
         aAdd( aCli, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaCli, nTotCon } )
      else
         aCli[ nPos, 4 ] += nTotCon
      end

   end






   if nImpDet <> 0

      if !::lChkSimula .AND. !ChkSubCta( cRutCnt, ::cGetEmpresaContaplus, cCtaVen, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + "subcuenta de venta " + RTrim( cCtaVen ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         return .F.
      end

      nPos           := aScan( aVta, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaVen } )
      if nPos == 0
         aAdd( aVta, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaVen, nImpDet } )
      else
         aVta[ nPos, 4 ] += nImpDet
      end

   end






   if nImpIvm <> 0

      if !::lChkSimula .AND. !ChkSubCta( cRutCnt, ::cGetEmpresaContaplus, cCtaIvm, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + " subcuenta de impuestos especiales " + RTrim( cCtaIvm ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         return .F.
      end

      nPos           := aScan( aIvm, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaIvm } )
      if nPos == 0
         aAdd( aIvm, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaIvm, nImpIvm } )
      else
         aIvm[ nPos, 4 ] += nImpIvm
      end

   end






   cCtaIva           := cSubCuentaIva( ::oDbfDet:nIvaArt, .F., cRutCnt, ::cGetEmpresaContaplus, ::oIvaImp )

   if nIvaDet <> 0

      if !::lChkSimula .AND. !ChkSubCta( cRutCnt, ::cGetEmpresaContaplus, cCtaIva, , .F. )
         ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + "subcuenta de " + cImp() + " " + RTrim( cCtaIva ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
         return .F.
      end

      nPos  := aScan( aIva, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaIva } )
      if nPos == 0
         aAdd( aIva, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaIva, nImpDet, nIvaDet, ::oDbfDet:nIvaArt } )
      else
         aIva[ nPos, 4 ] += nImpDet
         aIva[ nPos, 5 ] += nIvaDet
         aIva[ nPos, 6 ] := ::oDbfDet:nIvaArt
      end

   end





   if !::lChkSimula .AND. !ChkSubCta( cRutCnt, ::cGetEmpresaContaplus, cCtaPgo, , .F. )
      ::oTreeSelect:Add( "Contadores : " + ::oDbf:cNumTur + " subcuenta de pago " + RTrim( cCtaPgo ) + " no encontada, en empresa" + ::cGetEmpresaContaplus, 0 )
      return .F.
   end

   nPos  := aScan( aPgo, {|x| x[ 1 ] + x[ 2 ] + x[ 3 ] + x[ 4 ] == ::cGetEmpresaContaplus + ::cGetProjectoContaplus + cCtaPgo + cCtaCli } )
   if nPos == 0
      aAdd( aPgo, { ::cGetEmpresaContaplus, ::cGetProjectoContaplus, cCtaPgo, cCtaCli, nTotCon } )
   else
      aPgo[ nPos, 5 ] += nTotCon
   end





   for m := 1 to len( aCli )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aCli[ m, 3 ], , aCli[ m, 4 ], cDesAsi, , Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aVta )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aVta[ m, 3 ], , , cDesAsi, aVta[ m, 4 ], Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aIvm )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aIvm[ m, 3 ], , , cDesAsi, aIvm[ m, 4 ], Val( ::oDbf:cNumTur ), , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aIva )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aIva[ m, 3 ], cCtaCli, , cDesAsi, aIva[ m, 5 ], Val( ::oDbf:cNumTur ), aIva[ m, 4 ], aIva[ m, 6 ], , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next





   for m := 1 to len( aPgo )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aPgo[ m, 3 ], , aPgo[ m, 5 ], cPgoAsi, , ::oDbf:cNumTur, , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )





















      aadd( ::aSimula, MkAsiento(   ::nAsiento,  cCodDiv, dFecha, aPgo[ m, 4 ], , , cPgoAsi, aPgo[ m, 5 ], ::oDbf:cNumTur, , , , , ::cGetProjectoContaplus, , , , , ::lChkSimula, cTerNif, cTerNom ) )

   next

RETURN ( ::aSimula )



UTILITY STATIC function TTurno_Asiento() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local nLen
   local cSubCta     := ""
   local lErrors     := .F.

   if Empty( ::aSimula )
      Return .F.
   end

   nLen              := len( ::aSimula )






   for n := 1 to nLen

      if ( dbfDiario() )->( FieldPos( "SubCta" ) ) <> 0 .AND. ( dbfDiario() )->( FieldPos( "SubCta" ) ) <= len( ::aSimula[ n ] )

         cSubCta     := ::aSimula[ n, ( dbfDiario() )->( FieldPos( "SubCta" ) ) ]

         if !( dbfSubCta() )->( dbSeek( cSubCta ) )
            ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " subcuenta " + Rtrim( cSubCta ) + " no encontrada, en empresa" + ::cGetEmpresaContaplus, 0 )
            lErrors  := .T.
         end

      else

            lErrors  := .T.

      end

   next

   if lErrors
      Return .F.
   end






   ::oMtrSelect:SetTotal( nLen )

   for n := 1 to nLen

      ::oMtrSelect:Set( n )

      WriteAsiento( ::aSimula[ n ] )

      SysRefresh()

   next






   ::oDbf:FieldPutByName( "lConTur", .T. )






   if ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbf:eof()

         ::oTikT:FieldPutByName( "lConTik", .T. )

         ::oTikT:Skip()

      end

   end






   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         ::oFacCliT:FieldPutByName( "lContab", .T. )

         ::oFacCliT:Skip()

      end

   end






   ::oTreeSelect:Add( "Sesin : " + Alltrim( ::oDbf:cNumTur ) + "/" + Rtrim( ::oDbf:cSufTur ) + " asiento generado num. " + Ltrim( Str( ::nAsiento ) ), 1 )

RETURN ( .T. )



UTILITY STATIC function TTurno_CambiaEstado() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oDbf:FieldPutByName( "lConTur", ::lChkSimula )






   if ::oTikT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oTikT:cTurTik + ::oTikT:cSufTik == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbf:eof()

         ::oTikT:Load()
         ::oTikT:lConTik      := ::lChkSimula
         ::oTikT:Save()

         ::oTikT:Skip()

      end

   end






   if ::oFacCliT:Seek( ::oDbf:cNumTur + ::oDbf:cSufTur )

      while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oFacCliT:eof()

         ::oFacCliT:Load()
         ::oFacCliT:lContab   := ::lChkSimula
         ::oFacCliT:Save()

         ::oFacCliT:Skip()

      end

   end

   ::oWndBrw:Refresh()

RETURN ( Self )



UTILITY STATIC function TTurno_lSelectTurno( lSel) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lSel == nil, lSel := ::lChkSimula, ) ;

   if ::oDbf:lCloTur

      ::oDbf:FieldPutByName( "lSndTur", lSel )

      ::MarkTurno( lSel )

      if !Empty( ::oTreeSelect )
         ::oTreeSelect:Select( ::oTreeSelect:Add( "Sesin : " + ::oDbf:cNumTur + "/" + ::oDbf:cSufTur + " procesada.", 1 ) )
      end

   end

return ( Self )



UTILITY STATIC function TTurno_lSelectAll( lSel) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   CursorWait()

   if !Empty( ::oWndBrw )
      ::oWndBrw:Disable()
   end

   ::oDbf:GetStatus()

   ::oDbf:GoTop()
   while !::oDbf:eof()
      ::lSelectTurno( lSel )
      ::oDbf:Skip()
   end

   ::oDbf:SetStatus()

   if !Empty( ::oWndBrw )
      ::oWndBrw:Enable()
      ::oWndBrw:Refresh()
   end

   CursorWE()

return ( Self )



UTILITY STATIC function TTurno_EdtLine( oLbx) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local uVar1    := ::oDbfDet:nCanAnt
   local uVar2    := ::oDbfDet:nCanAct
   local uVar3    := ::oDbfDet:nPvpArt
   local bValid   := { || .T. }

   if !::oDbfDet:eof()

      if oLbx:lEditCol( 3, @uVar1, ::cPicUnd, bValid )

         if uVar1 >= 0

            ::oDbfDet:Load()
            ::oDbfDet:nCanAnt := uVar1
            ::oDbfDet:Save()

            if oLbx:lEditCol( 4, @uVar2, ::cPicUnd, bValid )

               if uVar2 >= 0

                  ::oDbfDet:Load()
                  ::oDbfDet:nCanAct := uVar2
                  ::oDbfDet:Save()

                  if oLbx:lEditCol( 6, @uVar3, ::cPouDiv, bValid )

                     if uVar3 > 0

                        ::oDbfDet:Load()
                        ::oDbfDet:nPvpArt := uVar3
                        ::oDbfDet:Save()

                     end

                  end

               end

            end

         end

      end

      oLbx:Refresh()

   end

RETURN NIL



UTILITY STATIC function TTurno_RellenaIva() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   while !::oDbfDet:eof()

      if ::oArticulo:Seek( ::oDbfDet:cCodArt )
         ::oDbfDet:FieldPutByName( "nIvaArt", nIva( ::oIvaImp:cAlias, ::oArticulo:TipoIva ) )
      end

      ::oDbfDet:Skip()

      SysRefresh()

   end

RETURN ( Self )



UTILITY STATIC function TTurno_lNowOpen( oWnd) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( oWnd == nil, oWnd := oWnd(), )

   __Run( oRetFld( oUser():cCaja(), ::oCaja, "lNoArq" ) )

   if ( !::lOpenTurno() .OR. !::lOpenCaja() ) .AND. !( oRetFld( oUser():cCaja(), ::oCaja, "lNoArq" ) )

      if !::lCreateTurno()

         MsgStop( "Es necesario iniciar una sesin para trabajar." )









      end

   end

   ::CurTurno()

   if ::oWndBrw <> nil
      ::oWndBrw:Refresh()
   end

RETURN ( Self )



UTILITY STATIC function TTurno_SyncAllDbf() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if Empty( ::oDbf ) .OR. Empty( ::oDbfCaj ) .OR. Empty( ::oDbfDet )
      ::DefineFiles()
   end

   lCheckDbf( ::oDbf    )
   lCheckDbf( ::oDbfCaj )
   lCheckDbf( ::oDbfDet )

RETURN ( Self )



UTILITY STATIC function TTurno_ActTactil() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oTikT:GetStatus( .T. )

   if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

      do case
         case ::oTikT:cTipTik == "1"

            while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

               AddImpTactil( nTotNTpv( ::oTikL:cAlias ), ::oTikL:cCbaTil, ::oArticulo )
               AddImpTactil( nTotNTpv( ::oTikL:cAlias ), ::oTikL:cComTil, ::oArticulo )

               ::oTikL:Skip()
               SysRefresh()

            end

         case ::oTikT:cTipTik == "4"

            while ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik == ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil .AND. !::oTikL:Eof()

               AddImpTactil( - nTotNTpv( ::oTikL:cAlias ), ::oTikL:cCbaTil, ::oArticulo )
               AddImpTactil( - nTotNTpv( ::oTikL:cAlias ), ::oTikL:cComTil, ::oArticulo )

               ::oTikL:Skip()
               SysRefresh()

            end

      end

   end

   ::oTikT:SetStatus()

RETURN NIL



UTILITY STATIC function TTurno_CreateData() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local lSnd        := .F.
   local oTurno
   local oTurnoTmp
   local cFileName   := "Tur" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()

   oTurno            := TTurno():Create( cPatEmp() )
   oTurno:OpenService()





   oTurnoTmp      := TTurno():Create( cPatSnd() )
   oTurnoTmp:OpenService( .T. )





   ::oSender:SetText( "Enviando sesiones" )

   oTurno:oDbf:GoTop()
   while !oTurno:oDbf:eof()
      if oTurno:oDbf:lSndTur
         lSnd  := .T.
         dbPass( oTurno:oDbf:cAlias, oTurnoTmp:oDbf:cAlias, .T. )

         ::oSender:SetText( oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )

         if oTurno:oDbfDet:Seek( oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur )
            while oTurno:oDbfDet:cNumTur + oTurno:oDbfDet:cSufTur == oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur
               dbPass( oTurno:oDbfDet:cAlias, oTurnoTmp:oDbfDet:cAlias, .T. )
               oTurno:oDbfDet:Skip()
               SysRefresh()
            end
         end

         if oTurno:oDbfCaj:Seek( oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur )
            while oTurno:oDbfCaj:cNumTur + oTurno:oDbfCaj:cSufTur == oTurno:oDbf:cNumTur + oTurno:oDbf:cSufTur
               dbPass( oTurno:oDbfCaj:cAlias, oTurnoTmp:oDbfCaj:cAlias, .T. )
               oTurno:oDbfCaj:Skip()
               SysRefresh()
            end
         end

      end
      oTurno:oDbf:Skip()
      SysRefresh()
   end





   oTurno:CloseService()
   oTurno:End()

   oTurnoTmp:CloseService()
   oTurnoTmp:End()

   if lSnd





      ::oSender:SetText( "Comprimiendo sesiones" )

      if ::oSender:lZipData( cFileName )
         ::oSender:SetText( "Ficheros comprimidos" )
      else
         ::oSender:SetText( "ERROR al crear fichero comprimido" )
      end

   else

      ::oSender:SetText( "No hay sesiones para enviar" )

   end

Return ( Self )



UTILITY STATIC function TTurno_RestoreData() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cPath     := cPatEmp()

   if ::OpenService()

      while !::oDbf:eof()

         if ::oDbf:lCloTur
            ::oDbf:Load()
            ::oDbf:lSndTur    := .F.
            ::oDbf:Save()
         end

         ::oDbf:Skip()

      end

      ::CloseService()

   end

Return ( Self )



UTILITY STATIC function TTurno_SendData() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cFileName         := "Tur" + StrZero( ::nGetNumberToSend(), 6 ) + "." + RetSufEmp()

   if file( cPatOut() + cFileName )

      if ftpSndFile( cPatOut() + cFileName, cFileName, 2000, ::oSender )
         ::lSuccesfullSend := .T.
         ::IncNumberToSend()
         ::oSender:SetText( "Fichero enviado" )
      else
         ::oSender:SetText( "ERROR fichero no enviado" )
      end

   end

Return ( Self )



UTILITY STATIC function TTurno_ReciveData() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local aExt        := aRetDlgEmp()





   ::oSender:SetText( "Recibiendo sesiones" )

   for n := 1 to len( aExt )
      ftpGetFiles( "Tur*." + aExt[ n ], cPatIn(), 2000, ::oSender )
   next

   ::oSender:SetText( "Sesiones recibidas" )

Return Self



UTILITY STATIC function TTurno_Process() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local m
   local oBlock
   local oError
   local oTurno
   local oTurnoTmp
   local aFiles      := Directory( cPatIn() )

   for m := 1 to len( aFiles )

      ::oSender:SetText( "Procesando fichero : " + aFiles[ m, 1 ] )

      oBlock         := ErrorBlock( { | oError | ApoloBreak( oError ) } )
      BEGIN SEQUENCE





      if ::oSender:lUnZipData( cPatIn() + aFiles[ m, 1 ] )





         if file( cPatSnd() + "Turno.Dbf" )

            oTurnoTmp   := TTurno():New( cPatSnd() )
            oTurnoTmp:OpenService( .F., .T. )

            oTurno      := TTurno():New( cPatEmp() )
            oTurno:OpenService()





            oTurnoTmp:oDbf:GoTop()
            while !oTurnoTmp:oDbf:eof()

               if oTurno:oDbf:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  dbPass( oTurnoTmp:oDbf:cAlias, oTurno:oDbf:cAlias, .F. )
                  ::oSender:SetText( "Reemplazado : " + oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )
               else
                  dbPass( oTurnoTmp:oDbf:cAlias, oTurno:oDbf:cAlias, .T. )
                  ::oSender:SetText( "Aadido     : " + oTurno:oDbf:cNumTur + "; " + Dtoc( oTurno:oDbf:dOpnTur ) + "; " + oTurno:oDbf:cHorOpn + "; " + Dtoc( oTurno:oDbf:dCloTur ) + "; " + oTurno:oDbf:cHorClo + "; " + oTurno:oDbf:cCajTur )
               end





               while oTurno:oDbfDet:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  oTurno:oDbfDet:Delete()
                  SysRefresh()
               end





               if oTurnoTmp:oDbfDet:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  while oTurnoTmp:oDbfDet:cNumTur + oTurnoTmp:oDbf:cSufTur == oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur .AND. !oTurno:oDbfDet:eof()
                     dbPass( oTurnoTmp:oDbfDet:cAlias, oTurno:oDbfDet:cAlias, .T. )
                     oTurnoTmp:oDbfDet:Skip()
                     SysRefresh()
                  end
               end





               while oTurno:oDbfCaj:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  oTurno:oDbfCaj:Delete()
                  SysRefresh()
               end





               if oTurnoTmp:oDbfCaj:Seek( oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur )
                  while oTurnoTmp:oDbfCaj:cNumTur + oTurnoTmp:oDbf:cSufTur == oTurnoTmp:oDbf:cNumTur + oTurnoTmp:oDbf:cSufTur .AND. !oTurno:oDbfCaj:eof()
                     dbPass( oTurnoTmp:oDbfCaj:cAlias, oTurno:oDbfCaj:cAlias, .T. )
                     oTurnoTmp:oDbfCaj:Skip()
                     SysRefresh()
                  end
               end





               oTurnoTmp:oDbf:Skip()
               SysRefresh()

            end





            oTurno:CloseService()
            oTurno:End()

            oTurnoTmp:CloseService()
            oTurnoTmp:End()

         end

      end

      ::oSender:AppendFileRecive( aFiles[ m, 1 ] )

      RECOVER USING oError

         ::oSender:SetText( "Error procesando fichero " + aFiles[ m, 1 ] )
         ::oSender:SetText( ErrorMessage( oError ) )

      end

      ErrorBlock( oBlock )

   next

Return Self



UTILITY STATIC function TTurno_Save() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   WritePProString( "Envio",     ::cText, cValToChar( ::lSelectSend ), ::cIniFile )
   WritePProString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile )

RETURN ( Self )



UTILITY STATIC function TTurno_Load() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::lSelectSend     := ( Upper( GetPvProfString( "Envio",     ::cText, cValToChar( ::lSelectSend ),   ::cIniFile ) ) == ".T." )
   ::lSelectRecive   := ( Upper( GetPvProfString( "Recepcion", ::cText, cValToChar( ::lSelectRecive ), ::cIniFile ) ) == ".T." )

RETURN ( Self )



UTILITY STATIC function TTurno_nGetNumberToSend() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::nNumberSend     := GetPvProfInt( "Numero", ::cText, ::nNumberSend, ::cIniFile )

Return ( ::nNumberSend )



Function lCajaOpen( cCodCaj )

   local oTurno         := TTurno():New( cPatEmp() )
   local lCajaOpen      := .T.

   if !Empty( oTurno )

      if oTurno:OpenService()

         if oTurno:oDbfCaj:SeekInOrd( oTurno:CurTurno() + cCodCaj, "cCajTur" )
            lCajaOpen   := !oTurno:oDbfCaj:lCajClo
         end

         oTurno:CloseService()

      end

      oTurno:End()

   end

Return ( lCajaOpen )






Function ChkTurno( oMenuItem, oWnd )

   local oTurno         := TTurno():New( cPatEmp(), oWnd, oMenuItem )

   if !Empty( oTurno )

      if oTurno:OpenFiles()

         oTurno:lNowOpen( oWnd )

         if oMsgSesion() <> nil
            oMsgSesion():SetText( "Sesin : " + Transform( oTurno:cCurTurno, "######" ) )
         end

         oTurno:CloseFiles()

      end

      oTurno:End()

   end

Return ( .T. )






Function lCurSesion( cDbfCaj )

   local lCurSesion  := .F.
   local lOpen       := .F.

   if Empty( cDbfCaj )

      dbUseArea( .T., ( cDriver() ), ( cPatDat() + "Cajas.Dbf" ), ( cCheckArea( "CAJAS", @cDbfCaj ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
      if !lAIS() ; ordListAdd( ( cPatDat() + "Cajas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end
      lOpen          := .T.

   end

   lCurSesion        := !Empty( TTurno():cCurTurno ) .OR. RetFld( oUser():cCaja(), cDbfCaj, "lNoArq" )

   if lOpen

      if !Empty( cDbfCaj )
         ( cDbfCaj )->( dbCloseArea() )
      end

      cDbfCaj        := nil

   end

Return ( lCurSesion )






Function CloSesion()

   TTurno():cCurTurno   := nil

Return ( nil )



function AddImpTactil( nImpVta, cCodArt, uArt )

   local aArtStatus

   do case
      case ValType( uArt ) == "C"

         aArtStatus  := aGetStatus( uArt, .T. )

         if ( uArt )->( dbSeek( cCodArt ) ) .AND. ( uArt )->( dbRLock() )
            ( uArt )->nPosTcl  += nImpVta
            ( uArt )->( dbRUnlock() )
         end

         SetStatus( uArt, aArtStatus )

      case ValType( uArt ) == "O"

         uArt:GetStatus()

         if uArt:Seek( cCodArt )
            uArt:Load()
            uArt:nPosTcl  += nImpVta
            uArt:Save()
         end

         uArt:SetStatus()

   end

return ( nil )



UTILITY STATIC function TTurno_CheckFiles( cFileAppendFrom) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::OpenService()
      ::CloseService()
   end

Return ( Self )



UTILITY STATIC function TTurno_DataReport( oFastReport) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno





   oFastReport:ClearDataSets()

   oFastReport:SetWorkArea(     "Sesin", ::oDbf:nArea, .F., { 1, 1, 0 } )
   oFastReport:SetFieldAliases( "Sesin", cObjectsToReport( ::oDbf ) )

   oFastReport:SetWorkArea(     "Cajas", ::oDbfCaj:nArea )
   oFastReport:SetFieldAliases( "Cajas", cObjectsToReport( ::oDbfCaj ) )

   oFastReport:SetWorkArea(     "Contadores", ::oDbfDet:nArea )
   oFastReport:SetFieldAliases( "Contadores", cObjectsToReport( ::oDbfDet ) )

   oFastReport:SetWorkArea(     "Lineas de informes", ::oDbfTemporal:nArea )
   oFastReport:SetFieldAliases( "Lineas de informes", cObjectsToReport( ::oDbfTemporal ) )

   oFastReport:SetWorkArea(     "Usuarios", ::oDbfUsr:nArea )
   oFastReport:SetFieldAliases( "Usuarios", cItemsToReport( aItmUsr() ) )

   oFastReport:SetWorkArea(     "Empresa", ::oDbfEmp:nArea )
   oFastReport:SetFieldAliases( "Empresa", cItemsToReport( aItmEmp() ) )

   oFastReport:SetMasterDetail( "Sesin",   "Cajas",                {|| ::cCurTurno } )
   oFastReport:SetMasterDetail( "Sesin",   "Contadores",           {|| ::cCurTurno } )
   oFastReport:SetMasterDetail( "Sesin",   "Usuarios",             {|| ::oDbf:cCajTur } )
   oFastReport:SetMasterDetail( "Sesin",   "Empresa",              {|| cCodigoEmpresaEnUso() } )

   oFastReport:SetResyncPair(   "Sesin",   "Cajas" )
   oFastReport:SetResyncPair(   "Sesin",   "Contadores" )
   oFastReport:SetResyncPair(   "Sesin",   "Usuarios" )
   oFastReport:SetResyncPair(   "Sesin",   "Empresa" )

Return nil



UTILITY STATIC function TTurno_VariableReport( oFastReport) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   oFastReport:DeleteCategory(  "Compras sesin" )
   oFastReport:DeleteCategory(  "Ventas sesin" )
   oFastReport:DeleteCategory(  "Entradas y salidas sesin" )
   oFastReport:DeleteCategory(  "Cobros sesin" )
   oFastReport:DeleteCategory(  "Pagos sesin" )
   oFastReport:DeleteCategory(  "Diferencias sesin" )
   oFastReport:DeleteCategory(  "Saldo sesin" )
   oFastReport:DeleteCategory(  "Cajas sesin" )
   oFastReport:DeleteCategory(  "Numeros sesin" )
   oFastReport:DeleteCategory(  "Monedas en caja" )





   oFastReport:AddVariable(     "Compras sesin",   "Total alabranes de proveedores",                "GetHbVar('nTotAlbPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total facturas de proveedores",                 "GetHbVar('nTotFacPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total facturas rectificativas de proveedores",  "GetHbVar('nTotRctPrvCompras')"     )
   oFastReport:AddVariable(     "Compras sesin",   "Total compras",                                 "GetHbVar('nTotCompras')"           )

   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en albaranes de clientes",      "GetHbVar('nTotAlbCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total albaranes de clientes",                    "GetHbVar('nTotAlbCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en facturas de clientes",       "GetHbVar('nTotFacCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total facturas de clientes",                     "GetHbVar('nTotFacCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total facturas rectificativas de clientes",      "GetHbVar('nTotRctCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en tickets de clientes",        "GetHbVar('nTotTikCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total tickets de clientes",                      "GetHbVar('nTotTikCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en cheques regalo de clientes", "GetHbVar('nTotTikCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total cheques regalo de clientes",               "GetHbVar('nTotChkCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en devoluciones de clientes",   "GetHbVar('nTotDevCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total devoluciones de clientes",                 "GetHbVar('nTotDevCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores en vales de clientes",          "GetHbVar('nTotValCliContadores')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total vales de clientes",                        "GetHbVar('nTotValCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total liquidado en vales de clientes",           "GetHbVar('nTotValCliLiquidados')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total anticipos de clientes",                    "GetHbVar('nTotAntCliVentas')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total liquidado en anticipos de clientes",       "GetHbVar('nTotAntCliLiquidados')"  )
   oFastReport:AddVariable(     "Ventas sesin",   "Total contadores",                               "GetHbVar('nTotContadores')"        )
   oFastReport:AddVariable(     "Ventas sesin",   "Total ventas",                                   "GetHbVar('nTotVentas')"            )
   oFastReport:AddVariable(     "Ventas sesin",   "Total venta de credito",                         "GetHbVar('nTotVentaCredito')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total venta contado",                            "GetHbVar('nTotVentaContado')"      )
   oFastReport:AddVariable(     "Ventas sesin",   "Total ventas sesin",                            "GetHbVar('nTotVentaSesion')"       )

   oFastReport:AddVariable(     "Ventas sesin",   "Importe de ticket medio",                        "GetHbVar('nTicketMedio')"          )

   oFastReport:AddVariable(     "Entradas y salidas sesin", "Total entradas y salidas",             "GetHbVar('nTotEntradas')"          )

   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas en pedido de clientes",           "GetHbVar('nTotPedCliEntregas')"    )
   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas en albaranes de clientes",        "GetHbVar('nTotAlbCliEntregas')"    )
   oFastReport:AddVariable(     "Cobros sesin",   "Total entregas a cuenta",                        "GetHbVar('nTotEntregas')"          )

   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en tickets de clientes",            "GetHbVar('nTotTikCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en facturas de clientes",           "GetHbVar('nTotFacCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en vales de clientes",              "GetHbVar('nTotValCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en cheques regalo",                 "GetHbVar('nTotChkCliCobros')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en efectivo",                       "GetHbVar('nTotCobroEfectivo')"     )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros no efectivo",                       "GetHbVar('nTotCobroNoEfectivo')"   )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en tarjeta",                        "GetHbVar('nTotCobroTarjeta')"      )
   oFastReport:AddVariable(     "Cobros sesin",   "Total cobros en sesin",                         "GetHbVar('nTotCobroMedios')"       )

   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en facturas de proveedores",          "GetHbVar('nTotFacPrvPagos')"       )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en efectivo",                         "GetHbVar('nTotPagoEfectivo')"      )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos no efectivo",                         "GetHbVar('nTotPagoNoEfectivo')"    )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en tarjeta",                          "GetHbVar('nTotPagoTarjeta')"       )
   oFastReport:AddVariable(     "Pagos sesin",   "Total pagos en sesion",                           "GetHbVar('nTotPagoMedios')"        )

   oFastReport:AddVariable(     "Diferencias sesin",   "Diferencias cobros",                        "GetHbVar('nDifCobros')"            )
   oFastReport:AddVariable(     "Diferencias sesin",   "Diferencias totales",                       "GetHbVar('nDifTotal')"             )

   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo efectivo",                           "GetHbVar('nTotSaldoEfectivo')"    )
   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo no efectivo",                        "GetHbVar('nTotSaldoNoEfectivo')"  )
   oFastReport:AddVariable(     "Saldo sesin",     "Total saldo tarjeta",                            "GetHbVar('nTotSaldoTarjeta')"     )

   oFastReport:AddVariable(     "Cajas sesin",     "Total caja efectivo",                           "GetHbVar('nTotCajaEfectivo')"      )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja tarjeta",                            "GetHbVar('nTotCajaTarjeta')"       )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja objetivo",                           "GetHbVar('nTotCajaObjetivo')"      )
   oFastReport:AddVariable(     "Cajas sesin",     "Total caja",                                    "GetHbVar('nTotCaja')"              )

   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de albaranes en sesin",                 "GetHbVar('nTotNumeroAlbaranes')"   )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de facturas en sesin",                  "GetHbVar('nTotNumeroFacturas')"    )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de tickets en sesin",                   "GetHbVar('nTotNumeroTikets')"      )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de vales en sesin",                     "GetHbVar('nTotNumeroVales')"       )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de cheques en sesin",                   "GetHbVar('nTotNumeroCheques')"     )
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de devoluciones",                        "GetHbVar('nTotNumeroDevoluciones')")
   oFastReport:AddVariable(     "Numeros sesin",   "Nmero de aperturas de cajn",                  "GetHbVar('nTotNumeroAptCajon')"    )

   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 500 ",                 "GetHbArrayVar('aMonedasEfe',1)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 200 ",                 "GetHbArrayVar('aMonedasEfe',2)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 100 ",                 "GetHbArrayVar('aMonedasEfe',3)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 50 ",                  "GetHbArrayVar('aMonedasEfe',4)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 20 ",                  "GetHbArrayVar('aMonedasEfe',5)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 10 ",                  "GetHbArrayVar('aMonedasEfe',6)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en billetes de 5 ",                   "GetHbArrayVar('aMonedasEfe',7)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 2 ",                    "GetHbArrayVar('aMonedasEfe',8)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 1 ",                    "GetHbArrayVar('aMonedasEfe',9)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.50 ",                 "GetHbArrayVar('aMonedasEfe',10)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.20 ",                 "GetHbArrayVar('aMonedasEfe',11)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.10 ",                 "GetHbArrayVar('aMonedasEfe',12)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.05 ",                 "GetHbArrayVar('aMonedasEfe',13)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.02 ",                 "GetHbArrayVar('aMonedasEfe',14)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en monedas de 0.01 ",                 "GetHbArrayVar('aMonedasEfe',15)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 500 ",                 "GetHbArrayVar('aMonedasRet',1)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 200 ",                 "GetHbArrayVar('aMonedasRet',2)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 100 ",                 "GetHbArrayVar('aMonedasRet',3)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 50 ",                  "GetHbArrayVar('aMonedasRet',4)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 20 ",                  "GetHbArrayVar('aMonedasRet',5)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 10 ",                  "GetHbArrayVar('aMonedasRet',6)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en billetes de 5 ",                   "GetHbArrayVar('aMonedasRet',7)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 2 ",                    "GetHbArrayVar('aMonedasRet',8)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 1 ",                    "GetHbArrayVar('aMonedasRet',9)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.50 ",                 "GetHbArrayVar('aMonedasRet',10)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.20 ",                 "GetHbArrayVar('aMonedasRet',11)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.10 ",                 "GetHbArrayVar('aMonedasRet',12)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.05 ",                 "GetHbArrayVar('aMonedasRet',13)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.02 ",                 "GetHbArrayVar('aMonedasRet',14)")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en monedas de 0.01 ",                 "GetHbArrayVar('aMonedasRet',15)")
   oFastReport:AddVariable(     "Monedas en caja",  "Efectivo en caja",                              "GetHbVar('nEfectivoEnCaja')")
   oFastReport:AddVariable(     "Monedas en caja",  "Retirado en caja",                              "GetHbVar('nRetiradoEnCaja')")
   oFastReport:AddVariable(     "Monedas en caja",  "Tarjeta en caja",                               "GetHbVar('nTarjetaEnCaja')")

Return nil



UTILITY STATIC function TTurno_DesignReport( oFastReport, dbfDoc) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ::OpenFiles()





      if Empty( ::oDbfTemporal )
         ::DefineTemporal()
      end
      ::oDbfTemporal:Activate( .F., .F. )





      ::oDbfTemporal:Append()
         ::oDbfTemporal:cGrpTur  := "GRUPO 1"
         ::oDbfTemporal:cKeyTur  := "CO"
         ::oDbfTemporal:cNatTur  := "Contado"
         ::oDbfTemporal:nImpTur  := 1
      ::oDbfTemporal:Save()

      ::oDbfTemporal:Append()
         ::oDbfTemporal:cGrpTur  := "GRUPO 1"
         ::oDbfTemporal:cKeyTur  := "TR"
         ::oDbfTemporal:cNatTur  := "Tarjeta"
         ::oDbfTemporal:nImpTur  := 2
      ::oDbfTemporal:Save()

      ::oDbfTemporal:Append()
         ::oDbfTemporal:cGrpTur  := "GRUPO 2"
         ::oDbfTemporal:cKeyTur  := "CO"
         ::oDbfTemporal:cNatTur  := "Contado"
         ::oDbfTemporal:nImpTur  := 3
      ::oDbfTemporal:Save()

      ::oDbfTemporal:Append()
         ::oDbfTemporal:cGrpTur  := "GRUPO 2"
         ::oDbfTemporal:cKeyTur  := "TR"
         ::oDbfTemporal:cNatTur  := "Tarjeta"
         ::oDbfTemporal:nImpTur  := 4
      ::oDbfTemporal:Save()





      ::lCalTurno()





      ::DataReport( oFastReport )





      if !Empty( ( dbfDoc )->mReport )

         oFastReport:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

      else

         oFastReport:SetProperty(     "Report",            "ScriptLanguage", "PascalScript" )

         oFastReport:AddPage(         "MainPage" )

         oFastReport:AddBand(         "CabeceraDocumento", "MainPage", 2 )
         oFastReport:SetProperty(     "CabeceraDocumento", "Top", 0 )
         oFastReport:SetProperty(     "CabeceraDocumento", "Height", 199 )

         oFastReport:AddBand(         "CabeceraColumnas",  "MainPage", 12 )
         oFastReport:SetProperty(     "CabeceraColumnas",  "Top", 200 )
         oFastReport:SetProperty(     "CabeceraColumnas",  "Height", 29 )

         oFastReport:AddBand(         "DetalleColumnas",   "MainPage", 6 )
         oFastReport:SetProperty(     "DetalleColumnas",   "Top", 230 )
         oFastReport:SetProperty(     "DetalleColumnas",   "Height", 29 )
         oFastReport:SetObjProperty(  "DetalleColumnas",   "DataSet", "Lineas de informes" )

         oFastReport:AddBand(         "PieColumnas",       "MainPage", 13 )
         oFastReport:SetProperty(     "PieColumnas",       "Top", 260 )
         oFastReport:SetProperty(     "PieColumnas",       "Height", 29 )

         oFastReport:AddBand(         "PieDocumento",      "MainPage", 3 )
         oFastReport:SetProperty(     "PieDocumento",      "Top", 290 )
         oFastReport:SetProperty(     "PieDocumento",      "Height", 99 )

      end





      ::VariableReport( oFastReport )





      oFastReport:DesignReport()

      oFastReport:DestroyFr()





      ::CloseFiles()

   else

      Return .F.

   end

Return .T.



UTILITY STATIC function TTurno_PrintReport( nDevice, nCopies, cPrinter, dbfDoc) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( nDevice == nil, nDevice := 2, ) ;
   IIF( nCopies == nil, nCopies := 1, ) ;
   IIF( cPrinter == nil, cPrinter := PrnGetName(), ) ;

   if !Empty( ::oTxt )
      ::oTxt:SetText( "Imprimiendo informe" )
   end

   SysRefresh()





   ::oDbf:GetRecno()
   ::oDbfCaj:GetRecno()
   ::oDbfDet:GetRecno()





   if Empty( ::oFastReport )
      ::oFastReport              := frReportManager():New()
      ::oFastReport:LoadLangRes( "Spanish.Xml" )
      ::lDestroyFastreport       := .T.
   end

   ::oFastReport:SetIcon( 1 )
   ::oFastReport:SetTitle(       "Diseador de documentos" )





   ::oFastReport:SetEventHandler( "Designer", "OnSaveReport", {|| ::oFastReport:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   ::DataReport( ::oFastReport )





   if !Empty( ( dbfDoc )->mReport )

      ::oFastReport:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      ::VariableReport( ::oFastReport )






      ::oFastReport:PrepareReport()





      do case
         case ( Valtype( nDevice ) == "N" .AND. nDevice == 2 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Visualizar" )
            ::oFastReport:ShowPreparedReport()

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 1 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Imprimir" )
            ::oFastReport:PrintOptions:SetPrinter( cPrinter )
            ::oFastReport:PrintOptions:SetCopies( nCopies )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:Print()

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 3 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Adobe PDF" )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:SetProperty( "PDFExport", "ShowDialog",  ::lPdfShowDialog )
            ::oFastReport:SetProperty( "PDFExport", "DefaultPath", ::cPdfDefaultPath )
            ::oFastReport:SetProperty( "PDFExport", "FileName",    ::cPdfFileName )
            ::oFastReport:DoExport( "PDFExport" )

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 4 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "HTML" )
            ::oFastReport:SetProperty( "HTMLExport", "ShowDialog", ::lPdfShowDialog )
            ::oFastReport:SetProperty( "HTMLExport", "DefaultPath",::cPdfDefaultPath )
            ::oFastReport:SetProperty( "HTMLExport", "FileName",   ::cHtmlFileName )
            ::oFastReport:DoExport( "HTMLExport" )

         case ( Valtype( nDevice ) == "N" .AND. nDevice == 5 ) .OR. ( Valtype( nDevice ) == "C" .AND. nDevice == "Excel" )
            ::oFastReport:SetProperty( "XLSExport", "FileName", "ArqueoCaja" + Alltrim( ::cCurTurno ) + ".xls" )
            ::oFastReport:DoExport( "XLSExport" )

      end

   end





   if ::lDestroyFastReport
      ::oFastReport:DestroyFr()
      ::oFastReport  := nil
   end





   ::oDbf:SetRecno()
   ::oDbfCaj:SetRecno()
   ::oDbfDet:SetRecno()

Return .T.



UTILITY STATIC function TTurno_DefineTemporal() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::cFileTemporal   := cGetNewFileName( cPatTmp() + "TTur" )

   ::oDbfTemporal := DbfServer( ( ::cFileTemporal ), "TTur" ):New( ( ::cFileTemporal ), "TTur", ( cLocalDriver() ), "lneas de informe", ( cPatTmp() ) )

      ::oDbfTemporal:AddField( "cGrpTur", "C", 60, 0,,,,, "Grupo", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nGrpPes", "N", 3, 0,,,,, "Peso", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cKeyTur", "C", 14, 0,,,,, "Clave", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "cNatTur", "C", 200, 0,,,,, "Naturaleza", .F.,, .F., {} )
      ::oDbfTemporal:AddField( "nImpTur", "N", 16, 6,,,,, "Importe", .F.,, .F., {} )

      ::oDbfTemporal:AddIndex( "cGruTur", ( ::cFileTemporal ), "Str( nGrpPes, 3 ) + cGrpTur + cKeyTur",,, .F., .F., "Nmero",,, .T., .F. )



RETURN ( ::oDbfTemporal )



UTILITY STATIC function TTurno_DestroyTemporal() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if !Empty( ::oDbfTemporal ) .AND. ::oDbfTemporal:Used()
      ::oDbfTemporal:End()
   end

   dbfErase( ::cFileTemporal )

   ::oDbfTemporal    := nil

RETURN ( Self )



UTILITY STATIC function TTurno_AppendInTemporal( cKey, cNaturaleza, nImporte) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   if ( cKey <> nil )
      cKey                       := Padr( cKey, 14, Space( 1 ) )
   end

   if ( cKey == nil )

      ::oDbfTemporal:Append()
      ::oDbfTemporal:cGrpTur     := ::cGrupoEnUso
      ::oDbfTemporal:nGrpPes     := ::nGrupoPeso
      ::oDbfTemporal:cNatTur     := cNaturaleza
      ::oDbfTemporal:nImpTur     := nImporte
      ::oDbfTemporal:Save()

   else

      if ::oDbfTemporal:Seek( Str( ::nGrupoPeso, 3 ) + ::cGrupoEnUso + cKey )

         ::oDbfTemporal:Load()
         ::oDbfTemporal:nImpTur  += nImporte
         ::oDbfTemporal:Save()

      else

         ::oDbfTemporal:Append()
         ::oDbfTemporal:cGrpTur  := ::cGrupoEnUso
         ::oDbfTemporal:nGrpPes  := ::nGrupoPeso
         ::oDbfTemporal:cKeyTur  := cKey
         ::oDbfTemporal:cNatTur  := cNaturaleza
         ::oDbfTemporal:nImpTur  := nImporte
         ::oDbfTemporal:Save()

      end

   end

RETURN ( Self )



UTILITY STATIC function TTurno_FillTemporal( cCodCaj) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local n
   local cTurno
   local cBancos
   local aBancos
   local cTipTik
   local nTotLin
   local cNomBnc
   local cTurnoCaja
   local oDbvBancos
   local oDbvArticulos
   local oDbcArticulos

   IIF( cCodCaj == nil, cCodCaj := oUser():cCaja(), ) ;

   aBancos              := {}
   cTurno               := ::oDbf:cNumTur + ::oDbf:cSufTur
   cTurnoCaja           := cTurno + cCodCaj





   if Empty( ::oDbfTemporal )
      ::DefineTemporal()
      ::oDbfTemporal:Activate( .F., .F. )
   end

   ::oDbfTemporal:Zap()





   if ::GetItemCheckState( "Entradas y salidas de cajas" )

      if ::oEntSal:Seek( cTurnoCaja )

         while ::oEntSal:cTurEnt + ::oEntSal:cSufEnt + ::oEntSal:cCodCaj == cTurnoCaja .AND. !::oEntSal:eof()

            ::AppendInTemporal( nil, ::cTxtEntradasSalidas(), ::nTotEntradasSalidas() )

            ::oEntSal:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Albaranes de clientes" )

      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            ::AppendInTemporal( nil, ::cTxtAlbaranCliente(), nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias(), nil, cDivEmp(), .F. ) )

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas de clientes" )

      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaCliente(), nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F. ) )

            ::oFacCliT:Skip()

         end

      end

   end





   if ::GetItemCheckState( "Facturas rectificativas de clientes" )

      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaRectificativaCliente(), nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F. ) )

            ::oRctCliT:Skip()

         end

      end

   end





   if ::GetItemCheckState( "Anticipos de clientes" )

      ::oAntCliT:OrdSetFocus( "cTurAnt" )
      if ::oAntCliT:Seek( cTurnoCaja )

         while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurnoCaja .AND. !::oAntCliT:eof()

            ::AppendInTemporal(  nil, ::cTxtAnticipoCliente(), ::nTotAnticipoCliente() )

            ::oAntCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Tickets" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "1"

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Devoluciones de clientes" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "4"

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Vales a clientes" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "6"

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Contadores" ) .AND. ::oTotales:nTotContadores() <> 0

      if ::oDbfDet:Seek( cTurno )

         while ::oDbfDet:cNumTur + ::oDbfDet:cSufTur == ::oDbf:cNumTur + ::oDbf:cSufTur .AND. !::oDbfDet:Eof()

            nTotLin     := Round( ( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt ) * ::oDbfDet:nPvpArt, ::nDorDiv )

            if nTotLin <> 0






               ::AppendInTemporal(  ::oDbfDet:cCodArt, Padr( Rtrim( ::oDbfDet:cCodArt ) + Space( 1 ) + Rtrim( ::oDbfDet:cNomArt ), 32 )       +  "[Ant.: " + Trans( ::oDbfDet:nCanAnt, "9999999" )                                + "]" +  "[Act.: " + Trans( ::oDbfDet:nCanAct, "9999999" )                                + "]" +  "[Und.: " + Trans( ::oDbfDet:nCanAct - ::oDbfDet:nCanAnt, "9999999" )            + "]" +  "[Pvp : " + Padl( LTrans( ::oDbfDet:nPvpArt, ::cPouDiv ), 7 )                    + "]", nTotLin )
            end

            ::oDbfDet:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Albaranes de proveedores" )

      if ::oAlbPrvT:Seek( cTurnoCaja )

         while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurnoCaja .AND. !::oAlbPrvT:eof()

            ::AppendInTemporal(  nil, ::cTxtAlbaranProveedor(), ::nTotAlbaranProveedor() )

            ::oAlbPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas de proveedores" )

      if ::oFacPrvT:Seek( cTurnoCaja )

         while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurnoCaja .AND. !::oFacPrvT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaProveedor(), ::nTotFacturaProveedor() )

            ::oFacPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Facturas rectificativas de proveedores" )

      if ::oRctPrvT:Seek( cTurnoCaja )

         while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurnoCaja .AND. !::oRctPrvT:eof()

            ::AppendInTemporal( nil, ::cTxtFacturaRectificativaProveedor(), ::nTotFacturaRectificativaProveedor() )

            ::oRctPrvT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Vales liquidados de clientes" )

      ::oTikT:OrdSetFocus( "cTurVal" )
      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikT:cTipTik == "6" .AND. ::oTikT:lLiqTik

               ::AppendInTemporal( nil, ::cTxtTiketCliente(), ::nTotTiketCliente() )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

      ::oTikT:OrdSetFocus( "cTurTik" )

   end





   if ::GetItemCheckState( "Anticipos liquidados de clientes" )

      ::oAntCliT:OrdSetFocus( "cTurLiq" )
      if ::oAntCliT:Seek( cTurnoCaja )

         while ::oAntCliT:cTurAnt + ::oAntCliT:cSufAnt + ::oAntCliT:cCodCaj == cTurnoCaja .AND. !::oAntCliT:eof()

            nTotLin     := nTotAntCli( ::oAntCliT:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias )

            if nTotLin <> 0




               ::AppendInTemporal(  nil, Alltrim( ::oAntCliT:cSerAnt + "/" + Alltrim( Str( ::oAntCliT:nNumAnt ) ) + "/" + ::oAntCliT:cSufAnt ) + Space( 1 ) +  Rtrim( ::oAntCliT:cCodCli ) + Space( 1 ) +  ::oAntCliT:cNomCli, nTotLin )

            end

            ::oAntCliT:Skip()

            SysRefresh()

         end

      end

      ::oAntCliT:OrdSetFocus( "cTurAnt" )

   end





   if ::GetItemCheckState( "Entregas a cuenta en pedidos de clientes" )

      if ::oPedCliP:Seek( cTurnoCaja )

         while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurnoCaja .AND. !::oPedCliP:eof()

            if !::oPedCliP:lPasado

               ::AppendInTemporal(  nil, ::cTxtPedidoEntrega(), ::nTotPedidoEntrega() )

            end

            ::oPedCliP:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Entregas a cuenta en albaranes de clientes" )

      if ::oAlbCliP:Seek( cTurnoCaja )

         while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurnoCaja .AND. !::oAlbCliP:eof()

            if !::oAlbCliP:lPasado

               ::AppendInTemporal(  nil, ::cTxtAlbaranEntrega(), ::nTotAlbaranEntrega() )

            end

            ::oAlbCliP:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Cobros en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros efectivo en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) < 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros no efectivo en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) == 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros tarjeta en facturas de clientes" )

      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo .AND. ( nTipoPago( ::oFacCliP:cCodPgo, ::oFPago ) == 3 )

               ::AppendInTemporal(  nil, ::cTxtFacturaCobro(), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros en tickets de clientes" )

      ::oTikP:GetStatus()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      if ::oTikP:Seek( cTurnoCaja )

         while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurnoCaja .AND. !::oTikP:eof()

            cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )

            do case
               case cTipTik == "1"
                  nTotLin  := nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

               case cTipTik == "4"
                  nTotLin  := - nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

               case cTipTik == "6"
                  nTotLin  := 0

            end

            if nTotLin <> 0






               ::AppendInTemporal(  nil, ::oTikP:cSerTik + "/" + Alltrim( ::oTikP:cNumTik ) + "/" + Rtrim( ::oTikP:cSufTik )            + Space( 1 ) +  ::oTikP:cFpgPgo                                                                                + Space( 1 ) +  Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cCliTik", 1 ) ) + Space( 1 ) +  Rtrim( oRetfld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cNomTik", 1 ) ) , nTotLin )

            end

            ::oTikP:Skip()

            SysRefresh()

         end

      end

      ::oTikP:SetStatus()

   end





   if ::GetItemCheckState( "Cobros por formas de pago" )





      ::oTikP:GetStatus()
      ::oTikP:OrdSetFocus( "cTurPgo" )

      if ::oTikP:Seek( cTurnoCaja )

         while ::oTikP:cTurPgo + ::oTikP:cSufTik + ::oTikP:cCodCaj == cTurnoCaja .AND. !::oTikP:eof()

            cTipTik        := oRetFld( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik, ::oTikT, "cTipTik", 1 )

            do case
               case cTipTik == "1"
                  nTotLin  := nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

               case cTipTik == "4"
                  nTotLin  := - nTotLCobTik( ::oTikP, ::oDbfDiv, cDivEmp() )

               case cTipTik == "6"
                  nTotLin  := 0

            end

            if nTotLin <> 0
               ::AppendInTemporal( ::oTikP:cFpgPgo, ::oTikP:cFpgPgo + Space( 1 ) + oRetFld( ::oTikP:cFpgPgo, ::oFPago ), nTotLin )
            end

            ::oTikP:Skip()

            SysRefresh()

         end

      end
      ::oTikP:SetStatus()





      ::oFacCliP:GetStatus()
      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo

               ::AppendInTemporal( ::oFacCliP:cCodPgo, ::oFacCliP:cCodPgo + Space( 1 ) + oRetFld( ::oFacCliP:cCodPgo, ::oFPago ), ::nTotFacturaCobro() )

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()





      ::oPedCliP:GetStatus()
      ::oPedCliP:OrdSetFocus( "cTurRec" )

      if ::oPedCliP:Seek( cTurnoCaja )

         while ::oPedCliP:cTurRec + ::oPedCliP:cSufPed + ::oPedCliP:cCodCaj == cTurnoCaja .AND. !::oPedCliP:eof()

            if !::oPedCliP:lPasado

               ::AppendInTemporal( ::oPedCliP:cCodPgo, ::oPedCliP:cCodPgo + Space( 1 ) + oRetFld( ::oPedCliP:cCodPgo, ::oFPago ), ::nTotPedidoEntrega() )

            end

            ::oPedCliP:Skip()

            SysRefresh()

         end

      end

      ::oPedCliP:SetStatus()





      ::oAlbCliP:GetStatus()
      ::oAlbCliP:OrdSetFocus( "cTurRec" )

      if ::oAlbCliP:Seek( cTurnoCaja )

         while ::oAlbCliP:cTurRec + ::oAlbCliP:cSufAlb + ::oAlbCliP:cCodCaj == cTurnoCaja .AND. !::oAlbCliP:eof()

            if !::oAlbCliP:lPasado

               ::AppendInTemporal( ::oAlbCliP:cCodPgo, ::oAlbCliP:cCodPgo + Space( 1 ) + oRetFld( ::oAlbCliP:cCodPgo, ::oFPago ), ::nTotAlbaranEntrega() )

            end

            ::oAlbCliP:Skip()

            SysRefresh()

         end

      end

      ::oAlbCliP:SetStatus()

   end





   if ::GetItemCheckState( "Pagos en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo

               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Pagos efectivo en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) < 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end

   if ::GetItemCheckState( "Pagos no efectivo en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) == 2 )

               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end

   if ::GetItemCheckState( "Pagos tarjeta en facturas a proveedores" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. ( nTipoPago( ::oFacPrvP:cCodPgo, ::oFPago ) == 3 )

               ::AppendInTemporal(  nil, ::cTxtFacturaPago(), ::nTotFacturaPago() )

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Pagos por formas de pago" )

      ::oFacPrvP:GetStatus()
      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo

               ::AppendInTemporal(  ::oFacPrvP:cCodPgo, ::oFacPrvP:cCodPgo + Space( 1 ) + oRetFld( ::oFacPrvP:cCodPgo, ::oFPago ), ::nTotFacturaPago() )

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()

      SysRefresh()

   end





   if ::GetItemCheckState( "Operaciones bancarias en cuentas de empresa" )

      oDbvBancos        := TDbVirtual( , "Bco" ):DefNew()
         oDbvBancos:AddField( "cNomBnc", "C", 50, 0 )
         oDbvBancos:AddField( "cCtaBnc", "C", 20, 0 )
         oDbvBancos:AddField( "cNumOpe", "C", 14, 0 )
         oDbvBancos:AddField( "dFecOpe", "N", 19, 6 )
         oDbvBancos:AddField( "cFpgOpe", "C",  2, 0 )
         oDbvBancos:AddField( "cCliOpe", "C",  2, 0 )
         oDbvBancos:AddField( "cNomOpe", "C",  2, 0 )
         oDbvBancos:AddField( "nImpOpe", "N", 19, 6 )
      oDbvBancos:Activate()





      ::oFacCliP:GetStatus()

      ::oFacCliP:OrdSetFocus( "cTurRec" )

      if ::oFacCliP:Seek( cTurnoCaja )

         while ::oFacCliP:cTurRec + ::oFacCliP:cSufFac + ::oFacCliP:cCodCaj == cTurnoCaja .AND. !::oFacCliP:eof()

            if ::oFacCliP:lCobrado .AND. !::oFacCliP:lNotArqueo .AND. !Empty( cCuentaEmpresaRecibo( ::oFacCliP ) )

               oDbvBancos:Append()
               oDbvBancos:cNomBnc   := oRetFld( cCuentaEmpresaRecibo( ::oFacCliP ), ::oEmpBnc, "cNomBnc", "cCtaBnc" )
               oDbvBancos:cCtaBnc   := cCuentaEmpresaRecibo( ::oFacCliP )
               oDbvBancos:cNumOpe   := ::oFacCliP:cSerie + "/" + Alltrim( Str( ::oFacCliP:nNumFac ) ) + "/" + Rtrim( ::oFacCliP:cSufFac )
               oDbvBancos:dFecOpe   := ::oFacCliP:dEntrada
               oDbvBancos:cFpgOpe   := ::oFacCliP:cCodPgo
               oDbvBancos:cCliOpe   := ::oFacCliP:cCodCli
               oDbvBancos:cNomOpe   := ::oFacCliP:cNomCli
               oDbvBancos:nImpOpe   := ::nTotFacturaCobro()

            end

            ::oFacCliP:Skip()

            SysRefresh()

         end

      end

      ::oFacCliP:SetStatus()





      ::oFacPrvP:GetStatus()

      ::oFacPrvP:OrdSetFocus( "cTurRec" )

      if ::oFacPrvP:Seek( cTurnoCaja )

         while ::oFacPrvP:cTurRec + ::oFacPrvP:cSufFac + ::oFacPrvP:cCodCaj == cTurnoCaja .AND. !::oFacPrvP:eof()

            if ::oFacPrvP:lCobrado .AND. !::oFacPrvP:lNotArqueo .AND. !Empty( cCuentaEmpresaRecibo( ::oFacPrvP ) )

               oDbvBancos:Append()
               oDbvBancos:cNomBnc   := oRetFld( cCuentaEmpresaRecibo( ::oFacPrvP ), ::oEmpBnc, "cNomBnc", "cCtaBnc" )
               oDbvBancos:cCtaBnc   := cCuentaEmpresaRecibo( ::oFacPrvP )
               oDbvBancos:cNumOpe   := ::oFacPrvP:cSerFac + "/" + Alltrim( Str( ::oFacPrvP:nNumFac ) ) + "/" + Rtrim( ::oFacPrvP:cSufFac )
               oDbvBancos:dFecOpe   := ::oFacPrvP:dEntrada
               oDbvBancos:cFpgOpe   := ::oFacPrvP:cCodPgo
               oDbvBancos:cCliOpe   := ::oFacPrvP:cCodPrv
               oDbvBancos:cNomOpe   := ::oFacPrvP:cNomPrv
               oDbvBancos:nImpOpe   := - ::nTotFacturaPago()

            end

            ::oFacPrvP:Skip()

            SysRefresh()

         end

      end

      ::oFacPrvP:SetStatus()





      cNomBnc              := nil

      oDbvBancos:GoTop()
      while !oDbvBancos:eof()

         if ( cNomBnc <> oDbvBancos:cNomBnc )

            cNomBnc        := "Cuenta bancaria : " + Rtrim( oDbvBancos:cNomBnc ) + Space( 1 ) + Alltrim( Trans( oDbvBancos:cCtaBnc, "@R ####################" ) )
            ::cGrupoEnUso  := Padr( cNomBnc, 60 )
            ::nGrupoPeso++

            aAdd( aBancos, oDbvBancos:cCtaBnc )

         end

         ::AppendInTemporal( nil, oDbvBancos:cNumOpe + Space( 1 ) +  Dtoc( oDbvBancos:dFecOpe ) + Space( 1 ) + oDbvBancos:cFpgOpe + Space( 1 ) + Rtrim( oDbvBancos:cCliOpe ) + Space( 1 ) + oDbvBancos:cNomOpe, oDbvBancos:nImpOpe )

         oDbvBancos:Skip()

         SysRefresh()

      end
















   end

   if ::GetItemCheckState( "Operaciones bancarias en cuentas de empresa" )

      ::cGrupoEnUso     := "Saldos cuentas bancarias"
      ::nGrupoPeso++

      ::oCuentasBancarias:oDbf:GoTop()
      while !::oCuentasBancarias:oDbf:Eof()

         ::AppendInTemporal( nil, Alltrim( ::oCuentasBancarias:oDbf:cNomBnc ) + " : " + Alltrim( ::oCuentasBancarias:oDbf:cEntBnc + ::oCuentasBancarias:oDbf:cSucBnc + ::oCuentasBancarias:oDbf:cDigBnc + ::oCuentasBancarias:oDbf:cCtaBnc ), ::oCuentasBancarias:nSaldoActual() )

         ::oCuentasBancarias:oDbf:Skip()

      end

   end





   if ::GetItemCheckState( "Compras por artculos" )

      oDbcArticulos     := TDbVirtual( , "Imp" ):DefNew()
         oDbcArticulos:AddField( "cCodArt", "C", 14, 0 )
         oDbcArticulos:AddField( "cNomArt", "C", 50, 0 )
         oDbcArticulos:AddField( "nUndArt", "N", 19, 6 )
         oDbcArticulos:AddField( "nPvpArt", "N", 19, 6 )
         oDbcArticulos:AddField( "nImpArt", "N", 19, 6 )
      oDbcArticulos:Activate()





      if ::oAlbPrvT:Seek( cTurnoCaja )

         while ::oAlbPrvT:cTurAlb + ::oAlbPrvT:cSufAlb + ::oAlbPrvT:cCodCaj == cTurnoCaja .AND. !::oAlbPrvT:eof()

            if !::oAlbPrvT:lFacturado .AND. ::oAlbPrvL:Seek( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb )

               while ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb == ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb .AND. !::oAlbPrvL:eof()

                  if oDbcArticulos:Seek( ::oAlbPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNAlbPrv( ::oAlbPrvL:cAlias )
                     oDbcArticulos:nImpArt += nImpLAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oAlbPrvL:cRef
                     oDbcArticulos:cNomArt := ::oAlbPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNAlbPrv( ::oAlbPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpUAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLAlbPrv( ::oAlbPrvT:cAlias, ::oAlbPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oAlbPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbPrvT:Skip()

            SysRefresh()

         end

      end





      if ::oFacPrvT:Seek( cTurnoCaja )

         while ::oFacPrvT:cTurFac + ::oFacPrvT:cSufFac + ::oFacPrvT:cCodCaj == cTurnoCaja .AND. !::oFacPrvT:eof()

            if ::oFacPrvL:Seek( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac )

               while ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac == ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac .AND. !::oFacPrvL:eof()

                  if oDbcArticulos:Seek(  ::oFacPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNFacPrv( ::oFacPrvL:cAlias, ::nDouDiv )
                     oDbcArticulos:nImpArt += nImpLFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDorDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oFacPrvL:cRef
                     oDbcArticulos:cNomArt := ::oFacPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNFacPrv( ::oFacPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpUFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLFacPrv( ::oFacPrvT:cAlias, ::oFacPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oFacPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oFacPrvT:Skip()

            SysRefresh()

         end

      end





      if ::oRctPrvT:Seek( cTurnoCaja )

         while ::oRctPrvT:cTurFac + ::oRctPrvT:cSufFac + ::oRctPrvT:cCodCaj == cTurnoCaja .AND. !::oRctPrvT:eof()

            if ::oRctPrvL:Seek( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac )

               while ::oRctPrvL:cSerFac + Str( ::oRctPrvL:nNumFac ) + ::oRctPrvL:cSufFac == ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac .AND. !::oRctPrvL:eof()

                  if oDbcArticulos:Seek(  ::oRctPrvL:cRef )
                     oDbcArticulos:nUndArt += nTotNRctPrv( ::oRctPrvL:cAlias, ::nDouDiv )
                     oDbcArticulos:nImpArt += nImpLRctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDorDiv, ::nDorDiv )
                  else
                     oDbcArticulos:Append()
                     oDbcArticulos:cCodArt := ::oRctPrvL:cRef
                     oDbcArticulos:cNomArt := ::oRctPrvL:cDetalle
                     oDbcArticulos:nUndArt := nTotNRctPrv( ::oRctPrvL:cAlias )
                     oDbcArticulos:nPvpArt := nImpURctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDouDiv, , .T. )
                     oDbcArticulos:nImpArt := nImpLRctPrv( ::oRctPrvT:cAlias, ::oRctPrvL:cAlias, ::nDouDiv, ::nDorDiv )
                  end

                  ::oRctPrvL:Skip()

                  SysRefresh()

               end

            end

            ::oRctPrvT:Skip()

            SysRefresh()

         end

      end


      oDbcArticulos:GoTop()

      while !oDbcArticulos:eof()

         ::AppendInTemporal(  nil, Rtrim( oDbcArticulos:cCodArt ) + Space( 1 ) + Rtrim( oDbcArticulos:cNomArt ) + Space( 1 ) + "[Und.:" + Ltrim( Trans( oDbcArticulos:nUndArt, ::cPicUnd ) ) + "]", oDbcArticulos:nImpArt )

         oDbcArticulos:Skip()

         SysRefresh()

      end

   end





   if ::GetItemCheckState( "Ventas por artculos" )

      oDbvArticulos     := TDbVirtual( , "Imp" ):DefNew()
         oDbvArticulos:AddField( "cCodArt", "C", 14, 0 )
         oDbvArticulos:AddField( "cNomArt", "C", 50, 0 )
         oDbvArticulos:AddField( "nUndArt", "N", 19, 6 )
         oDbvArticulos:AddField( "nPvpArt", "N", 19, 6 )
         oDbvArticulos:AddField( "nImpArt", "N", 19, 6 )
      oDbvArticulos:Activate()

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        if ::oTikL:nCtlStk <> 2

                           if oDbvArticulos:Seek( ::oTikL:cCbaTil )
                              oDbvArticulos:nUndArt += ::oTikL:nUntTil
                              oDbvArticulos:nImpArt += nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                           else
                              oDbvArticulos:Append()
                              oDbvArticulos:cCodArt := ::oTikL:cCbaTil
                              oDbvArticulos:cNomArt := ::oTikL:cNomTil
                              oDbvArticulos:nUndArt := ::oTikL:nUntTil
                              oDbvArticulos:nPvpArt := nImpUTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv )
                              oDbvArticulos:nImpArt := nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                           end

                        end

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        if ::oTikL:nCtlStk <> 2

                           if oDbvArticulos:Seek( ::oTikL:cCbaTil )
                              oDbvArticulos:nUndArt -= ::oTikL:nUntTil
                              oDbvArticulos:nImpArt -= nTotLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                           else
                              oDbvArticulos:Append()
                              oDbvArticulos:cCodArt := ::oTikL:cCbaTil
                              oDbvArticulos:cNomArt := ::oTikL:cNomTil
                              oDbvArticulos:nUndArt := - ::oTikL:nUntTil
                              oDbvArticulos:nPvpArt := - nTotUTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv )
                              oDbvArticulos:nImpArt := - nTotLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv )
                           end

                        end

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  if ::oAlbCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek( ::oAlbCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNAlbCli( ::oAlbCliL:cAlias )
                        oDbvArticulos:nImpArt += nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oAlbCliL:cRef
                        oDbvArticulos:cNomArt := ::oAlbCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNAlbCli( ::oAlbCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     end

                  end

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  if ::oFacCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek(  ::oFacCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNFacCli( ::oFacCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt += nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oFacCliL:cRef
                        oDbvArticulos:cNomArt := ::oFacCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNFacCli( ::oFacCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     end

                  end

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  if ::oRctCliL:nCtlStk <> 2

                     if oDbvArticulos:Seek(  ::oRctCliL:cRef )
                        oDbvArticulos:nUndArt += nTotNFacRec( ::oRctCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt += nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     else
                        oDbvArticulos:Append()
                        oDbvArticulos:cCodArt := ::oRctCliL:cRef
                        oDbvArticulos:cNomArt := ::oRctCliL:cDetalle
                        oDbvArticulos:nUndArt := nTotNFacRec( ::oRctCliL:cAlias )
                        oDbvArticulos:nPvpArt := nImpUFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv )
                        oDbvArticulos:nImpArt := nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv )
                     end

                  end

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end





      oDbvArticulos:GoTop()
      while !oDbvArticulos:eof()

         ::AppendInTemporal(  nil, Rtrim( oDbvArticulos:cCodArt ) + Space( 1 ) + Rtrim( oDbvArticulos:cNomArt ) + Space( 1 ) + "[Und.:" + Ltrim( Trans( oDbvArticulos:nUndArt, ::cPicUnd ) ) + "]", oDbvArticulos:nImpArt )

         oDbvArticulos:Skip()

         SysRefresh()

      end

   end





   if ::GetItemCheckState( "Ventas por familias" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( ::oTikL:cCodFam, Rtrim( ::oTikL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oTikL:cCodFam, ::oFamilia ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "4"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( ::oTikL:cCodFam, Rtrim( ::oTikL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oTikL:cCodFam, ::oFamilia ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( ::oAlbCliL:cCodFam, Rtrim( ::oAlbCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oAlbCliL:cCodFam, ::oFamilia ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nRouDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( ::oFacCliL:cCodFam, Rtrim( ::oFacCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oFacCliL:cCodFam, ::oFamilia ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( ::oRctCliL:cCodFam, Rtrim( ::oRctCliL:cCodFam ) + Space( 1 ) + Rtrim( oRetFld( ::oRctCliL:cCodFam, ::oFamilia ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por categora" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ), ::oCategoria ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "4"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodCate" ), ::oCategoria ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodCate" ), Rtrim( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodCate" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodCate" ), ::oCategoria ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodCate" ), Rtrim( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodCate" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodCate" ), ::oCategoria ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodCate" ), Rtrim( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodCate" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodCate" ), ::oCategoria ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por fabricante" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf, "cCodFab" ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "4"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf, "cCodFab" ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLAlbCli( ::oAlbCliT:cAlias,  ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ), Rtrim( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodFab" ), ::oFabricante:oDbf ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por temporada" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "4"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oAlbCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oFacCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ), Rtrim( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ) ) + Space( 1 ) + Rtrim( oRetFld( oRetFld( ::oRctCliL:cRef, ::oArticulo, "cCodTemp" ), ::oTemporada ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por tipo de artculos" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ) + Space( 1 ) + oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), ::oTipArt:oDbf, "cNomTip" ), nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

               case ::oTikT:cTipTik == "4"

                  if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

                     while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                        ::AppendInTemporal( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ) + Space( 1 ) + oRetFld( oRetFld( ::oTikL:cCbaTil, ::oArticulo, "cCodTip" ), ::oTipArt:oDbf, "cNomTip" ), - nImpLTpv( ::oTikT:cAlias, ::oTikL:cAlias, ::nDouDiv, ::nDorDiv ) )

                        ::oTikL:Skip()

                        SysRefresh()

                     end

                  end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado .AND. ::oAlbCliL:Seek( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

               while ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb == ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb .AND. !::oAlbCliL:eof()

                  ::AppendInTemporal( ::oAlbCliL:cCodTip, Rtrim( ::oAlbCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oAlbCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLAlbCli( ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oAlbCliL:Skip()

                  SysRefresh()

               end

            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            if ::oFacCliL:Seek( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

               while ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac == ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac .AND. !::oFacCliL:eof()

                  ::AppendInTemporal( ::oFacCliL:cCodTip, Rtrim( ::oFacCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oFacCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLFacCli( ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oFacCliL:Skip()

                  SysRefresh()

               end

            end

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            if ::oRctCliL:Seek( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

               while ::oRctCliL:cSerie + Str( ::oRctCliL:nNumFac ) + ::oRctCliL:cSufFac == ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac .AND. !::oRctCliL:eof()

                  ::AppendInTemporal( ::oRctCliL:cCodTip, Rtrim( ::oRctCliL:cCodTip ) + Space( 1 ) + Rtrim( oRetFld( ::oRctCliL:cCodTip, ::oTipArt:oDbf ) ), nImpLFacRec( ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::nDouDiv, ::nDorDiv ) )

                  ::oRctCliL:Skip()

                  SysRefresh()

               end

            end

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por usuarios" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            do case
               case ::oTikT:cTipTik == "1"

                   ::AppendInTemporal( ::oTikT:cCcjTik, Rtrim( ::oTikT:cCcjTik ) + Space( 1 ) + Rtrim( RetUser( ::oTikT:cCcjTik, ::oUser:cAlias ) ), nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

               case ::oTikT:cTipTik == "4"

                   ::AppendInTemporal( ::oTikT:cCcjTik, Rtrim( ::oTikT:cCcjTik ) + Space( 1 ) + Rtrim( RetUser( ::oTikT:cCcjTik, ::oUser:cAlias ) ), - nTotTik( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik, ::oTikT:cAlias, ::oTikL:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end





      if ::oAlbCliT:Seek( cTurnoCaja )

         while ::oAlbCliT:cTurAlb + ::oAlbCliT:cSufAlb + ::oAlbCliT:cCodCaj == cTurnoCaja .AND. !::oAlbCliT:eof()

            if !::oAlbCliT:lFacturado
               ::AppendInTemporal( ::oAlbCliT:cCodUsr, Rtrim( ::oAlbCliT:cCodUsr ) + Space( 1 ) + Rtrim( RetUser( ::oAlbCliT:cCodUsr, ::oUser:cAlias ) ), nTotAlbCli( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb, ::oAlbCliT:cAlias, ::oAlbCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )
            end

            ::oAlbCliT:Skip()

            SysRefresh()

         end

      end





      if ::oFacCliT:Seek( cTurnoCaja )

         while ::oFacCliT:cTurFac + ::oFacCliT:cSufFac + ::oFacCliT:cCodCaj == cTurnoCaja .AND. !::oFacCliT:eof()

            ::AppendInTemporal( ::oFacCliT:cCodUsr, Rtrim( ::oFacCliT:cCodUsr ) + Space( 1 ) + Rtrim( RetUser( ::oFacCliT:cCodUsr, ::oUser:cAlias ) ), nTotFacCli( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac, ::oFacCliT:cAlias, ::oFacCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, ::oFacCliP:cAlias, ::oAntCliT:cAlias, nil, cDivEmp(), .F., .T. ) )

            ::oFacCliT:Skip()

            SysRefresh()

         end

      end





      if ::oRctCliT:Seek( cTurnoCaja )

         while ::oRctCliT:cTurFac + ::oRctCliT:cSufFac + ::oRctCliT:cCodCaj == cTurnoCaja .AND. !::oRctCliT:eof()

            ::AppendInTemporal( ::oRctCliT:cCodUsr, Rtrim( ::oRctCliT:cCodUsr ) + Space( 1 ) + Rtrim( RetUser( ::oRctCliT:cCodUsr, ::oUser:cAlias ) ), nTotFacRec( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac, ::oRctCliT:cAlias, ::oRctCliL:cAlias, ::oIvaImp:cAlias, ::oDbfDiv:cAlias, nil, cDivEmp(), .F., .T. ) )

            ::oRctCliT:Skip()

            SysRefresh()

         end

      end

   end





   if ::GetItemCheckState( "Ventas por tipos de " + cImp() )

      for n := 1 to len( ::aTipIva )





      ::AppendInTemporal(  nil, "Base " + lTrim( Trans( ::aTipIva[ n, 2 ], ::cPorDiv ) )    + Space( 1 ) +  "al " + Trans( ::aTipIva[ n, 1 ], "@E 99.9%" )              + Space( 1 ) +  "cuota " + lTrim( Trans( ::aTipIva[ n, 3 ], ::cPorDiv ) ), ::aTipIva[ n, 4 ] )

      next

   end





   ::oTikL:GoTop()

   if ::GetItemCheckState( "Ventas por tipo de invitaciones" )

      if ::oTikT:Seek( cTurnoCaja )

         while ::oTikT:cTurTik + ::oTikT:cSufTik + ::oTikT:cNcjTik == cTurnoCaja .AND. !::oTikT:eof()

            if ::oTikL:Seek( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

               while ::oTikL:cSerTil + ::oTikL:cNumTil + ::oTikL:cSufTil == ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik .AND. !::oTikL:eof()

                  if !Empty( ::oTikL:cCodInv )

                     ::AppendInTemporal(  ::oTikL:cCodInv, Rtrim( ::oTikL:cCodInv ) + Space( 1 ) + AllTrim( oRetFld( ::oTikL:cCodInv, ::oTipInv:oDbf ) ), ::oTikL:nUntTil )

                  end

                  ::oTikL:Skip()

                  SysRefresh()

               end

            end

            ::oTikT:Skip()

            SysRefresh()

         end

      end

   end

   ::oDbfTemporal:GoTop()

RETURN ( Self )



UTILITY STATIC function TTurno_bEdtAlbaranCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAlbCliT:cSerAlb + Str( ::oAlbCliT:nNumAlb ) + ::oAlbCliT:cSufAlb )

Return ( {|| EdtAlbCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oFacCliT:cSerie + Str( ::oFacCliT:nNumFac ) + ::oFacCliT:cSufFac )

Return ( {|| EdtFacCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaRectificativaCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oRctCliT:cSerie + Str( ::oRctCliT:nNumFac ) + ::oRctCliT:cSufFac )

Return ( {|| EdtFacRec( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtTiketCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

   if ( "TPV" $ cParamsMain() )
      Return ( {|| InitTikCli( cNumeroDocumento ) } )
   end

Return ( { || EdtTikCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bZooTiketCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikT:cSerTik + ::oTikT:cNumTik + ::oTikT:cSufTik )

Return ( { || ZooTikCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtAnticipoCliente() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAntCliT:cSerAnt + Str( ::oAntCliT:nNumAnt ) + ::oAntCliT:cSufAnt )

Return ( {|| EdtAntCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtAlbaranProveedor() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oAlbPrvT:cSerAlb + Str( ::oAlbPrvT:nNumAlb ) + ::oAlbPrvT:cSufAlb )

Return ( {|| EdtAlbPrv( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaProveedor() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oFacPrvT:cSerFac + Str( ::oFacPrvT:nNumFac ) + ::oFacPrvT:cSufFac )

Return ( {|| EdtFacPrv( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaRectificativaProveedor() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oRctPrvT:cSerFac + Str( ::oRctPrvT:nNumFac ) + ::oRctPrvT:cSufFac )

Return ( {|| EdtRctPrv( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtTiketCobro() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik )

Return ( {|| EdtTikCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bZooTiketCobro() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := by( ::oTikP:cSerTik + ::oTikP:cNumTik + ::oTikP:cSufTik )

Return ( {|| ZooTikCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaCobro() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oFacCliP:cSerie + Str( ::oFacCliP:nNumFac ) + ::oFacCliP:cSufFac

   if !Empty( ::oFacCliP:cTipRec )
      Return ( {|| EdtFacRec( cNumeroDocumento ) } )
   end

Return ( {|| EdtFacCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtPedidoEntrega() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oPedCliT:cSerPed + Str( ::oPedCliP:nNumPed ) + ::oPedCliP:cSufPed

Return ( {|| EdtPedCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtAlbaranEntrega() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oAlbCliP:cSerAlb + Str( ::oAlbCliP:nNumAlb ) +::oAlbCliP:cSufAlb

Return ( {|| EdtAlbCli( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtEntradasSalidas() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oEntSal:Recno()

Return ( {|| EdtEntSal( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_bEdtFacturaPago() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cNumeroDocumento  := ::oFacPrvP:cSerFac + Str( ::oFacPrvP:nNumFac ) + ::oFacPrvP:cSufFac

   if !Empty( ::oFacPrvP:cTipRec )
      Return ( {|| EdtRctPrv( cNumeroDocumento ) } )
   end

Return ( {|| EdtFacPrv( cNumeroDocumento ) } )



UTILITY STATIC function TTurno_ContabilizaSesiones() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local oSerDocIni
   local oNumDocIni
   local oSufDocIni
   local oSerDocFin
   local oNumDocFin
   local oSufDocFin
   local cPicture                := "999999999"
   local oImageList
   local oGetEmpresaContaplus
   local oGetProjectoContaplus
   local oSayEmpresaContaplus
   local cSayEmpresaContaplus
   local oSayProjecto
   local cSayProjecto            := ""
   local oBmpContabilidad
   local nMtrProcess             := 0
   local nMtrSelect              := 0

   oImageList                    := TImageList():New( 16, 16 )
   oImageList:AddMasked( TBitmap():Define( "bRed" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )
   oImageList:AddMasked( TBitmap():Define( "bGreen" ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

   ::nNumDocIni                  := ::oDbf:FieldGetName( ::cNumDocKey )
   ::nNumDocFin                  := ::oDbf:FieldGetName( ::cNumDocKey )
   ::cSufDocIni                  := ::oDbf:FieldGetName( ::cSufDocKey )
   ::cSufDocFin                  := ::oDbf:FieldGetName( ::cSufDocKey )

   ::cGetEmpresaContaplus        := cEmpCnt()
   cSayEmpresaContaplus          := ChkEmpresaContaplus( cRutCnt(), cEmpCnt() )

   ::cGetProjectoContaplus       := cProCnt()
   cSayProjecto                  := ChkProyecto( cProCnt(), nil, cRutCnt(), cEmpCnt() )

   if ValType( ::nNumDocIni ) == "C"
      ::lNumDocChr               := .T.
      ::nLenDocIni               := Len( ::nNumDocIni )
      ::nNumDocIni               := Val( Trans( ::nNumDocIni, cPicture ) )
      ::nNumDocFin               := Val( Trans( ::nNumDocFin, cPicture ) )
   else
      ::nLenDocIni               := Len( Str( ::nNumDocIni ) )
   end

   cPicture                      := Replicate( "9", ::nLenDocIni )

   ::oDlgSelect = TDialog():New(,,,,, "ContabilizaSesion",, .F.,,,,,, .F.,,,,,, .F., )





   oBmpContabilidad := TBitmap():ReDefine( 500, "Folder2_red_Alpha_48",, ::oDlgSelect,,, .F., .F.,,, .F.,,, .T. )



   TCheckBox():ReDefine( 90, { | u | If( PCount()==0, ::lAllSesions, ::lAllSesions:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )







   oNumDocIni := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::nNumDocIni, ::nNumDocIni:= u ) }, ::oDlgSelect,, cPicture,,,,,,, .F., {||     !::lAllSesions},, .F., .T.,,,,,, nil,,, )





   oSufDocIni := TGetHlp():ReDefine( 101, { | u | If( PCount()==0, ::cSufDocIni, ::cSufDocIni:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     !::lAllSesions},, .F., .F.,,,,,, nil,,, )







   oNumDocFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::nNumDocFin, ::nNumDocFin:= u ) }, ::oDlgSelect,, cPicture,,,,,,, .F., {||     !::lAllSesions},, .F., .T.,,,,,, nil,,, )





   oSufDocFin := TGetHlp():ReDefine( 111, { | u | If( PCount()==0, ::cSufDocFin, ::cSufDocFin:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     !::lAllSesions},, .F., .F.,,,,,, nil,,, )









   ::oFechaInicio := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::dFechaInicio, ::dFechaInicio:= u ) }, ::oDlgSelect,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





   ::oFechaFin := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::dFechaFin, ::dFechaFin:= u ) }, ::oDlgSelect,,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )










   oGetEmpresaContaplus := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cGetEmpresaContaplus, ::cGetEmpresaContaplus:= u ) }, ::oDlgSelect,, "@!",,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oGetEmpresaContaplus:bValid   := {|| ChkEmpresaContaplus( cRutCnt(), ::cGetEmpresaContaplus, oSayEmpresaContaplus ), .T. }
      oGetEmpresaContaplus:bHelp    := {|| BrwEmpresaContaplus( cRutCnt(), oGetEmpresaContaplus ) }






   oSayEmpresaContaplus := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cSayEmpresaContaplus, cSayEmpresaContaplus:= u ) }, ::oDlgSelect,, "@!",,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )






   oGetProjectoContaplus := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, ::cGetProjectoContaplus, ::cGetProjectoContaplus:= u ) }, ::oDlgSelect,, "@R ###.######",,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, )

      oGetProjectoContaplus:bValid  := {|| ChkProyecto( ::cGetProjectoContaplus, oSayProjecto, cRutCnt(), ::cGetEmpresaContaplus ), .T. }
      oGetProjectoContaplus:bHelp   := {|| BrwProyecto( oGetProjectoContaplus, oSayProjecto, cRutCnt(), ::cGetEmpresaContaplus ) }





   oSayProjecto := TGetHlp():ReDefine( 151, { | u | If( PCount()==0, cSayProjecto, cSayProjecto:= u ) }, ::oDlgSelect,,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )








   ::oChkSimula := TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::lChkSimula, ::lChkSimula:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::lChkContabilizarFacturasProveedores, ::lChkContabilizarFacturasProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 171, { | u | If( PCount()==0, ::lChkContabilizarRectificativasProveedores, ::lChkContabilizarRectificativasProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 172, { | u | If( PCount()==0, ::lChkContabilizarPagosProveedores, ::lChkContabilizarPagosProveedores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 173, { | u | If( PCount()==0, ::lChkContabilizarFactura, ::lChkContabilizarFactura:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 174, { | u | If( PCount()==0, ::lChkContabilizarRectificativa, ::lChkContabilizarRectificativa:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 175, { | u | If( PCount()==0, ::lChkContabilizarAnticipos, ::lChkContabilizarAnticipos:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 176, { | u | If( PCount()==0, ::lChkContabilizarTicket, ::lChkContabilizarTicket:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 177, { | u | If( PCount()==0, ::lChkContabilizarCobros, ::lChkContabilizarCobros:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 178, { | u | If( PCount()==0, ::lChkContabilizarContadores, ::lChkContabilizarContadores:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )





   TWebBtn():Redefine(1170,,,,, {|This| ( aEval( ::oSer, {|o| Eval( o:bSetGet, .T. ), o:refresh() } ) ) }, ::oDlgSelect,,,,, "LEFT",,,,, ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ), ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ) ):SetTransparent()

   TWebBtn():Redefine(1180,,,,, {|This| ( aEval( ::oSer, {|o| Eval( o:bSetGet, .F. ), o:refresh() } ) ) }, ::oDlgSelect,,,,, "LEFT",,,,, ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ), ( 0 + ( 0 * 256 ) + ( 255 * 65536 ) ) ):SetTransparent()

   ::oSer[  1 ] := TCheckBox():ReDefine( 1190, { | u | If( PCount()==0, ::aSer[  1 ], ::aSer[  1 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  2 ] := TCheckBox():ReDefine( 1200, { | u | If( PCount()==0, ::aSer[  2 ], ::aSer[  2 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  3 ] := TCheckBox():ReDefine( 1210, { | u | If( PCount()==0, ::aSer[  3 ], ::aSer[  3 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  4 ] := TCheckBox():ReDefine( 1220, { | u | If( PCount()==0, ::aSer[  4 ], ::aSer[  4 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  5 ] := TCheckBox():ReDefine( 1230, { | u | If( PCount()==0, ::aSer[  5 ], ::aSer[  5 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  6 ] := TCheckBox():ReDefine( 1240, { | u | If( PCount()==0, ::aSer[  6 ], ::aSer[  6 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  7 ] := TCheckBox():ReDefine( 1250, { | u | If( PCount()==0, ::aSer[  7 ], ::aSer[  7 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  8 ] := TCheckBox():ReDefine( 1260, { | u | If( PCount()==0, ::aSer[  8 ], ::aSer[  8 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[  9 ] := TCheckBox():ReDefine( 1270, { | u | If( PCount()==0, ::aSer[  9 ], ::aSer[  9 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 10 ] := TCheckBox():ReDefine( 1280, { | u | If( PCount()==0, ::aSer[ 10 ], ::aSer[ 10 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 11 ] := TCheckBox():ReDefine( 1290, { | u | If( PCount()==0, ::aSer[ 11 ], ::aSer[ 11 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 12 ] := TCheckBox():ReDefine( 1300, { | u | If( PCount()==0, ::aSer[ 12 ], ::aSer[ 12 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 13 ] := TCheckBox():ReDefine( 1310, { | u | If( PCount()==0, ::aSer[ 13 ], ::aSer[ 13 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 14 ] := TCheckBox():ReDefine( 1320, { | u | If( PCount()==0, ::aSer[ 14 ], ::aSer[ 14 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 15 ] := TCheckBox():ReDefine( 1330, { | u | If( PCount()==0, ::aSer[ 15 ], ::aSer[ 15 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 16 ] := TCheckBox():ReDefine( 1340, { | u | If( PCount()==0, ::aSer[ 16 ], ::aSer[ 16 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 17 ] := TCheckBox():ReDefine( 1350, { | u | If( PCount()==0, ::aSer[ 17 ], ::aSer[ 17 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 18 ] := TCheckBox():ReDefine( 1360, { | u | If( PCount()==0, ::aSer[ 18 ], ::aSer[ 18 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 19 ] := TCheckBox():ReDefine( 1370, { | u | If( PCount()==0, ::aSer[ 19 ], ::aSer[ 19 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 20 ] := TCheckBox():ReDefine( 1380, { | u | If( PCount()==0, ::aSer[ 20 ], ::aSer[ 20 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 21 ] := TCheckBox():ReDefine( 1390, { | u | If( PCount()==0, ::aSer[ 21 ], ::aSer[ 21 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 22 ] := TCheckBox():ReDefine( 1400, { | u | If( PCount()==0, ::aSer[ 22 ], ::aSer[ 22 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 23 ] := TCheckBox():ReDefine( 1410, { | u | If( PCount()==0, ::aSer[ 23 ], ::aSer[ 23 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 24 ] := TCheckBox():ReDefine( 1420, { | u | If( PCount()==0, ::aSer[ 24 ], ::aSer[ 24 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 25 ] := TCheckBox():ReDefine( 1430, { | u | If( PCount()==0, ::aSer[ 25 ], ::aSer[ 25 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )
   ::oSer[ 26 ] := TCheckBox():ReDefine( 1440, { | u | If( PCount()==0, ::aSer[ 26 ], ::aSer[ 26 ]:= u ) }, ::oDlgSelect,,,,,,, .F.,, .F. )









   ::oMtrSelect := TMeter():ReDefine( 200, { | u | If( PCount()==0, nMtrSelect, nMtrSelect:= u ) },, ::oDlgSelect, .F.,,, .T.,,,, )





   ::oMtrProcess := TMeter():ReDefine( 210, { | u | If( PCount()==0, nMtrProcess, nMtrProcess:= u ) },, ::oDlgSelect, .F.,,, .T.,,,, )





   ::oTreeSelect  := TTreeView():Redefine( 400, ::oDlgSelect )








   TButton():ReDefine( 1, {||( ::EvalContabilizaSesiones() )}, ::oDlgSelect,,, .F.,,,, .F. )




   ::oBtnCancelContabilizacion := TButton():ReDefine( 2, {||( ::oDlgSelect:end() )}, ::oDlgSelect,,, .F.,,,, .F. )

   ::oDlgSelect:AddFastKey( 116, {|| ::EvalContabilizaSesiones() } )

   ::oDlgSelect:bStart := {|| ::StartContabilizaSesiones( oImageList ) }

   ::oDlgSelect:Activate( ::oDlgSelect:bLClicked, ::oDlgSelect:bMoved, ::oDlgSelect:bPainted, .T.,,,, ::oDlgSelect:bRClicked,,, )

   if !Empty( oBmpContabilidad )
      oBmpContabilidad:End()
   end

RETURN ( Self )



UTILITY STATIC function TTurno_StartContabilizaSesiones( oImageList) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   ::oTreeSelect:SetImageList( oImageList )

RETURN ( Self )



UTILITY STATIC function TTurno_EvalContabilizaSesiones() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local bOldAction

   ::lBreak                            := .F.

   ::oDbf:GetStatus()

   ::oDlgSelect:Disable()



   bOldAction                          := ::oBtnCancelContabilizacion:bAction
   ::oBtnCancelContabilizacion:bAction := {|| ::lBreak := .T. }
   ::oBtnCancelContabilizacion:Enable()

   ::oTreeSelect:Enable()



   ::oTreeSelect:DeleteAll()

   if ::lAllSesions

      ::Contabiliza( ::lChkSimula )

   else

      if ::oDbf:Seek( Str( ::nNumDocIni, ::nLenDocIni ) + ::cSufDocIni, .T. )

         ::oMtrProcess:SetTotal( ::oDbf:OrdKeyCount() )



         while ::oDbf:FieldGetName( ::cNumDocKey ) + ::oDbf:FieldGetName( ::cSufDocKey ) >= Str( ::nNumDocIni, ::nLenDocIni ) + ::cSufDocIni .AND. ::oDbf:FieldGetName( ::cNumDocKey ) + ::oDbf:FieldGetName( ::cSufDocKey ) <= Str( ::nNumDocFin, ::nLenDocIni ) + ::cSufDocFin .AND. !::oDbf:eof()

            ::Contabiliza( ::lChkSimula )

            ::oDbf:Skip()

            SysRefresh()

            ::oMtrProcess:Set( ::oDbf:OrdKeyNo() )

         end

         ::oMtrProcess:Set( ::oDbf:OrdKeyCount() )

      end

      ::oDbf:SetStatus()

   end



   ::oBtnCancelContabilizacion:bAction := bOldAction

   ::oDlgSelect:Enable()

RETURN NIL
































































































UTILITY STATIC function TTurno_GetLastOpen() ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local a        := {}
   local cLasTur  := ""

   if Empty( ::oDbf )
      Return ( cLasTur )
   end

   if !( ::oDbf:Used() )
      Return ( cLasTur )
   end

   ::oDbf:OrdSetFocus( "lCloTur" )

   if ::oDbf:Seek( .F. ) .AND. !( ::oDbf:lCloTur )
      cLasTur     := ::oDbf:cNumTur + ::oDbf:cSufTur
   end

   ::oDbf:OrdSetFocus( "cNumTur" )

RETURN ( cLasTur )



UTILITY STATIC function TTurno_CurTurno( lDelega) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   IIF( lDelega == nil, lDelega := .T., ) ;

   ::cCurTurno       := ::GetLastOpen()

   if !lDelega
      ::cCurTurno    := SubStr( ::cCurTurno, 1, 6 )
   end

RETURN ( ::cCurTurno )



UTILITY STATIC function TTurno_MailArqueo( cCurrentTruno) ; local Self AS CLASS TTurno := QSelf() AS CLASS TTurno

   local cMensajeMail   := ""

   ::cPdfFileName       := "Arqueo" + Alltrim( cCurrentTruno ) + "Caja" + Alltrim( ::oDbfCaj:cCodCaj ) + ".pdf"
   ::cHtmlFileName      := "Arqueo" + Alltrim( cCurrentTruno ) + "Caja" + Alltrim( ::oDbfCaj:cCodCaj ) + ".html"
   ::cPdfDefaultPath    := cPatEmpTmp()

   ::lPdfShowDialog     := .F.

   ::PrintArqueo( cCurrentTruno, ::oDbfCaj:cCodCaj, 4 )

   cMensajeMail         := "Caja [" + ::oDbfCaj:cCodCaj + Space( 1 ) + Rtrim( oRetFld( ::oDbfCaj:cCodCaj, ::oCaja ) ) + "],"
   cMensajeMail         += " cerrada a las " + Left( Time(), 5 )
   cMensajeMail         += " del da " + Dtoc( Date() ) + "." + Chr(13)+Chr(10)

   if ::oTotales:nTotCompras( ::oDbfCaj:cCodCaj ) <> 0
      cMensajeMail      += "Compras en albaranes "                + Alltrim( Str( ::oTotales:nTotAlbPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Compras en facturas "                 + Alltrim( Str( ::oTotales:nTotFacPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Compras en facturas rectificativas "  + Alltrim( Str( ::oTotales:nTotRctPrvCompras( ::oDbfCaj:cCodCaj ) ) )   + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Total compras "                       + Alltrim( Str( ::oTotales:nTotCompras( ::oDbfCaj:cCodCaj ) ) )         + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
   end

   if ::oTotales:nTotVentas( ::oDbfCaj:cCodCaj ) <> 0
      cMensajeMail      += "Ventas en albaranes "                 + Alltrim( Str( ::oTotales:nTotAlbCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en facturas "                  + Alltrim( Str( ::oTotales:nTotFacCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en facturas rectificativas "   + Alltrim( Str( ::oTotales:nTotRctCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en tickets "                   + Alltrim( Str( ::oTotales:nTotTikCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Ventas en cheques regalo "            + Alltrim( Str( ::oTotales:nTotChkCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Devoluciones "                        + Alltrim( Str( ::oTotales:nTotDevCliVentas( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
      cMensajeMail      += "Total ventas "                        + Alltrim( Str( ::oTotales:nTotVentas( ::oDbfCaj:cCodCaj ) ) )       + cSimDiv( cDivEmp(), ::oDbfDiv ) + "." + Chr(13)+Chr(10)
   end

   cMensajeMail         += Chr(13)+Chr(10)
   cMensajeMail         += "Total venta sesin " + Alltrim( Str( ::oTotales:nTotVentaSesion( ::oDbfCaj:cCodCaj ) ) ) + cSimDiv( cDivEmp(), ::oDbfDiv ) + "."
   cMensajeMail         += Chr(13)+Chr(10) + Chr(13)+Chr(10)

   ::lPdfShowDialog     := .T.





   with object TGenMailing():New()

      :cGetDe           := "Gestool" + Space( 1 ) + "2K13"
      :cGetAsunto       := "Arqueo de caja " + Alltrim( ::oDbfCaj:cCodCaj ) + " sesin " + Alltrim( cCurrentTruno )
      :cNombre          := "Gestool"
      :cDireccion       := Rtrim( ::cEnviarMail )

      if File( ::cPdfDefaultPath + ::cHtmlFileName )
         :lCargaHtml( ::cPdfDefaultPath + ::cHtmlFileName )
      else
         :cGetMensaje   := Rtrim( cMensajeMail )
      end

      :lExternalSendMail()

   end





   if File( ::cPdfDefaultPath + ::cPdfFileName )
      fErase( ::cPdfDefaultPath + ::cPdfFileName )
   end

   if File( ::cPdfDefaultPath + ::cHtmlFileName )
      fErase( ::cPdfDefaultPath + ::cHtmlFileName )
   end

Return ( Self )







Function cCurSesion( cCurSes, lDelega )

   local oTurno

   IIF( lDelega == nil, lDelega := .T., ) ;



   oTurno               := TTurno()

   if cCurSes <> nil
      oTurno:cCurTurno  := cCurSes
   end
















Return ( if( lDelega, oTurno:cCurTurno, SubStr( oTurno:cCurTurno, 1, 6 ) ) )




Function lExisteTurno( cNumTur, dbfTurno )

   local nRec
   local lExiste     := .F.
   local lOpen       := .F.

   if Empty( dbfTurno )
      dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "Turno.DBF" ), ( cCheckArea( "Turno", @dbfTurno ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
      if !lAIS() ; ordListAdd( ( cPatEmp() + "Turno.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
      lOpen          := .T.
   else
      nRec           := ( dbfTurno )->( Recno() )
   end

   lExiste           := dbSeekInOrd( Padl( AllTrim( cNumTur ), 6 ), "cNumTur", dbfTurno )

   if lOpen
      ( dbfTurno )->( dbCloseArea() )
   else
      ( dbfTurno )->( dbGoTo( nRec ) )
   end

Return ( lExiste )
