#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 12 ".\Prg\TComercio.prg"
static oTimer
static oComercio
Static oMsgAlarm



_HB_CLASS TComercio ; UTILITY FUNCTION TComercio(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TComercio" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { hRas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "hRas" }, .F., .F. ), )
   _HB_MEMBER { lRasValido} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lRasValido" }, .F., .F. ), )
   _HB_MEMBER { lFtpValido} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lFtpValido" }, .F., .F. ), )

   _HB_MEMBER { lServer} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lServer" }, .F., .F. ), )

   _HB_MEMBER { oText} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oText" }, .F., .F. ), )
   _HB_MEMBER { cText} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cText" }, .F., .F. ), )
   _HB_MEMBER { aSend} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aSend" }, .F., .F. ), )
   _HB_MEMBER { oInt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oInt" }, .F., .F. ), )
   _HB_MEMBER { oFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFtp" }, .F., .F. ), )
   _HB_MEMBER { nTotMeter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nTotMeter" }, .F., .F. ), )

   _HB_MEMBER { oMeter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMeter" }, .F., .F. ), )
   _HB_MEMBER { nActualMeter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nActualMeter" }, .F., .F. ), )

   _HB_MEMBER { oMeterL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMeterL" }, .F., .F. ), )
   _HB_MEMBER { nActualMeterL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nActualMeterL" }, .F., .F. ), )

   _HB_MEMBER { oBmpSel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBmpSel" }, .F., .F. ), )
   _HB_MEMBER { oDlg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDlg" }, .F., .F. ), )
   _HB_MEMBER { oFld} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFld" }, .F., .F. ), )
   _HB_MEMBER { oBmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBmp" }, .F., .F. ), )

   _HB_MEMBER { oSubItem} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSubItem" }, .F., .F. ), )
   _HB_MEMBER { oSubItem2} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSubItem2" }, .F., .F. ), )

   _HB_MEMBER { cIniFile} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cIniFile" }, .F., .F. ), )

   _HB_MEMBER { lPlanificarEnvio} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lPlanificarEnvio" }, .F., .F. ), )
   _HB_MEMBER { cHoraEnvio} ; IIF( !.F., s_oClass:AddMultiData(, "0000", nScope + IIF( .F., 32, 0 ), { "cHoraEnvio" }, .F., .F. ), )
   _HB_MEMBER { lPlanificarRecepcion} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lPlanificarRecepcion" }, .F., .F. ), )
   _HB_MEMBER { cHoraRecepcion} ; IIF( !.F., s_oClass:AddMultiData(, "0000", nScope + IIF( .F., 32, 0 ), { "cHoraRecepcion" }, .F., .F. ), )
   _HB_MEMBER { lEnviado} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lEnviado" }, .F., .F. ), )
   _HB_MEMBER { lRecibido} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lRecibido" }, .F., .F. ), )
   _HB_MEMBER { lGetProcesados} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lGetProcesados" }, .F., .F. ), )
   _HB_MEMBER { lGetFueraSecuencia} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lGetFueraSecuencia" }, .F., .F. ), )
   _HB_MEMBER { lGetEliminarFicheros} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lGetEliminarFicheros" }, .F., .F. ), )

   _HB_MEMBER { lPedidosWeb} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lPedidosWeb" }, .F., .F. ), )

   _HB_MEMBER { nTipoEnvio} ; IIF( !.F., s_oClass:AddMultiData(, 1, nScope + IIF( .F., 32, 0 ), { "nTipoEnvio" }, .F., .F. ), )

   _HB_MEMBER { nLevel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nLevel" }, .F., .F. ), )

   _HB_MEMBER { oDbfSenderReciver} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfSenderReciver" }, .F., .F. ), )
   _HB_MEMBER { oDbfFilesReciver} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfFilesReciver" }, .F., .F. ), )

   _HB_MEMBER { aFilesProcessed} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aFilesProcessed" }, .F., .F. ), )

   _HB_MEMBER { oBotonTerminar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBotonTerminar" }, .F., .F. ), )

   _HB_MEMBER { cFilTxt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFilTxt" }, .F., .F. ), )
   _HB_MEMBER { oFilTxt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFilTxt" }, .F., .F. ), )
   _HB_MEMBER { hFilTxt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "hFilTxt" }, .F., .F. ), )

   _HB_MEMBER { oBtnCancel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCancel" }, .F., .F. ), )
   _HB_MEMBER { oBtnExportar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnExportar" }, .F., .F. ), )

   _HB_MEMBER { oTree} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTree" }, .F., .F. ), )
   _HB_MEMBER { oImageList} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImageList" }, .F., .F. ), )

   _HB_MEMBER { cPath} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPath" }, .F., .F. ), )

   _HB_MEMBER { lSincAll} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lSincAll" }, .F., .F. ), )
   _HB_MEMBER { oArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArticulos" }, .F., .F. ), )
   _HB_MEMBER { lArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lArticulos" }, .F., .F. ), )
   _HB_MEMBER { oFamilias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFamilias" }, .F., .F. ), )
   _HB_MEMBER { lFamilias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lFamilias" }, .F., .F. ), )
   _HB_MEMBER { oPedidos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedidos" }, .F., .F. ), )
   _HB_MEMBER { lPedidos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lPedidos" }, .F., .F. ), )
   _HB_MEMBER { oFabricantes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFabricantes" }, .F., .F. ), )
   _HB_MEMBER { lFabricantes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lFabricantes" }, .F., .F. ), )
   _HB_MEMBER { oTipIva} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipIva" }, .F., .F. ), )
   _HB_MEMBER { lIva} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lIva" }, .F., .F. ), )
   _HB_MEMBER { oCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCliente" }, .F., .F. ), )
   _HB_MEMBER { lCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lCliente" }, .F., .F. ), )

   _HB_MEMBER { oArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArt" }, .F., .F. ), )
   _HB_MEMBER { oPro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPro" }, .F., .F. ), )
   _HB_MEMBER { oTblPro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTblPro" }, .F., .F. ), )
   _HB_MEMBER { oFPAgo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFPAgo" }, .F., .F. ), )

   _HB_MEMBER { oArtDiv} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArtDiv" }, .F., .F. ), )
   _HB_MEMBER { oTipArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipArt" }, .F., .F. ), )
   _HB_MEMBER { oFam} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFam" }, .F., .F. ), )
   _HB_MEMBER { oGrpFam} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oGrpFam" }, .F., .F. ), )
   _HB_MEMBER { oCli} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCli" }, .F., .F. ), )
   _HB_MEMBER { oObras} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oObras" }, .F., .F. ), )

   _HB_MEMBER { oIva} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oIva" }, .F., .F. ), )
   _HB_MEMBER { oDivisas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDivisas" }, .F., .F. ), )
   _HB_MEMBER { oPedCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliT" }, .F., .F. ), )
   _HB_MEMBER { oPedCliI} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliI" }, .F., .F. ), )
   _HB_MEMBER { oPedCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliL" }, .F., .F. ), )
   _HB_MEMBER { oCount} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCount" }, .F., .F. ), )
   _HB_MEMBER { oFab} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFab" }, .F., .F. ), )
   _HB_MEMBER { oKit} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oKit" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliT" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacRecL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecL" }, .F., .F. ), )
   _HB_MEMBER { oTikCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliL" }, .F., .F. ), )
   _HB_MEMBER { oProLin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oProLin" }, .F., .F. ), )
   _HB_MEMBER { oProMat} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oProMat" }, .F., .F. ), )
   _HB_MEMBER { oHisMov} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oHisMov" }, .F., .F. ), )
   _HB_MEMBER { oPedPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedPrvL" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvT" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvL" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvL" }, .F., .F. ), )
   _HB_MEMBER { oRctPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRctPrvL" }, .F., .F. ), )
   _HB_MEMBER { oArtImg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArtImg" }, .F., .F. ), )

   _HB_MEMBER { oStock} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oStock" }, .F., .F. ), )

   _HB_MEMBER { oCon} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCon" }, .F., .F. ), )
   _HB_MEMBER { cHost} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cHost" }, .F., .F. ), )
   _HB_MEMBER { cUser} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cUser" }, .F., .F. ), )
   _HB_MEMBER { cPasswd} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPasswd" }, .F., .F. ), )
   _HB_MEMBER { cDbName} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cDbName" }, .F., .F. ), )
   _HB_MEMBER { nPort} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nPort" }, .F., .F. ), )
   _HB_MEMBER { cSeriePed} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cSeriePed" }, .F., .F. ), )
   _HB_MEMBER { cHostFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cHostFtp" }, .F., .F. ), )
   _HB_MEMBER { nPortFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nPortFtp" }, .F., .F. ), )
   _HB_MEMBER { cUserFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cUserFtp" }, .F., .F. ), )
   _HB_MEMBER { cPasswdFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPasswdFtp" }, .F., .F. ), )
   _HB_MEMBER { lPassiveFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lPassiveFtp" }, .F., .F. ), )
   _HB_MEMBER { cPlataforma} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPlataforma" }, .F., .F. ), )
   _HB_MEMBER { nExportar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nExportar" }, .F., .F. ), )
   _HB_MEMBER { Cookiekey} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "Cookiekey" }, .F., .F. ), )

   _HB_MEMBER { oInt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oInt" }, .F., .F. ), )
   _HB_MEMBER { oFtp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFtp" }, .F., .F. ), )
   _HB_MEMBER { aImages} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aImages" }, .F., .F. ), )
   _HB_MEMBER { aImagesArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aImagesArticulos" }, .F., .F. ), )
   _HB_MEMBER { aImagesCategories} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aImagesCategories" }, .F., .F. ), )
   _HB_MEMBER { aTipoImagesPrestashop} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aTipoImagesPrestashop" }, .F., .F. ), )
   _HB_MEMBER { cDImagen} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cDImagen" }, .F., .F. ), )
   _HB_MEMBER { nLanguage} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nLanguage" }, .F., .F. ), )

   _HB_MEMBER { nPrecioMinimo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nPrecioMinimo" }, .F., .F. ), )

   _HB_MEMBER { nSecondTimer} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nSecondTimer" }, .F., .F. ), )

   _HB_MEMBER { lDefImgPrp} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lDefImgPrp" }, .F., .F. ), )

   _HB_MEMBER { nNumeroCategorias} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nNumeroCategorias" }, .F., .F. ), )
   _HB_MEMBER { aCategorias} ; IIF( !.F., s_oClass:AddMultiData(, {}, nScope + IIF( .F., 32, 0 ), { "aCategorias" }, .F., .F. ), )

   _HB_MEMBER New(); IIF( .F., s_oClass:ModMethod( "New", @TComercio_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "New", @TComercio_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Create(); IIF( .F., s_oClass:ModInline( "Create", {|Self | Self, ( Self ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "Create", {|Self | Self, ( Self ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER OpenFiles(); IIF( .F., s_oClass:ModMethod( "OpenFiles", @TComercio_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenFiles", @TComercio_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CloseFiles(); IIF( .F., s_oClass:ModMethod( "CloseFiles", @TComercio_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseFiles", @TComercio_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Activate( oWnd); IIF( .F., s_oClass:ModMethod( "Activate", @TComercio_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Activate", @TComercio_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AutoRecive(); IIF( .F., s_oClass:ModMethod( "AutoRecive", @TComercio_AutoRecive(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AutoRecive", @TComercio_AutoRecive(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Sincronizar(); IIF( .F., s_oClass:ModMethod( "Sincronizar", @TComercio_Sincronizar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Sincronizar", @TComercio_Sincronizar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Exportar(); IIF( .F., s_oClass:ModMethod( "Exportar", @TComercio_Exportar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Exportar", @TComercio_Exportar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER Importar(); IIF( .F., s_oClass:ModMethod( "Importar", @TComercio_Importar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Importar", @TComercio_Importar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SetText( cText); IIF( .F., s_oClass:ModMethod( "SetText", @TComercio_SetText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetText", @TComercio_SetText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER MeterGlobalText( cText); IIF( .F., s_oClass:ModMethod( "MeterGlobalText", @TComercio_MeterGlobalText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MeterGlobalText", @TComercio_MeterGlobalText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER MeterParticularText( cText); IIF( .F., s_oClass:ModMethod( "MeterParticularText", @TComercio_MeterParticularText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MeterParticularText", @TComercio_MeterParticularText(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendArticulo( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos, oTablaArticulos_Images, oTablaOfertas); IIF( .F., s_oClass:ModMethod( "AppendArticulo", @TComercio_AppendArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendArticulo", @TComercio_AppendArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendPropiedades( oTablaPropiedades, oTablaPropiedades_Lineas, oTablaRelaciones_Propiedades_Lineas); IIF( .F., s_oClass:ModMethod( "AppendPropiedades", @TComercio_AppendPropiedades(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendPropiedades", @TComercio_AppendPropiedades(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendFamilia( oTablaFamilias, oTablaFamiliasDesc); IIF( .F., s_oClass:ModMethod( "AppendFamilia", @TComercio_AppendFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFamilia", @TComercio_AppendFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendClient( oTablaClientes, oTablaClientesDirec, oTablaClientesInfo, oTablaZona); IIF( .F., s_oClass:ModMethod( "AppendClient", @TComercio_AppendClient(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendClient", @TComercio_AppendClient(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendPedido( oTablaPedidos, oTablaPedidosPro, oTablaPedidosAtributos, oTablaPedidosTotal); IIF( .F., s_oClass:ModMethod( "AppendPedido", @TComercio_AppendPedido(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendPedido", @TComercio_AppendPedido(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendImages(); IIF( .F., s_oClass:ModMethod( "AppendImages", @TComercio_AppendImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendImages", @TComercio_AppendImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendFabricantes( oTablaFabricantes, oTablaFabricantes_info); IIF( .F., s_oClass:ModMethod( "AppendFabricantes", @TComercio_AppendFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFabricantes", @TComercio_AppendFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendIva( oTablaIva, oTablaIva_rates, oTablaGeoZone, oTablaZone); IIF( .F., s_oClass:ModMethod( "AppendIva", @TComercio_AppendIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendIva", @TComercio_AppendIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendZone( oTablaGeoZone, oTablaZone); IIF( .F., s_oClass:ModMethod( "AppendZone", @TComercio_AppendZone(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendZone", @TComercio_AppendZone(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EstadoPedidos( oTablaPedidos, oTablaPedidosStatus); IIF( .F., s_oClass:ModMethod( "EstadoPedidos", @TComercio_EstadoPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EstadoPedidos", @TComercio_EstadoPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendImages_bd(); IIF( .F., s_oClass:ModMethod( "AppendImages_bd", @TComercio_AppendImages_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendImages_bd", @TComercio_AppendImages_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendIva_bd( oTablaIva); IIF( .F., s_oClass:ModMethod( "AppendIva_bd", @TComercio_AppendIva_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendIva_bd", @TComercio_AppendIva_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendArticulo_bd( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos); IIF( .F., s_oClass:ModMethod( "AppendArticulo_bd", @TComercio_AppendArticulo_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendArticulo_bd", @TComercio_AppendArticulo_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendPropiedades_bd( oTablaPropiedades, oTablaPropiedades_Lineas, oTablaRelaciones_Propiedades_Lineas); IIF( .F., s_oClass:ModMethod( "AppendPropiedades_bd", @TComercio_AppendPropiedades_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendPropiedades_bd", @TComercio_AppendPropiedades_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendFamilia_bd( oTablaFamilias, oTablaFamiliasDesc); IIF( .F., s_oClass:ModMethod( "AppendFamilia_bd", @TComercio_AppendFamilia_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFamilia_bd", @TComercio_AppendFamilia_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppendFabricantes_bd( oTablaFabricantes, oTablaFabricantes_info); IIF( .F., s_oClass:ModMethod( "AppendFabricantes_bd", @TComercio_AppendFabricantes_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFabricantes_bd", @TComercio_AppendFabricantes_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppProducts( oDb); IIF( .F., s_oClass:ModMethod( "AppProducts", @TComercio_AppProducts(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppProducts", @TComercio_AppProducts(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppOptions( oDb); IIF( .F., s_oClass:ModMethod( "AppOptions", @TComercio_AppOptions(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppOptions", @TComercio_AppOptions(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppOptions_Values( oDb); IIF( .F., s_oClass:ModMethod( "AppOptions_Values", @TComercio_AppOptions_Values(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppOptions_Values", @TComercio_AppOptions_Values(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppOptions_Relacion( oDb); IIF( .F., s_oClass:ModMethod( "AppOptions_Relacion", @TComercio_AppOptions_Relacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppOptions_Relacion", @TComercio_AppOptions_Relacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppCategories( oDb); IIF( .F., s_oClass:ModMethod( "AppCategories", @TComercio_AppCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppCategories", @TComercio_AppCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppGrpCategories( oDb); IIF( .F., s_oClass:ModMethod( "AppGrpCategories", @TComercio_AppGrpCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppGrpCategories", @TComercio_AppGrpCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppCustomers( oDb); IIF( .F., s_oClass:ModMethod( "AppCustomers", @TComercio_AppCustomers(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppCustomers", @TComercio_AppCustomers(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppPedidos( oDb); IIF( .F., s_oClass:ModMethod( "AppPedidos", @TComercio_AppPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppPedidos", @TComercio_AppPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppFabricantes( oDb); IIF( .F., s_oClass:ModMethod( "AppFabricantes", @TComercio_AppFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppFabricantes", @TComercio_AppFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppIva( oDb); IIF( .F., s_oClass:ModMethod( "AppIva", @TComercio_AppIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppIva", @TComercio_AppIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppZone( oDb); IIF( .F., s_oClass:ModMethod( "AppZone", @TComercio_AppZone(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppZone", @TComercio_AppZone(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppAtributes( oDb, codigo); IIF( .F., s_oClass:ModMethod( "AppAtributes", @TComercio_AppAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppAtributes", @TComercio_AppAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppImages( oDb, codigo); IIF( .F., s_oClass:ModMethod( "AppImages", @TComercio_AppImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppImages", @TComercio_AppImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppPreciosAtributes( oTablaArticulos, oTablaArticulos_Atributos, nCodWeb); IIF( .F., s_oClass:ModMethod( "AppPreciosAtributes", @TComercio_AppPreciosAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppPreciosAtributes", @TComercio_AppPreciosAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER CambiarEPedidos( oDb); IIF( .F., s_oClass:ModMethod( "CambiarEPedidos", @TComercio_CambiarEPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CambiarEPedidos", @TComercio_CambiarEPedidos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER DropAtributes( oDb); IIF( .F., s_oClass:ModMethod( "DropAtributes", @TComercio_DropAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DropAtributes", @TComercio_DropAtributes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppIva_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppIva_bd", @TComercio_AppIva_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppIva_bd", @TComercio_AppIva_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppProducts_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppProducts_bd", @TComercio_AppProducts_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppProducts_bd", @TComercio_AppProducts_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppOptions_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppOptions_bd", @TComercio_AppOptions_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppOptions_bd", @TComercio_AppOptions_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppCategories_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppCategories_bd", @TComercio_AppCategories_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppCategories_bd", @TComercio_AppCategories_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppCustomers_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppCustomers_bd", @TComercio_AppCustomers_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppCustomers_bd", @TComercio_AppCustomers_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AppFabricantes_bd( oDb); IIF( .F., s_oClass:ModMethod( "AppFabricantes_bd", @TComercio_AppFabricantes_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppFabricantes_bd", @TComercio_AppFabricantes_bd(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetParentCategories(); IIF( .F., s_oClass:ModMethod( "GetParentCategories", @TComercio_GetParentCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetParentCategories", @TComercio_GetParentCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetParentFamilia(); IIF( .F., s_oClass:ModMethod( "GetParentFamilia", @TComercio_GetParentFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetParentFamilia", @TComercio_GetParentFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetParentFabricantes(); IIF( .F., s_oClass:ModMethod( "GetParentFabricantes", @TComercio_GetParentFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetParentFabricantes", @TComercio_GetParentFabricantes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetParentIva(); IIF( .F., s_oClass:ModMethod( "GetParentIva", @TComercio_GetParentIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetParentIva", @TComercio_GetParentIva(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetParentTipoArticulo( oDb); IIF( .F., s_oClass:ModMethod( "GetParentTipoArticulo", @TComercio_GetParentTipoArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetParentTipoArticulo", @TComercio_GetParentTipoArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lParentTipoArticulo( oTablaFamilias, oTablaFamiliasDesc); IIF( .F., s_oClass:ModMethod( "lParentTipoArticulo", @TComercio_lParentTipoArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lParentTipoArticulo", @TComercio_lParentTipoArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetLanguage( oDb); IIF( .F., s_oClass:ModMethod( "GetLanguage", @TComercio_GetLanguage(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetLanguage", @TComercio_GetLanguage(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AutoInt( oTabla); IIF( .F., s_oClass:ModMethod( "AutoInt", @TComercio_AutoInt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AutoInt", @TComercio_AutoInt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddImages( cImage); IIF( .F., s_oClass:ModMethod( "AddImages", @TComercio_AddImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddImages", @TComercio_AddImages(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ChangeSincAll(); IIF( .F., s_oClass:ModMethod( "ChangeSincAll", @TComercio_ChangeSincAll(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ChangeSincAll", @TComercio_ChangeSincAll(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetTipArt(); IIF( .F., s_oClass:ModMethod( "GetTipArt", @TComercio_GetTipArt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetTipArt", @TComercio_GetTipArt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER GetPropArt(); IIF( .F., s_oClass:ModMethod( "GetPropArt", @TComercio_GetPropArt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetPropArt", @TComercio_GetPropArt(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cModelArticulo( nId); IIF( .F., s_oClass:ModMethod( "cModelArticulo", @TComercio_cModelArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "cModelArticulo", @TComercio_cModelArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SeleccionFamilia(); IIF( .F., s_oClass:ModMethod( "SeleccionFamilia", @TComercio_SeleccionFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SeleccionFamilia", @TComercio_SeleccionFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ExportarPrestashop(); IIF( .F., s_oClass:ModMethod( "ExportarPrestashop", @TComercio_ExportarPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ExportarPrestashop", @TComercio_ExportarPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ImportarPrestashop(); IIF( .F., s_oClass:ModMethod( "ImportarPrestashop", @TComercio_ImportarPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ImportarPrestashop", @TComercio_ImportarPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetLanguagePrestashop(); IIF( .F., s_oClass:ModMethod( "GetLanguagePrestashop", @TComercio_GetLanguagePrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetLanguagePrestashop", @TComercio_GetLanguagePrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendFamiliaPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendFamiliaPrestashop", @TComercio_AppendFamiliaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFamiliaPrestashop", @TComercio_AppendFamiliaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddCategoriaRaiz(); IIF( .F., s_oClass:ModMethod( "AddCategoriaRaiz", @TComercio_AddCategoriaRaiz(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddCategoriaRaiz", @TComercio_AddCategoriaRaiz(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppTipoArticuloPrestashop(); IIF( .F., s_oClass:ModMethod( "AppTipoArticuloPrestashop", @TComercio_AppTipoArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppTipoArticuloPrestashop", @TComercio_AppTipoArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppCategoriesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppCategoriesPrestashop", @TComercio_AppCategoriesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppCategoriesPrestashop", @TComercio_AppCategoriesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppGrupoCategoriesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppGrupoCategoriesPrestashop", @TComercio_AppGrupoCategoriesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppGrupoCategoriesPrestashop", @TComercio_AppGrupoCategoriesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendArticuloPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendArticuloPrestashop", @TComercio_AppendArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendArticuloPrestashop", @TComercio_AppendArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER RecalculaPosicionesCategoriasPrestashop(); IIF( .F., s_oClass:ModMethod( "RecalculaPosicionesCategoriasPrestashop", @TComercio_RecalculaPosicionesCategoriasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "RecalculaPosicionesCategoriasPrestashop", @TComercio_RecalculaPosicionesCategoriasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppProductsPrestashop(); IIF( .F., s_oClass:ModMethod( "AppProductsPrestashop", @TComercio_AppProductsPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppProductsPrestashop", @TComercio_AppProductsPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendIvaPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendIvaPrestashop", @TComercio_AppendIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendIvaPrestashop", @TComercio_AppendIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppIvaPrestashop(); IIF( .F., s_oClass:ModMethod( "AppIvaPrestashop", @TComercio_AppIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppIvaPrestashop", @TComercio_AppIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendImagesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendImagesPrestashop", @TComercio_AppendImagesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendImagesPrestashop", @TComercio_AppendImagesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddTipoImagesPrestashop( cImage); IIF( .F., s_oClass:ModMethod( "AddTipoImagesPrestashop", @TComercio_AddTipoImagesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddTipoImagesPrestashop", @TComercio_AddTipoImagesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER aTipoImagenPrestashop(); IIF( .F., s_oClass:ModMethod( "aTipoImagenPrestashop", @TComercio_aTipoImagenPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "aTipoImagenPrestashop", @TComercio_aTipoImagenPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddImagesArticulos(); IIF( .F., s_oClass:ModMethod( "AddImagesArticulos", @TComercio_AddImagesArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddImagesArticulos", @TComercio_AddImagesArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddImagesCategories(); IIF( .F., s_oClass:ModMethod( "AddImagesCategories", @TComercio_AddImagesCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddImagesCategories", @TComercio_AddImagesCategories(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendClientPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendClientPrestashop", @TComercio_AppendClientPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendClientPrestashop", @TComercio_AppendClientPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendPedidoprestashop(); IIF( .F., s_oClass:ModMethod( "AppendPedidoprestashop", @TComercio_AppendPedidoprestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendPedidoprestashop", @TComercio_AppendPedidoprestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EstadoPedidosPrestashop(); IIF( .F., s_oClass:ModMethod( "EstadoPedidosPrestashop", @TComercio_EstadoPedidosPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EstadoPedidosPrestashop", @TComercio_EstadoPedidosPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendClientesToPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendClientesToPrestashop", @TComercio_AppendClientesToPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendClientesToPrestashop", @TComercio_AppendClientesToPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendFabricantesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendFabricantesPrestashop", @TComercio_AppendFabricantesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendFabricantesPrestashop", @TComercio_AppendFabricantesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppFabricantesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppFabricantesPrestashop", @TComercio_AppFabricantesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppFabricantesPrestashop", @TComercio_AppFabricantesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppendPropiedadesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppendPropiedadesPrestashop", @TComercio_AppendPropiedadesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppendPropiedadesPrestashop", @TComercio_AppendPropiedadesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AppPropiedadesPrestashop(); IIF( .F., s_oClass:ModMethod( "AppPropiedadesPrestashop", @TComercio_AppPropiedadesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AppPropiedadesPrestashop", @TComercio_AppPropiedadesPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetColorDefault(); IIF( .F., s_oClass:ModMethod( "GetColorDefault", @TComercio_GetColorDefault(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetColorDefault", @TComercio_GetColorDefault(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetValPrp( nIdPrp, nProductAttibuteId); IIF( .F., s_oClass:ModMethod( "GetValPrp", @TComercio_GetValPrp(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GetValPrp", @TComercio_GetValPrp(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nDefImagen( cCodArt, cImagen); IIF( .F., s_oClass:ModMethod( "nDefImagen", @TComercio_nDefImagen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nDefImagen", @TComercio_nDefImagen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nCodigoWebImagen( cCodArt, cImagen); IIF( .F., s_oClass:ModMethod( "nCodigoWebImagen", @TComercio_nCodigoWebImagen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nCodigoWebImagen", @TComercio_nCodigoWebImagen(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lLimpiaRefImgWeb(); IIF( .F., s_oClass:ModMethod( "lLimpiaRefImgWeb", @TComercio_lLimpiaRefImgWeb(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lLimpiaRefImgWeb", @TComercio_lLimpiaRefImgWeb(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdFamiliasPrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdFamiliasPrestashop", @TComercio_DelIdFamiliasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdFamiliasPrestashop", @TComercio_DelIdFamiliasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdGrupoFamiliasPrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdGrupoFamiliasPrestashop", @TComercio_DelIdGrupoFamiliasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdGrupoFamiliasPrestashop", @TComercio_DelIdGrupoFamiliasPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdTipoArticuloPrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdTipoArticuloPrestashop", @TComercio_DelIdTipoArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdTipoArticuloPrestashop", @TComercio_DelIdTipoArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdArticuloPrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdArticuloPrestashop", @TComercio_DelIdArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdArticuloPrestashop", @TComercio_DelIdArticuloPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdFabricantePrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdFabricantePrestashop", @TComercio_DelIdFabricantePrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdFabricantePrestashop", @TComercio_DelIdFabricantePrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelIdIvaPrestashop(); IIF( .F., s_oClass:ModMethod( "DelIdIvaPrestashop", @TComercio_DelIdIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelIdIvaPrestashop", @TComercio_DelIdIvaPrestashop(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TComercio ;



UTILITY STATIC function TComercio_New( oMenuItem, oWnd) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   IIF( oMenuItem == nil, oMenuItem := "01108", ) ;

   ::nLevel                := nLevelUsr( oMenuItem )

   ::lSincAll              := .F.
   ::lArticulos            := .T.
   ::lFamilias             := .T.
   ::lPedidos              := .T.
   ::lFabricantes          := .T.
   ::lIva                  := .T.
   ::lCliente              := .T.
   ::aImages               := {}
   ::aImagesArticulos      := {}
   ::aImagesCategories     := {}
   ::aTipoImagesPrestashop := {}
   ::nTotMeter             := 0

   ::cHost                 := uFieldEmpresa( "cSitSql" )
   ::cUser                 := uFieldEmpresa( "cUsrSql" )
   ::cPasswd               := uFieldEmpresa( "cPswSql" )
   ::cDbName               := uFieldEmpresa( "cDtbSql" )
   ::nPort                 := uFieldEmpresa( "nPrtSql", 3306 )
   ::cDImagen              := uFieldEmpresa( "cdImagen" )
   ::cSeriePed             := uFieldEmpresa( "cSeriePed" )
   ::nSecondTimer          := uFieldEmpresa( "nTiempoPed", 0 ) * 60000
   ::cUserFtp              := uFieldEmpresa( "cUsrFtpImg" )
   ::cPasswdFtp            := uFieldEmpresa( "cPswFtpImg" )
   ::cHostFtp              := uFieldEmpresa( "cHostFtpImg" )
   ::nPortFtp              := uFieldEmpresa( "nPrtFtp", 21 )
   ::lPassiveFtp           := uFieldEmpresa( "lPasFtp" )
   ::nExportar             := 1
   ::Cookiekey             := uFieldEmpresa( "cCooKey" )

   if uFieldEmpresa( "nTipWeb" ) == 1
      ::cPlataforma        := "OsCommerce"
   else
      ::cPlataforma        := "Prestashop"
   end

RETURN ( Self )



UTILITY STATIC function TComercio_OpenFiles() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oBlock
   local oError
   local lOpen     := .T.





   oBlock         := ErrorBlock( { | oError | Break( oError ) } )
   BEGIN SEQUENCE

   ::oArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArt:AddBag( "ARTICULO.CDX" ) ; ::oArt:AddBag( ) ; ::oArt:AutoIndex()

   ::oPro := DbfServer( "PRO.DBF", ):NewOpen( "PRO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oPro:AddBag( "PRO.CDX" ) ; ::oPro:AddBag( ) ; ::oPro:AutoIndex()

   ::oTblPro := DbfServer( "TBLPRO.DBF", ):NewOpen( "TBLPRO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTblPro:AddBag( "TBLPRO.CDX" ) ; ::oTblPro:AddBag( ) ; ::oTblPro:AutoIndex()

   ::oArtDiv := DbfServer( "ARTDIV.DBF", ):NewOpen( "ARTDIV.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArtDiv:AddBag( "ARTDIV.CDX" ) ; ::oArtDiv:AddBag( ) ; ::oArtDiv:AutoIndex()

   ::oFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oFam:AddBag( "FAMILIAS.CDX" ) ; ::oFam:AddBag( ) ; ::oFam:AutoIndex()

   ::oGrpFam := DbfServer( "GRPFAM.DBF", ):NewOpen( "GRPFAM.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oGrpFam:AddBag( "GRPFAM.CDX" ) ; ::oGrpFam:AddBag( ) ; ::oGrpFam:AutoIndex()

   ::oTipArt := DbfServer( "TIPART.DBF", ):NewOpen( "TIPART.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTipArt:AddBag( "TIPART.CDX" ) ; ::oTipArt:AddBag( ) ; ::oTipArt:AutoIndex()

   ::oCli := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oCli:AddBag( "CLIENT.CDX" ) ; ::oCli:AddBag( ) ; ::oCli:AutoIndex()

   ::oObras := DbfServer( "OBRAST.DBF", ):NewOpen( "OBRAST.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oObras:AddBag( "OBRAST.CDX" ) ; ::oObras:AddBag( ) ; ::oObras:AutoIndex()

   ::oIva := DbfServer( "TIVA.DBF", ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oIva:AddBag( "TIVA.CDX" ) ; ::oIva:AddBag( ) ; ::oIva:AutoIndex()

   ::oDivisas := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDivisas:AddBag( "DIVISAS.CDX" ) ; ::oDivisas:AddBag( ) ; ::oDivisas:AutoIndex()

   ::oPedCliT := DbfServer( "PEDCLIT.DBF", ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliT:AddBag( "PEDCLIT.CDX" ) ; ::oPedCliT:AddBag( ) ; ::oPedCliT:AutoIndex()

   ::oPedCliI := DbfServer( "PEDCLII.DBF", ):NewOpen( "PEDCLII.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliI:AddBag( "PEDCLII.CDX" ) ; ::oPedCliI:AddBag( ) ; ::oPedCliI:AutoIndex()

   ::oPedCliL := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PEDCLIL.CDX" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()

   ::oCount := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oCount:AddBag( "NCOUNT.CDX" ) ; ::oCount:AddBag( ) ; ::oCount:AutoIndex()

   ::oFPago := DbfServer( "FPAGO.DBF", ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFPago:AddBag( "FPAGO.CDX" ) ; ::oFPago:AddBag( ) ; ::oFPago:AutoIndex()

   ::oFab := DbfServer( "FABRICANTES.DBF", ):NewOpen( "FABRICANTES.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oFab:AddBag( "FABRICANTES.CDX" ) ; ::oFab:AddBag( ) ; ::oFab:AutoIndex()

   ::oKit := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oKit:AddBag( "ARTKIT.Cdx" ) ; ::oKit:AddBag( ) ; ::oKit:AutoIndex()

   ::oAlbCliT := DbfServer( "ALBCLIT.DBF", ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliT:AddBag( "ALBCLIT.CDX" ) ; ::oAlbCliT:AddBag( ) ; ::oAlbCliT:AutoIndex()

   ::oAlbCliL := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "ALBCLIL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()

   ::oFacCliL := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FACCLIL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()

   ::oFacRecL := DbfServer( "FACRECL.DBF", ):NewOpen( "FACRECL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FACRECL.CDX" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()

   ::oTikCliL := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TIKEL.CDX" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()

   ::oProLin := DbfServer( "PROLIN.DBF", ):NewOpen( "PROLIN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProLin:AddBag( "PROLIN.CDX" ) ; ::oProLin:AddBag( ) ; ::oProLin:AutoIndex()

   ::oProMat := DbfServer( "PROMAT.DBF", ):NewOpen( "PROMAT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oProMat:AddBag( "PROMAT.CDX" ) ; ::oProMat:AddBag( ) ; ::oProMat:AutoIndex()

   ::oHisMov := DbfServer( "HISMOV.DBF", ):NewOpen( "HISMOV.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oHisMov:AddBag( "HISMOV.CDX" ) ; ::oHisMov:AddBag( ) ; ::oHisMov:AutoIndex()

   ::oPedPrvL := DbfServer( "PEDPROVL.DBF", ):NewOpen( "PEDPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvL:AddBag( "PEDPROVL.CDX" ) ; ::oPedPrvL:AddBag( ) ; ::oPedPrvL:AutoIndex()

   ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()

   ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()

   ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()

   ::oRctPrvL := DbfServer( "RCTPRVL.DBF", ):NewOpen( "RCTPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRctPrvL:AddBag( "RCTPRVL.CDX" ) ; ::oRctPrvL:AddBag( ) ; ::oRctPrvL:AutoIndex()

   ::oArtImg := DbfServer( "ARTIMG.DBF", ):NewOpen( "ARTIMG.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArtImg:AddBag( "ARTIMG.CDX" ) ; ::oArtImg:AddBag( ) ; ::oArtImg:AutoIndex()

   ::oStock                := TStock():Create( cPatGrp() )

   if !::oStock:lOpenFiles()

      lOpen                := .F.

   else

      ::oStock:cKit        := ::oKit:cAlias
      ::oStock:cPedCliL    := ::oPedCliL:cAlias
      ::oStock:cAlbCliT    := ::oAlbCliT:cAlias
      ::oStock:cAlbCliL    := ::oAlbCliL:cAlias
      ::oStock:cFacCliL    := ::oFacCliL:cAlias
      ::oStock:cFacRecL    := ::oFacRecL:cAlias
      ::oStock:cTikL       := ::oTikCliL:cAlias
      ::oStock:cProducL    := ::oProLin:cAlias
      ::oStock:cProducM    := ::oProMat:cAlias
      ::oStock:cHisMov     := ::oHisMov:cAlias
      ::oStock:cPedPrvL    := ::oPedPrvL:cAlias
      ::oStock:cAlbPrvT    := ::oAlbPrvT:cAlias
      ::oStock:cAlbPrvL    := ::oAlbPrvL:cAlias
      ::oStock:cFacPrvL    := ::oFacPrvL:cAlias
      ::oStock:cRctPrvL    := ::oRctPrvL:cAlias

   end

   RECOVER USING oError

      lOpen                := .F.

      msgStop( "Imposible abrir todas las bases de datos" )
      ::CloseFiles()

   end

   ErrorBlock( oBlock )

RETURN ( lOpen )



UTILITY STATIC function TComercio_CloseFiles() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if !Empty( ::oArt ) .AND. ::oArt:Used()
      ::oArt:End()
   end

   if !Empty( ::oPro ) .AND. ::oPro:Used()
      ::oPro:End()
   end

   if !Empty( ::oTblPro ) .AND. ::oTblPro:Used()
      ::oTblPro:End()
   end

   if !Empty( ::oFam ) .AND. ::oFam:Used()
      ::oFam:End()
   end

   if !Empty( ::oGrpFam ) .AND. ::oGrpFam:Used()
      ::oGrpFam:End()
   end

   if !Empty( ::oTipArt ) .AND. ::oTipArt:Used()
      ::oTipArt:End()
   end

   if !Empty( ::oCli ) .AND. ::oCli:Used()
      ::oCli:End()
   end

   if !Empty( ::oFPago ) .AND. ::oFPago:Used()
      ::oFPago:End()
   end

   if !Empty( ::oObras ) .AND. ::oObras:Used()
      ::oObras:End()
   end

   if !Empty( ::oArtDiv ) .AND. ::oArtDiv:Used()
      ::oArtDiv:End()
   end

   if !Empty( ::oIva ) .AND. ::oIva:Used()
      ::oIva:End()
   end

   if !Empty( ::oDivisas ) .AND. ::oDivisas:Used()
      ::oDivisas:End()
   end

   if !Empty( ::oPedCliT ) .AND. ::oPedCliT:Used()
      ::oPedCliT:End()
   end

   if !Empty( ::oPedCliI ) .AND. ::oPedCliI:Used()
      ::oPedCliI:End()
   end

   if !Empty( ::oPedCliL ) .AND. ::oPedCliL:Used()
      ::oPedCliL:End()
   end

  if !Empty( ::oCount ) .AND. ::oCount:Used()
      ::oCount:End()
   end

   if !Empty( ::oFab ) .AND. ::oFab:Used()
      ::oFab:End()
   end

   if !Empty( ::oKit ) .AND. ::oKit:Used()
      ::oKit:End()
   end

   if !Empty( ::oAlbCliT ) .AND. ::oAlbCliT:Used()
      ::oAlbCliT:End()
   end

   if !Empty( ::oAlbCliL ) .AND. ::oAlbCliL:Used()
      ::oAlbCliL:End()
   end

   if !Empty( ::oFacCliL ) .AND. ::oFacCliL:Used()
      ::oFacCliL:End()
   end

   if !Empty( ::oFacRecL ) .AND. ::oFacRecL:Used()
      ::oFacRecL:End()
   end

   if !Empty( ::oTikCliL ) .AND. ::oTikCliL:Used()
      ::oTikCliL:End()
   end

   if !Empty( ::oProLin ) .AND. ::oProLin:Used()
      ::oProLin:End()
   end

   if !Empty( ::oProMat ) .AND. ::oProMat:Used()
      ::oProMat:End()
   end

   if !Empty( ::oHisMov ) .AND. ::oHisMov:Used()
      ::oHisMov:End()
   end

   if !Empty( ::oPedPrvL ) .AND. ::oPedPrvL:Used()
      ::oPedPrvL:End()
   end

   if !Empty( ::oAlbPrvT ) .AND. ::oAlbPrvT:Used()
      ::oAlbPrvT:End()
   end

   if !Empty( ::oAlbPrvL ) .AND. ::oAlbPrvL:Used()
      ::oAlbPrvL:End()
   end

   if !Empty( ::oFacPrvL ) .AND. ::oFacPrvL:Used()
      ::oFacPrvL:End()
   end

   if !Empty( ::oRctPrvL ) .AND. ::oRctPrvL:Used()
      ::oRctPrvL:End()
   end

   if !Empty( ::oArtImg ) .AND. ::oArtImg:Used()
      ::oArtImg:End()
   end

   ::oArt      := nil
   ::oPro      := nil
   ::oTblPro   := nil
   ::oFPago    := nil
   ::oFam      := nil
   ::oGrpFam   := nil
   ::oCli      := nil
   ::oObras    := nil
   ::oPedCliT  := nil
   ::oPedCliI  := nil
   ::oPedCliL  := nil
   ::oCount    := nil
   ::oFab      := nil
   ::oIva      := nil
   ::oDivisas  := nil
   ::oTipArt   := nil
   ::oKit      := nil
   ::oAlbCliT  := nil
   ::oAlbCliL  := nil
   ::oFacCliL  := nil
   ::oFacRecL  := nil
   ::oTikCliL  := nil
   ::oProLin   := nil
   ::oProMat   := nil
   ::oHisMov   := nil
   ::oPedPrvL  := nil
   ::oAlbPrvT  := nil
   ::oAlbPrvL  := nil
   ::oFacPrvL  := nil
   ::oRctPrvL  := nil
   ::oArtImg   := nil

RETURN ( Self )



UTILITY STATIC function TComercio_Activate( oWnd) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   IIF( oWnd == nil, oWnd := oWnd(), ) ;

   if nAnd( ::nLevel, 1 ) <> 0
      msgStop( "Acceso no permitido." )
      return ( Self )
   end

   CursorWait()

   if oWnd <> nil
      SysRefresh(); oWnd:CloseAll(); SysRefresh()
   end





   ::oDlg = TDialog():New(,,,,, "Comercio_0",, .F.,,,,,, .F.,,,,,, .F., )





      ::oBmp := TBitmap():ReDefine( 500, "earth2_alpha_48",, ::oDlg,,, .F., .F.,,, .F.,,, .T. )




      ::oFld := TPages():Redefine( 10, ::oDlg, {"Comercio_1", "Comercio_2"},,,, )









      TSay():ReDefine( 220, {|| ::cPlataforma}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TSay():ReDefine( 100, {|| ::cHost}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TSay():ReDefine( 110, {|| ::nPort}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TSay():ReDefine( 120, {|| ::cUser}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TSay():ReDefine( 130, {|| ::cDbName}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      TRadMenu():Redefine( { | u | If( PCount()==0, ::nExportar, ::nExportar:= u ) }, ::oFld:aDialogs[ 1 ],, { 121, 122 },,,,, .F.,, )







      TCheckBox():ReDefine( 210, { | u | If( PCount()==0, ::lSincAll, ::lSincAll:= u ) }, ::oFld:aDialogs[ 1 ],, {|| ( ::ChangeSincAll() )},,,,, .F., {||      ( ::nExportar == 1 )}, .F. )




      ::oArticulos := TCheckBox():ReDefine( 140, { | u | If( PCount()==0, ::lArticulos, ::lArticulos:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )




       ::oFamilias := TCheckBox():ReDefine( 150, { | u | If( PCount()==0, ::lFamilias, ::lFamilias:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )




       ::oPedidos := TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::lPedidos, ::lPedidos:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )




       ::oFabricantes := TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::lFabricantes, ::lFabricantes:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )




       ::oTipIva := TCheckBox():ReDefine( 180, { | u | If( PCount()==0, ::lIva, ::lIva:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )




       ::oCliente := TCheckBox():ReDefine( 230, { | u | If( PCount()==0, ::lCliente, ::lCliente:= u ) }, ::oFld:aDialogs[ 1 ],,,,,,, .F., {||      ( ::nExportar == 1 .AND. !::lSincAll )}, .F. )



       TSay():ReDefine( 190, {|| ::cUserFtp}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )



       TSay():ReDefine( 200, {|| ::cDImagen}, ::oFld:aDialogs[ 1 ],,,, .F.,, .F., .F. )





      ::oTree        := TTreeView():Redefine( 100, ::oFld:aDialogs[ 2 ] )

      ::oText := TSay():ReDefine( 110, {|| ::cText}, ::oFld:aDialogs[ 2 ],,,, .F.,, .F., .F. )

      ::oMeter       := TMeter():ReDefine( 120, { | u | if( pCount() == 0, ::nActualMeter, ::nActualMeter := u ) }, 10, ::oFld:aDialogs[ 2 ], .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )

      ::oMeterL      := TMeter():ReDefine( 130, { | u | if( pCount() == 0, ::nActualMeterL, ::nActualMeterL := u ) }, 10, ::oFld:aDialogs[ 2 ], .F., , , .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )









      ::oBtnExportar := TButtonBmp():ReDefine( 220, {||( ::Sincronizar() )}, ::oDlg,,, .F.,,,, .F.,,, )



      ::oBtnCancel := TButton():ReDefine( 2, {||( ::oDlg:end() )}, ::oDlg,,, .F.,,,, .F. )

      ::oDlg:bStart  := {|| CursorWe() }

   ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )





   ::oBmp:End()

Return Nil



UTILITY STATIC function TComercio_Sincronizar() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if uFieldEmpresa( "nTipWeb" ) == 1

      if ::nExportar == 1
         ::Exportar()
      else
         ::Importar()
      end

   else

      ::aCategorias     := {}

      if ::nExportar == 1
         ::ExportarPrestashop()
      else
         ::ImportarPrestashop()
      end

   end

Return .T.



UTILITY STATIC function TComercio_AutoRecive( oWnd) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb

   if !Empty( oTimer )
      oTimer:DeActivate()
   end

   IIF( oWnd == nil, oWnd := oWnd(), ) ;

   if ::OpenFiles()

      ::SetText( "Intentando conectar con el servidor " + '"' + ::cHost + '"' + ", el usuario " + '"' + ::cUser + '"' + " y la base de datos " + '"' + ::cDbName + '".' , 1 )

      ::oCon            := TMSConnect():New()

      if !::oCon:Connect( ::cHost, ::cUser, ::cPasswd, ::cDbName, ::nPort )

          ::SetText( "No se ha podido conectar con la base de datos." )

      else

          ::SetText( "Se ha conectado con xito a la base de datos." , 1 )

          oDb           := TMSDataBase():New ( ::oCon, ::cDbName )

          if Empty( oDb )

             ::SetText( "La Base de datos: " + ::cDbName + " no est activa.", 1 )

          else

            ::AppendClient( oDb )
            ::AppendPedido( oDb )

          end

      end

      ::oCon:Destroy()

      ::SetText( "Base de datos desconectada.", 1 )

   else

      ::SetText( "Error al abrir los ficheros necesarios.", 1 )

   end





   lPedidosWeb( ::oPedCliT:cAlias )





   ::Closefiles()





   if !Empty( oTimer )
      oTimer:Activate()
   end

Return Nil



UTILITY STATIC function TComercio_Exportar() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb
   local oBlock
   local oError




   if !::lSincAll .OR. ( ::lSincAll .AND. ApoloMsgNoYes(  "Ha seleccionado un envio global de informacin hacia la web,"          + Chr(13)+Chr(10) +  "la operacin es muy delicada y conlleva vaciar las tablas de la web."  + Chr(13)+Chr(10) +  "Desea continuar?" ,"Seleccione una opcin" ) )

      if !Empty( ::oFld )
         ::oFld:SetOption( 2 )
      end

      ::oBtnExportar:Hide()

      ::oBtnCancel:Disable()




      if ::OpenFiles()

         ::SetText ( "Intentando conectar con el servidor " + '"' + ::cHost + '"' + ", el usuario " + '"' + ::cUser + '"' + " y la base de datos " + '"' + ::cDbName + '".' , 1 )

         ::oCon            := TMSConnect():New()

         if !::oCon:Connect( ::cHost, ::cUser, ::cPasswd, ::cDbName, ::nPort )

            ::SetText ( "No se ha podido conectar con la base de datos." )

         else

            ::SetText ( "Se ha conectado con xito a la base de datos." , 1 )

            oDb            := TMSDataBase():New ( ::oCon, ::cDbName )

            if Empty( oDb )

               ::SetText ( "La Base de datos: " + ::cDbName + " no esta activa.", 1 )

            else



               ::nLanguage    := ::GetLanguage( oDb )

               ::oMeter:SetTotal( 10 )
               ::nActualMeter := 1

               if ::lPedidos .OR. ::lSincAll

                  ::MeterGlobalText( "Descargando clientes" )
                  ::AppendClient( oDb )
                  sysRefresh()

                  ::MeterGlobalText( "Descargando pedidos" )
                  ::AppendPedido( oDb )
                  sysRefresh()

                  ::MeterGlobalText( "Actualizando estado de los pedidos" )
                  ::EstadoPedidos( oDb )
                  sysRefresh()

               end

               if ::lSincAll
                  ::MeterGlobalText( "Actualizando ciudades de OsCommerce" )
                  ::AppendZone( odb )
               end

               sysRefresh()
               if ::lIva .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando tipos de " + "IVA" )
                  ::AppendIva( odb )
                  sysRefresh()
               end

               if ::lFamilias .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando familias" )
                  ::AppendFamilia( odb )
                  sysRefresh()
               end

               if ::lFabricantes .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando fabricantes" )
                  ::AppendFabricantes( odb )
                  sysRefresh()
               end

               if ::lArticulos .OR. ::lSincAll

                  ::MeterGlobalText( "Actualizando propiedades de artculos" )
                  ::AppendPropiedades( odb )

                  ::MeterGlobalText( "Actualizando artculos" )
                  ::AppendArticulo( odb )
                  sysRefresh()

               end

               ::MeterGlobalText( "Subiendo imagenes" )

               ::AppendImages()

             end

         end

         ::oCon:Destroy()

         ::SetText( "Base de datos desconectada.", 1 )

         ::MeterGlobalText( "Proceso finalizado" )

      else

         ::SetText( "Error al abrir los ficheros necesarios.", 1 )

      end









      ::Closefiles()

      ::oBtnExportar:Hide()

      ::oBtnCancel:Enable()

   end

return( self )



UTILITY STATIC function TComercio_Importar() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb

   if !ApoloMsgNoYes( "Se va a iniciar el proceso de importacin desde OsCommerce, los datos de su equipo van a ser modificados." + Chr(13)+Chr(10) + Chr(13)+Chr(10) + "Desea continuar?", "Elija una opcin" )
      Return ( Self )
   end

   if !Empty( ::oFld )
      ::oFld:SetOption( 2 )
   end

   ::oBtnExportar:Disable()
   ::oBtnCancel:Disable()

   if ::OpenFiles()

      ::SetText ( "Intentando conectar con el servidor " + '"' + ::cHost + '"' + ", el usuario " + '"' + ::cUser + '"' + " y la base de datos " + '"' + ::cDbName + '".' , 1 )

      ::oCon            := TMSConnect():New()

      if !::oCon:Connect( ::cHost, ::cUser, ::cPasswd, ::cDbName, ::nPort )

          ::SetText ( "No se ha podido conectar con la base de datos." )

      else

           ::SetText ( "Se ha conectado con xito a la base de datos." , 1 )

          oDb := TMSDataBase():New ( ::oCon, ::cDbName )

          if Empty( oDb )

             ::SetText ( "La Base de datos: " + ::cDbName + " no esta activa.", 1 )

          else

            ::oMeter:SetTotal( 9 )
            ::nActualMeter := 1

            ::MeterGlobalText( "Descargando propiedades" )
            ::AppendPropiedades_bd( odb )
            sysRefresh()

            if ::lIva .OR. ::lSincAll
               ::MeterGlobalText( "Descargando tipos de " + "IVA" )
               ::AppendIva_bd( odb )
               sysRefresh()
            end

            if ::lFamilias .OR. ::lSincAll
               ::MeterGlobalText( "Descargando familias" )
               ::AppendFamilia_bd( odb )
               sysRefresh()
            end

            if ::lFabricantes .OR. ::lSincAll
               ::MeterGlobalText( "Descargando fabricantes" )
               ::AppendFabricantes_bd( odb )
               sysRefresh()
            end

            if ::lArticulos .OR. ::lSincAll
               ::MeterGlobalText( "Descargando artculos" )
               ::AppendArticulo_bd( odb )
               sysRefresh()
            end

            if ::lPedidos .OR. ::lSincAll
               ::MeterGlobalText( "Descargando clientes" )
               ::AppendClient( oDb )
               sysRefresh()

               ::MeterGlobalText( "Descargando pedidos" )
               ::AppendPedido( oDb )
               sysRefresh()

               ::MeterGlobalText( "Actualizando estados de pedidos" )
               ::EstadoPedidos( oDb )
               sysRefresh()
            end

            ::MeterGlobalText( "Descargando imagenes" )
            ::AppendImages_bd()

          end

      end

      ::oCon:Destroy()

      ::SetText( "Base de datos desconectada.", 1 )

   else

      ::SetText( "Error al abrir los ficheros necesarios.", 1 )

   end

   ::Closefiles()

   ::oBtnExportar:Enable()
   ::oBtnCancel:Enable()

return( self )



UTILITY STATIC function TComercio_SetText( cText, nLevel) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   IIF( nLevel == nil, nLevel := 2, ) ;

   if Empty( ::cFilTxt )
      ::cFilTxt      := cGetNewFileName( cPatLog() + "Com" + Dtos( Date() ) + StrTran( Time(), ":", "" ) ) + ".Txt"
      ::hFilTxt      := fCreate( ::cFilTxt )
   end

   if Empty( ::hFilTxt )
      ::hFilTxt      := fOpen( ::cFilTxt, 1 )
   endif





   do case
      case nLevel == 1
         fWrite( ::hFilTxt, cValToChar( cText ) + Chr(13)+Chr(10) )
      case nLevel == 2
         fWrite( ::hFilTxt, Space( 3 ) + cValToChar( cText ) + Chr(13)+Chr(10) )
      case nLevel == 3
         fWrite( ::hFilTxt, Space( 6 ) + cValToChar( cText ) + Chr(13)+Chr(10) )
   end

   if ::oTree <> nil
      do case
         case nLevel == 1
            ::oSubItem  := ::oTree:Add( cText )
            ::oTree:Select( ::oSubItem )
         case nLevel == 2
            ::oSubItem2 := ::oTree:Add( cText )
            ::oTree:Select( ::oSubItem2 )
            ::oTree:Expand()
         case nLevel == 3
            ::oTree:Select( ::oSubItem2:Add( cText ) )
            ::oSubItem2:Expand()
      end
   end

RETURN ( Self )



UTILITY STATIC function TComercio_MeterGlobalText( cText) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   IIF( cText == nil, cText := "", ) ;

   if !Empty( ::oText )
      ::oText:SetText( cText )
   end

   if !Empty( ::oMeter )
      ::oMeter:Set( ++::nActualMeter )
   end

RETURN ( Self )



UTILITY STATIC function TComercio_MeterParticularText( cText) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   IIF( cText == nil, cText := "", ) ;

   if !Empty( ::oText )
      ::oText:SetText( cText )
   end

   if !Empty( ::oMeterL )
      ::oMeterL:Set( ++::nActualMeterL )
   end

RETURN ( Self )



UTILITY STATIC function TComercio_AppendZone( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTablaGeoZone
   local oTablaZone





   if oDb:ExistTable( "zones_to_geo_zones" )  .AND. oDb:ExistTable( "geo_zones" )

      oTablaGeoZone        := TMSTable():New( oDb, "zones_to_geo_zones" )
      oTablaZone           := TMSTable():New( oDb, "geo_zones" )






      if oTablaGeoZone:Open() .AND. oTablaZone:Open()





         if ::lSincAll
            oTablaZone:oCmd:ExecDirect(      "TRUNCATE TABLE " + oTablaZone:cName )
            oTablaGeoZone:oCmd:ExecDirect(   "TRUNCATE TABLE " + oTablaGeoZone:cName )
            ::SetText ( "Tablas de zonas borradas corectamente ", 2  )
         end

         if oTablaZone:RecCount() > 0 .AND. !oTablaZone:Find( 2, "Spain" , .T. )
            ::appZone( oTablaZone, oTablaGeoZone )
         end

     else

         ::SetText ( "No se puede abrir las tablas de Zona ", 1  )

      end

      oTablaGeoZone:Free()
      oTablaZone:Free()

   else

      ::SetText( "No existe la tabla de Zona", 1 )

   end

Return( Self )



UTILITY STATIC function TComercio_AppendClient( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaClientes
   local oTablaClientesDirec
   local oTablaClientesInfo
   local oTablaZona
   local nCodigo

   ::nTotMeter    := 0








   if oDb:ExistTable( "customers" )  .AND. oDb:ExistTable( "address_book" ) .AND. oDb:ExistTable( "customers_info" ) .AND. oDb:ExistTable( "zones" )

      oTablaClientes           := TMSTable():New( oDb, "customers" )
      oTablaClientesDirec      := TMSTable():New( oDb, "address_book" )
      oTablaClientesInfo       := TMSTable():New( oDb, "customers_info" )
      oTablaZona               := TMSTable():New( oDb, "zones" )








      if oTablaClientes:Open()      .AND. oTablaClientesDirec:Open() .AND. oTablaClientesInfo:Open()  .AND. oTablaZona:Open()

         oTablaClientes:GoTop()
         oTablaClientesDirec:GoTop()
         oTablaClientesInfo:GoTop()
         oTablaZona:GoTop()

         ::SetText( "Actualizando clientes de la web", 2 )





         if oTablaClientes:RecCount() > 0

         for n := 1 to oTablaClientes:RecCount()

            oTablaClientes:Load()

            if ::oCli:SeekInOrd( upper( oTablaClientes:GetBuffer( 6 ) ) , "cMeiInt" )

               if !::oCli:lPubInt

                  nCodigo := oTablaClientes:GetBuffer( 1 )

                  ::SetText( "Borrado cliente "  + AllTrim( Str( oTablaClientes:GetBuffer( 1 ) ) ) + " de la tabla customers", 3 )

                  oTablaClientes:Delete()





                  if oTablaClientesDirec:RecCount() > 0 .AND. oTablaClientesDirec:Find( 2, nCodigo , .T. )

                     oTablaClientesDirec:Delete()

                  end

               end

            end

            oTablaClientes:Skip()

         next

         end





         ::SetText( "Subiendo clientes a la web", 2 )

         ::oCli:OrdSetFocus( "lSndEnviar" )
         ::oCli:GoTop()

         while !::oCli:Eof()

            if ::oCli:lPubInt .AND. ::oCli:lSndInt
               ::nTotMeter    += 1
            end

            ::oCli:Skip()

         end

         if !Empty( ::oMeterL )
            ::oMeterL:SetTotal( ::nTotMeter )
            ::nActualMeterL   := 1
         end





         ::oCli:GoTop()
         while !::oCli:Eof()

            if ::oCli:lPubInt .AND. ::oCli:lSndInt

               ::MeterParticularText( " Actualizando cliente " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

               ::AppCustomers( oTablaClientes, oTablaClientesDirec, oTablaClientesInfo, oTablaZona )

               ::oCli:Load()

               ::oCli:lSndInt  := .F.

               if !::oCli:Save()
                  ::SetText( "Error modificando estado de clientes", 3 )
               end

            end

            ::oCli:Skip()

         end

         ::oCli:OrdSetFocus( "Cod" )





         oTablaClientes:GoTop()
         oTablaClientesDirec:GoTop()

         ::AppCustomers_bd( oTablaClientes, oTablaClientesDirec, oTablaZona )

      else

         ::SetText ( "No se puede abrir las tablas de Clientes ", 1  )

      end

      oTablaClientes:Free()
      oTablaClientesDirec:Free()
      oTablaClientesInfo:Free()
      oTablaZona:Free()

   else

      ::SetText( "No existe la tabla de Clientes", 1 )

   end

Return (  Self )



UTILITY STATIC function TComercio_AppendPropiedades_bd( odb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaPropiedades
   local oTablaPropiedades_Lineas
   local oTablaRelaciones_Propiedades_Lineas







   if oDb:ExistTable( "products_options" )                              .AND. oDb:ExistTable( "products_options_values" )                       .AND. oDb:ExistTable( "products_options_values_to_products_options" )

      oTablaPropiedades                     := TMSTable():New( oDb, "products_options" )
      oTablaPropiedades_Lineas              := TMSTable():New( oDb, "products_options_values" )
      oTablaRelaciones_Propiedades_Lineas   := TMSTable():New( oDb, "products_options_values_to_products_options" )







      if oTablaPropiedades:Open()                  .AND. oTablaPropiedades_Lineas:Open()           .AND. oTablaRelaciones_Propiedades_Lineas:Open()

         oTablaPropiedades:GoTop()
         oTablaPropiedades_Lineas:GoTop()
         oTablaRelaciones_Propiedades_Lineas:GoTop()

         ::SetText ( "Tabla de propiedades: ", 2 )





         ::AppOptions_bd( oTablaPropiedades, oTablaPropiedades_Lineas, oTablaRelaciones_Propiedades_Lineas )

         sysRefresh()

      else

         ::SetText ( "No se puede abrir las tablas de propiedades", 1  )

      end

      oTablaPropiedades:Free()
      oTablaPropiedades_Lineas:Free()
      oTablaRelaciones_Propiedades_Lineas:Free()

   else

      ::SetText( "No existen las tablas de propiedades", 1 )

   end


Return(  Self )




UTILITY STATIC function TComercio_AppendPropiedades( odb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaPropiedades
   local oTablaPropiedades_Lineas
   local oTablaRelaciones_Propiedades_Lineas

   ::nTotMeter    := 0







   if oDb:ExistTable( "products_options" )                              .AND. oDb:ExistTable( "products_options_values" )                       .AND. oDb:ExistTable( "products_options_values_to_products_options" )

      oTablaPropiedades                     := TMSTable():New( oDb, "products_options" )
      oTablaPropiedades_Lineas              := TMSTable():New( oDb, "products_options_values" )
      oTablaRelaciones_Propiedades_Lineas   := TMSTable():New( oDb, "products_options_values_to_products_options" )







      if oTablaPropiedades:Open()                     .AND. oTablaPropiedades_Lineas:Open()              .AND. oTablaRelaciones_Propiedades_Lineas:Open()





         if ::lSincAll
            oTablaPropiedades:oCmd:ExecDirect(                    "TRUNCATE TABLE " + oTablaPropiedades:cName )
            oTablaPropiedades_Lineas:oCmd:ExecDirect(             "TRUNCATE TABLE " + oTablaPropiedades_Lineas:cName )
            oTablaRelaciones_Propiedades_Lineas:oCmd:ExecDirect(  "TRUNCATE TABLE " + oTablaRelaciones_Propiedades_Lineas:cName )
            ::SetText( "Tablas de propiedades borradas corectamente", 2  )
         end

         oTablaPropiedades:GoTop()
         oTablaPropiedades_Lineas:GoTop()
         oTablaRelaciones_Propiedades_Lineas:GoTop()

         ::SetText ( "Actualizando propiedades: ", 2 )





         if oTablaPropiedades:RecCount()> 0

            for n := 1 to oTablaPropiedades:RecCount()

               oTablaPropiedades:Load()

               if !::oPro:SeekInOrd( Str( oTablaPropiedades:GetBuffer( 1 ), 11 ), "cCodWeb" )

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaPropiedades:GetBuffer( 1 ) ) ) + " atributos", 3 )

                  oTablaPropiedades:Delete()

               end

               oTablaPropiedades:Skip()

            next

         end





         if oTablaPropiedades_Lineas:RecCount() > 0

            for n := 1 to oTablaPropiedades_Lineas:RecCount()

               oTablaPropiedades_Lineas:Load()

               if !::oTblPro:SeekInOrd( Str( oTablaPropiedades_Lineas:GetBuffer( 1 ), 11 ), "cCodWeb" )

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaPropiedades_Lineas:GetBuffer( 1 ) ) ) + " lineas de atributos", 3 )

                  oTablaPropiedades_Lineas:Delete()

               end

               oTablaPropiedades_Lineas:Skip()

            next

         end





         if oTablaRelaciones_Propiedades_Lineas:RecCount() > 0

            for n := 1 to oTablaRelaciones_Propiedades_Lineas:RecCount()

               oTablaRelaciones_Propiedades_Lineas:Load()

               if !::oPro:SeekInOrd( Str( oTablaRelaciones_Propiedades_Lineas:GetBuffer( 2 ), 11 ), "cCodWeb" )

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaRelaciones_Propiedades_Lineas:GetBuffer( 1 ) ) ) + " relaciones de atributos", 3 )

                   oTablaRelaciones_Propiedades_Lineas:Delete()

               end

               oTablaRelaciones_Propiedades_Lineas:Skip()

            next

         end





         ::oPro:GoTop()
         while !::oPro:Eof()

            if ( ::oPro:lPubInt ) .AND. ( ::oPro:lSndDoc .OR. ::lSincAll )

               ::nTotMeter          += 1

               ::oTblPro:GoTop()
               while !::oTblPro:Eof()

                  if ::oPro:cCodPro == ::oTblPro:cCodPro

                     ::nTotMeter    += 1

                  end

                  sysRefresh()

                  ::oTblPro:Skip()

               end

            end

         sysRefresh()

         ::oPro:Skip()

         end

         ::oMeterL:SetTotal( ::nTotMeter )

         ::nActualMeterL            := 1





         ::oPro:GoTop()
         while !::oPro:Eof()

            if ( ::oPro:lPubInt ) .AND. ( ::oPro:lSndDoc .OR. ::lSincAll )

               ::MeterParticularText( " Actualizando propiedades " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

               ::AppOptions( oTablaPropiedades )

               ::oTblPro:GoTop()
               while !::oTblPro:Eof()

                  if ::oPro:cCodPro == ::oTblPro:cCodPro

                     ::MeterParticularText( " Actualizando lineas de propiedades " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

                     ::AppOptions_Values( oTablaPropiedades_Lineas )

                     ::AppOptions_Relacion( oTablaRelaciones_Propiedades_Lineas )

                  end

                  sysRefresh()

                  ::oTblPro:Skip()

               end

            end

            ::oPro:Load()

            ::oPro:lSndDoc  := .F.

            if !::oPro:Save()
               ::SetText( "Error modificando estado de propiedades", 3 )
            end

            sysRefresh()

            ::oPro:Skip()

         end



      else

         ::SetText ( "No se puede abrir las tablas de propiedades", 1  )

      end

      oTablaPropiedades:Free()
      oTablaPropiedades_Lineas:Free()
      oTablaRelaciones_Propiedades_Lineas:Free()

   else

      ::SetText( "No existen las tablas de propiedades", 1 )

   end

Return(  Self )



UTILITY STATIC function TComercio_AppOptions_bd( oTablaPropiedades, oTablaPropiedades_Lineas, oTablaRelaciones_Propiedades_Lineas) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodWeb
   local cCodWebLin
   local cCodPro
   local cNombre
   local cNombreLineas
   local n
   local n2
   local n3

   ::nTotMeter                         := 0





   oTablaPropiedades:GoTop()
   oTablaPropiedades_Lineas:GoTop()
   oTablaRelaciones_Propiedades_Lineas:GoTop()

   if oTablaRelaciones_Propiedades_Lineas:RecCount() > 0

   for n := 1 to oTablaRelaciones_Propiedades_Lineas:RecCount()

      oTablaRelaciones_Propiedades_Lineas:Load()

      cCodWeb                          := oTablaRelaciones_Propiedades_Lineas:GetBuffer( 2 )
      cCodWebLin                       := oTablaRelaciones_Propiedades_Lineas:GetBuffer( 3 )





      if oTablaPropiedades:RecCount() > 0 .AND. oTablaPropiedades:Find( 1, cCodWeb, .T. )
         oTablaPropiedades:Load()

         if oTablaPropiedades:GetBuffer( 2 ) == ::nLanguage
            ::nTotMeter    += 1
         end

      end





      if oTablaPropiedades_Lineas:RecCount() > 0 .AND. oTablaPropiedades_Lineas:Find( 1, cCodWebLin, .T. )
         oTablaPropiedades_Lineas:Load()

         if oTablaPropiedades_Lineas:GetBuffer( 2 ) == ::nLanguage
            ::nTotMeter    += 1
         end

      end

      oTablaRelaciones_Propiedades_Lineas:skip()

   next

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL := 1





   oTablaPropiedades:GoTop()
   oTablaPropiedades_Lineas:GoTop()
   oTablaRelaciones_Propiedades_Lineas:GoTop()

   if oTablaRelaciones_Propiedades_Lineas:RecCount() > 0

   for n := 1 to oTablaRelaciones_Propiedades_Lineas:RecCount()

      oTablaRelaciones_Propiedades_Lineas:Load()

      cCodWeb                          := oTablaRelaciones_Propiedades_Lineas:GetBuffer( 2 )
      cCodWebLin                       := oTablaRelaciones_Propiedades_Lineas:GetBuffer( 3 )





      if oTablaPropiedades:RecCount() > 0 .AND. oTablaPropiedades:Find( 1, cCodWeb, .T. )
         oTablaPropiedades:Load()

         if oTablaPropiedades:GetBuffer( 2 ) == ::nLanguage

            cNombre                    := oTablaPropiedades:GetBuffer( 3 )
            ::MeterParticularText( " Descargando propiedades " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            if !::oPro:SeekInOrd( Str( cCodWeb, 11 ), "cCodWeb" )

               ::oPro:Append()

               cCodPro                 := RJust( NextVal( DbLast( ::oPro:cAlias , 1, nil, nil, 1 ) ), "0", 3 )

               ::oPro:cCodPro          := cCodPro
               ::oPro:cDesPro          := cNombre
               ::oPro:cCodWeb          := cCodWeb

               if ::oPro:save()
                  ::SetText( "Aadido propiedad " + Rtrim( cNombre ), 3 )
               else
                  ::SetText( "Error al aadir propiedad " + Rtrim( cNombre ), 3 )
               end

            else

               cCodPro                 := ::oPro:cCodPro

               ::oPro:Load()

               ::oPro:cDesPro          := cNombre
               ::oPro:cCodWeb          := cCodWeb

               if !::oPro:save()
                  ::SetText( "Error al modificar propiedad " + Rtrim( cNombre ), 3 )
               end

            end

         end

      end





      if oTablaPropiedades_Lineas:RecCount() > 0 .AND. oTablaPropiedades_Lineas:Find( 1, cCodWebLin, .T. )
         oTablaPropiedades_Lineas:Load()

         if oTablaPropiedades_Lineas:GetBuffer( 2 ) == ::nLanguage
            cNombre                    := oTablaPropiedades_Lineas:GetBuffer( 3 )

            if !::oTblPro:SeekInOrd( Str( cCodWebLin, 11 ), "cCodWeb" )

               ::oTblPro:Append()

               ::oTblPro:cCodPro       := cCodPro
               ::oTblPro:cCodTbl       := RJust( NextVal( DbLast( ::oTblPro:cAlias, 2, nil, nil, 1 ) ), "0", 3 )
               ::oTblPro:cDesTbl       := cNombre
               ::oTblPro:cCodWeb       := cCodWebLin

               if ::oTblPro:save()
                  ::SetText( "Aadido linea de propiedad " + Rtrim( cNombre ), 3 )
               else
                  ::SetText( "Error al aadir linea de propiedad " + Rtrim( cNombre ), 3 )
               end

            else

               ::oTblPro:Load()

               ::oTblPro:cCodPro       := cCodPro
               ::oTblPro:cDesTbl       := cNombre
               ::oTblPro:cCodWeb       := cCodWebLin

               if ::oTblPro:save()
                  ::SetText( "Modificando linea de propiedad " + Rtrim( cNombre ), 3 )
               else
                  ::SetText( "Error al modificar linea de propiedad " + Rtrim( cNombre ), 3 )
               end

            end

         end

      end

   oTablaRelaciones_Propiedades_Lineas:skip()

   next

   end

Return nil



UTILITY STATIC function TComercio_AppOptions( oTablaPropiedades) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb        := 0

   oTablaPropiedades:GoTop()

   if ::oPro:cCodWeb == 0 .OR. ::lSincAll





      nCodigoWeb           := ::AutoInt( oTablaPropiedades )

      oTablaPropiedades:Blank()
      oTablaPropiedades:FieldPut( 1, nCodigoWeb  )
      oTablaPropiedades:FieldPut( 2, ::nLanguage )
      oTablaPropiedades:FieldPut( 3, ::oCon:EscapeStr( ::GetPropArt() ) )

      if oTablaPropiedades:Insert()

         ::SetText( "Aadiendo propiedades " + Rtrim( ::oPro:cCodPro ) + Space( 1 ) + AllTrim( ::GetPropArt() ), 3 )

         ::oPro:fieldPutByName( "cCodWeb", nCodigoWeb )

      else
         ::SetText( "Error insertado" + Rtrim( ::oPro:cCodPro ) + Space( 1 ) + AllTrim( ::GetPropArt() ) + " en tabla products_option", 3 )

         return .F.

      end

   else





      if oTablaPropiedades:RecCount() > 0 .AND. oTablaPropiedades:Find( 1, ::oPro:cCodWeb, .T. )

         oTablaPropiedades:Load()

         oTablaPropiedades:FieldPut( 2, ::nLanguage )
         oTablaPropiedades:FieldPut( 3, ::oCon:EscapeStr( ::GetPropArt() ) )

         if oTablaPropiedades:update()
            ::SetText( "Modificando propiedad " + Rtrim( ::oPro:cCodPro ) + Space( 1 ) + AllTrim( ::GetPropArt() ), 3 )
         else
            ::SetText( "Error modificando" + Rtrim( ::oPro:cCodPro ) + Space( 1 ) + AllTrim( ::GetPropArt() ) + " en tabla propiedades", 3 )
         end

      end

   end

Return nCodigoWeb



UTILITY STATIC function TComercio_AppOptions_Values( oTablaPropiedades_Lineas) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb        := 0


   oTablaPropiedades_Lineas:GoTop()








   if !::lSincAll                                                 .AND.  ::oTblPro:cCodWeb <> 0                                      .AND.  oTablaPropiedades_Lineas:RecCount() > 0                     .AND.  oTablaPropiedades_Lineas:Find( 1, ::oTblPro:cCodWeb, .T. )

      oTablaPropiedades_Lineas:Load()

      oTablaPropiedades_Lineas:FieldPut( 2, ::nLanguage )
      oTablaPropiedades_Lineas:FieldPut( 3, ::oCon:EscapeStr( ::oTblPro:cDesTbl ) )

      if oTablaPropiedades_Lineas:Update()
         ::SetText( "Modificando lineas de propiedades " + Rtrim( ::oTblPro:cCodTbl ) + Space( 1 ) + AllTrim( ::oTblPro:cDesTbl ), 3 )
      else
         ::SetText( "Error modificando lineas de propiedades" + Rtrim( ::oTblPro:cCodTbl ) + Space( 1 ) + AllTrim( ::oTblPro:cDesTbl ) + " en tabla lineas de propiedades", 3 )
      end

   else

      nCodigoWeb           := ::AutoInt( oTablaPropiedades_Lineas )

      oTablaPropiedades_Lineas:Blank()
      oTablaPropiedades_Lineas:FieldPut( 1, nCodigoWeb )
      oTablaPropiedades_Lineas:FieldPut( 2, ::nLanguage )
      oTablaPropiedades_Lineas:FieldPut( 3, ::oCon:EscapeStr( ::oTblPro:cDesTbl ) )

      if oTablaPropiedades_Lineas:Insert()

         ::SetText( "Aadiendo linea de propiedades " + Rtrim( ::oTblPro:cCodTbl ) + Space( 1 ) + AllTrim( ::oTblPro:cDesTbl ), 3 )

         ::oTblPro:fieldPutByName( "cCodWeb", nCodigoWeb )

      else

         ::SetText( "Error insertado" + Rtrim( ::oTblPro:cCodTbl ) + Space( 1 ) + AllTrim( ::oTblPro:cDesTbl ) + " en tabla products_option_values", 3 )

         return .F.

      end

   end

Return nCodigoWeb



UTILITY STATIC function TComercio_AppOptions_Relacion( oTablaRelaciones_Propiedades_Lineas) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local cCodPro

   oTablaRelaciones_Propiedades_Lineas:GoTop()

   cCodPro   := oRetFld( ::oTblPro:cCodPro, ::oPro, "cCodWeb" )



   if oTablaRelaciones_Propiedades_Lineas:RecCount() <= 0                     .OR. !oTablaRelaciones_Propiedades_Lineas:Find( 2, cCodPro, .T. )            .OR. !oTablaRelaciones_Propiedades_Lineas:Find( 3, ::oTblPro:cCodWeb , .T. )

      oTablaRelaciones_Propiedades_Lineas:Blank()

      oTablaRelaciones_Propiedades_Lineas:FieldPut( 2, cCodPro )
      oTablaRelaciones_Propiedades_Lineas:FieldPut( 3, ::oTblPro:cCodWeb )

      if !oTablaRelaciones_Propiedades_Lineas:Insert()
         ::SetText( "Error estableciendo la relacin en propiedades " + Rtrim( cCodPro ), 3 )
      else
         ::SetText( "Establecioendo la relacin de propiedades " + Rtrim( ::oPro:cDesPro ) + " con " + Rtrim( ::oTblPro:cDesTbl ), 3 )
      end

   end

Return( nil )



UTILITY STATIC function TComercio_AppendArticulo_bd( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaArticulos
   local oTablaDescripciones
   local oTablaRelaciones
   local oTablaArticulos_Atributos
   local oTablaArticulos_Images
   local uResult








   if oDb:ExistTable( "products" ).AND. oDb:ExistTable( "products_description" ).AND. oDb:ExistTable( "products_to_categories" ).AND. oDb:ExistTable( "products_attributes" )

      oTablaArticulos            := TMSTable():New( oDb, "products" )
      oTablaDescripciones        := TMSTable():New( oDb, "products_description" )
      oTablaRelaciones           := TMSTable():New( oDb, "products_to_categories" )
      oTablaArticulos_Atributos  := TMSTable():New( oDb, "products_attributes" )
      if oDb:ExistTable( "products_images" )
         oTablaArticulos_Images  := TMSTable():New( oDb, "products_images" )
      end








      if oTablaArticulos:Open()           .AND. oTablaDescripciones:Open()       .AND. oTablaRelaciones:Open()          .AND. oTablaArticulos_Atributos:Open()

         if oTablaArticulos_Images        <> nil
            oTablaArticulos_Images:Open()
         end





         ::SetText( "Tabla de artculos ", 2 )

         ::AppProducts_bd( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos )

      end

      oTablaArticulos:Free()
      oTablaDescripciones:Free()
      oTablaRelaciones:Free()
      oTablaArticulos_Atributos:Free()
      if oTablaArticulos_Images        <> nil
         oTablaArticulos_Images:Free()
      end

   else

      ::SetText( "No existe la tabla de artculos", 1 )

   end

Return( Self )



UTILITY STATIC function TComercio_AppProducts_bd( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodWeb
   local nPrecio
   local cImagen
   local cNombre        := ""
   local cCodigoFamilia
   local cCodPro1       := ""
   local cCodPro2       := ""
   local n
   local n2
   local cCodIva
   local cCodFab
   local nPeso

   ::nTotMeter          := 0





   oTablaArticulos:GoTop()

   if oTablaArticulos:RecCount() > 0

      for n := 1 to oTablaArticulos:RecCount()

         ::nTotMeter       += 1

         oTablaArticulos:skip()

      next

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL      := 1





   oTablaArticulos:GoTop()

   if oTablaArticulos:RecCount() > 0

   for n := 1 to oTablaArticulos:RecCount()

      cCodPro1    := ""
      cCodPro2    := ""

      oTablaArticulos:Load()

      cCodWeb     := oTablaArticulos:GetBuffer( 1 )
      cImagen     := oTablaArticulos:GetBuffer( 4 )
      nPrecio     := oTablaArticulos:GetBuffer( 5 )
      nPeso       := oTablaArticulos:GetBuffer( 9 )
      cCodIva     := oTablaArticulos:GetBuffer( 11 )
      cCodFab     := oTablaArticulos:GetBuffer( 12 )





      oTablaDescripciones:GoTop()

      if oTablaDescripciones:RecCount() > 0 .AND. oTablaDescripciones:Find( 1 , cCodWeb , .T. )

         oTablaDescripciones:Load()

         if oTablaDescripciones:GetBuffer( 2 ) == ::nLanguage
            cNombre  := oTablaDescripciones:GetBuffer( 3 )
         end

      end





      oTablaArticulos_Atributos:GoTop()

      for n2 := 1 to oTablaArticulos_Atributos:RecCount()

      oTablaArticulos_Atributos:Load()

         if oTablaArticulos_Atributos:GetBuffer( 2 ) == cCodWeb

            if Empty( cCodPro1 )

               cCodPro1         := oTablaArticulos_Atributos:GetBuffer( 3 )

            end

            if !Empty( cCodPro1 ) .AND. ( cCodPro1 <> oTablaArticulos_Atributos:GetBuffer( 3 ) )

               cCodPro2         := oTablaArticulos_Atributos:GetBuffer( 3 )

            end

         end

      oTablaArticulos_Atributos:skip()
      next





      oTablaRelaciones:GoTop()

      if oTablaRelaciones:Find( 1, cCodWeb , .T. )
         oTablaRelaciones:Load()
            cCodigoFamilia     := oTablaRelaciones:GetBuffer( 2 )
      end

      ::MeterParticularText( " Descargando artculo " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

      if !::oArt:SeekInOrd( Str( cCodWeb, 11 ), "cCodWeb" )

         ::oArt:Append()

         ::oArt:Codigo              := RJust( NextVal( DbLast( ::oArt:cAlias , 1, nil, nil, 1 ) ), "0", 4 )
         ::oArt:Nombre              := cNombre
         ::oArt:pVenta1             := nPrecio
         ::oArt:cCodWeb             := cCodWeb
         ::oArt:Familia             := BuscarCodFam( cCodigoFamilia, ::oFam )
         ::oArt:lIvaInc             := .T.
         ::oArt:TipoIva             := BuscarCodIva( cCodIva, ::oIva )
         ::oArt:nPesoKg             := nPeso
         ::oArt:cCodFab             := BuscarCodFab( cCodFab, ::oFab )
         ::oArt:lPubInt             := .T.
         ::oArt:cCodPrp1            := BuscarCodPro( cCodPro1, ::oPro )
         ::oArt:cCodPrp2            := BuscarCodPro( cCodPro2, ::oPro )
         ::oArt:cImagenWeb          := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )

         if ::oArt:save()
            ::SetText( "Aadido artculo " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else
            ::SetText( "Error al aadir artculo " + Rtrim( cNombre ), 3 )
         end

      else

         ::oArt:Load()

         ::oArt:Nombre              := cNombre
         ::oArt:pVenta1             := nPrecio
         ::oArt:cCodWeb             := cCodWeb
         ::oArt:Familia             := BuscarCodFam( cCodigoFamilia, ::oFam )
         ::oArt:lIvaInc             := .T.
         ::oArt:TipoIva             := BuscarCodIva( cCodIva, ::oIva )
         ::oArt:nPesoKg             := nPeso
         ::oArt:cCodFab             := BuscarCodFab( cCodFab, ::oFab )
         ::oArt:lPubInt             := .T.
         ::oArt:cCodPrp1            := BuscarCodPro( cCodPro1, ::oPro )
         ::oArt:cCodPrp2            := BuscarCodPro( cCodPro2, ::oPro )
         ::oArt:cImagenWeb          := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )

         if ::oArt:save()

            ::SetText( "Modificando artculo " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else

            ::SetText( "Error al modificar artculo " + Rtrim( cNombre ), 3 )

         end

      end

   oTablaArticulos:skip()

   next

   end

Return( nil )



UTILITY STATIC function TComercio_AppendArticulo( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaArticulos
   local oTablaDescripciones
   local oTablaRelaciones
   local oTablaArticulos_Atributos
   local oTablaArticulos_Images
   local oTablaOfertas
   local uResult

   ::nTotMeter    := 0









   if oDb:ExistTable( "products" ).AND. oDb:ExistTable( "products_description" ).AND. oDb:ExistTable( "products_to_categories" ).AND. oDb:ExistTable( "products_attributes" ).AND. oDb:ExistTable( "specials" )

      oTablaArticulos            := TMSTable():New( oDb, "products" )
      oTablaDescripciones        := TMSTable():New( oDb, "products_description" )
      oTablaRelaciones           := TMSTable():New( oDb, "products_to_categories" )
      oTablaArticulos_Atributos  := TMSTable():New( oDb, "products_attributes" )
      oTablaOfertas              := TMSTable():New( oDb, "specials" )

      if oDb:ExistTable( "products_images" )
         oTablaArticulos_Images  := TMSTable():New( oDb, "products_images" )
      end









      if oTablaArticulos:Open()           .AND. oTablaDescripciones:Open()       .AND. oTablaRelaciones:Open()          .AND. oTablaArticulos_Atributos:Open() .AND. oTablaOfertas:Open()

         if oTablaArticulos_Images        <> nil
            oTablaArticulos_Images:Open()
         end






         if ::lSincAll
            oTablaArticulos:oCmd:ExecDirect(             "TRUNCATE TABLE " + oTablaArticulos:cName )
            oTablaDescripciones:oCmd:ExecDirect(         "TRUNCATE TABLE " + oTablaDescripciones:cName )
            oTablaRelaciones:oCmd:ExecDirect(            "TRUNCATE TABLE " + oTablaRelaciones:cName )
            oTablaArticulos_Atributos:oCmd:ExecDirect(   "TRUNCATE TABLE " + oTablaArticulos_Atributos:cName )
            oTablaOfertas:oCmd:ExecDirect(               "TRUNCATE TABLE " + oTablaOfertas:cName )

            if oTablaArticulos_Images    <> nil
               oTablaArticulos_Images:oCmd:ExecDirect(   "TRUNCATE TABLE " + oTablaArticulos_Images:cName )
            end


            ::SetText ( "Tablas de artculos borradas corectamente ", 2  )
         end

         oTablaArticulos:GoTop()
         oTablaDescripciones:GoTop()
         oTablaRelaciones:GoTop()
         oTablaArticulos_Atributos:GoTop()
         oTablaOfertas:GoTop()

         if oTablaArticulos_Images        <> nil
            oTablaArticulos_Images:GoTop()
         end


         ::SetText ( "Actualizando artculos de la web: ", 2 )





         if oTablaArticulos:RecCount() > 0

         for n := 1 to oTablaArticulos:RecCount()

            oTablaArticulos:Load()

            if ::oArt:SeekInOrd( Str( oTablaArticulos:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oArt:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos:GetBuffer( 1 ) ) ) + " de la tabla products", 3 )

                  oTablaArticulos:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos:GetBuffer( 1 ) ) ) + " de la tabla products", 3 )

               oTablaArticulos:Delete()

            end

            oTablaArticulos:Skip()

         next

         end





         for n := 1 to oTablaDescripciones:RecCount()

         oTablaDescripciones:Load()

            if ::oArt:SeekInOrd( Str( oTablaDescripciones:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oArt:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaDescripciones:GetBuffer( 1 ) ) ) + " de la tabla products_description", 3 )

                  oTablaDescripciones:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaDescripciones:GetBuffer( 1 ) ) ) + " de la tabla products_description", 3 )

               oTablaDescripciones:Delete()

            end

            oTablaDescripciones:Skip()

         next





         for n := 1 to oTablaRelaciones:RecCount()

            oTablaRelaciones:Load()

            if ::oArt:SeekInOrd( Str( oTablaRelaciones:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oArt:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaRelaciones:GetBuffer( 1 ) ) ) + " de la tabla products_to_categories", 3 )

                  oTablaRelaciones:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaRelaciones:GetBuffer( 1 ) ) ) + " de la tabla products_to_categories", 3 )
               oTablaRelaciones:Delete()

            end

            oTablaRelaciones:Skip()

         next




         if oTablaArticulos_Images        <> nil

            for n := 1 to oTablaArticulos_Images:RecCount()

               oTablaArticulos_Images:Load()

               if ::oArt:SeekInOrd( Str( oTablaArticulos_Images:GetBuffer( 2 ), 11 ), "cCodWeb" )

                  if !::oArt:lPubInt

                      ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos_Images:GetBuffer( 2 ) ) ) + " de la tabla products_images", 3 )

                      oTablaArticulos_Images:Delete()

                  end

               else

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos_Images:GetBuffer( 2 ) ) ) + " de la tabla products_images", 3 )
                  oTablaArticulos_Images:Delete()

               end

               oTablaArticulos_Images:Skip()

            next

         end





         for n := 1 to oTablaOfertas:RecCount()

            oTablaOfertas:Load()

            if ::oArt:SeekInOrd( Str( oTablaOfertas:GetBuffer( 2 ), 11 ), "cCodWeb" )

               if !::oArt:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaOfertas:GetBuffer( 2 ) ) ) + " de la tabla specials", 3 )

                  oTablaOfertas:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaOfertas:GetBuffer( 2 ) ) ) + " de la tabla specials", 3 )
               oTablaOfertas:Delete()

            end

            oTablaOfertas:Skip()

         next





         ::oArt:GoTop()
         while !::oArt:Eof()

            if ::oArt:lPubInt .AND. ( ::oArt:lSndDoc .OR. ::lSincAll )
               ::nTotMeter    += 1
            end

            sysRefresh()

         ::oArt:Skip()

         end

         ::oMeterL:SetTotal( ::nTotMeter )
         ::nActualMeterL := 1





         ::oArt:GoTop()
         while !::oArt:Eof()

            if ::oArt:lPubInt .AND. ( ::oArt:lSndDoc .OR. ::lSincAll )

               ::MeterParticularText( " Actualizando artculo " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

               ::AppProducts( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos, oTablaArticulos_Images, oTablaOfertas, oDb )

               ::oArt:fieldPutByName( "lSndDoc", .F. )

            end

            sysRefresh()

         ::oArt:Skip()

         end

      else

         ::SetText ( "No se puede abrir las tablas de artculos", 1  )

      end

      oTablaArticulos:Free()
      oTablaDescripciones:Free()
      oTablaRelaciones:Free()
      oTablaArticulos_Atributos:Free()
      oTablaOfertas:Free()

      if oTablaArticulos_Images        <> nil
         oTablaArticulos_Images:Free()
      end

   else

      ::SetText( "No existe la tabla de artculos", 1 )

   end


Return(  Self )



UTILITY STATIC function TComercio_AppProducts( oTablaArticulos, oTablaDescripciones, oTablaRelaciones, oTablaArticulos_Atributos, oTablaArticulos_Images, oTablaOfertas, oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local o
   local n                 := 0
   local nIva              := 0
   local id_iva            := 0
   local cCodFab           := 0
   local nPrecio           := 0
   local nPrecioOferta     := 0
   local aStock            := {}
   local nStock            := 0
   local nCodigoWeb        := 0
   local nPrecioDef        := 0
   local nPrecioWeb        := 0

   oTablaArticulos:GoTop()
   oTablaDescripciones:GoTop()
   oTablaRelaciones:GoTop()
   oTablaArticulos_Atributos:GoTop()
   if oTablaArticulos_Images        <> nil
      oTablaArticulos_Images:Gotop()
   end
   oTablaOfertas:GoTop()

   nPrecioDef              := uFieldEmpresa( "nPreWebVta" )

   nIva                    := ( 1 + nIva( ::oIva, ::oArt:TipoIva ) / 100 )

   do case





      case nPrecioDef <= 1 .AND. !::oArt:lIvaInc

         nPrecio              := ::oArt:pVenta1

         if ::oArt:nImpInt1 <> 0
            nPrecioOferta     := ::oArt:nImpInt1
         end

      case nPrecioDef <= 1 .AND. ::oArt:lIvaInc

         nPrecio              := Round( ::oArt:pVtaIva1 / nIva, nDwbDiv() )

         if ::oArt:nImpIva1 <> 0
            nPrecioOferta     := Round( ::oArt:nImpIva1 / nIva, nDwbDiv() )
         end





      case nPrecioDef == 2 .AND. !::oArt:lIvaInc

         nPrecio             := ::oArt:pVenta2

         if ::oArt:nImpInt2 <> 0
            nPrecioOferta    := ::oArt:nImpInt2
         end

      case nPrecioDef == 2 .AND. ::oArt:lIvaInc

         nPrecio             := Round( ::oArt:pVtaIva2 / nIva, nDwbDiv() )

         if ::oArt:nImpIva2 <> 0
            nPrecioOferta    := Round( ::oArt:nImpIva2 / nIva, nDwbDiv() )
         end





      case nPrecioDef == 3 .AND. !::oArt:lIvaInc

         nPrecio             := ::oArt:pVenta3

         if ::oArt:nImpInt2 <> 0
            nPrecioOferta    := ::oArt:nImpInt3
         end

      case nPrecioDef == 3 .AND. ::oArt:lIvaInc

         nPrecio             := Round( ::oArt:pVtaIva3 / nIva, nDwbDiv() )

         if ::oArt:nImpIva2 <> 0
            nPrecioOferta    := Round( ::oArt:nImpIva3 / nIva, nDwbDiv() )
         end





      case nPrecioDef == 4 .AND. !::oArt:lIvaInc

         nPrecio             := ::oArt:pVenta4

         if ::oArt:nImpInt4 <> 0
            nPrecioOferta    := ::oArt:nImpInt4
         end

      case nPrecioDef == 4 .AND. ::oArt:lIvaInc

         nPrecio             := Round( ::oArt:pVtaIva4 / nIva, nDwbDiv() )

         if ::oArt:nImpIva4 <> 0
            nPrecioOferta    := Round( ::oArt:nImpIva4 / nIva, nDwbDiv() )
         end






      case nPrecioDef == 5 .AND. !::oArt:lIvaInc

         nPrecio             := ::oArt:pVenta5

         if ::oArt:nImpInt5 <> 0
            nPrecioOferta    := ::oArt:nImpInt5
         end

      case nPrecioDef == 5 .AND. ::oArt:lIvaInc

         nPrecio             := Round( ::oArt:pVtaIva5 / nIva, nDwbDiv() )

         if ::oArt:nImpIva5 <> 0
            nPrecioOferta    := Round( ::oArt:nImpIva5 / nIva, nDwbDiv() )
         end






      case nPrecioDef == 6 .AND. !::oArt:lIvaInc

         nPrecio             := ::oArt:pVenta6

         if ::oArt:nImpInt2 <> 0
            nPrecioOferta          := ::oArt:nImpInt6
         end

      case nPrecioDef == 6 .AND. ::oArt:lIvaInc

         nPrecio             := Round( ::oArt:pVtaIva6 / nIva, nDwbDiv() )

         if ::oArt:nImpIva6 <> 0
            nPrecioOferta    := Round( ::oArt:nImpIva6 / nIva, nDwbDiv() )
         end

   end

   if nPrecio == 0

      nPrecio              := ::oArt:nImpInt1

      if ::oArt:nImpInt1 <> 0
         nPrecio           := ::oArt:nImpInt1
      else
         nPrecio           := ::oArt:pVenta1
      end

   end





   ::nPrecioMinimo         := nPrecio





   if ::oArt:cCodWeb == 0 .OR. ::lSincAll





      oTablaArticulos:Blank()





      oTablaArticulos:FieldPut( 2, Max( ::oStock:nStockArticulo( ::oArt:Codigo ), 0 ) )


      ::oStock:aStockArticulo( ::oArt:Codigo )



      oTablaArticulos:FieldPut( 3, Left( ::oArt:Codigo, 12 ) )
      oTablaArticulos:FieldPut( 4, cNoPathInt( ::cdImagen ) + "/" + cNoPath( cFirstImage( ::oArt:Codigo, ::oArtImg:cAlias ) ) )

      oTablaArticulos:FieldPut( 5, if( ::oArt:pVtaWeb < 1, ::oArt:pVenta1 , ::oArt:pVtaWeb ) )
      oTablaArticulos:FieldPut( 6, GetSysDate() )
      oTablaArticulos:FieldPut( 9, ::oArt:nPesoKG )
      oTablaArticulos:FieldPut(10, 1 )
      oTablaArticulos:FieldPut(11, ::GetParentIva() )
      oTablaArticulos:FieldPut(12, ::GetParentFabricantes() )

      if oTablaArticulos:Insert()

         ::SetText( "Aadiendo artculo " + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ), 3 )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::oArt:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::AppImages( oTablaArticulos_Images, nCodigoWeb )










      else

         ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ) + " en tabla products", 3 )

         return .F.

      end





      oTablaDescripciones:Blank()

      oTablaDescripciones:FieldPut( 2, ::nLanguage )
      oTablaDescripciones:FieldPut( 3, ::SeleccionFamilia() )

      oTablaDescripciones:FieldPut( 4, ::oCon:EscapeStr( ::oArt:mDesTec ) )

      if !oTablaDescripciones:Insert()
      ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " en tabla products_description", 3 )
      end





      oTablaRelaciones:Blank()

      oTablaRelaciones:FieldPut( 1, ::oArt:cCodWeb  )

      if Empty( ::oArt:cCodTip )
         oTablaRelaciones:FieldPut( 2, ::GetParentCategories() )
      else
         oTablaRelaciones:FieldPut( 2, ::GetParentTipoArticulo( oDb ) )
      end

      if !oTablaRelaciones:Insert()
         ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " en tabla products_to_categories", 3 )
      end





      ::AppAtributes( oTablaArticulos_Atributos, nCodigoWeb )







      if ::oArt:pVtaWeb  <> 0                 .AND. ::oArt:pVtaWeb  <> ::oArt:nImpInt1   .AND. ::oArt:nImpInt1 <> 0

            oTablaOfertas:Blank()

            oTablaOfertas:FieldPut( 2, ::oArt:cCodWeb )
            oTablaOfertas:FieldPut( 3, nPrecioOferta )
            oTablaOfertas:FieldPut( 4, GetSysDate() )
            oTablaOfertas:FieldPut( 8, 1 )

            if !oTablaOfertas:Insert()
               ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " en tabla specials", 3 )
            end

     end

   else





      if oTablaArticulos:RecCount() > 0 .AND. oTablaArticulos:Find( 1, ::oArt:cCodWeb, .T. )

         oTablaArticulos:Load()

         oTablaArticulos:FieldPut( 2, 1 )
         oTablaArticulos:FieldPut( 3, Left( ::oArt:Codigo, 12 ) )









         oTablaArticulos:FieldPut( 4, cNoPathInt( ::cdImagen ) + "/" + cNoPath( cFirstImage( ::oArt:Codigo, ::oArtImg:cAlias ) ) )

         oTablaArticulos:FieldPut( 5, if( ::oArt:pVtaWeb < 1, ::oArt:pVenta1, ::oArt:pVtaWeb ) )
         oTablaArticulos:FieldPut( 6, GetSysDate() )
         oTablaArticulos:FieldPut( 9, ::oArt:nPesoKG )
         oTablaArticulos:FieldPut(10, 1 )
         oTablaArticulos:FieldPut(11, ::GetParentIva() )
         oTablaArticulos:FieldPut(12, ::GetParentFabricantes() )

         if oTablaArticulos:update()
            ::SetText( "Modificando articulo " + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ), 3 )

            if Empty( ::oArt:cImagenWeb )
               ::AddImages( ::oArt:cImagen )
            else
               ::AddImages( ::oArt:cImagenWeb )
            end

         else
            ::SetText( "Error modificando" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ) + " en tabla products", 3 )
         end

      end





      if oTablaDescripciones:RecCount() > 0 .AND. oTablaDescripciones:Find( 1, ::oArt:cCodWeb, .T. )

         oTablaDescripciones:Load()

         oTablaDescripciones:FieldPut( 2, ::nLanguage )

         oTablaDescripciones:FieldPut( 3, ::SeleccionFamilia() )
         oTablaDescripciones:FieldPut( 4, ::oCon:EscapeStr( ::oArt:mDesTec ) )

         if !oTablaDescripciones:update()
            ::SetText( "Error modificando" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ) + " en tabla products_description", 3 )
         end

      end





      if oTablaRelaciones:RecCount() > 0 .AND. oTablaRelaciones:Find( 1, ::oArt:cCodWeb, .T. )

         oTablaRelaciones:FieldPut( 1, ::oArt:cCodWeb )

         if Empty( ::oArt:cCodtip )
            oTablaRelaciones:FieldPut( 2, ::GetParentCategories() )
         else
            oTablaRelaciones:FieldPut( 2, ::GetParentTipoArticulo( oDb ) )
         end

         if !oTablaRelaciones:update()
            ::SetText( "Error modificando" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ) + " en tabla products_to_categories", 3 )
         end

      else

         oTablaRelaciones:Blank()

         oTablaRelaciones:FieldPut( 1, ::oArt:cCodWeb  )

         if Empty( ::oArt:cCodtip )
            oTablaRelaciones:FieldPut( 2, ::GetParentCategories() )
         else
            oTablaRelaciones:FieldPut( 2, ::GetParentTipoArticulo( oDb ) )
         end

         if !oTablaRelaciones:Insert()
            ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " en tabla products_to_categories", 3 )
         end

      end





      if oTablaOfertas:RecCount() > 0 .AND. oTablaOfertas:Find( 1, ::oArt:cCodWeb, .T. )

            oTablaOfertas:Load()

            oTablaOfertas:FieldPut( 2, ::oArt:cCodWeb )
            oTablaOfertas:FieldPut( 3, nPrecioOferta )
            oTablaOfertas:FieldPut( 4, GetSysDate() )
            oTablaOfertas:FieldPut( 8, 1 )

            if !oTablaOfertas:update()
               ::SetText( "Error modificando" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + AllTrim( ::oArt:Nombre ) + " en tabla specials", 3 )
            end

      end





      ::AppImages( oTablaArticulos_Images, ::oArt:cCodWeb )





      ::AppAtributes( oTablaArticulos_Atributos, ::oArt:cCodWeb )

   end





   ::AppPreciosAtributes( oTablaArticulos, oTablaArticulos_Atributos )

Return nCodigoWeb



UTILITY STATIC function TComercio_AppAtributes( oTablaArticulos_Atributos, nCodigoWeb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local aValPrp1
   local aValPrp2





   oTablaArticulos_Atributos:GoTop()

   if oTablaArticulos_Atributos:RecCount() > 0

   for n := 1 to oTablaArticulos_Atributos:RecCount()

      oTablaArticulos_Atributos:Load()

      if oTablaArticulos_Atributos:GetBuffer( 2 ) == nCodigoWeb

         ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos_Atributos:GetBuffer( 1 ) ) ) + " relacin de atributos", 3 )

         oTablaArticulos_Atributos:Delete()

      end

      oTablaArticulos_Atributos:Skip()

   next

   end





   ::oTblPro:GetStatus()

   ::oTblPro:OrdSetFocus( "cCodWeb" )

   if !Empty( ::oArt:cCodPrp1 )

      ::oTblPro:GoTop()
      while !::oTblPro:Eof()

         if ::oArt:cCodPrp1 == ::oTblPro:cCodPro

            aValPrp1 := hb_aTokens( ::oArt:mValPrp1, "," )

            if Empty( ::oArt:mValPrp1 ) .OR. aScan( aValPrp1, {|a| Alltrim( ::oTblPro:cCodTbl ) == a } ) <> 0

               oTablaArticulos_Atributos:Blank()

               oTablaArticulos_Atributos:FieldPut( 2, nCodigoWeb )
               oTablaArticulos_Atributos:FieldPut( 3, oRetFld( ::oArt:cCodPrp1, ::oPro, "cCodWeb" ) )
               oTablaArticulos_Atributos:FieldPut( 4, ::oTblPro:cCodWeb )

               if !oTablaArticulos_Atributos:Insert()
                  ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la propiedad " + Alltrim( ::oTblPro:cCodTbl ) + " en tabla products_attributes", 3 )
               else
                  ::SetText( "Registro insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la propiedad " + Alltrim( ::oTblPro:cCodTbl ) + " en tabla products_attributes", 3 )
               end

            end

         end

         ::oTblPro:Skip()

      end

   end





   if !Empty( ::oArt:cCodPrp2 )

      ::oTblPro:GoTop()
      while !::oTblPro:Eof()

         if ::oArt:cCodPrp2 == ::oTblPro:cCodPro

            aValPrp2 := hb_aTokens( ::oArt:mValPrp2, "," )

            if Empty( ::oArt:mValPrp2 ) .OR. aScan( aValPrp2, {|a| Alltrim( ::oTblPro:cCodTbl ) == a } ) <> 0

               oTablaArticulos_Atributos:Blank()

               oTablaArticulos_Atributos:FieldPut( 2, nCodigoWeb )
               oTablaArticulos_Atributos:FieldPut( 3, oRetFld( ::oArt:cCodPrp2, ::oPro, "cCodWeb" ) )
               oTablaArticulos_Atributos:FieldPut( 4, ::oTblPro:cCodWeb )

               if !oTablaArticulos_Atributos:Insert()
                  ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la propiedad " + Alltrim( ::oTblPro:cCodTbl ) + " en tabla products_attributes", 3 )
               else
                  ::SetText( "Registro insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la propiedad " + Alltrim( ::oTblPro:cCodTbl ) + " en tabla products_attributes", 3 )
               end

            end

         end

         ::oTblPro:Skip()

      end

   end

   ::oTblPro:SetStatus()





   oTablaArticulos_Atributos:oCmd:ExecDirect( "ALTER TABLE `products_attributes` ORDER BY `products_attributes_id`"  )

return nil



UTILITY STATIC function TComercio_AppImages( oTablaArticulos_Images, nCodigoWeb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local nImage := 0




   if oTablaArticulos_Images        <> nil

      oTablaArticulos_Images:GoTop()

      if oTablaArticulos_Images:RecCount() > 0

      for n := 1 to oTablaArticulos_Images:RecCount()

       oTablaArticulos_Images:Load()

         if oTablaArticulos_Images:GetBuffer( 2 ) == nCodigoWeb

            ::SetText( "Borrado registro "  + AllTrim( Str( oTablaArticulos_Images:GetBuffer( 1 ) ) ) + " relacin de imagenes", 3 )

            oTablaArticulos_Images:Delete()

         end

         oTablaArticulos_Images:Skip()

      next

      end





      ::oArtImg:GetStatus()

      ::oArtImg:OrdSetFocus( "cCodArt" )

      if ::oArtImg:Seek( ::oArt:Codigo )

       while ( ::oArtImg:cCodArt == ::oArt:Codigo ) .AND. !::oArtImg:Eof()

            oTablaArticulos_Images:Blank()

            oTablaArticulos_Images:FieldPut( 2, nCodigoWeb )

            oTablaArticulos_Images:FieldPut( 3, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oArtImg:cImgArt) )

            oTablaArticulos_Images:FieldPut( 4, ++nImage  )

            if !oTablaArticulos_Images:Insert()
               ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la imagen " + Alltrim( ::oArt:Codigo ) + " en tabla products_images", 3 )
          else
              ::SetText( "Registro insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " con la imagen " + Alltrim( ::oArt:Codigo ) + " en tabla products_images", 3 )

              ::AddImages( ::oArtImg:cImgArt )

          end

            ::oArtImg:Skip()

         end

      end

      ::oArtImg:SetStatus()

   end

return nil



UTILITY STATIC function TComercio_AppPreciosAtributes( oTablaArticulos, oTablaArticulos_Atributos) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nIva
   local oPrePro
   local aPrePro     := {}
   local nPrePro     := 0
   local cStatement  := ""

   nIva              := ( 1 + nIva( ::oIva, ::oArt:TipoIva ) / 100 )





   ::oArtDiv:GetStatus()

   if ::oArtDiv:Seek( ::oArt:Codigo )

      while ::oArtDiv:cCodArt == ::oArt:Codigo .AND. !::oArtDiv:Eof()

         with object ( SPrePro() )

            :cCodArt    := Str( ::oArt:cCodWeb )
            :cCodPrp    := Str( RetFld( ::oArtDiv:cCodPr1, ::oPro:cAlias, "cCodWeb", "cCodPro" ) )
            :cValPrp    := Str( RetFld( ::oArtDiv:cCodPr1 + ::oArtDiv:cValPr1, ::oTblPro:cAlias, "cCodWeb", "cCodPro" ) )

            if ::oArt:lIvaInc .AND. nIva <> 0
               :nPrecio := Round( ::oArtDiv:nPreIva1 / nIva, nDwbDiv() )
            else
               :nPrecio := ::oArtDiv:nPreVta1
            end

            aAdd( aPrePro, oClone( hb_QWith() ) )

         end

         ::oArtDiv:Skip()

      end

   end

   if Len( aPrePro ) <> 0





      if ::nPrecioMinimo == 0

         for each oPrePro in aPrePro

            if ::nPrecioMinimo == 0
               ::nPrecioMinimo   := oPrePro:nPrecio
            end

            ::nPrecioMinimo      := Min( oPrePro:nPrecio, ::nPrecioMinimo )

         next

      end





      cStatement                    := "UPDATE " + oTablaArticulos:cName + Space( 1 )
      cStatement                    += "SET "
      cStatement                    += "products_price = '" + Alltrim( Str( ::nPrecioMinimo ) ) + "' "
      cStatement                    += "WHERE "
      cStatement                    += "products_id = '" + Alltrim( Str( ::oArt:cCodWeb ) ) + "' "
      cStatement                    += "LIMIT 1"

      if !TMSCommand():New( ::oCon ):ExecDirect( cStatement )
         ::SetText( "Error modificando precio mnimo de artculo", 3 )
      end





      for each oPrePro in aPrePro

         nPrePro     := oPrePro:nPrecio - ::nPrecioMinimo

         if nPrePro  <> 0

            cStatement    := "UPDATE products_attributes "
            cStatement    += "SET "
            cStatement    += "options_values_price = '" + Alltrim( Str( Abs( nPrePro ) ) ) + "' , "
            if nPrePro > 0
               cStatement += "price_prefix = '+' "
            else
               cStatement += "price_prefix = '-' "
            end
            cStatement    += "WHERE "
            cStatement    += "products_id = '" + Alltrim( oPrePro:cCodArt ) + "' AND "
            cStatement    += "options_id = '" + Alltrim( oPrePro:cCodPrp ) + "' AND "
            cStatement    += "options_values_id = '" + Alltrim( oPrePro:cValPrp ) + "'"

            if !TMSCommand():New( ::oCon ):ExecDirect( cStatement )
               ::SetText( "Error al modificar precios por propiedades", 3 )
            end

         end

      next

   end

   ::oArtDiv:SetStatus()

return nil



UTILITY STATIC function TComercio_DropAtributes( oTablaArticulos_Atributos) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   oTablaArticulos_Atributos:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaArticulos_Atributos:cName )

Return nil



UTILITY STATIC function TComercio_AppendFamilia_bd( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaFamilias
   local oTablaFamiliasDesc

   if oDb:ExistTable( "categories" ) .AND. oDb:ExistTable( "categories_description" )

      oTablaFamilias       := TMSTable():New( oDb, "categories" )
      oTablaFamiliasDesc   := TMSTable():New( oDb, "categories_description" )

      if oTablaFamilias:Open() .AND. oTablaFamiliasDesc:Open()

         oTablaFamilias:GoTop()
         oTablaFamiliasDesc:GoTop()

         ::SetText ( "Actualizando familias y grupos de familias: ", 2 )





         ::AppCategories_bd( oTablaFamilias, oTablaFamiliasDesc )

      else

         ::SetText ( "No se puede abrir la tabla: " + oTablaFamilias:cName, 1 )

      end

      oTablaFamilias:Free()
      oTablaFamiliasDesc:Free()

   else

      ::SetText ( "No se puede crear la tabla: " + oTablaFamilias:cName, 1 )

   end

Return ( Self )



UTILITY STATIC function TComercio_AppCategories_bd( oTablaFamilias, oTablaFamiliasDesc) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodigoWeb  := 0
   local cImagen
   local cNombre
   local n
   local n2

   ::nTotMeter       := 0





   oTablaFamilias:GoTop()
   oTablaFamiliasDesc:GoTop()

   if oTablaFamilias:RecCount() > 0

   for n := 1 to oTablaFamilias:RecCount()

      ::nTotMeter += 1

      oTablaFamiliasDesc:skip()

   next

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL := 1





   oTablaFamilias:GoTop()
   oTablaFamiliasDesc:GoTop()

   if oTablaFamilias:RecCount() > 0

   for n := 1 to oTablaFamilias:RecCount()

      oTablaFamilias:Load()

      cCodigoWeb     := oTablaFamilias:GetBuffer( 1 )
      cImagen        := oTablaFamilias:GetBuffer( 2 )

      oTablaFamiliasDesc:GoTop()

      for n2 := 1 to oTablaFamiliasDesc:RecCount()

         oTablaFamiliasDesc:Load()

         if oTablaFamiliasDesc:GetBuffer( 1 ) == cCodigoWeb .AND. oTablaFamiliasDesc:GetBuffer( 2 ) == ::nLanguage

            cNombre  := oTablaFamiliasDesc:GetBuffer( 3 )

         end

         oTablaFamiliasDesc:skip()

      next





      ::MeterParticularText( " Descargando familia " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

      if !::oFam:SeekInOrd( Str( cCodigoWeb, 11 ), "cCodWeb" )

         ::oFam:Append()

         ::oFam:cCodFam       := RJust( NextVal( DbLast( ::oFam:cAlias , 1, nil, nil, 1 ) ), "0", 3 )
         ::oFam:cNomFam       := cNombre
         ::oFam:cImgBtn       := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )
         ::oFam:cCodWeb       := cCodigoWeb
         ::oFam:lPubInt       := .T.

         if ::oFam:save()

            ::SetText( "Aadido familia " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else

            ::SetText( "Error al aadir familia" + Rtrim( cNombre ), 3 )

         end

      else

         ::oFam:Load()

         ::oFam:cNomFam       := cNombre
         ::oFam:cImgBtn       := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )
         ::oFam:cCodWeb       := cCodigoWeb
         ::oFam:lPubInt       := .T.

         if ::oFam:save()

            ::SetText( "Modificando familia " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else

            ::SetText( "Error al modificar familia " + Rtrim( cNombre ), 3 )

         end

      end

      oTablaFamiliasDesc:skip()

   next

   end

return .T.



UTILITY STATIC function TComercio_AppendFamilia( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local oTablaFamilias
   local oTablaFamiliasDesc

   ::nTotMeter             := 0


   if oDb:ExistTable( "categories" ) .AND. oDb:ExistTable( "categories_description" )

      oTablaFamilias       := TMSTable():New( oDb, "categories" )
      oTablaFamiliasDesc   := TMSTable():New( oDb, "categories_description" )


      if oTablaFamilias:Open()   .AND. oTablaFamiliasDesc:Open()





         if ::lSincAll
            oTablaFamilias:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaFamilias:cName )
            oTablaFamiliasDesc:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaFamiliasDesc:cName )
            ::SetText ( "Tablas de familias borradas corectamente ", 2  )
         end

         oTablaFamilias:GoTop()
         oTablaFamiliasDesc:GoTop()

         ::SetText ( "Actualizando familias y grupos de familias: ", 2 )





         if oTablaFamilias:RecCount() > 0

         for n := 1 to oTablaFamilias:RecCount()

            oTablaFamilias:Load()










            if ::oGrpFam:SeekInOrd( Str( oTablaFamilias:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oGrpFam:lPubInt

                  ::SetText( "Borrado "  + AllTrim( Str( oTablaFamilias:GetBuffer( 1 ) ) ) + " de la tabla categories 2", 3 )

                  oTablaFamilias:Delete()

               end

            elseif ::oFam:SeekInOrd( Str( oTablaFamilias:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oFam:lPubInt

                  ::SetText( "Borrado "  + AllTrim( Str( oTablaFamilias:GetBuffer( 1 ) ) ) + " de la tabla categories 3", 3 )

                  oTablaFamilias:Delete()

               end

            end

            oTablaFamilias:Skip()

         next

         end





         if oTablaFamiliasDesc:RecCount() > 0

         for n := 1 to oTablaFamiliasDesc:RecCount()

            oTablaFamiliasDesc:Load()









            if ::oGrpFam:SeekInOrd( Str( oTablaFamiliasDesc:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oGrpFam:lPubInt

                  ::SetText( "Borrado "  + AllTrim( Str( oTablaFamiliasDesc:GetBuffer( 1 ) ) ) + " de la tabla categories_description", 3 )

                  oTablaFamiliasDesc:Delete()

               end

            elseif ::oFam:SeekInOrd( Str( oTablaFamiliasDesc:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oFam:lPubInt

                  ::SetText( "Borrado "  + AllTrim( Str( oTablaFamiliasDesc:GetBuffer( 1 ) ) ) + " de la tabla categories_description", 3 )

                  oTablaFamiliasDesc:Delete()

               end

            end

            oTablaFamiliasDesc:Skip()

         next

         end





         ::oGrpFam:GoTop()
         while !::oGrpFam:Eof()

            if ::oGrpFam:lPubInt .AND. ( ::oGrpFam:lSndDoc .OR. ::lSincAll )
               ::nTotMeter += 1
            end

            ::oGrpFam:Skip()

         end

         ::oFam:GoTop()
         while !::oFam:Eof()

            if ::oFam:lPubInt .AND. ( ::oFam:lSelDoc .OR. ::lSincAll )
               ::nTotMeter += 1
            end

            ::oFam:Skip()

         end

         ::oMeterL:SetTotal( ::nTotMeter )

         ::nActualMeterL   := 1





         ::oGrpFam:GoTop()

         while !::oGrpFam:Eof()

            if ::oGrpFam:lPubInt .AND. ( ::oGrpFam:lSndDoc .OR. ::lSincAll )

               ::MeterParticularText( " Actualizando familia " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

               ::AppGrpCategories( oTablaFamilias, oTablaFamiliasDesc )

            end

            ::oGrpFam:FieldPutByName( "lSndDoc", .F. )

            ::oGrpFam:Skip()

         end





         ::oFam:GoTop()

         while !::oFam:Eof()

            if ::oFam:lPubInt .AND. ( ::oFam:lSelDoc .OR. ::lSincAll )

               ::MeterParticularText( "Actualizando familia " + AllTrim( Str( ::nActualMeterL ) ) + " de " + AllTrim( Str( ::nTotMeter ) ) )

               ::AppCategories( oTablaFamilias, oTablaFamiliasDesc )

            end

            ::oFam:FieldPutByName( "lSelDoc", .F. )

            ::oFam:Skip()

         end

      else

         ::SetText ( "No se puede abrir la tabla: " + oTablaFamilias:cName, 1 )

      end

      oTablaFamilias:Free()

   else

      ::SetText ( "No se puede crear la tabla: " + oTablaFamilias:cName, 1 )

   end

Return ( Self )



UTILITY STATIC function TComercio_AppCategories( oTablaFamilias, oTablaFamiliasDesc) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb        := 0

   oTablaFamilias:GoTop()

   if ( ::oFam:cCodWeb == 0 .OR. ::lSincAll )





      oTablaFamilias:Blank()
      oTablaFamilias:FieldPut( 2, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oFam:cImgBtn ) )
      oTablaFamilias:FieldPut( 3, ::GetParentFamilia() )
      oTablaFamilias:FieldPut( 4, ::oFam:nPosInt )
      oTablaFamilias:FieldPut( 5, GetSysDate() )
      oTablaFamilias:FieldPut( 6, GetSysDate() )

      if oTablaFamilias:Insert()

         ::SetText( "Aadiendo familia " + Rtrim( ::oFam:cCodFam ) + Space( 1 ) + AllTrim( ::oFam:cNomFam ), 3 )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::oFam:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::AddImages( ::oFam:cImgBtn )

      else

         ::SetText( "Error insertado" + Rtrim( ::oFam:cCodFam ) + Space( 1 ) + AllTrim( ::oFam:cNomFam ) + " en tabla categories", 3 )

      end





      if nCodigoWeb <> 0

         oTablaFamiliasDesc:Blank()
         oTablaFamiliasDesc:FieldPut( 1, nCodigoWeb )
         oTablaFamiliasDesc:FieldPut( 2, ::nLanguage )
         oTablaFamiliasDesc:FieldPut( 3, ::oCon:EscapeStr( ::oFam:cNomFam ) )

         if !oTablaFamiliasDesc:Insert()
            ::SetText( "Error insertado" + Rtrim( ::oArt:Codigo ) + Space( 1 ) + Alltrim( ::oArt:Nombre ) + " en tabla products_description", 3 )
         end

      end

   else





      if oTablaFamilias:RecCount() > 0 .AND. oTablaFamilias:Find( 1, ::oFam:cCodWeb, .T. )

         oTablaFamilias:Load()

         oTablaFamilias:FieldPut( 2, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oFam:cImgBtn ) )
         oTablaFamilias:FieldPut( 3, 0 )
         oTablaFamilias:FieldPut( 3, ::GetParentFamilia() )
         oTablaFamilias:FieldPut( 4, ::oFam:nPosInt )
         oTablaFamilias:FieldPut( 5, GetSysDate() )
         oTablaFamilias:FieldPut( 6, GetSysDate() )

         if oTablaFamilias:update()

            ::SetText( "Modificando Familia " + Rtrim( ::oFam:cCodFam ) + Space( 1 ) + AllTrim( ::oFam:cNomFam), 3 )

            ::AddImages( ::oFam:cImgBtn )

         else

            ::SetText( "Error modificando" + Rtrim( ::oFam:cCodFam ) + Space( 1 ) + AllTrim( ::oFam:cNomFam ) + " en tabla categories", 3 )

         end

      end





      if oTablaFamiliasDesc:RecCount() > 0 .AND. oTablaFamiliasDesc:Find( 1, ::oFam:cCodWeb, .T.)

         oTablaFamiliasDesc:Load()

         oTablaFamiliasDesc:FieldPut( 2, ::nLanguage )
         oTablaFamiliasDesc:FieldPut( 3, ::oCon:EscapeStr( ::oFam:cNomFam ) )

         if !oTablaFamiliasDesc:update()
            ::SetText( "Error modificando" + Rtrim( ::oFam:cCodFam ) + Space( 1 ) + AllTrim( ::oFam:cNomFam ) + " en tabla categories_description", 3 )
         end

      end

   end

return nCodigoWeb



UTILITY STATIC function TComercio_AppGrpCategories( oTablaFamilias, oTablaFamiliasDesc) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb        := 0

   oTablaFamilias:GoTop()

   if ::oGrpFam:cCodWeb == 0 .OR. ::lSincAll





      oTablaFamilias:Blank()
      oTablaFamilias:FieldPut( 3, 0 )

      oTablaFamilias:FieldPut( 5, GetSysDate() )
      oTablaFamilias:FieldPut( 6, GetSysDate() )

      if oTablaFamilias:Insert()

         ::SetText( "Aadiendo Grupo de familia " + Rtrim( ::oGrpFam:cCodGrp ) + Space( 1 ) + AllTrim( ::oGrpFam:cNomGrp ), 3 )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::oGrpFam:fieldPutByName( "cCodWeb", nCodigoWeb )

      end





      oTablaFamiliasDesc:Blank()
      oTablaFamiliasDesc:FieldPut( 1, nCodigoWeb )
      oTablaFamiliasDesc:FieldPut( 2, ::nLanguage )
      oTablaFamiliasDesc:FieldPut( 3, ::oCon:EscapeStr( ::oGrpFam:cNomGrp ) )

      if !oTablaFamiliasDesc:Insert()
         ::SetText( "Error insertado" + Rtrim( ::oGrpFam:cCodGrp ) + Space( 1 ) + AllTrim( ::oGrpFam:cNomGrp ) + " en tabla categories", 3 )
      end

   else




      if oTablaFamilias:RecCount() > 0 .AND. oTablaFamilias:Find( 1, ::oGrpFam:cCodWeb, .T. )

         oTablaFamilias:Load()

         oTablaFamilias:FieldPut( 3, 0 )

         oTablaFamilias:FieldPut( 5, GetSysDate() )
         oTablaFamilias:FieldPut( 6, GetSysDate() )

         if oTablaFamilias:update()
            ::SetText( "Modificando grupo familia " + Rtrim( ::oGrpFam:cCodGrp ) + Space( 1 ) + AllTrim( ::oGrpFam:cNomGrp ), 3 )
         else
            ::SetText( "Error modificando" + Rtrim( ::oGrpFam:cCodGrp ) + Space( 1 ) + AllTrim( ::oGrpFam:cNomGrp ) + " en tabla categories", 3 )
         end

      end





      if oTablaFamiliasDesc:RecCount() > 0 .AND. oTablaFamiliasDesc:Find( 1, ::oGrpFam:cCodWeb, .T.)

         oTablaFamiliasDesc:Load()

         oTablaFamiliasDesc:FieldPut( 2, ::nLanguage )
         oTablaFamiliasDesc:FieldPut( 3, ::oCon:EscapeStr( ::oGrpFam:cNomGrp ) )

         if !oTablaFamiliasDesc:update()
            ::SetText( "Error modificando" + Rtrim( ::oGrpFam:cCodGrp ) + Space( 1 ) + AllTrim( ::oGrpFam:cNomGrp ) + " en tabla categories_description", 3 )
         end

      end

   end

Return nCodigoWeb



UTILITY STATIC function TComercio_AppendPedido( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTablaPedidos
   local oTablaPedidosPro
   local oTablaPedidosAtributos
   local oTablaPedidosTotal
   local oTablaPedidosHistory





   if oDb:ExistTable( "orders" )  .AND. oDb:ExistTable( "orders_products" ) .AND. oDb:ExistTable( "orders_products_attributes" ) .AND. oDb:ExistTable( "orders_total" ) .AND. oDb:ExistTable( "orders_status_history" )

      oTablaPedidos           := TMSTable():New( oDb, "orders" )
      oTablaPedidosPro        := TMSTable():New( oDb, "orders_products" )
      oTablaPedidosAtributos  := TMSTable():New( oDb, "orders_products_attributes" )
      oTablaPedidosTotal      := TMSTable():New( oDb, "orders_total" )
      oTablaPedidosHistory    := TMSTable():New( oDb, "orders_status_history" )









      if oTablaPedidos:Open() .AND. oTablaPedidosPro:Open() .AND. oTablaPedidosAtributos:Open() .AND. oTablaPedidosTotal:Open() .AND. oTablaPedidosHistory:Open()

         oTablaPedidos:GoTop()
         oTablaPedidosPro:GoTop()
         oTablaPedidosAtributos:GoTop()
         oTablaPedidosTotal:GoTop()
         oTablaPedidosHistory:GoTop()

         ::SetText( "Actualizando Pedidos", 2 )





         ::AppPedidos( oTablaPedidos, oTablaPedidosPro, oTablaPedidosAtributos, oTablaPedidosTotal, oTablaPedidosHistory )

      else

         ::SetText ( "No se puede abrir las tablas de pedidos", 1  )

      end

      oTablaPedidos:Free()
      oTablaPedidosPro:Free()
      oTablaPedidosAtributos:Free()
      oTablaPedidosTotal:Free()
      oTablaPedidosHistory:Free()

   else

      ::SetText( "No existe la tabla de pedidos", 1 )

   end

Return ( Self )



UTILITY STATIC function TComercio_GetParentIva() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nIva     := 0

   if ::oIva:Seek( ::oArt:TipoIva )
      nIva        := ::oIva:cCodWeb
   end

Return ( nIva )



UTILITY STATIC function TComercio_GetParentFamilia() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local ParentFamilia  := 0

   if ::oGrpFam:Seek( ::oFam:cCodGrp )
      if ::oGrpFam:lPubInt
         ParentFamilia  := ::oGrpFam:cCodWeb
      end
   end

Return ( ParentFamilia )



UTILITY STATIC function TComercio_GetParentFabricantes() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local ParenFabricantes  := 0

   if ::oFab:Seek( ::oArt:cCodFab )
      if ::oFab:lPubInt
         ParenFabricantes := ::oFab:cCodWeb
      end
   end

Return( ParenFabricantes )



UTILITY STATIC function TComercio_AppendIva( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTablaIva
   local oTablaIva_rates
   local oTablaZone
   local n



   if oDb:ExistTable( "tax_class" )  .AND. oDb:ExistTable( "tax_rates" )  .AND. oDb:ExistTable( "geo_zones" )

      oTablaIva            := TMSTable():New( oDb, "tax_class" )
      oTablaIva_rates      := TMSTable():New( oDb, "tax_rates" )
      oTablaZone           := TMSTable():New( oDb, "geo_zones" )







      if oTablaIva:Open()        .AND. oTablaIva_rates:Open()  .AND. oTablaZone:Open()





         if ::lSincAll
            oTablaIva:oCmd:ExecDirect(       "TRUNCATE TABLE " + oTablaIva:cName )
            oTablaIva_rates:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaIva_rates:cName )
            oTablaZone:oCmd:ExecDirect(      "TRUNCATE TABLE " + oTablaZone:cName )
            ::SetText ( "Tablas de tipos de " + cImp() + " borradas corectamente ", 2  )
         end

         oTablaIva:GoTop()
         oTablaIva_rates:GoTop()
         oTablaZone:GoTop()

         ::SetText ( "Actualizando los tipos de " + cImp() + " de la web: ", 2 )





         if oTablaIva:RecCount() > 0

         for n := 1 to oTablaIva:RecCount()

            oTablaIva:Load()

            if ::oIva:SeekInOrd( Str( oTablaIva:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oIva:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaIva:GetBuffer( 1 ) ) ) + " de la tabla tax_class", 3 )

                  oTablaIva:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaIva:GetBuffer( 1 ) ) ) + " de la tabla tax_class", 3 )

               oTablaIva:Delete()

            end

            oTablaIva:Skip()

         next

         end





         if oTablaIva_rates:RecCount() > 0

         for n := 1 to oTablaIva_rates:RecCount()

            oTablaIva_rates:Load()

            if ::oIva:SeekInOrd( Str( oTablaIva_rates:GetBuffer( 3 ), 11 ), "cCodWeb" )

               if !::oIva:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( Str( oTablaIva_rates:GetBuffer( 1 ) ) ) + " de la tabla tax_rate", 3 )

                  oTablaIva_rates:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaIva_rates:GetBuffer( 1 ) ) ) + " de la tabla tax_rate", 3 )

               oTablaIva_rates:Delete()

            end

            oTablaIva_rates:Skip()

         next

         end





         ::oIva:GoTop()

         while !::oIva:Eof()

            if ::oIva:lPubInt .AND. ( ::oIva:lSndDoc .OR. ::lSincAll )

               ::AppIva( oTablaIva, oTablaIva_rates, oTablaZone )

               ::oIva:FieldPutByName( "lSndDoc", .F. )

            end

            ::oIva:Skip()

         end

      else

         ::SetText ( "No se puede abrir las tablas de " + cImp(), 1  )

      end

      oTablaIva:Free()
      oTablaIva_rates:Free()
      oTablaZone:Free()

   else

      ::SetText( "No existen las tablas para el " + cImp(), 1 )

   end

Return( self )



UTILITY STATIC function TComercio_GetParentCategories() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local idCategories := 0

   if ::oFam:Seek( ::oArt:Familia )
      if ::oFam:lPubInt
         idCategories := ::oFam:cCodWeb
      end
   end

Return( idCategories )



UTILITY STATIC function TComercio_GetParentTipoArticulo( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb
   local oTablaFamilias
   local oTablaFamiliasDesc
   local idCategories            := 0

   if ::oTipArt:Seek( ::oArt:cCodTip ) .AND. ::oFam:Seek( ::oArt:Familia )

      if ::oTipArt:lPubInt .AND. ( ::oTipArt:lSelect .OR. ::lSincAll )

         if oDb:ExistTable( "categories" ) .AND. oDb:ExistTable( "categories_description" )

            oTablaFamilias       := TMSTable():New( oDb, "categories" )
            oTablaFamiliasDesc   := TMSTable():New( oDb, "categories_description" )

            if oTablaFamilias:Open() .AND. oTablaFamiliasDesc:Open()

               idCategories      := ::lParentTipoArticulo( oTablaFamilias, oTablaFamiliasDesc )
               if Empty( idCategories )





                  oTablaFamilias:Blank()
                  oTablaFamilias:FieldPut( 2, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oTipArt:cImgTip ) )
                  oTablaFamilias:FieldPut( 3, ::GetParentCategories() )
                  oTablaFamilias:FieldPut( 4, ::oTipArt:nPosInt )
                  oTablaFamilias:FieldPut( 5, GetSysDate() )
                  oTablaFamilias:FieldPut( 6, GetSysDate() )

                  if oTablaFamilias:Insert()

                     ::SetText( "Aadiendo tipo de artculo " + AllTrim( ::GetTipArt() ), 3 )

                     idCategories   := ::oCon:GetInsertId()





                  else

                     ::SetText( "Error insertado" +  AllTrim( ::GetTipArt() ) + " en tabla categories", 3 )

                  end





                  ::AddImages( ::oTipArt:cImgTip )





                  oTablaFamiliasDesc:Blank()
                  oTablaFamiliasDesc:FieldPut( 1, idCategories )
                  oTablaFamiliasDesc:FieldPut( 2, ::nLanguage )
                  oTablaFamiliasDesc:FieldPut( 3, ::oCon:EscapeStr( ::GetTipArt() ) )

                  if oTablaFamiliasDesc:Insert()
                     ::SetText( "Insertado" + AllTrim( ::GetTipArt() ) + " en tabla products_description", 3 )
                  else
                     ::SetText( "Error insertado" + AllTrim( ::GetTipArt() ) + " en tabla products_description", 3 )
                  end

               end

            end

         end

      end







   end

Return( idCategories )



UTILITY STATIC function TComercio_lParentTipoArticulo( oTablaFamilias, oTablaFamiliasDesc) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local oQuery2
   local nCategories := 0
   local nCategories2:= 0

   if Empty( ::oFam:cCodWeb )
      return 0
   end

   oQuery            := TMSQuery():New( ::oCon, "SELECT * FROM " + oTablaFamiliasDesc:cName + ' WHERE categories_name = "' + ::oCon:EscapeStr( Rtrim( ::GetTipArt() ) ) + '"' )

   if oQuery:Open()

      if oQuery:RecCount() > 0

         oQuery:GoTop()
         while !oQuery:Eof()

            nCategories       := oQuery:FieldGet( 1 )



            oQuery2           := TMSQuery():New( ::oCon, "SELECT * FROM " + oTablaFamilias:cName + " WHERE categories_id = " + Alltrim( Str( nCategories ) ) + " AND parent_id = " + Alltrim( Str( ::oFam:cCodWeb ) ) )

            if oQuery2:Open()

               if oQuery2:RecCount() > 0

                  if oQuery2:FieldGet( 1 ) <> 0

                     nCategories2   := oQuery2:FieldGet( 1 )

                  end

               end

            end

            oQuery2:Free()

            oQuery2  := nil



            oQuery:Skip()

         end

         nCategories := nCategories2

      else

         nCategories := 0

      end

   end

   oQuery:Free()

   oQuery            := nil
























return ( nCategories )



UTILITY STATIC function TComercio_AppCustomers( oTablaClientes, oTablaClientesDirec, oTablaClientesinfo, oTablaZona) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nSpace
   local cClave
   local cConstante        := "00"
   local nCodigoWeb        := 0
   local nCodigoDirec      := 0
   local cFirstName
   local cLastName
   local prueba
   local id_pais
   local id_zona
   local cProvincia

   oTablaClientes:GoTop()
   oTablaClientesDirec:GoTop()
   oTablaZona:GoTop()





   if ::oCli:nTipCli <> 3

      cProvincia     := Upper( SubStr( ::oCli:Provincia, 1, 1 ) ) + Lower( SubStr( ::oCli:Provincia, 2 ) )

      if oTablaZona:RecCount() > 0 .AND. !oTablaZona:Find( 4, cProvincia, .T. )

         ::SetText( "Error Provincia no encontrada del Cliente " + Rtrim( ::oCli:Titulo ), 3 )

         return .F.

      else

         oTablaZona:Load()
         id_zona     := oTablaZona:GetBuffer( 1 )
         id_pais     := oTablaZona:GetBuffer( 2 )

      end

      if ::oCli:cCodWeb == 0





         if Empty( ::oCli:Domicilio ) .OR. Empty(::oCli:CodPostal ) .OR. Empty(::oCli:Poblacion ) .OR. Empty(::oCli:Provincia )
            return .F.
         end





         nSpace               := At( " ", ::oCli:Titulo )
         cFirstName           := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, 1, nSpace ) )
         cLastName            := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, nSpace + 1 ) )

         oTablaClientes:Blank()
         oTablaClientes:FieldPut( 3, cFirstName  )
         oTablaClientes:FieldPut( 4, cLastName )
         oTablaClientes:FieldPut( 6, ::oCli:cMeIInt )
         oTablaClientes:FieldPut( 8, ::oCli:Telefono )
         oTablaClientes:FieldPut( 9, ::oCli:Fax )
         oTablaClientes:FieldPut( 10, ( hb_md5( cConstante + Rtrim( ::oCli:cClave ) ) + ":" + cConstante ) )

         if oTablaClientes:Insert()

             ::SetText( "Aadiendo Cliente " + Rtrim( ::oCli:Titulo ), 3 )

             nCodigoWeb       := ::oCon:GetInsertId()

             ::oCli:fieldPutByName( "cCodWeb", nCodigoWeb )

         else
             ::SetText( "Error aadiendo Cliente " + Rtrim( ::oCli:Titulo ) + " en tabla customers", 3 )
         end





         oTablaClientesDirec:Blank()
         oTablaClientesDirec:FieldPut( 2,  nCodigoWeb )
         oTablaClientesDirec:FieldPut( 5,  cFirstName )
         oTablaClientesDirec:FieldPut( 6,  cLastName )
         oTablaClientesDirec:FieldPut( 7,  ::oCon:EscapeStr( ::oCli:Domicilio ) )
         oTablaClientesDirec:FieldPut( 9,  ::oCon:EscapeStr( ::oCli:CodPostal ) )
         oTablaClientesDirec:FieldPut( 10, ::oCon:EscapeStr( ::oCli:Poblacion ) )
         oTablaClientesDirec:FieldPut( 11, ::oCon:EscapeStr( ::oCli:Provincia ) )
         oTablaClientesDirec:FieldPut( 12, id_pais )
         oTablaClientesDirec:FieldPut( 13, id_zona )


         if !oTablaClientesDirec:Insert()
            ::SetText( "Error aadiendo Cliente " + Rtrim( ::oCli:Titulo ) + " en tabla Address_book", 3 )
         end

         nCodigoDirec         := ::oCon:GetInsertId()





         oTablaClientes:Refresh()

         if oTablaClientes:RecCount() > 0 .AND. oTablaClientes:Find( 1, nCodigoDirec, .T. )

             oTablaClientes:Load()
             oTablaClientes:FieldPut( 7, nCodigoDirec )
             oTablaClientes:update()

         end

      else





         nSpace               := At( " ", ::oCli:Titulo )
         cFirstName           := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, 1, nSpace ) )
         cLastName            := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, nSpace + 1 ) )

         if oTablaClientes:RecCount() > 0 .AND. oTablaClientes:Find( 1, ::oCli:cCodWeb, .T. )

            oTablaClientes:Load()
            oTablaClientes:FieldPut( 3, cFirstName  )
            oTablaClientes:FieldPut( 4, cLastName )
            oTablaClientes:FieldPut( 6, ::oCli:cMeIInt )
            oTablaClientes:FieldPut( 10, ( hb_md5( cConstante + Rtrim( ::oCli:cClave ) ) + ":" + cConstante ) )
            oTablaClientes:FieldPut( 8, ::oCli:Telefono )

            if oTablaClientes:update()
               ::SetText( "Modificando cliente " + Rtrim( ::oCli:Titulo ), 3 )
            else
               ::SetText( "Error modificando cliente " + Rtrim( ::oCli:Titulo ) + " en tabla customers", 3 )
            end
         end





         if oTablaClientesDirec:RecCount() > 0 .AND. oTablaClientesDirec:Find( 1, ::oCli:cCodWeb, .T. )

            oTablaClientesDirec:Load()
            oTablaClientesDirec:FieldPut( 5, cFirstName  )
            oTablaClientesDirec:FieldPut( 6, cLastName )
            oTablaClientesDirec:FieldPut( 7, ::oCon:EscapeStr( ::oCli:Domicilio ) )
            oTablaClientesDirec:FieldPut( 9, ::oCon:EscapeStr( ::oCli:CodPostal ) )
            oTablaClientesDirec:FieldPut( 10, ::oCon:EscapeStr( ::oCli:Poblacion ) )
            oTablaClientesDirec:FieldPut( 11, ::oCon:EscapeStr( ::oCli:Provincia ) )
            oTablaClientesDirec:FieldPut( 12, id_pais )
            oTablaClientesDirec:FieldPut( 13, id_zona )

            if !oTablaClientesDirec:update()
               ::SetText( "Error modificando cliente " + Rtrim( ::oCli:Titulo ) + " en tabla Address_book", 3 )
            end

         end

      end

   end

Return( nCodigoWeb )



UTILITY STATIC function TComercio_AppCustomers_bd( oTablaClientes, oTablaClientesDirec, oTablaZona) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local cCodCliente
   local cCodObraCliente
   local cNextcCodObr
   local cLastCli := ""

   ::nTotMeter    := 0

   oTablaClientes:Refresh()
   oTablaClientesDirec:Refresh()

   if oTablaClientes:RecCount() > 0

      for n := 1 to oTablaClientes:RecCount()
         ::nTotMeter += 1
         oTablaClientes:Skip()
      next

   end

   if !Empty( ::oMeterL )
      ::oMeterL:SetTotal( ::nTotMeter )
   end

   ::nActualMeterL := 1





   oTablaClientes:GoTop()

   if oTablaClientes:RecCount() > 0

   for n := 1 to oTablaClientes:RecCount()

      ::MeterParticularText( " Descargando cliente " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

      oTablaClientes:Load()

      if !::oCli:SeekInOrd( Str( oTablaClientes:GetBuffer( 1 ), 11 ), "cCodWeb" )

         cLastCli          := dbLast(  ::oCli, 1 )

         ::oCli:Append()
         ::oCli:Blank()



         ::oCli:Cod        := NextKey( cLastCli, ::oCli:cAlias, "0", RetNumCodCliEmp() )
         ::oCli:Titulo     := if ( uFieldEmpresa( "LAPELNOMB" ), oTablaClientes:GetBuffer( 4 ) + ", " + oTablaClientes:GetBuffer ( 3 ), oTablaClientes:GetBuffer( 3 ) + ", " + oTablaClientes:GetBuffer ( 4 ) )
         ::oCli:Telefono   := oTablaClientes:GetBuffer( 8 )
         ::oCli:Fax        := if( Empty( oTablaClientes:GetBuffer( 9 ) ), "", oTablaClientes:GetBuffer( 9 ) )
         ::oCli:cMeiInt    := oTablaClientes:GetBuffer( 6 )
         ::oCli:cClave     := oTablaClientes:GetBuffer( 10 )
         ::oCli:lPubInt    := .T.
         ::oCli:nTipCli    := 3
         ::oCli:cCodWeb    := oTablaClientes:GetBuffer( 1 )
         ::oCli:lChgPre    := .T.

         if ::oCli:Save()

            ::SetText( "Aadido cliente de la web " + Rtrim( ::oCli:Titulo ), 3 )

         else

            ::SetText( "Error al aadir cliente de la tabla customer en cliente" + Rtrim( ::oCli:Titulo ), 3 )

         end

      else

         if ::oCli:nTipCli == 3

            ::oCli:Load()

            ::oCli:Titulo     := if ( uFieldEmpresa( "LAPELNOMB" ), oTablaClientes:GetBuffer( 4 ) + ", " + oTablaClientes:GetBuffer ( 3 ), oTablaClientes:GetBuffer( 4 ) + ", " + oTablaClientes:GetBuffer ( 3 ) )
            ::oCli:Telefono   := oTablaClientes:GetBuffer( 8 )
            ::oCli:Fax        := if( Empty( oTablaClientes:GetBuffer( 9 ) ), "", oTablaClientes:GetBuffer( 9 ) )
            ::oCli:cMeiInt    := oTablaClientes:GetBuffer( 6 )
            ::oCli:cClave     := oTablaClientes:GetBuffer( 10 )
            ::oCli:lPubInt    := .T.
            ::oCli:cCodWeb    := oTablaClientes:GetBuffer( 1 )

            if ::oCli:save()

               ::SetText( "Modificando cliente " + Rtrim( ::oCli:Titulo ), 3 )

            else

               ::SetText( "Error al modificar cliente" + Rtrim( ::oCli:Titulo ), 3 )

            end

         end

      end

      if !Empty( oTablaClientes:GetBuffer( 7 ) ) .AND. oTablaclientesDirec:Find( 1, oTablaClientes:GetBuffer( 7 ) , .T. )

         oTablaClientesDirec:Load()

         ::oCli:Load()

         ::oCli:Domicilio        := oTablaClientesDirec:GetBuffer( 7 )
         ::oCli:CodPostal        := oTablaClientesDirec:GetBuffer( 9 )
         ::oCli:Poblacion        := oTablaClientesDirec:GetBuffer( 10 )
         if oTablaClientesDirec:Fieldpos( "entry_NIF" ) <> 0
            ::oCli:Nif           := oTablaClientesDirec:FieldGetByName( "entry_NIF" )
         end
         ::oCli:Provincia     := BuscarProvincia( oTablaClientesDirec:GetBuffer( 13 ), oTablaZona )

         if !::oCli:Save()
            ::SetText( "Error al aadir cliente de la tabla Address_Book en cliente" + Rtrim( ::oCli:Titulo ), 3 )
         end

      end

      oTablaClientes:Skip()

   next

   end





   oTablaClientesDirec:GoTop()

   if oTablaClientesDirec:RecCount() > 0

   for n := 1 to oTablaClientesDirec:RecCount()

      oTablaClientesDirec:Load()

      cCodCliente          := BuscarCliente( oTablaclientesDirec:GetBuffer( 2 ), ::oCli )

      if !Empty( cCodCliente )

         cCodObraCliente   := oTablaclientesDirec:GetBuffer( 1 )
         cCodObraCliente   := Str( cCodObraCliente, 11 )

         if ::oObras:SeekInOrd( cCodObraCliente, "cCodWeb" )

            ::oObras:Load()

            ::oObras:cCodCli     := cCodCliente
            ::oObras:cNomObr     := oTablaclientesDirec:GetBuffer( 5 ) + ", " + oTablaclientesDirec:GetBuffer( 6 )
            ::oObras:cDirObr     := oTablaclientesDirec:GetBuffer( 7 )
            ::oObras:cPobObr     := oTablaclientesDirec:GetBuffer( 10 )
            ::oObras:cPrvObr     := BuscarProvincia( oTablaClientesDirec:GetBuffer( 13 ), oTablaZona )
            ::oObras:cPosObr     := oTablaclientesDirec:GetBuffer( 9 )
            ::oObras:cCodWeb     := oTablaclientesDirec:GetBuffer( 1 )
            if oTablaClientesDirec:Fieldpos( "entry_telephone" ) <> 0
            ::oObras:cTelObr     := oTablaClientesDirec:FieldGetByName( "entry_telephone" )
            end

            if !::oObras:Save()
               ::SetText( "Error al modificar direccin " + Rtrim( oTablaclientesDirec:GetBuffer( 7 ) ), 3 )
            end

         else



            ::oObras:Append()

            ::oObras:cCodCli     := cCodCliente
            ::oObras:cCodObr     := "@" + Alltrim( cCodObraCliente )
            ::oObras:cNomObr     := oTablaclientesDirec:GetBuffer( 5 ) + ", " + oTablaclientesDirec:GetBuffer( 6 )
            ::oObras:cDirObr     := oTablaclientesDirec:GetBuffer( 7 )
            ::oObras:cPobObr     := oTablaclientesDirec:GetBuffer( 10 )
            ::oObras:cPrvObr     := BuscarProvincia( oTablaClientesDirec:GetBuffer( 13 ), oTablaZona )
            ::oObras:cPosObr     := oTablaclientesDirec:GetBuffer( 9 )
            ::oObras:cCodWeb     := oTablaclientesDirec:GetBuffer( 1 )
            if oTablaClientesDirec:Fieldpos( "entry_telephone" ) <> 0
            ::oObras:cTelObr     := oTablaClientesDirec:FieldGetByName( "entry_telephone" )
            end

            if !::oObras:Save()
               ::SetText( "Error al aadir direccin " + Rtrim( oTablaclientesDirec:GetBuffer( 7 ) ), 3 )
            end

         end

       end

      oTablaClientesDirec:Skip()

   next

   end

Return ( self )



Function HB_DBCREATETEMP()

Return( nil )



UTILITY STATIC function TComercio_AppPedidos( oTablaPedidos, oTablaPedidosPro, oTablaPedidosAtributos, oTablaPedidosTotal, oTablaPedidosHistory) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n
   local n2
   local n3
   local n4
   local cont           := 0
   local dFecha
   local cArticulo
   local nNumeroPedido
   local nNumero
   local cCodArt        := Space( 18 )
   ::nTotMeter          := 0





   oTablaPedidos:GoTop()

   if oTablaPedidos:RecCount() > 0

   for n := 1 to oTablaPedidos:RecCount()

      oTablaPedidos:Load()

      if oTablaPedidos:GetBuffer( 39 ) == 1 .AND. ::oCli:SeekInOrd( Str( oTablaPedidos:GetBuffer( 2 ), 11 ), "cCodWeb" )
         ::nTotMeter    +=1
      end

      oTablaPedidos:skip()
   next

   end

   if !Empty( ::oMeterL )
      ::oMeterL:SetTotal( ::nTotMeter )
   end

   ::nActualMeterL   := 1





   oTablaPedidos:GoTop()
   oTablaPedidosPro:GoTop()
   oTablaPedidosAtributos:GoTop()
   oTablaPedidosTotal:GoTop()
   oTablaPedidosHistory:GoTop()

   if oTablaPedidos:RecCount() > 0

   for n := 1 to oTablaPedidos:RecCount()

      oTablaPedidos:Load()

      if oTablaPedidos:GetBuffer( 39 ) == 1

         if ::oCli:SeekInOrd( Str( oTablaPedidos:GetBuffer( 2 ), 11 ), "cCodWeb" )

            ::MeterParticularText( " Descargando pedidos " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            Set( 4, "yyyy/mm/dd" )
            dFecha                     := Ctod( Left( oTablaPedidos:GetBuffer( 38 ), 10 ) )
            Set( 4, "dd/mm/yyyy" )

            nNumeroPedido              := nNewDoc( ::cSeriePed, ::oPedCliT:cAlias, "nPedCli", 9, ::oCount:cAlias )
            nNumero                    := oTablaPedidos:GetBuffer( 1 )

            ::oPedCliT:Append()

            ::oPedCliT:cSerPed         := ::cSeriePed
            ::oPedCliT:nNumPed         := nNumeroPedido
            ::oPedCliT:cSufPed         := RetSufEmp()
            ::oPedCliT:cCodCli         := ::oCli:Cod
            ::oPedCliT:cCodAlm         := cDefAlm()
            ::oPedCliT:cCodCaj         := cDefCaj()
            ::oPedCliT:cDivPed         := "EUR"
            ::oPedCliT:cNomCli         := oTablaPedidos:GetBuffer( 3 )
            ::oPedCliT:cDirCli         := oTablaPedidos:GetBuffer( 5 )
            ::oPedCliT:cPobCli         := oTablaPedidos:GetBuffer( 7 )
            ::oPedCliT:cPosCli         := oTablaPedidos:GetBuffer( 8 )
            if oTablaPedidos:Fieldpos( "billing_nif" ) <> 0
            ::oPedCliT:cDniCli         := oTablaPedidos:FieldGetByName( "billing_nif" )
            end
            ::oPedCliT:dFecPed         := dFecha
            ::oPedCliT:lInternet       := .T.
            ::oPedCliT:cTimCre         := Time()
            ::oPedCliT:cCodPgo         := BuscarFormaPago( oTablaPedidos:GetBuffer( 32 ), ::oFPago )
            ::oPedCliT:nManObr         := BuscarGastoEnvio( oTablaPedidos:GetBuffer( 1 ), oTablaPedidosTotal )
            ::oPedCliT:cManObr         := "Gasto envio"

            ::oPedCliT:cCodObr         := BuscarDireccion( oTablaPedidos:GetBuffer( "billing_street_address" ), ::oObras, ::oCli:Cod )
            ::oPedCliT:cCodWeb         := oTablaPedidos:GetBuffer( 1 )
            ::oPedCliT:nEstado         := 1
            ::oPedCliT:lSndDoc         := .T.





            oTablaPedidosHistory:GoTop()

            for n4 := 1 to oTablaPedidosHistory:RecCount()

               oTablaPedidosHistory:Load()

               if oTablaPedidosHistory:GetBuffer( 2 ) == nNumero
                  ::oPedCliT:mComent   := oTablaPedidosHistory:GetBuffer( 6 )
               end

               oTablaPedidosHistory:Skip()

            next

            if ::oPedCliT:save()
               ::SetText( "Aadido pedido de " + Rtrim( ::oPedCliT:cNomCli ), 3 )
            else
               ::SetText( "Error al aadir pedido en la tabla cabecera" + Rtrim( ::oPedCliT:cNomCli ), 3 )
            end

         end

         oTablaPedidosPro:GoTop()
         for n2 := 1 to oTablaPedidosPro:RecCount()

            oTablaPedidosPro:Load()

            if oTablaPedidosPro:GetBuffer( 2 ) == nNumero

               cCodArt                    := ::cModelArticulo( oTablaPedidosPro:GetBuffer( 3 ) )

               ::oPedCliL:Append()

               ::oPedCliL:cSerPed         := ::cSeriePed
               ::oPedCliL:nNumPed         := nNumeroPedido
               ::oPedCliL:cSufPed         := RetSufEmp()
               ::oPedCliL:cRef            := cCodArt
               ::oPedCliL:cDetalle        := oTablaPedidosPro:GetBuffer( 5 )
               if Empty( cCodArt )
                  ::oPedCliL:mLngDes      := oTablaPedidosPro:GetBuffer( 5 )
               end
               ::oPedCliL:nIva            := oTablaPedidosPro:GetBuffer( 8 )
               ::oPedCliL:nPreDiv         := oTablaPedidosPro:GetBuffer( 7 )

               ::oPedCliL:nUniCaja        := oTablaPedidosPro:GetBuffer( 9 )

               if ::oArt:SeekInOrd( cCodArt, "Codigo" )

                  ::oPedCliL:lLote        := ::oArt:lLote
                  ::oPedCliL:cLote        := ::oArt:cLote

               end

               for n3 := 1 to oTablaPedidosAtributos:RecCount()

                  oTablaPedidosAtributos:Load()

                  if oTablaPedidosAtributos:GetBuffer( 2 ) == oTablaPedidosPro:GetBuffer( 2 ) .AND. oTablaPedidosAtributos:GetBuffer( 3 ) == oTablaPedidosPro:GetBuffer( 1 )

                     if cont == 0



                        if ::oPro:SeekInOrd( oTablaPedidosAtributos:GetBuffer( 4 ), "cDesPro" )

                           ::oPedCliL:cCodPr1      := ::oPro:cCodPro

                           if ::oTblPro:SeekInOrd( ::oPedCliL:cCodPr1 + oTablaPedidosAtributos:GetBuffer( 5 ), "cCodDes" )
                              ::oPedCliL:cValPr1   := ::oTblPro:cCodTbl
                              cont                 := 1
                           end

                        end

                     else



                        if ::oPro:SeekInOrd( oTablaPedidosAtributos:GetBuffer( 4 ), "cDesPro" )

                           ::oPedCliL:cCodPr2      := ::oPro:cCodPro

                           if ::oTblPro:SeekInOrd( ::oPedCliL:cCodPr2 + oTablaPedidosAtributos:GetBuffer( 5 ), "cCodDes" )
                              ::oPedCliL:cValPr2   := ::oTblPro:cCodTbl
                           end

                        end
                     end

                  end

                  oTablaPedidosAtributos:skip()
               next

               if !::oPedCliL:Save()
                  ::SetText( "Error al aadir pedido en la tabla PedCliL" + Rtrim( ::oPedCliL:cNomCli ), 3 )
               end

            end

            oTablaPedidosPro:Skip()

         next

      end

      oTablaPedidos:Skip()

   next

   end

Return( nil )



UTILITY STATIC function TComercio_AppendImages() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cImage
   local oFile
   local hSource
   local nBytes
   local cBuffer  := Space( 2000 )
   local nCount   := 0

   ::nTotMeter    := 0

   ::oInt         := TInternet():New()
   ::oFtp         := TFtp():New( ::cHostFtp, ::oInt, ::cUserFtp, ::cPasswdFtp, ::lPassiveFtp )

   if Empty( ::oFtp ) .OR. Empty( ::oFtp:hFtp )

      MsgStop( "Imposible conectar al sitio ftp " + ::cHostFtp )

   else

      if !Empty( ::cDImagen )
         ::oFtp:CreateDirectory( ::cDImagen )
         ::oFtp:SetCurrentDirectory( ::cDImagen )
      end

      ::SetText( "Actualizando imagenes", 2 )





      ::nTotMeter          := len( ::aImages )
      nCount               := 1

      for each cImage in ::aImages

         ::SetText( "Subiendo imagen " + cNoPath( cImage ), 3 )

         ::MeterParticularText( " Subiendo imagen " + AllTrim( Str( nCount ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

         oFile          := TFtpFile():New( cFileBmpName( cImage ), ::oFtp )
         if !oFile:PutFile( ::oMeterL )
            ::SetText( "Error copiando imagen " + cFileBmpName( cImage ), 3 )
         end

         nCount            += 1

         oFile:End()

         sysRefresh()

      next

   end

   if !Empty( ::oInt )
      ::oInt:end()
   end

   if !Empty( ::oFtp )
      ::oFtp:end()
   end

Return( nil )



UTILITY STATIC function TComercio_AppendImages_bd() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cImage
   local aFile
   local cFile
   local oFile
   local hTarget
   local nBytes
   local nTotal         := 0
   local cBuffer        := Space( 2000 )
   local nTotalBytes    := 0
   local nCount         := 1

   ::oInt               := TInternet():New()
   ::oFtp               := TFtp():New( ::cHostFtp, ::oInt, ::cUserFtp, ::cPasswdFtp, ::lPassiveFtp )

   ::nTotMeter          := 0

   if Empty( ::oFtp ) .OR. Empty( ::oFtp:hFtp )

      MsgStop( "Imposible conectar al sitio ftp " + ::cHostFtp )

   else

      ::SetText( "Actualizando imagenes", 2 )

      ::oFtp:SetCurrentDirectory( ::cDImagen )

      aFile       := ::oFtp:Directory( "*.*" )





      ::nTotMeter    := len( ::aImages ) - 1

      for each cImage in ::aImages

         for each cFile in aFile

         if Upper( cNoPathInt( cImage ) ) == Upper( cFile[ 1 ] )

            nTotal         := 0

            ::SetText( "Bajando imagen " + cFile[ 1 ], 3 )

            ::MeterParticularText( "Descargando imagen " + AllTrim( Str( nCount ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            hTarget        := fCreate( uFieldEmpresa( "cDirImg" ) + "\" + cFile[ 1 ] )

            oFile          := TFtpFile():New( cFile[ 1 ], ::oFtp )
            oFile:OpenRead()





            ::oMeterL:SetTotal( cFile[ 2 ] )





            while .T.

               cBuffer     := oFile:Read()
               nBytes      := Len( cBuffer )

               if nBytes > 0
                  fWrite( hTarget, cBuffer, nBytes )
               else
                  exit
               end

               nTotal      += nBytes

               ::oMeterL:Set( nTotal )

               sysRefresh()

            end

            fClose( hTarget )

            oFile:End()

            nCount      += 1

         end

         next

         sysRefresh()

      next

   end

   if !Empty( ::oInt )
      ::oInt:end()
   end

   if !Empty( ::oFtp )
      ::oFtp:end()
   end

Return( nil )



UTILITY STATIC function TComercio_AppendFabricantes_bd( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodFab
   local oTablaFabricantes
   local oTablaFabricantes_info
   local n


   if oDb:ExistTable( "manufacturers" )  .AND. oDb:ExistTable( "manufacturers_info" )

      oTablaFabricantes           := TMSTable():New( oDb, "manufacturers" )
      oTablaFabricantes_info      := TMSTable():New( oDb, "manufacturers_info" )






      if oTablaFabricantes:Open() .AND. oTablaFabricantes_info:Open()

         oTablaFabricantes:GoTop()
         oTablaFabricantes_info:GoTop()





         ::SetText( "Tabla de fabricantes ", 2 )

         ::AppFabricantes_bd( oTablaFabricantes, oTablaFabricantes_info )

      else

         ::SetText ( "No se puede abrir las tablas de fabricante", 1  )

      end

      oTablaFabricantes:Free()
      oTablaFabricantes_info:Free()

   else

      ::SetText( "No existe la tabla de fabricantes", 1 )

   end

Return( nil )



UTILITY STATIC function TComercio_AppendFabricantes( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodFab
   local oTablaFabricantes
   local oTablaFabricantes_info
   local n

   ::nTotMeter    := 0


   if oDb:ExistTable( "manufacturers" )  .AND. oDb:ExistTable( "manufacturers_info" )

      oTablaFabricantes           := TMSTable():New( oDb, "manufacturers" )
      oTablaFabricantes_info      := TMSTable():New( oDb, "manufacturers_info" )






      if oTablaFabricantes:Open() .AND. oTablaFabricantes_info:Open()





         if ::lSincAll
            oTablaFabricantes:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaFabricantes:cName )
            oTablaFabricantes_info:oCmd:ExecDirect( "TRUNCATE TABLE " + oTablaFabricantes_info:cName )
            ::SetText ( "Tablas de fabricantes borradas corectamente ", 2  )
         end

         oTablaFabricantes:GoTop()
         oTablaFabricantes_info:GoTop()

         ::SetText ( "Actualizando Fabricantes de la web: ", 2 )





         if oTablaFabricantes:RecCount() > 0

         for n := 1 to oTablaFabricantes:RecCount()

            oTablaFabricantes:Load()

            if ::oFab:SeekInOrd( Str( oTablaFabricantes:GetBuffer( 1 ), 11 ), "cCodWeb" )

               if !::oFab:lPubInt

                  ::SetText( "Borrado registro "  + AllTrim( oTablaFabricantes:GetBuffer( 2 ) ) + " de la tabla manufacturers", 3 )

                  oTablaFabricantes:Delete()

               end

            else

               ::SetText( "Borrado registro "  + AllTrim( oTablaFabricantes:GetBuffer( 2 ) ) + " de la tabla manufacturers", 3 )

               oTablaFabricantes:Delete()

            end

            oTablaFabricantes:Skip()

         next

         end





         if oTablaFabricantes_info:RecCount() > 0

         for n := 1 to oTablaFabricantes_info:RecCount()

            oTablaFabricantes_info:Load()

            if !::oFab:SeekInOrd( Str( oTablaFabricantes_info:GetBuffer( 1 ), 11 ), "cCodWeb" )

               ::SetText( "Borrado registro "  + AllTrim( Str( oTablaFabricantes_info:GetBuffer( 2 ) ) ) + " de la tabla manufacturers_info", 3 )

               oTablaFabricantes_info:Delete()

               ::oFab:fieldPutByName( "cCodWeb", 0 )

            end
            oTablaFabricantes_info:Skip()

         next

         end





         ::oFab:GoTop()

         while !::oFab:Eof()

            if ::oFab:lPubInt .AND. ::oFab:lSndDoc
               ::nTotMeter    += 1
            end

            ::oFab:Skip()

         end

         ::oMeterL:SetTotal( ::nTotMeter )
         ::nActualMeterL := 1




         ::oFab:GoTop()

         while !::oFab:Eof()

            if ::oFab:lPubInt .AND. ::oFab:lSndDoc
               ::MeterParticularText( " Actualizando fabricantes " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )
               ::AppFabricantes( oTablaFabricantes, oTablaFabricantes_info )
            end

            ::oFab:load()
            ::oFab:lSndDoc  := .F.

            if !::oFab:Save()
               ::SetText( "Error modificando estado de fabricante", 3 )
            end

            ::oFab:Skip()

         end

      else

         ::SetText ( "No se puede abrir las tablas de fabricante", 1  )

      end

      oTablaFabricantes:Free()
      oTablaFabricantes_info:Free()

   else

      ::SetText( "No existe la tabla de fabricantes", 1 )

   end

Return( nil )



UTILITY STATIC function TComercio_AppFabricantes_bd( oTablaFabricantes, oTablaFabricantes_info) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodWeb
   local cNombre
   local cImagen
   local url
   local n

   ::nTotMeter       := 0





   oTablaFabricantes:GoTop()

   if oTablaFabricantes:RecCount() > 0

      for n := 1 to oTablaFabricantes:RecCount()

         ::nTotMeter    += 1

         oTablaFabricantes:skip()

      next

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL   := 1





   oTablaFabricantes:GoTop()

   if oTablaFabricantes:RecCount() > 0

   for n := 1 to oTablaFabricantes:RecCount()

      oTablaFabricantes:Load()

      cCodWeb              := oTablaFabricantes:GetBuffer( 1 )
      cNombre              := oTablaFabricantes:GetBuffer( 2 )
      cImagen              := oTablaFabricantes:GetBuffer( 3 )

      oTablaFabricantes_info:GoTop()

      if oTablaFabricantes_info:Find( 1, cCodWeb , .T. )
         oTablaFabricantes_info:Load()
         url               := oTablaFabricantes_info:GetBuffer( 3 )
      end

      ::MeterParticularText( " Descargando fabricante " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

      if !::oFab:SeekInOrd( Str( cCodWeb, 11 ), "cCodWeb" )

         ::oFab:Append()

         ::oFab:cCodFab       := RJust( NextVal( DbLast( ::oFab:cAlias , 1, nil, nil, 1 ) ), "0", 3 )
         ::oFab:cNomFab       := cNombre
         ::oFab:lPubInt       := .T.
         ::oFab:cImgLogo      := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )
         ::oFab:cCodWeb       := cCodWeb
         ::oFab:cUrlFab       := url

         if ::oFab:save()

            ::SetText( "Aadido fabricante " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else

            ::SetText( "Error al aadir fabricante" + Rtrim( cNombre ), 3 )

         end

      else

         ::oFab:Load()

         ::oFab:cNomFab       := cNombre
         ::oFab:lPubInt       := .T.
         ::oFab:cImgLogo      := uFieldEmpresa( "cDirImg" ) + "\" + cNoPathInt( cImagen )
         ::oFab:cCodWeb       := cCodWeb
         ::oFab:cUrlFab       := url

         if ::oFab:save()

            ::SetText( "Modificando fabricante " + Rtrim( cNombre ), 3 )

            ::AddImages( cImagen )

         else

            ::SetText( "Error al modificar fabricante" + Rtrim( cNombre ), 3 )

         end

      end

   oTablaFabricantes:skip()

   next

   end

Return( nil )



UTILITY STATIC function TComercio_AppFabricantes( oTablaFabricantes, oTablaFabricantes_info) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodFab

   oTablaFabricantes:GoTop()
   oTablaFabricantes_info:GoTop()

   if ::oFab:cCodWeb == 0 .OR. ::lSincAll





      oTablaFabricantes:Blank()
      oTablaFabricantes:FieldPut( 2, ::oCon:EscapeStr( ::oFab:cNomFab ) )
      oTablaFabricantes:FieldPut( 3, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oFab:cImgLogo))
      oTablaFabricantes:FieldPut( 4, GetSysDate() )
      oTablaFabricantes:FieldPut( 5, GetSysDate() )

      if oTablaFabricantes:Insert()

         ::SetText( "Aadiendo fabricante " + AllTrim( ::oFab:cNomFab ), 3 )

         ::AddImages( ::oFab:cImgLogo )

         cCodFab           := ::oCon:GetInsertId()

         ::oFab:fieldPutByName( "cCodWeb", cCodFab )

      else

         ::SetText( "Error insertado"  + AllTrim( ::oFab:cNomFab ) + " en tabla manufacturers", 3 )

      end





      oTablaFabricantes_info:Blank()
      oTablaFabricantes_info:FieldPut( 1, cCodFab )
      oTablaFabricantes_info:FieldPut( 2, ::nLanguage )
      oTablaFabricantes_info:FieldPut( 3, ::oFab:cUrlFab )

      if ! oTablaFabricantes_info:Insert()

         ::SetText( "Error insertado"  + AllTrim( ::oFab:cNomFab ) + " en tabla manufacturers_info", 3 )

      end

   else



        if oTablaFabricantes:RecCount() > 0 .AND. oTablaFabricantes:Find( 1, ::oFab:cCodWeb, .T. )

            oTablaFabricantes:Load()
            oTablaFabricantes:FieldPut( 2, ::oCon:EscapeStr( ::oFab:cNomFab ) )
            oTablaFabricantes:FieldPut( 3, cNoPathInt( ::cdImagen ) + "/" + cNoPath( ::oFab:cImgLogo))
            oTablaFabricantes:FieldPut( 4, GetSysDate() )
            oTablaFabricantes:FieldPut( 5, GetSysDate() )

            if oTablaFabricantes:update()

               ::SetText( "Modificando fabricante " + Rtrim( ::oFab:cNomFab ), 3 )

               ::AddImages( ::oFab:cImgLogo )

            else

               ::SetText( "Error modificando fabricante " + Rtrim( ::oFab:cNomFab ) + " en tabla manufacturers", 3 )

            end

         end




        if oTablaFabricantes_info:RecCount() > 0 .AND. oTablaFabricantes_info:Find( 1, ::oFab:cCodWeb, .T. )

            oTablaFabricantes_info:Load()
            oTablaFabricantes_info:FieldPut( 1, cCodFab )
            oTablaFabricantes_info:FieldPut( 2, ::nLanguage )
            oTablaFabricantes_info:FieldPut( 3, ::oFab:cUrlFab )


            if !oTablaFabricantes:update()
               ::SetText( "Error modificando fabricante " + Rtrim( ::oFab:cNomFab ) + " en tabla manufacturers_info", 3 )
            end

       end

   end

Return( nil )



UTILITY STATIC function TComercio_AppIva( oTablaIva, oTablaIva_rates, oTablaZone) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigo
   local nCodigoZona       := 0

   oTablaIva:GoTop()
   oTablaIva_rates:GoTop()
   oTablaZone:GoTop()

   if oTablaZone:RecCount() > 0 .AND. oTablaZone:Find( 2, "Espaa" , .T.)
      nCodigoZona          := oTablaZone:FieldGet( 1 )
   end





   if ::oIva:cCodWeb == 0 .OR. ::lSincAll

      oTablaIva:Blank()
      oTablaIva:FieldPut( 2, ::oCon:EscapeStr( ::oIva:DescIva ) )
      oTablaIva:FieldPut( 3, ::oIva:TPIva )
      oTablaIva:FieldPut( 4, GetSysDate() )
      oTablaIva:FieldPut( 5, GetSysDate() )

      if oTablaIva:Insert()

         ::SetText( "Aadiendo " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ), 3 )

         nCodigo           := ::oCon:GetInsertId()

         ::oIva:fieldPutByName( "cCodWeb", nCodigo )

      else

         ::SetText( "Error insertado"  + AllTrim( ::oIva:DescIva  ) + " en tabla tax_class", 3 )

      end





      oTablaIva:Blank()
      oTablaIva_rates:FieldPut( 2, nCodigoZona )
      oTablaIva_rates:FieldPut( 3, nCodigo )
      oTablaIva_rates:FieldPut( 4, 1 )
      oTablaIva_rates:FieldPut( 5, ::oIva:TpIva )
      oTablaIva_rates:FieldPut( 6, ::oCon:EscapeStr( ::oIva:DescIva ) )
      oTablaIva_rates:FieldPut( 7, GetSysDate() )
      oTablaIva_rates:FieldPut( 8, GetSysDate() )

      if !oTablaIva_rates:Insert()
         ::SetText( "Error insertado"  + AllTrim( ::oIva:DescIva  ) + " en tabla tax_class", 3 )
      end

   else





      if oTablaIva:RecCount() > 0 .AND. oTablaIva:Find( 1, ::oIva:cCodWeb, .T. )

         oTablaIva:Load()
         oTablaIva:FieldPut( 2, ::oCon:EscapeStr( ::oIva:DescIva ) )
         oTablaIva:FieldPut( 3, ::oIva:TPIva )
         oTablaIva:FieldPut( 4, GetSysDate() )
         oTablaIva:FieldPut( 5, GetSysDate() )

         if oTablaIva:Update()
            ::SetText( "Modificando " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + "en la tabla tax_class", 3 )
         else
            ::SetText( "Error modificando " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + "en la tabla tax_class", 3 )
         end

      end





      if oTablaIva_rates:RecCount() > 0 .AND. oTablaIva_rates:Find( 3, ::oIva:cCodWeb, .T. )

         oTablaIva_rates:Load()
         oTablaIva_rates:FieldPut( 2, nCodigoZona )
         oTablaIva_rates:FieldPut( 4, 1 )
         oTablaIva_rates:FieldPut( 5, ::oIva:TpIva )
         oTablaIva_rates:FieldPut( 6, ::oCon:EscapeStr( ::oIva:DescIva ) )
         oTablaIva_rates:FieldPut( 7, GetSysDate() )
         oTablaIva_rates:FieldPut( 8, GetSysDate() )

         if oTablaIva_rates:Update()
            ::SetText( "Modificando " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + "en la tabla tax_rates", 3 )
         else
            ::SetText( "Error modificando " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + "en la tabla tax_rates", 3 )
         end

      end

   end

Return( nil )



 UTILITY STATIC function TComercio_AppZone( oTablaZone, oTablaGeoZone) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   Local aNombre
   Local aZona
   Local aZona2
   Local aCodigo  := {}

   Local cNombre
   Local cZona
   Local cZona2
   Local cCodigo

   oTablaZone:GoTop()
   oTablaGeoZone:GoTop()


   aNombre :={ "Espaa", "Islas" }
















































   aZona   :={ 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 158, 159, 160, 161, 162, 164, 165, 166, 167, 168, 169, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181 }



   aZona2 := { 145, 163, 170 }





    for each cNombre in aNombre

       oTablaZone:Blank()
       oTablaZone:FieldPut( 2, ::oCon:EscapeStr( cNombre ) )
       oTablaZone:FieldPut( 3, "Peninsula" )
       oTablaZone:FieldPut( 4, getsysdate() )
       oTablaZone:FieldPut( 5, getsysdate() )

       if oTablaZone:Insert()

          ::SetText( "Aadiendo Zona " + cNombre, 2 )

          aAdd ( aCodigo, ::oCon:GetInsertId() )

       else
          ::SetText( "Error aadiendo Zona " + cNombre, 2 )
       end

    next





    for each cZona in aZona

       oTablaGeoZone:Blank()
       oTablaGeoZone:FieldPut( 2, 195 )
       oTablaGeoZone:FieldPut( 3, cZona )
       oTablaGeoZone:FieldPut( 4, aCodigo[1] )
       oTablaGeoZone:FieldPut( 5, getsysdate() )
       oTablaGeoZone:FieldPut( 6, getsysdate() )

       if oTablaGeoZone:Insert()

          ::SetText( "Aadiendo Geo Zona " + str( cZona ), 2 )

       else
          ::SetText( "Error aadiendo Geo Zona " + str( cZona ), 2 )
       end

    next





    for each cZona2 in aZona2

       oTablaGeoZone:Blank()
       oTablaGeoZone:FieldPut( 2, 195 )
       oTablaGeoZone:FieldPut( 3, cZona2 )
       oTablaGeoZone:FieldPut( 4, aCodigo[2] )
       oTablaGeoZone:FieldPut( 5, getsysdate() )
       oTablaGeoZone:FieldPut( 6, getsysdate() )

       if oTablaGeoZone:Insert()

          ::SetText( "Aadiendo Geo Zona 2 " + str( cZona2 ), 2 )

       else
          ::SetText( "Error aadiendo Geo Zona 2 " + str( cZona2 ), 2 )
       end

    next

 Return( nil )



 UTILITY STATIC function TComercio_AutoInt( oTabla) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local Codigo     :=1
   local n
   local Ultimo

   oTabla:Refresh()

   if oTabla:RecCount() > 0

   for n := 1 to oTabla:RecCount()

      oTabla:Load()

      if oTabla:GetBuffer( 1 )>= Codigo
      Codigo := oTabla:GetBuffer( 1 )
      end

   oTabla:skip()

   next

   end

   Codigo += 1

Return( Codigo )



UTILITY STATIC function TComercio_AppendIva_bd( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTablaIva

   if oDb:ExistTable( "tax_class" )

      oTablaIva            := TMSTable():New( oDb, "tax_class" )





      if oTablaIva:Open()

         oTablaIva:GoTop()

         ::SetText ( "Tipos de " + cImp() + ": ", 2 )

         ::oIva:GoTop()

         ::AppIva_bd( oTablaIva )

      else

         ::SetText ( "No se puede abrir las tablas de " + cImp(), 1  )

      end

      oTablaIva:Free()

   else

      ::SetText( "No existen las tablas para el " + cImp(), 1 )

   end

Return ( Self )



UTILITY STATIC function TComercio_AppIva_bd( oTablaIva) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodWeb           := 0
   local cNombre
   local cDescrip
   local n
   local n2

   ::nTotMeter             := 0





   oTablaIva:GoTop()

   if oTablaIva:RecCount() > 0

   for n := 1 to oTablaIva:RecCount()

      ::nTotMeter          += 1

      oTablaIva:skip()

   next

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL         := 1





   oTablaIva:GoTop()

   if oTablaIva:RecCount() > 0

   for n := 1 to oTablaIva:RecCount()

      oTablaIva:Load()

      cCodWeb              := oTablaIva:GetBuffer( 1 )
      cNombre              := oTablaIva:GetBuffer( 2 )
      cDescrip             := oTablaIva:GetBuffer( 3 )





      ::MeterParticularText( " Descargando tipos de " + cImp() + Space( 1 ) + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )


      if ::oIva:SeekInOrd( Str( cCodWeb, 11 ), "cCodWeb" )

         ::oIva:Load()

         ::oIva:DescIva    := cNombre
         ::oIva:TPIva      := Val( cDescrip )

         if ::oIva:save()
            ::SetText( "Modificando " + cImp() + Space(1) + Rtrim( cNombre ), 3 )
         else
            ::SetText( "Error al modificar " + cImp() + Space(1) + Rtrim( cNombre ), 3 )
         end

      else

         ::oIva:Append()

         ::oIva:Tipo       := Alltrim( Str( cCodWeb ) )
         ::oIva:DescIva    := cNombre
         ::oIva:TPIva      := Val( cDescrip )
         ::oIva:cCodWeb    := cCodWeb

         if ::oIva:save()
            ::SetText( "Aadido " + cImp() + Space(1) + Rtrim( cNombre ), 3 )
         else
            ::SetText( "Error al aadir " + cImp() + Space(1) + Rtrim( cNombre ), 3 )
         end

      end

      oTablaIva:skip()

   next

   end

return .T.



UTILITY STATIC function TComercio_EstadoPedidos( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oTablaPedidos
   local oTablaPedidosStatus

   ::nTotMeter := 0


   if oDb:ExistTable( "orders" )  .AND. oDb:ExistTable( "orders_status_history" )

      oTablaPedidos        := TMSTable():New( oDb, "orders" )
      oTablaPedidosStatus  := TMSTable():New( oDb, "orders_status_history" )





      if oTablaPedidos:Open() .AND. oTablaPedidosStatus:Open()

         oTablaPedidos:GoTop()
         oTablaPedidosStatus:GoTop()





         ::oPedCliT:GoTop()
         while !::oPedCliT:Eof()

            if ::oPedCliT:lInternet .AND. ::oPedCliT:lSndDoc

               ::nTotMeter += 1

            end

         ::oPedCliT:Skip()

         end

         ::oMeterL:SetTotal( ::nTotMeter )
         ::nActualMeterL   := 1





         ::oPedCliT:GoTop()
         while !::oPedCliT:Eof()

            if ::oPedCliT:lInternet .AND. ::oPedCliT:lSndDoc

               ::MeterParticularText( "Actualizando estado de pedidos " + AllTrim( Str( ::nActualMeterL ) ) + " de " + AllTrim( Str( ::nTotMeter ) ) )

               ::CambiarEPedidos( oTablaPedidos, oTablaPedidosStatus )

               ::oPedCliT:load()
               ::oPedCliT:lSndDoc := .F.

               if !::oPedCliT:Save()
                  ::SetText( "Error modificando estado de pedido", 3 )
               end

            end

         ::oPedCliT:Skip()

         end

      else

         ::SetText ( "No se puede abrir tablas para actualizar estados de pedidos", 1  )

      end

      oTablaPedidos:Free()
      oTablaPedidosStatus:Free()

   else

      ::SetText( "No existe las tablas para los estados de pedidos", 1 )

   end

Return ( self )



UTILITY STATIC function TComercio_CambiarEPedidos( oTablaPedidos, oTablaPedidosStatus) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nEstado     := 0

   oTablaPedidos:GoTop()
   oTablaPedidosStatus:GoTop()

   if oTablaPedidos:Find( 1, ::oPedCliT:cCodWeb , .T. )

      oTablaPedidos:Load()

      if ::oPedCliT:nEstado == 1

         nEstado                    := 2

         oTablaPedidos:FieldPut( 39, 2 )
         oTablaPedidos:update()

         if ::oPedCliI:SeekInOrd( ::oPedCliT:cSerPed + Str( ::oPedCliT:nNumPed ) + ::oPedCliT:cSufPed , "lSndWeb" )

            while !::oPedCliI:Eof()

               oTablaPedidosStatus:Blank()
               oTablaPedidosStatus:FieldPut( 2, ::oPedCliT:cCodWeb )
               oTablaPedidosStatus:FieldPut( 3, nEstado )
               oTablaPedidosStatus:FieldPut( 4, GetSysDate() )
               oTablaPedidosStatus:FieldPut( 5, 1 )
               oTablaPedidosStatus:FieldPut( 6, ::oPedCliI:mDesInc )

               if !oTablaPedidosStatus:Insert()
                  ::SetText( "Error insertando historico de pedido " + ::oPedCliT:cCodWeb , 3 )
               end

               ::oPedCliI:load()
               ::oPedCliI:lSndWeb   := .T.

               if !::oPedCliI:Save()
                  ::SetText( "Error modificando historico de pedido", 3 )
               end

            ::oPedCliI:Skip()

            end

         end

      else

         nEstado     := 3

         oTablaPedidos:FieldPut( 39, 3 )
         oTablaPedidos:Update()

         oTablaPedidosStatus:Blank()
         oTablaPedidosStatus:FieldPut( 2, ::oPedCliT:cCodWeb )
         oTablaPedidosStatus:FieldPut( 3, nEstado )
         oTablaPedidosStatus:FieldPut( 4, GetSysDate() )
         oTablaPedidosStatus:FieldPut( 5, 1 )
         oTablaPedidosStatus:FieldPut( 6, "Pedido enviado" )

         if !oTablaPedidosStatus:Insert()
            ::SetText( "Error insertando historico de pedido " + ::oPedCliT:cCodWeb , 3 )
         end

      end

   end

Return .T.



UTILITY STATIC function TComercio_AddImages( cImage) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aImages, cImage ) == 0
      aAdd( ::aImages, cImage )
   end

Return ( ::aImages )



UTILITY STATIC function TComercio_ChangeSincAll() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if ::lSincAll

      ::lArticulos      := .T.
      ::lFamilias       := .T.
      ::lPedidos        := .T.
      ::lFabricantes    := .T.
      ::lIva            := .T.

      ::oArticulos:Disable()
      ::oFamilias:Disable()
      ::oPedidos:Disable()
      ::oFabricantes:Disable()
      ::oTipIva:Disable()

   else

      ::oArticulos:Enable()
      ::oFamilias:Enable()
      ::oPedidos:Enable()
      ::oFabricantes:Enable()
      ::oTipIva:Enable()

   end

Return .T.



UTILITY STATIC function TComercio_cModelArticulo( nId) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local cModel      := ""

   oQuery            := TMSQuery():New( ::oCon, "SELECT * FROM " + "products" + ' WHERE products_id = "' + Alltrim( Str( nId ) ) + '"' )
   if oQuery:Open()

      if oQuery:RecCount() > 0
         cModel      := oQuery:FieldGet( 3 )
      end

   end

   oQuery:Free()

   oQuery            := nil

return ( cModel )



UTILITY STATIC function TComercio_GetTipArt() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cTipArt      := ""

   if !Empty ( ::oTipArt:cNomInt )
      cTipArt  := ::oTipArt:cNomInt
   else
      cTipArt  := ::oTipArt:cNomTip
   end

return ( cTipArt )



UTILITY STATIC function TComercio_GetPropArt() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cPropArt      := ""

   if !Empty  ( ::oPro:cNomInt )
      cPropArt  := ::oPro:cNomInt
   else
      cPropArt  := ::oPro:cDesPro
   end

return ( cPropArt )




Function SetAutoRecive()

   if Empty( oComercio )
      oComercio   := TComercio():New()
   end






   if !Empty( oComercio )           .AND.  !Empty( oComercio:cHost )     .AND.  !Empty( oComercio:cUser )     .AND.  !Empty( oComercio:cPasswd )   .AND.  !Empty( oComercio:cDbName )   .AND.  ( oComercio:nSecondTimer <> 0 )

      oTimer      := TTimer():New( oComercio:nSecondTimer, {|| oComercio:AutoRecive() } )
      oTimer:Activate()

   end

Return( nil )



Function KillAutoRecive()

   if !Empty( oTimer )
      oTimer:End()
   end

   oTimer         := nil
   oComercio      := nil

Return( nil )



Static Function BuscarCodFam( cCodigo, oFam )

   local cCodFamilia

   if oFam:SeekInOrd( Str( cCodigo, 11 ), "cCodWeb" )

      cCodFamilia       := oFam:cCodfam

   end

Return cCodFamilia



UTILITY STATIC function TComercio_GetLanguage( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cCodLanguage
   local oTablaLanguages





   if oDb:ExistTable( "languages" )

      oTablaLanguages                        := TMSTable():New( oDb, "languages" )





      if oTablaLanguages:Open()




         if oTablaLanguages:RecCount() > 0 .AND. oTablaLanguages:Find( 5, "espanol", .F. )
            oTablaLanguages:Load()
            cCodLanguage   := oTablaLanguages:GetBuffer( 1 )
         end

      end

   end

Return cCodLanguage



Static Function BuscarCodPro( cCodigo, oPro )

   local cCodPro

   if oPro:SeekInOrd( Str( cCodigo, 11 ), "cCodWeb" )

      cCodPro       := oPro:cCodPro

   end

Return cCodPro



Static Function BuscarCodIva( cCodigo, oIva )

   local cCodIva

   if oIva:SeekInOrd( Str( cCodigo, 11 ), "cCodWeb" )
      cCodIva           := oIva:Tipo
   end

Return cCodIva



Static Function BuscarCodFab( cCodigo, oFab )

   local cCodFab

   if oFab:SeekInOrd( Str( cCodigo, 11 ), "cCodWeb" )

      cCodFab           := oFab:cCodFab

   end

Return cCodFab



Static Function BuscarProvincia( cCodZona, oTablaZona )

   local cNomZona := ""

   if ValType( cCodZona ) == "N" .AND. cCodZona <> 0

      if oTablaZona:Find( 1, cCodZona , .T. )

         oTablaZona:load()

         cNomZona    := oTablaZona:GetBuffer( 4 )

      end

   end

Return cNomZona



Static Function BuscarCliente( cCodCli, oCli )

   local cCodigo := ""

   if oCli:SeekInOrd( Str( cCodCli, 11 ), "cCodWeb" )
      cCodigo    := oCli:Cod
   end

Return cCodigo



Static Function BuscarFormaPago( cNombre , oFPago )

   local cCodigo  := Space( 2 )

   if oFPago:SeekInOrd( Upper( cNombre ), "cDesPgoBig" )
      cCodigo     := oFPago:cCodPago
   end

Return cCodigo



Static Function BuscarGastoEnvio( cCodigo, oTotal )

   local nTotal   := 0
   local n

   if oTotal:RecCount() > 0

   for n := 1 to oTotal:RecCount()

      oTotal:Load()


      if( oTotal:GetBuffer( 2 ) == cCodigo ).AND. ( oTotal:GetBuffer( 6 ) == "ot_shipping" )

         nTotal   := oTotal:GetBuffer( 5 )

      end

   oTotal:Skip()

   next

   end

Return nTotal



Static Function BuscarDireccion( cDireccion, oObras, cCliente )

   local cCodigo

   if oObras:SeekInOrd( Upper( cDireccion ), "cDirObr" )
      cCodigo     := oObras:cCodObr
   end

Return cCodigo



UTILITY STATIC function TComercio_SeleccionFamilia() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local cFamilia

   if oRetFld( ::oArt:FAMILIA, ::oFam, "LFAMINT" )
      cFamilia    := AllTrim( oRetFld( ::oArt:FAMILIA, ::oFam ) ) + Space( 1 ) + Rtrim( ::oArt:Nombre )
   else
      cFamilia    := ::oArt:Nombre
   end

Return cFamilia







UTILITY STATIC function TComercio_ExportarPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb
   local oBlock
   local oError




   if !::lSincAll .OR. ( ::lSincAll .AND. ApoloMsgNoYes(   "Ha seleccionado un envio global de informacin hacia la web,"          + Chr(13)+Chr(10) +  "la operacin es muy delicada y conlleva vaciar las tablas de la web."  + Chr(13)+Chr(10) +  "Desea continuar?" ,"Seleccione una opcin" ) )

      if !Empty( ::oFld )
         ::oFld:SetOption( 2 )
      end

      ::oBtnExportar:Hide()

      ::oBtnCancel:Disable()




      if ::OpenFiles()

         ::SetText ( "Intentando conectar con el servidor " + '"' + ::cHost + '"' + ", el usuario " + '"' + ::cUser + '"' + " y la base de datos " + '"' + ::cDbName + '".' , 1 )

         ::oCon            := TMSConnect():New()

         if !::oCon:Connect( ::cHost, ::cUser, ::cPasswd, ::cDbName, ::nPort )

            ::SetText ( "No se ha podido conectar con la base de datos." )

         else

            ::SetText ( "Se ha conectado con xito a la base de datos." , 1 )

            oDb            := TMSDataBase():New ( ::oCon, ::cDbName )

            if Empty( oDb )

               ::SetText ( "La Base de datos: " + ::cDbName + " no esta activa.", 1 )

            else





               ::nLanguage    := ::GetLanguagePrestashop( oDb )

               ::oMeter:SetTotal( 10 )
               ::nActualMeter := 1






               if ::lIva .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando tipos de " + cImp() )
                  ::SetText ( "Exportando tablas de tipos de " + cImp(), 2 )
                  ::AppendIvaPrestashop( odb )
                  sysRefresh()
               end





               if ::lFabricantes .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando fabricantes" )
                  ::SetText ( "Exportando tablas de fabricantes", 2 )
                  ::AppendFabricantesPrestashop()
                  sysRefresh()
               end





               if ::lFamilias .OR. ::lSincAll
                  ::MeterGlobalText( "Actualizando familias" )
                  ::SetText ( "Exportando tablas de familias de artculos", 2 )
                  ::AppendFamiliaPrestashop( odb )
                  sysRefresh()
               end





               if ::lArticulos .OR. ::lSincAll

                  ::MeterGlobalText( "Actualizando artculos" )
                  ::SetText ( "Exportando tablas de propiedades de artculos", 2 )
                  ::AppendPropiedadesPrestashop()
                  ::SetText ( "Exportando tablas de artculos", 2 )
                  ::AppendArticuloPrestashop( odb )
                  ::RecalculaPosicionesCategoriasPrestashop()
                  sysRefresh()

               end





               if ::lPedidos .OR. ::lSincAll

                  ::MeterGlobalText( "Descargando clientes" )
                  ::AppendClientPrestashop()
                  sysRefresh()

                  ::MeterGlobalText( "Descargando pedidos" )
                  ::AppendPedidoprestashop()
                  sysRefresh()

                  ::MeterGlobalText( "Actualizando estado de los pedidos" )
                  ::EstadoPedidosPrestashop()
                  sysRefresh()

               end





               if ::lCliente .OR. ::lSincAll

                  ::MeterGlobalText( "Actualizando estado de los pedidos" )
                  ::AppendClientesToPrestashop()
                  sysRefresh()

               end





               ::MeterGlobalText( "Subiendo imagenes" )

               ::AppendImagesPrestashop()

             end

         end

         ::oCon:Destroy()

         ::SetText( "Base de datos desconectada.", 1 )

         ::MeterGlobalText( "Proceso finalizado" )

      else

         ::SetText( "Error al abrir los ficheros necesarios.", 1 )

      end









      ::Closefiles()

      ::oBtnExportar:Hide()

      ::oBtnCancel:Enable()

   end

Return .T.



UTILITY STATIC function TComercio_ImportarPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oDb

   if !ApoloMsgNoYes( "Se va a iniciar el proceso de importacin desde OsCommerce, los datos de su equipo van a ser modificados." + Chr(13)+Chr(10) + Chr(13)+Chr(10) + "Desea continuar?", "Elija una opcin" )
      Return ( Self )
   end

   if !Empty( ::oFld )
      ::oFld:SetOption( 2 )
   end

   ::oBtnExportar:Disable()
   ::oBtnCancel:Disable()

   if ::OpenFiles()

      ::SetText ( "Intentando conectar con el servidor " + '"' + ::cHost + '"' + ", el usuario " + '"' + ::cUser + '"' + " y la base de datos " + '"' + ::cDbName + '".' , 1 )

      ::oCon            := TMSConnect():New()

      if !::oCon:Connect( ::cHost, ::cUser, ::cPasswd, ::cDbName, ::nPort )

          ::SetText ( "No se ha podido conectar con la base de datos." )

      else

           ::SetText ( "Se ha conectado con xito a la base de datos." , 1 )

          oDb := TMSDataBase():New ( ::oCon, ::cDbName )

          if Empty( oDb )

             ::SetText ( "La Base de datos: " + ::cDbName + " no esta activa.", 1 )

          else

            Msginfo( "Importamos en Prestashop" )

















































          end

      end

      ::oCon:Destroy()

      ::SetText( "Base de datos desconectada.", 1 )

   else

      ::SetText( "Error al abrir los ficheros necesarios.", 1 )

   end

   ::Closefiles()

   ::oBtnExportar:Enable()
   ::oBtnCancel:Enable()

Return .T.



UTILITY STATIC function TComercio_GetLanguagePrestashop( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery
   local cCodLanguage

   if oDb:ExistTable( "ps_lang" )

      oQuery               := TMSQuery():New( ::oCon, "SELECT * FROM ps_lang WHERE active = 1" )

      if oQuery:Open()

         if oQuery:RecCount() > 0

            cCodLanguage   := oQuery:FieldGet( 1 )

         end

      end

   end

   oQuery:Free()

Return if( !Empty( cCodLanguage ), cCodLanguage, 3 )



UTILITY STATIC function TComercio_AppendFamiliaPrestashop( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n

   if ::lSincAll





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_category" )
         ::SetText ( "Tabla ps_category borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_category", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_category_lang" )
         ::SetText ( "Tabla ps_category_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_category_lang", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_category_product" )
         ::SetText ( "Tabla ps_category_product borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_category_product", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_category_group" )
         ::SetText ( "Tabla ps_category_group borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_category_group", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_category_shop" )
         ::SetText ( "Tabla ps_category_shop borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_category_shop", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_image" )
         ::SetText ( "Tabla ps_image borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_image", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_image_shop" )
         ::SetText ( "Tabla ps_image_shop borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_image_shop", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_image_lang" )
         ::SetText ( "Tabla ps_image_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_image_lang", 3  )
      end





      ::DelIdFamiliasPrestashop()
      ::DelIdGrupoFamiliasPrestashop()
      ::DelIdTipoArticuloPrestashop()





      ::AddCategoriaRaiz()

   end





   ::oGrpFam:GoTop()

   while !::oGrpFam:Eof()

      if ::oGrpFam:lPubInt .AND. ( ::oGrpFam:lSndDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando grupos familias" )





         ::AppGrupoCategoriesPrestashop()

      end

      ::oGrpFam:FieldPutByName( "lSelDoc", .F. )

      ::oGrpFam:Skip()

   end





   ::oFam:GoTop()

   while !::oFam:Eof()

      if ::oFam:lPubInt .AND. ( ::oFam:lSelDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando familias" )





         ::AppCategoriesPrestashop()

      end

      ::oFam:FieldPutByName( "lSelDoc", .F. )

      ::oFam:Skip()

   end

Return ( Self )



UTILITY STATIC function TComercio_AddCategoriaRaiz() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio





   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category ( id_category, id_parent, id_shop_default, level_depth, nleft, nright, active, date_add, date_upd, position ) VALUES ( '1', '0', '1', '0', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0' ) " )
      ::nNumeroCategorias++
      ::SetText( "He insertado correctamente en la tabla categorias la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_lang ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '1', '" + Str( ::nLanguage ) + "', 'Root', 'Root', 'Root', '', '', '' )" )
      ::SetText( "He insertado correctamente en la tabla categorias lenguajes la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category_lang", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_shop ( id_category, id_shop, position ) VALUES ( '1', '1', '0' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '1', '1' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '1', '2' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '1', '3' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora root en ps_category_group", 3 )
   end





   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category ( id_parent, id_shop_default, level_depth, nleft, nright, active, date_add, date_upd, position, is_root_category ) VALUES ( '1', '1', '1', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0', '1' ) " )
      ::nNumeroCategorias++
      ::SetText( "He insertado correctamente en la tabla categorias la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_lang ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '2', '" + Str( ::nLanguage ) + "', 'Inicio', 'Inicio', 'Inicio', '', '', '' )" )
      ::SetText( "He insertado correctamente en la tabla categorias lenguajes la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category_lang", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_shop ( id_category, id_shop, position ) VALUES ( '2', '1', '0' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '2', '1' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '2', '2' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '2', '3' )" )
      ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
   else
      ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
   end

Return ( Self )



UTILITY STATIC function TComercio_AppCategoriesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local oCategoria
   local nCodigoWeb           := 0
   local nParent              := 2

   if !Empty( ::oFam:cCodGrp )
      nParent                 := oRetFld( ::oFam:cCodGrp, ::oGrpFam, "cCodWeb" )
   end

   if ( ::oFam:cCodWeb == 0 .OR. ::lSincAll )





      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category ( id_parent, level_depth, nleft, nright, active, date_add, date_upd, position ) VALUES ( '" + Str( nParent ) + "', '2', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0' ) " )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::nNumeroCategorias++





         oCategoria                       := SCategoria()
         oCategoria:id                    := nCodigoWeb
         oCategoria:idParent              := nParent
         oCategoria:nTipo                 := 2

         aAdd( ::aCategorias, oCategoria )





         ::oFam:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::SetText( "He insertado la familia " + AllTrim( ::oFam:cNomFam ) + " correctamente en la tabla ps_category", 3 )

      else
         ::SetText( "Error al insertar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_lang ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '" + Str( nCodigoWeb ) + "', '" + Str( ::nLanguage ) + "', '" + AllTrim( ::oFam:cNomFam ) + "', '" + AllTrim( ::oFam:cNomFam ) + "', '" + cLinkRewrite( ::oFam:cNomFam ) + "', '', '', '' )" )
         ::SetText( "He insertado la familia " + AllTrim( ::oFam:cNomFam ) + " correctamente en la tabla ps_category_lang", 3 )
      else
         ::SetText( "Error al insertar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_lang", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_shop ( id_category, id_shop, position ) VALUES ( '" + Str( nCodigoWeb ) + "', '1', '0' )" )
         ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
      else
         ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '1' )" )
         ::SetText( "He insertado la familia " + AllTrim( ::oFam:cNomFam ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '2' )" )
         ::SetText( "He insertado la familia " + AllTrim( ::oFam:cNomFam ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '3' )" )
         ::SetText( "He insertado la familia " + AllTrim( ::oFam:cNomFam ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_group", 3 )
      end





      if !Empty( ::oFam:cImgBtn )





         oImagen                       := SImagen()
         oImagen:cNombreImagen         := ::oFam:cImgBtn
         oImagen:nTipoImagen           := 2
         oImagen:cPrefijoNombre        := AllTrim( Str( nCodigoWeb ) )

         ::AddImages( oImagen )

      end

   else





      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category SET date_upd='" + dtos( GetSysDate() ) + "' WHERE id_category=" + AllTrim( Str( ::oFam:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category", 3 )
      else
         ::SetText( "Error al actualizar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category_lang SET name='" + AllTrim( ::oFam:cNomFam ) + "', description='" + AllTrim( ::oFam:cNomFam ) + "', link_rewrite='" + cLinkRewrite( ::oFam:cNomFam ) + "' WHERE id_category=" + AllTrim( Str( ::oFam:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_lang", 3 )
      else
         ::SetText( "Error al actualizar la familia " + AllTrim( ::oFam:cNomFam ) + " en la tabla ps_category_lang", 3 )
      end

   end

return nCodigoWeb



UTILITY STATIC function TComercio_AppGrupoCategoriesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRecAnt           := ::oGrpFam:Recno()
   local nCodigoWeb        := 2
   local oCategoria

   if ( ::oGrpFam:cCodWeb == 0 .OR. ::lSincAll )

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category ( id_parent, level_depth, nleft, nright, active, date_add, date_upd, position ) VALUES ( '2', '2', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0' ) " )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::nNumeroCategorias++





         oCategoria                       := SCategoria()
         oCategoria:id                    := nCodigoWeb
         oCategoria:idParent              := 2
         oCategoria:nTipo                 := 1

         aAdd( ::aCategorias, oCategoria )





         ::oGrpFam:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category", 3 )

      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_lang ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '" + Str( nCodigoWeb ) + "', '" + Str( ::nLanguage ) + "', '" + AllTrim( ::oGrpFam:cNomGrp ) + "', '" + AllTrim( ::oGrpFam:cNomGrp ) + "', '" + cLinkRewrite( ::oGrpFam:cNomGrp ) + "', '', '', '' )" )
         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category_lang", 3 )
      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_lang", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_shop ( id_category, id_shop, position ) VALUES ( '" + Str( nCodigoWeb ) + "', '1', '0' )" )
         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category_shop", 3 )
      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_shop", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '1' )" )
         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '2' )" )
         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '3' )" )
         ::SetText( "He insertado el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " correctamente en la tabla ps_category_group", 3 )
      else
         ::SetText( "Error al insertar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_group", 3 )
      end

   else





      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category SET date_upd='" + dtos( GetSysDate() ) + "' WHERE id_category=" + AllTrim( Str( ::oGrpFam:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category", 3 )
      else
         ::SetText( "Error al actualizar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category_lang SET name='" + AllTrim( ::oGrpFam:cNomGrp ) + "', description='" + AllTrim( ::oGrpFam:cNomGrp ) + "', link_rewrite='" + cLinkRewrite( ::oGrpFam:cNomGrp ) + "' WHERE id_category=" + AllTrim( Str( ::oGrpFam:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_lang", 3 )
      else
         ::SetText( "Error al actualizar el grupo de familia " + AllTrim( ::oGrpFam:cNomGrp ) + " en la tabla ps_category_lang", 3 )
      end

   end

return nCodigoWeb



UTILITY STATIC function TComercio_RecalculaPosicionesCategoriasPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nContador      := 3
   local aTemporal      := ::aCategorias
   local oCategoria
   local nPos           := 0
   local oCat
   local oCat2





   if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category SET nLeft='1', nRight='" + AllTrim( Str( ::nNumeroCategorias * 2 ) ) + "' WHERE id_category=1" )
      ::SetText( "Actualizada correctamente el grupo de familia en la tabla ps_category", 3 )
   else
      ::SetText( "Error al actualizar el grupo de familia en la tabla ps_category", 3 )
   end

   if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category SET nLeft='2', nRight='" + AllTrim( Str( ( ::nNumeroCategorias * 2 ) -1 ) ) + "' WHERE id_category=2" )
      ::SetText( "Actualizada correctamente el grupo de familia en la tabla ps_category", 3 )
   else
      ::SetText( "Error al actualizar el grupo de familia en la tabla ps_category", 3 )
   end





   for each oCategoria in aTemporal

      do case
         case oCategoria:nTipo == 1

            nPos := aScan( ::aCategorias, {|a| a:id == oCategoria:id } )

            if nPos <> 0
               ::aCategorias[ nPos ]:nLeft   := nContador
               nContador++
            end

            for each oCat in ::aCategorias

               if oCat:idParent == oCategoria:id

                  oCat:nLeft   := nContador
                  nContador++

                  for each oCat2 in ::aCategorias

                     if oCat2:idParent == oCat:id
                        oCat2:nLeft   := nContador
                        nContador++
                        oCat2:nRight  := nContador
                        nContador++
                     end

                  next

                  oCat:nRight  := nContador
                  nContador++

               end

            next

            nPos := aScan( ::aCategorias, {|a| a:id == oCategoria:id } )

            if nPos <> 0
               ::aCategorias[ nPos ]:nRight   := nContador
               nContador++
            end

         case oCategoria:nTipo == 2

            if oCategoria:idParent == 2

                  nPos := aScan( ::aCategorias, {|a| a:id == oCategoria:id } )

                  if nPos <> 0
                     ::aCategorias[ nPos ]:nLeft   := nContador
                     nContador++
                     ::aCategorias[ nPos ]:nRight  := nContador
                     nContador++
                  end

            end

      end

   next





   for each oCategoria in ::aCategorias

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_category SET nLeft='" + AllTrim( Str( oCategoria:nLeft ) ) + "', nRight='" + AllTrim( Str( ( oCategoria:nRight ) ) + "' WHERE id_category=" + AllTrim( Str( oCategoria:id ) ) ) )
         ::SetText( "Actualizada correctamente el grupo de familia en la tabla ps_category", 3 )
      else
         ::SetText( "Error al actualizar el grupo de familia en la tabla ps_category", 3 )
      end

   next

return ( .T. )



UTILITY STATIC function TComercio_AppendArticuloPrestashop( oDb) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio





   if ::lSincAll





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product" )
         ::SetText ( "Tabla ps_product borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_attachment" )
         ::SetText ( "Tabla ps_product_attachment borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_attachment", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_attribute" )
         ::SetText ( "Tabla ps_product_attribute borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_attribute", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_attribute_combination" )
         ::SetText ( "Tabla ps_product_attribute_combination borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_attribute_combination", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_attribute_image" )
         ::SetText ( "Tabla ps_product_attribute_image borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_attribute_image", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_country_tax" )
         ::SetText ( "Tabla ps_product_country_tax borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_country_tax", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_download" )
         ::SetText ( "Tabla ps_product_download borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_download", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_group_reduction_cache" )
         ::SetText ( "Tabla ps_product_group_reduction_cache borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_group_reduction_cache", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_shop" )
         ::SetText ( "Tabla ps_product_shop borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_shop", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_lang" )
         ::SetText ( "Tabla ps_product_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_lang", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_sale" )
         ::SetText ( "Tabla ps_product_sale borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_sale", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_product_tag" )
         ::SetText ( "Tabla ps_product_tag borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_product_tag", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_specific_price" )
         ::SetText ( "Tabla ps_specific_price borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_specific_price", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_feature" )
         ::SetText ( "Tabla ps_feature borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_feature", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_feature_lang" )
         ::SetText ( "Tabla ps_feature_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_feature_lang", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_feature_product" )
         ::SetText ( "Tabla ps_feature_product borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_feature_product", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_feature_value" )
         ::SetText ( "Tabla ps_feature_value borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_feature_value", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_feature_value_lang" )
         ::SetText ( "Tabla ps_feature_value_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_feature_value_lang", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_scene" )
         ::SetText ( "Tabla ps_scene borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_scene", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_scene_category" )
         ::SetText ( "Tabla ps_scene_category borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_scene_category", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_scene_lang" )
         ::SetText ( "Tabla ps_scene_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_scene_lang", 3  )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_scene_products" )
         ::SetText ( "Tabla ps_scene_products borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_scene_products", 3  )
      end

      ::lLimpiaRefImgWeb()





      ::DelIdTipoArticuloPrestashop()

   end

   ::oMeterL:Set( 0 )

   ::oMeter:Refresh()

   ::oMeterL:SetTotal( ::oArt:OrdKeyCount() )





   ::oArt:GoTop()

   while !::oArt:Eof()

      if ::oArt:lPubInt .AND. ( ::oArt:lSndDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando artculos" )





         ::AppProductsPrestashop()

      end

      ::oArt:FieldPutByName( "lSndDoc", .F. )

      ::oArt:Skip()

      ::oMeterL:AutoInc()

   end

   ::oMeterL:SetTotal( ::oArt:LastRec() )

return ( Self )



UTILITY STATIC function TComercio_AppProductsPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb           := 0
   local nCodigoImagen        := 0
   local oImagen
   local nOrdAnt
   local nPosition            := 1
   local nCodigoPropiedad     := 0
   local aPropiedades1        := {}
   local aPropiedades2        := {}
   local aPropiedad1
   local aPropiedad2
   local nPrecio              := 0
   local nOrdArtDiv           := ::oArtDiv:OrdSetFocus( "cCodArt" )
   local nParent              := 0

   ::lDefImgPrp               := .F.

   if Empty( ::oArt:Familia ) .OR. ::GetParentCategories() == 0

      ::SetText( "No se puede introducir el artculo " + AllTrim( ::oArt:Nombre ) + " por no tener familia", 2 )

   else

      if !Empty( ::oArt:cCodTip )
         nParent              := ::AppTipoArticuloPrestashop( ::oArt:cCodTip, ::GetParentCategories() )
      else
         nParent              := ::GetParentCategories()
      end

      if ( ::oArt:cCodWeb == 0 .OR. ::lSincAll )

























         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_product ( id_manufacturer, " +  "id_tax_rules_group, " +  "id_category_default, " +  "id_shop_default, " +  "quantity, " +  "minimal_quantity, " +  "price, " +  "active, " +  "date_add, " +  "date_upd )" +  " VALUES " +  "('" + AllTrim( Str( oRetFld( ::oArt:cCodFab, ::oFab, "cCodWeb", "cCodFab" ) ) ) + "', " +  "'" + AllTrim( Str( oRetFld( ::oArt:TipoIva, ::oIva, "CGRPWEB", "TIPO" ) ) ) + "', " +  "'" + AllTrim( Str( nParent ) ) + "', " +  "'1', " +  "'1', " +  "'1', " +  "'" + if( !Empty( ::oArt:cCodPrp1 ), "0", AllTrim( Str( ::oArt:nImpInt1 ) ) ) + "', " +  "'1', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )" )

            nCodigoWeb           := ::oCon:GetInsertId()

            ::oArt:fieldPutByName( "cCodWeb", nCodigoWeb )

            ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_product", 3 )

         else
            ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product", 3 )
         end









         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_product ( id_category, " +  "id_product )" +  " VALUES " +  "('" + AllTrim( Str( Max( nParent, 1 ) ) ) + "', " +  "'" + Str( nCodigoWeb ) + "' )" )
         else
            ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_category_product", 3 )
         end























         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_product_shop ( id_product, " +  "id_shop, " +  "id_category_default, " +  "id_tax_rules_group, " +  "on_sale, " +  "price, " +  "active, " +  "date_add, " +  "date_upd )" +  " VALUES " +  "('" + Str( nCodigoWeb ) + "', " +  "'1', " +  "'" + AllTrim( Str( nParent ) ) + "', " +  "'" + AllTrim( Str( oRetFld( ::oArt:TipoIva, ::oIva, "CGRPWEB", "TIPO" ) ) ) + "', " +  "'0', " +  "'" + if( !Empty( ::oArt:cCodPrp1 ), "0", AllTrim( Str( ::oArt:nImpInt1 ) ) ) + "', " +  "'1', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )" )

            ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_product_shop", 3 )

         else
            ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product_shop", 3 )
         end





















         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_product_lang ( id_product, " +  "id_lang, " +  "description, " +  "description_short, " +  "link_rewrite, " +  "name, " +  "available_now, " +  "available_later )" +  " VALUES " +  "('" + Str( nCodigoWeb ) + "', " +  "'" + Str( ::nLanguage ) + "', " +  "'" + AllTrim( ::oArt:mDesTec ) + "', " +  "'" + AllTrim( ::oArt:Nombre ) + "', " +  "'" + cLinkRewrite( ::oArt:Nombre ) + "', " +  "'" + AllTrim( ::oArt:Nombre ) + "', " +  "'En stock', " +  "'' )" )

            ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_product_lang", 3 )

         else

            ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product_lang", 3 )

         end























































































































































































































































































































































































         nOrdAnt        := ::oArtImg:OrdSetFocus( "cCodArt" )

         if !::oArtImg:Seek( ::oArt:Codigo )

            if !Empty( ::oArt:cImagen )







               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_image ( id_product, " +  "position, " +  "cover )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'" + Str( nPosition ) + "', " +  "'1' )" )

                  nCodigoImagen           := ::oCon:GetInsertId()

                  ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_image", 3 )

               else
                  ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_image", 3 )
               end







               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_image_shop (  id_image, " +  "id_shop, " +  "cover )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoImagen ) ) + "', " +  "'1', " +  "'1' )" )

                  ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_image_shop", 3 )

               else
                  ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_image_shop", 3 )
               end





               oImagen                       := SImagen()
               oImagen:cNombreImagen         := ::oArt:cImagen
               oImagen:nTipoImagen           := 1
               oImagen:cCarpeta              := AllTrim( Str( nCodigoImagen ) )
               oImagen:cPrefijoNombre        := AllTrim( Str( nCodigoImagen ) )

               ::AddImages( oImagen )

               nPosition++

            end

         else





            while ::oArtImg:cCodArt == ::oArt:Codigo .AND. !::oArtImg:Eof()







               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_image ( id_product, " +  "position, " +  "cover )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'" + Str( nPosition ) + "', " +  "'" + if( ::oArtImg:lDefImg, "1", "0" ) + "' )" )

                  nCodigoImagen           := ::oCon:GetInsertId()

                  ::oArtImg:fieldPutByName( "cCodWeb", nCodigoImagen )

                  ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_image", 3 )

               else
                  ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_image", 3 )
               end











               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_image_lang ( id_image, " +  "id_lang, " +  "legend )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoImagen ) ) + "', " +  "'" + AllTrim( Str( ::nLanguage ) ) + "', " +  "'" + AllTrim( ::oArtImg:cNbrArt ) + "' )" )

                  ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_image_lang", 3 )

               else
                  ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_image_lang", 3 )
               end








               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_image_shop (  id_image, " +  "id_shop, " +  "cover )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoImagen ) ) + "', " +  "'1', " +  "'" + if( ::oArtImg:lDefImg, "1", "0" ) + "' )" )

                  ::SetText( "He insertado el artculo " + AllTrim( ::oArt:Nombre ) + " correctamente en la tabla ps_image_shop", 3 )

               else
                  ::SetText( "Error al insertar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_image_shop", 3 )
               end





               oImagen                       := SImagen()
               oImagen:cNombreImagen         := ::oArtImg:cImgArt
               oImagen:nTipoImagen           := 1
               oImagen:cCarpeta              := AllTrim( Str( nCodigoImagen ) )
               oImagen:cPrefijoNombre        := AllTrim( Str( nCodigoImagen ) )

               ::AddImages( oImagen )

               ::oArtImg:Skip()

               nPosition++

            end

         end

         ::oArtImg:OrdSetFocus( nOrdAnt )

      else





         if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_product SET id_manufacturer='" + AllTrim( Str( oRetFld( ::oArt:cCodFab, ::oFab, "CCODWEB", "CCODFAB" ) ) ) + "', id_tax_rules_group='" + AllTrim( Str( oRetFld( ::oArt:TipoIva, ::oIva, "CGRPWEB", "TIPO" ) ) ) + "', id_category_default='" + AllTrim( Str( ::GetParentCategories() ) ) + "', price='" + AllTrim( Str( ::oArt:nImpInt1 ) ) + "', date_upd='" + AllTrim( dtoc( GetSysDate() ) ) + "' WHERE id_product=" + AllTrim( Str( ::oArt:cCodWeb ) ) )
            ::SetText( "Actualizado correctamente el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product", 3 )
         else
            ::SetText( "Error al actualizar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_product_lang SET description='" + AllTrim( ::oArt:Nombre ) + "', description_short='" + AllTrim( ::oArt:Nombre ) + "' WHERE id_product=" + AllTrim( Str( ::oArt:cCodWeb ) ) )
            ::SetText( "Actualizado correctamente el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product_lang", 3 )
         else
            ::SetText( "Error al actualizar el artculo " + AllTrim( ::oArt:Nombre ) + " en la tabla ps_product_lang", 3 )
         end

      end

   end

   ::oArtDiv:OrdSetFocus( "nOrdArtDiv" )

return nCodigoweb



UTILITY STATIC function TComercio_AppTipoArticuloPrestashop( cCodTip, IdParent) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb     := 0
   local nOrdAnt        := ::oTipArt:OrdSetFocus( "cCodTip" )
   local oCategoria
   local oImagen

   if !::oTipArt:Seek( cCodTip )

      nCodigoWeb        := IdParent

   else

      if ( ::oTipArt:cCodWeb <> 0 )

         nCodigoWeb     := ::oTipArt:cCodWeb

      else

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category ( id_parent, level_depth, nleft, nright, active, date_add, date_upd, position ) VALUES ( '" + Str( IdParent ) + "', '2', '0', '0', '1', '" + dtos( GetSysDate() ) + "', '" + dtos( GetSysDate() ) + "', '0' ) " )

            nCodigoWeb           := ::oCon:GetInsertId()

            ::nNumeroCategorias++





            oCategoria                       := SCategoria()
            oCategoria:id                    := nCodigoWeb
            oCategoria:idParent              := IdParent
            oCategoria:nTipo                 := 3

            aAdd( ::aCategorias, oCategoria )





            ::oTipArt:fieldPutByName( "cCodWeb", nCodigoWeb )

            ::SetText( "He insertado el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " correctamente en la tabla ps_category", 3 )

         else
            ::SetText( "Error al insertar el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " en la tabla ps_category", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_lang ( id_category, id_lang, name, description, link_rewrite, meta_title, meta_keywords, meta_description ) VALUES ( '" + Str( nCodigoWeb ) + "', '" + Str( ::nLanguage ) + "', '" + AllTrim( ::oTipArt:cNomTip ) + "', '" + AllTrim( ::oTipArt:cNomTip ) + "', '" + cLinkRewrite( ::oTipArt:cNomTip ) + "', '', '', '' )" )
            ::SetText( "He insertado el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " correctamente en la tabla ps_category_lang", 3 )
         else
            ::SetText( "Error al insertar el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " en la tabla ps_category_lang", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_shop ( id_category, id_shop, position ) VALUES ( '" + Str( nCodigoWeb ) + "', '1', '0' )" )
            ::SetText( "He insertado correctamente en la tabla categorias grupo la categora raiz", 3 )
         else
            ::SetText( "Error al insertar la categora inicio en ps_category_group", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '1' )" )
            ::SetText( "He insertado el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " correctamente en la tabla ps_category_group", 3 )
         else
            ::SetText( "Error al insertar v " + AllTrim( ::oTipArt:cNomTip ) + " en la tabla ps_category_group", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '2' )" )
            ::SetText( "He insertado el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " correctamente en la tabla ps_category_group", 3 )
         else
            ::SetText( "Error al insertar el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " en la tabla ps_category_group", 3 )
         end

         if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_category_group ( id_category, id_group ) VALUES ( '" + Str( nCodigoWeb ) + "', '3' )" )
            ::SetText( "He insertado el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " correctamente en la tabla ps_category_group", 3 )
         else
            ::SetText( "Error al insertar el tipo de artculo " + AllTrim( ::oTipArt:cNomTip ) + " en la tabla ps_category_group", 3 )
         end





         if !Empty( ::oTipArt:cImgTip )





            oImagen                       := SImagen()
            oImagen:cNombreImagen         := ::oTipArt:cImgTip
            oImagen:nTipoImagen           := 2
            oImagen:cPrefijoNombre        := AllTrim( Str( nCodigoWeb ) )

            ::AddImages( oImagen )

         end

      end

   end

return nCodigoWeb



UTILITY STATIC function TComercio_nDefImagen( cCodArt, cImagen) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nDef           := 0

   if ::oArtImg:SeekInOrd( cCodArt, "lDefImg" )

      if ::oArtImg:cImgArt == cImagen

         nDef           := 1

      end

   else

      if !::lDefImgPrp

         nDef           := 1

         ::lDefImgPrp   := .T.

      end

   end

Return nDef



UTILITY STATIC function TComercio_lLimpiaRefImgWeb() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec     := ::oArtDiv:Recno()
   local nOrdAnt  := ::oArtDiv:OrdSetFocus( "cCodArt" )

   ::oArtDiv:GoTop()

   while !::oArtDiv:Eof()

      ::oArtDiv:fieldPutByName( "cCodImgWeb", 0 )

      ::oArtDiv:Skip()

   end

   ::oArtDiv:OrdSetFocus( nOrdAnt )
   ::oArtDiv:GoTo( nRec )

return .T.



UTILITY STATIC function TComercio_nCodigoWebImagen( cCodArt, cImagen) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigo  := 0
   local nRec     := ::oArtDiv:Recno()
   local nOrdAnt  := ::oArtDiv:OrdSetFocus( "cCodArt" )

   ::oArtDiv:GoTop()

   if ::oArtDiv:Seek( cCodArt )

      while ::oArtDiv:cCodArt == cCodArt .AND. !::oArtDiv:Eof()

         if ::oArtDiv:cImgWeb == cImagen .AND. ::oArtDiv:cCodImgWeb <> 0

            nCodigo  := ::oArtDiv:cCodImgWeb

         end

         ::oArtDiv:Skip()

      end

   end

   ::oArtDiv:OrdSetFocus( nOrdAnt )
   ::oArtDiv:GoTo( nRec )

return nCodigo



UTILITY STATIC function TComercio_AppendIvaPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio





   if ::lSincAll





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_tax" )
         ::SetText ( "Tabla ps_tax borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_tax", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_tax_lang" )
         ::SetText ( "Tabla ps_tax_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_tax_lang", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_tax_rule" )
         ::SetText ( "Tabla ps_tax_rule borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_tax_rule", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_tax_rules_group" )
         ::SetText ( "Tabla ps_tax_rules_group borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_tax_rules_group", 3  )
      end





      ::DelIdIvaPrestashop()

   end





   ::oIva:GoTop()

   while !::oIva:Eof()

      if ::oIva:lPubInt .AND. ( ::oIva:lSndDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando tipos de " + cImp() )





         ::AppIvaPrestashop()

      end

      ::oIva:FieldPutByName( "lSndDoc", .F. )

      ::oIva:Skip()

   end

return ( Self )



UTILITY STATIC function TComercio_AppIvaPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb            := 0
   local nCodigoGrupoWeb       := 0

   if ( ::oIva:cCodWeb == 0 .OR. ::lSincAll )





      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_tax ( rate, " +  "active )" +  " VALUES " +  "('" + AllTrim( Str( ::oIva:TpIva ) ) + "', " +  "'1' )" )

         nCodigoWeb           := ::oCon:GetInsertId()

         ::oIva:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::SetText( "He insertado el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " correctamente en la tabla ps_tax", 3 )

      else
         ::SetText( "Error al insertar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax", 3 )
      end











      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_tax_lang ( id_tax, " +  "id_lang, " +  "name )" +  " VALUES " +  "('" + Str( nCodigoWeb ) + "', " +  "'" + Str( ::nLanguage ) + "', " +  "'" + AllTrim( ::oIva:DescIva ) + "' )" )

         ::SetText( "He insertado el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " correctamente en la tabla ps_tax_lang", 3 )

      else

         ::SetText( "Error al insertar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_lang", 3 )

      end









      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_tax_rules_group ( name, " +  "active )" +  " VALUES " +  "('" + AllTrim( ::oIva:DescIva ) + "', " +  "'1' )" )

         nCodigoGrupoWeb           := ::oCon:GetInsertId()

         ::oIva:fieldPutByName( "cGrpWeb", nCodigoGrupoWeb )

         ::SetText( "He insertado el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " correctamente en la tabla ps_tax_rule_group", 3 )

      else
         ::SetText( "Error al insertar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_rule_group", 3 )
      end











      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_tax_rule ( id_tax_rules_group, " +  "id_country, " +  "id_tax )" +  " VALUES " +  "('" + Str( nCodigoGrupoWeb ) + "', " +  "'6', " +  "'" + Str( nCodigoWeb ) + "' )" )

         ::SetText( "He insertado el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " correctamente en la tabla ps_tax_rule", 3 )

      else

         ::SetText( "Error al insertar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_rule", 3 )

      end

   else





      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_tax SET rate='" + AllTrim( Str( ::oIva:TpIva ) ) + "' WHERE id_tax=" + AllTrim( Str( ::oIva:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax", 3 )
      else
         ::SetText( "Error al actualizar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_tax_lang SET name='" + AllTrim( ::oIva:DescIva ) + "' WHERE id_tax=" + AllTrim( Str( ::oIva:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_lang", 3 )
      else
         ::SetText( "Error al actualizar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_lang", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_tax_rules_group SET name='" + AllTrim( ::oIva:DescIva ) + "' WHERE id_tax_rules_group=" + AllTrim( Str( ::oIva:cGrpWeb ) ) )
         ::SetText( "Actualizada correctamente el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_rules_group", 3 )
      else
         ::SetText( "Error al actualizar el tipo de " + cImp() + Space(1) + AllTrim( ::oIva:DescIva ) + " en la tabla ps_tax_rules_group", 3 )
      end

   end

return nCodigoweb



UTILITY STATIC function TComercio_AppendImagesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oFile
   local oImage
   local oTipoImage
   local hSource
   local nBytes
   local cBuffer           := Space( 2000 )
   local nCount            := 0
   local cNewImg           := ""
   local oImagenFinal

   ::aImagesCategories     := {}
   ::aImagesArticulos      := {}





   ::aTipoImagenPrestashop()





   for each oImage in ::aImages





      do case

         case oImage:nTipoImagen == 1

            cNewImg           := cPatTmp() + oImage:cPrefijoNombre + ".jpg"

            SaveImage( oImage:cNombreImagen, cNewImg )

            oImagenFinal                  := SImagen()
            oImagenFinal:cNombreImagen    := cNewImg
            oImagenFinal:nTipoImagen      := oImage:nTipoImagen
            oImagenFinal:cCarpeta         := oImage:cCarpeta

            ::AddImagesArticulos( oImagenFinal )

         case oImage:nTipoImagen == 2

            cNewImg           := cPatTmp() + oImage:cPrefijoNombre + ".jpg"

            SaveImage( oImage:cNombreImagen, cNewImg )

            oImagenFinal                  := SImagen()
            oImagenFinal:cNombreImagen    := cNewImg
            oImagenFinal:nTipoImagen      := oImage:nTipoImagen

            ::AddImagesCategories( oImagenFinal )

      end





      for each oTipoImage in ::aTipoImagesPrestashop

         do case

            case oImage:nTipoImagen == 1 .AND. oTipoImage:lProducts

               cNewImg           := cPatTmp() + oImage:cPrefijoNombre + "-" + oTipoImage:cNombreTipo + ".jpg"

               SaveImage( oImage:cNombreImagen, cNewImg, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

               oImagenFinal                  := SImagen()
               oImagenFinal:cNombreImagen    := cNewImg
               oImagenFinal:nTipoImagen      := oImage:nTipoImagen
               oImagenFinal:cCarpeta         := oImage:cCarpeta

               ::AddImagesArticulos( oImagenFinal )

            case oImage:nTipoImagen == 2 .AND. oTipoImage:lCategories

               cNewImg           := cPatTmp() + oImage:cPrefijoNombre + "-" + oTipoImage:cNombreTipo + ".jpg"

               SaveImage( oImage:cNombreImagen, cNewImg, oTipoImage:nAnchoTipo, oTipoImage:nAltoTipo )

               oImagenFinal                  := SImagen()
               oImagenFinal:cNombreImagen    := cNewImg
               oImagenFinal:nTipoImagen      := oImage:nTipoImagen

               ::AddImagesCategories( oImagenFinal )

         end

      next

   next

   if Len( ::aImagesArticulos ) > 0





      ::nTotMeter    := 0

      ::oInt         := TInternet():New()
      ::oFtp         := TFtp():New( ::cHostFtp, ::oInt, ::cUserFtp, ::cPasswdFtp, ::lPassiveFtp )

      if Empty( ::oFtp ) .OR. Empty( ::oFtp:hFtp )

         MsgStop( "Imposible conectar al sitio ftp " + ::cHostFtp )

      else

         ::SetText( "Actualizando imagenes de productos", 2 )





         ::nTotMeter                := len( ::aImagesArticulos )
         nCount                     := 1

         if !Empty( ::cDImagen )
            ::oFtp:CreateDirectory( ::cDImagen + "/p" )
            ::oFtp:SetCurrentDirectory( ::cDImagen + "/p" )
         end

         for each oImage in ::aImagesArticulos

            ::SetText( "Subiendo imagen " + cNoPath( oImage:cNombreImagen ), 3 )

            ::MeterParticularText( " Subiendo imagen " + AllTrim( Str( nCount ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            ::oFtp:CreateDirectory( oImage:cCarpeta )
            ::oFtp:SetCurrentDirectory( oImage:cCarpeta )

            oFile                   := TFtpFile():New( cFileBmpName( oImage:cNombreImagen ), ::oFtp )
            if !oFile:PutFile( ::oMeterL )
               ::SetText( "Error copiando imagen " + cFileBmpName( oImage:cNombreImagen ), 3 )
            end

            ::oFtp:SetCurrentDirectory( ".." )

            nCount                  += 1

            oFile:End()





            sysRefresh()

         next

      end

      if !Empty( ::oInt )
         ::oInt:end()
      end

      if !Empty( ::oFtp )
         ::oFtp:end()
      end

   end





   if Len( ::aImagesCategories ) > 0





      ::nTotMeter    := 0

      ::oInt         := TInternet():New()
      ::oFtp         := TFtp():New( ::cHostFtp, ::oInt, ::cUserFtp, ::cPasswdFtp, ::lPassiveFtp )

      if Empty( ::oFtp ) .OR. Empty( ::oFtp:hFtp )

         MsgStop( "Imposible conectar al sitio ftp " + ::cHostFtp )

      else

         ::SetText( "Actualizando imagenes de categoras", 2 )





         ::nTotMeter                := len( ::aImagesCategories )
         nCount                     := 1

         if !Empty( ::cDImagen )
            ::oFtp:CreateDirectory( ::cDImagen + "/c" )
            ::oFtp:SetCurrentDirectory( ::cDImagen + "/c" )
         end

         for each oImage in ::aImagesCategories

            ::SetText( "Subiendo imagen " + cNoPath( oImage:cNombreImagen ), 3 )

            ::MeterParticularText( " Subiendo imagen " + AllTrim( Str( nCount ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            oFile                   := TFtpFile():New( cFileBmpName( oImage:cNombreImagen ), ::oFtp )
            if !oFile:PutFile( ::oMeterL )
               ::SetText( "Error copiando imagen " + cFileBmpName( oImage:cNombreImagen ), 3 )
            end

            nCount                  += 1

            oFile:End()





            sysRefresh()

         next

      end

      if !Empty( ::oInt )
         ::oInt:end()
      end

      if !Empty( ::oFtp )
         ::oFtp:end()
      end

   end





   for each oImage in ::aImagesArticulos
      fErase( oImage:cNombreImagen )
   next

   for each oImage in ::aImagesCategories
      fErase( oImage:cNombreImagen )
   next

Return( nil )



UTILITY STATIC function TComercio_aTipoImagenPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local oQuery            := TMSQuery():New( ::oCon, "SELECT * FROM ps_image_type" )

   if oQuery:Open()

      if oQuery:RecCount() > 0

         oQuery:GoTop()

         while !oQuery:Eof()

            oImagen                       := STipoImagen()
            oImagen:cNombreTipo           := oQuery:FieldGetByName( "name" )
            oImagen:nAnchoTipo            := oQuery:FieldGetByName( "width" )
            oImagen:nAltoTipo             := oQuery:FieldGetByName( "height" )
            oImagen:lCategories           := ( oQuery:FieldGetByName( "categories" ) == 1 )
            oImagen:lProducts             := ( oQuery:FieldGetByName( "products" ) == 1 )
            oImagen:lManufactures         := ( oQuery:FieldGetByName( "manufacturers" ) == 1 )
            oImagen:lSuppliers            := ( oQuery:FieldGetByName( "suppliers" ) == 1 )
            oImagen:lScenes               := ( oQuery:FieldGetByName( "scenes" ) == 1 )
            oImagen:lStores               := ( oQuery:FieldGetByName( "stores" ) == 1 )

            ::AddTipoImagesPrestashop( oImagen )

            oQuery:Skip()

         end

      end

   end

   oQuery:Free()

   oQuery            := nil

Return ( self )



UTILITY STATIC function TComercio_AddImagesArticulos( cImage) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aImagesArticulos, cImage ) == 0
      aAdd( ::aImagesArticulos, cImage )
   end

Return ( ::aImagesArticulos )



UTILITY STATIC function TComercio_AddImagesCategories( cImage) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aImagesCategories, cImage ) == 0
      aAdd( ::aImagesCategories, cImage )
   end

Return ( ::aImagesCategories )



UTILITY STATIC function TComercio_AddTipoImagesPrestashop( cImage) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   if aScan( ::aTipoImagesPrestashop, cImage ) == 0
      aAdd( ::aTipoImagesPrestashop, cImage )
   end

Return ( ::aTipoImagesPrestashop )



UTILITY STATIC function TComercio_AppendClientPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQueryDirecciones
   local lFirst                  := .T.
   local oQuery                  := TMSQuery():New( ::oCon, "SELECT * FROM ps_customer" )
   local cCodCli





   if oQuery:Open()





      ::nTotMeter    := oQuery:RecCount()

      if !Empty( ::oMeterL )
         ::oMeterL:SetTotal( ::nTotMeter )
      end

      ::nActualMeterL := 1

      if oQuery:RecCount() > 0

         ::SetText( "Descargando clientes desde la web", 2 )

         oQuery:GoTop()

         while !oQuery:Eof()

            ::MeterParticularText( " Descargando cliente " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            if !::oCli:SeekInOrd( Str( oQuery:FieldGet( 1 ), 11 ), "cCodWeb" )

               cCodCli           := NextKey( dbLast(  ::oCli, 1 ), ::oCli:cAlias, "0", RetNumCodCliEmp() )

               ::oCli:Append()
               ::oCli:Blank()
               ::oCli:Cod        := cCodCli
               ::oCli:Titulo     := oQuery:FieldGet( 10 ) + Space( 1 ) + oQuery:FieldGet( 11 )
               ::oCli:nTipCli    := 3
               ::oCli:CopiasF    := 1
               ::oCli:Serie      := uFieldEmpresa( "cSeriePed" )
               ::oCli:nRegIva    := 1
               ::oCli:nTarifa    := 1
               ::oCli:cMeiInt    := oQuery:FieldGet( 12 )
               ::oCli:lChgPre    := .T.
               ::oCli:lSndInt    := .T.
               ::oCli:CodPago    := cDefFpg()
               ::oCli:cCodAlm    := cDefAlm()
               ::oCli:dFecChg    := GetSysDate()
               ::oCli:cTimChg    := Time()
               ::oCli:lPubInt    := .T.
               ::oCli:cCodWeb    := oQuery:FieldGet( 1 )
               ::oCli:lWeb       := .T.





               oQueryDirecciones       := TMSQuery():New( ::oCon, "SELECT * FROM ps_address WHERE id_customer = " + Str( oQuery:FieldGet( 1 ) ) )

               if oQueryDirecciones:Open()

                  if oQueryDirecciones:RecCount() > 0

                     oQueryDirecciones:GoTop()

                     while !oQueryDirecciones:Eof()





                        if lFirst

                           ::oCli:Nif            := oQueryDirecciones:FieldGet( 20 )
                           ::oCli:Domicilio      := oQueryDirecciones:FieldGet( 12 ) + " " + oQueryDirecciones:FieldGet( 13 )
                           ::oCli:Poblacion      := oQueryDirecciones:FieldGet( 15 )
                           ::oCli:CodPostal      := oQueryDirecciones:FieldGet( 14 )
                           ::oCli:Telefono       := oQueryDirecciones:FieldGet( 17 )
                           ::oCli:Movil          := oQueryDirecciones:FieldGet( 18 )

                        end





                        ::oObras:Append()
                        ::oObras:Blank()

                        ::oObras:cCodCli         := cCodCli
                        ::oObras:cCodObr         := "@" + AllTrim( Str( oQueryDirecciones:FieldGet( 1 ) ) )
                        ::oObras:cNomObr         := oQueryDirecciones:FieldGet( 12 ) + " " + oQueryDirecciones:FieldGet( 13 )
                        ::oObras:cDirObr         := oQueryDirecciones:FieldGet( 12 ) + " " + oQueryDirecciones:FieldGet( 12 )
                        ::oObras:cPobObr         := oQueryDirecciones:FieldGet( 15 )
                        ::oObras:cPosObr         := oQueryDirecciones:FieldGet( 14 )
                        ::oObras:cTelObr         := oQueryDirecciones:FieldGet( 17 )
                        ::oObras:cMovObr         := oQueryDirecciones:FieldGet( 18 )
                        ::oObras:lDefObr         := lFirst
                        ::oObras:cCodWeb         := oQueryDirecciones:FieldGet( 1 )

                        ::oObras:Save()

                        oQueryDirecciones:Skip()

                        lFirst                   := .F.

                     end

                  end

               end

               if ::oCli:Save()
                  ::SetText( "Cliente " + AllTrim( oQuery:FieldGet( 10 ) ) + Space( 1 ) + AllTrim( oQuery:FieldGet( 11 ) ) + " introducido correctamente.", 3 )
               else
                  ::SetText( "Error al descargar el cliente: " + AllTrim( oQuery:FieldGet( 10 ) ) + Space( 1 ) + AllTrim( oQuery:FieldGet( 11 ) ), 3 )
               end

            else

               ::SetText( "El cliente " + AllTrim( oQuery:FieldGet( 10 ) ) + Space( 1 ) + AllTrim( oQuery:FieldGet( 11 ) ) + " ya existe en nuestra base se datos.", 3 )

            end

            oQuery:Skip()

            ::nActualMeterL++

            lFirst                               := .T.

         end

      end

   end

   oQuery:Free()

   oQuery                                        := nil

Return ( self )



UTILITY STATIC function TComercio_AppendPedidoprestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery                  := TMSQuery():New( ::oCon, "SELECT * FROM ps_orders" )
   local cSerPed                 := ""
   local nNumPed                 := 0
   local cSufPed                 := ""
   local dFecha
   local oQueryL
   local nNumLin                 := 1
   local cCodWeb                 := 1

   if oQuery:Open()





      ::nTotMeter    := oQuery:RecCount()

      if !Empty( ::oMeterL )
         ::oMeterL:SetTotal( ::nTotMeter )
      end

      ::nActualMeterL := 1





      if oQuery:RecCount() > 0

         ::SetText( "Descargando pedidos desde la web", 2 )

         oQuery:GoTop()

         while !oQuery:Eof()

            ::MeterParticularText( " Descargando pedido " + AllTrim( Str( ::nActualMeterL ) ) + " de "  + AllTrim( Str( ::nTotMeter ) ) )

            if !::oPedCliT:SeekInOrd( Str( oQuery:FieldGet( 1 ), 11 ), "cCodWeb" )





               cSerPed                 := uFieldEmpresa( "cSeriePed" )
               nNumPed                 := nNewDoc( uFieldEmpresa( "cSeriePed" ), ::oPedCliT:cAlias, "NPEDCLI", , ::oCount:cAlias )
               cSufPed                 := RetSufEmp()

               Set( 4, "yyyy/mm/dd" )
               dFecha                  := Ctod( Left( oQuery:FieldGet( 42 ), 10 ) )
               Set( 4, "dd/mm/yyyy" )

               ::oPedCliT:Append()
               ::oPedCliT:Blank()

               ::oPedCliT:cSerPed      := cSerPed
               ::oPedCliT:nNumPed      := nNumPed
               ::oPedCliT:cSufPed      := cSufPed
               ::oPedCliT:cTurPed      := cCurSesion()
               ::oPedCliT:dFecPed      := dFecha
               ::oPedCliT:cCodAlm      := oUser():cAlmacen()
               ::oPedCliT:cCodCaj      := oUser():cCaja()
               ::oPedCliT:cCodPgo      := cDefFpg()
               ::oPedCliT:nEstado      := 1
               ::oPedCliT:nTarifa      := 1
               ::oPedCliT:cDivPed      := cDivEmp()
               ::oPedCliT:nVdvPed      := nChgDiv( cDivEmp(), ::oDivisas:cAlias )
               ::oPedCliT:lSndDoc      := .T.
               ::oPedCliT:lIvaInc      := uFieldEmpresa( "lIvaInc" )
               ::oPedCliT:cManObr      := Padr( "Gastos envio", 250 )
               ::oPedCliT:nManObr      := oQuery:FieldGet( 30 )
               ::oPedCliT:lCloPed      := .F.
               ::oPedCliT:cCodUsr      := cCurUsr()
               ::oPedCliT:dFecCre      := GetSysDate()
               ::oPedCliT:cTimCre      := Time()
               ::oPedCliT:cCodDlg      := oUser():cDelegacion()
               ::oPedCliT:lWeb         := .T.
               ::oPedCliT:lInternet    := .T.
               ::oPedCliT:cCodWeb      := oQuery:FieldGet( 1 )
               cCodWeb                 := oQuery:FieldGet( 1 )
               ::oPedCliT:nTotNet      := oQuery:FieldGet( 29 )
               ::oPedCliT:nTotIva      := oQuery:FieldGet( 25 ) - ( oQuery:FieldGet( 29 ) + oQuery:FieldGet( 32 ) )
               ::oPedCliT:nTotPed      := oQuery:FieldGet( 25 )

               if ::oCli:SeekInOrd( Str( oQuery:FieldGet( 4 ), 11 ) , "cCodWeb" )

                  ::oPedCliT:cCodCli   := ::oCli:Cod
                  ::oPedCliT:cNomCli   := ::oCli:Titulo
                  ::oPedCliT:cDirCli   := ::oCli:Domicilio
                  ::oPedCliT:cPobCli   := ::oCli:Poblacion
                  ::oPedCliT:cPrvCli   := ::oCli:Provincia
                  ::oPedCliT:cPosCli   := ::oCli:CodPostal
                  ::oPedCliT:cDniCli   := ::oCli:Nif
                  ::oPedCliT:lModCli   := .T.
                  ::oPedCliT:cTlfCli   := ::oCli:Telefono
                  ::oPedCliT:cCodGrp   := ::oCli:cCodGrp
                  ::oPedCliT:nRegIva   := ::oCli:nRegIva

               end





               oQueryL            := TMSQuery():New( ::oCon, "SELECT * FROM ps_order_detail WHERE id_order=" + AllTrim( Str( cCodWeb ) ) )

               if oQueryL:Open()

                  if oQueryL:RecCount() > 0

                     oQueryL:GoTop()

                     while !oQueryL:Eof()

                        ::oPedCliL:Append()
                        ::oPedCliL:Blank()
                        ::oPedCliL:cSerPed        := cSerPed
                        ::oPedCliL:nNumPed        := nNumPed
                        ::oPedCliL:cSufPed        := cSufPed
                        ::oPedCliL:cDetalle       := oQueryL:FieldGet( 8 )
                        ::oPedCliL:mLngDes        := oQueryL:FieldGet( 8 )
                        ::oPedCliL:nCanPed        := 1
                        ::oPedCliL:nUniCaja       := oQueryL:FieldGet( 9 )
                        ::oPedCliL:nPreDiv        := oQueryL:FieldGet( 14 )
                        ::oPedCliL:dFecha         := dFecha
                        ::oPedCliL:nNumLin        := nNumLin
                        ::oPedCliL:cAlmLin        := cDefAlm()
                        ::oPedCliL:nTarLin        := 1


                        if ::oArt:SeekInOrd( Str( oQueryL:FieldGet( 6 ), 11 ) , "cCodWeb" )

                           ::oPedCliL:cRef        := ::oArt:Codigo
                           ::oPedCliL:cUnidad     := ::oArt:cUnidad
                           ::oPedCliL:nPesoKg     := ::oArt:nPesoKg
                           ::oPedCliL:cPesoKg     := ::oArt:cUnidad
                           ::oPedCliL:nVolumen    := ::oArt:nVolumen
                           ::oPedCliL:cVolumen    := ::oArt:cVolumen
                           ::oPedCliL:nCtlStk     := ::oArt:nCtlStock
                           ::oPedCliL:nCosDiv     := nCosto( ::oArt:Codigo, ::oArt:cAlias, ::oKit:cAlias )
                           ::oPedCliL:cCodTip     := ::oArt:cCodTip
                           ::oPedCliL:cCodFam     := ::oArt:Familia
                           ::oPedCliL:cGrpFam     := RetFld( ::oArt:Familia, ::oFam:cAlias, "cCodGrp" )
                           ::oPedCliL:cCodPr1     := ::oArt:cCodPrp1
                           ::oPedCliL:cCodPr2     := ::oArt:cCodPrp2
                           ::oPedCliL:cValPr1     := ::GetValPrp( oRetFld( ::oArt:cCodPrp1, ::oPro, "cCodWeb", "cCodPro" ), oQueryL:FieldGet( 7 ) )
                           ::oPedCliL:cValPr2     := ::GetValPrp( oRetFld( ::oArt:cCodPrp2, ::oPro, "cCodWeb", "cCodPro" ), oQueryL:FieldGet( 7 ) )
                           ::oPedCliL:nIva        := nIva( ::oIva:cAlias, ::oArt:TipoIva )

                        end

                        if !::oPedCliL:Save()
                           ::SetText( "Error al descargar las lineas el pedido: " + cSerPed + "/" + AllTrim( Str( nNumPed ) ) + "/" + cSufPed, 3 )
                        end

                     oQueryL:Skip()

                     nNumLin++

                     end

                  end

               end

               if ::oPedCliT:Save()
                  ::SetText( "Pedido " + cSerPed + "/" + AllTrim( Str( nNumPed ) ) + "/" + cSufPed + " introducido correctamente.", 3 )
               else
                  ::SetText( "Error al descargar el pedido: " + cSerPed + "/" + AllTrim( Str( nNumPed ) ) + "/" + cSufPed, 3 )
               end

            else

               ::SetText( "El pedido " + ::oPedCliT:cSerPed + "/" + AllTrim( Str( ::oPedCliT:nNumPed ) ) + "/" + ::oPedCliT:cSufPed + " ya ha sido importado desde la pgina web.", 3 )

            end

            oQuery:Skip()

            ::nActualMeterL++

         end

      end

   end

   oQuery:Free()

   oQuery   := nil

Return ( self )



UTILITY STATIC function TComercio_EstadoPedidosPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery

   ::nTotMeter := 0





   ::oPedCliT:GoTop()
   while !::oPedCliT:Eof()

      if ::oPedCliT:lInternet .AND. ::oPedCliT:nEstado <> 3
         ::nTotMeter ++
      end

   ::oPedCliT:Skip()

   end

   ::oMeterL:SetTotal( ::nTotMeter )
   ::nActualMeterL   := 1





   ::SetText( "Actualizando el estado de los pedidos", 2 )

   ::oPedCliT:GoTop()
   while !::oPedCliT:Eof()

      if ::oPedCliT:lInternet .AND. ::oPedCliT:nEstado <> 1

         ::MeterParticularText( "Actualizando estado de pedidos " + AllTrim( Str( ::nActualMeterL ) ) + " de " + AllTrim( Str( ::nTotMeter ) ) )

         oQuery                  := TMSQuery():New( ::oCon, "SELECT * FROM ps_order_history WHERE id_order=" + AllTrim( Str( ::oPedCliT:cCodWeb ) ) + " AND id_order_state=5" )

         if oQuery:Open()

            if oQuery:RecCount() == 0









               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_order_history ( id_employee, " +  "id_order, " +  "id_order_state, " +  "date_add )" +  " VALUES " +  "('1', " +  "'" + AllTrim( Str( ::oPedCliT:cCodWeb ) ) + "', " +  "'5', " +  "'" + dtos( GetSysDate() ) + "' )" )

                  ::SetText( "Actualizado el estado del pedido " + ::oPedCliT:cSerPed + "/" + AllTrim( Str( ::oPedCliT:nNumPed ) ) + "/" + ::oPedCliT:cSufPed, 3 )

               else

                  ::SetText( "Error al actualizar el estado del pedido " + ::oPedCliT:cSerPed + "/" + AllTrim( Str( ::oPedCliT:nNumPed ) ) + "/" + ::oPedCliT:cSufPed, 3 )

               end

            end

         end

      end

   ::oPedCliT:Skip()

   end

Return ( self )



UTILITY STATIC function TComercio_AppendClientesToPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nCodigoWeb  := 0
   local nSpace      := 0
   local cFirstName  := ""
   local cLastName   := ""

   ::SetText( "Recorremos la tabla de clientes", 2 )





   ::oCli:GoTop()

   while !::oCli:Eof()

      if ::oCli:lPubInt .AND. ::oCli:lSndInt

         if !::oCli:lWeb

            if ::oCli:cCodWeb == 0

               nSpace               := At( " ", ::oCli:Titulo )
               cFirstName           := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, 1, nSpace ) )
               cLastName            := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, nSpace + 1 ) )



























               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_customer ( id_gender, " +  "id_default_group, " +  "firstname, " +  "lastname, " +  "email, " +  "passwd, " +  "newsletter, " +  "secure_key, " +  "active, " +  "is_guest, " +  "deleted, " +  "date_add, " +  "date_upd )" +  " VALUES " +  "('9', " +  "'1', " +  "'" + AllTrim( cFirstName ) + "', " +  "'" + AllTrim( cLastName ) + "', " +  "'" + AllTrim( ::oCli:cMeiInt ) + "', " +  "'" + hb_md5( AllTrim( ::Cookiekey ) + AllTrim( ::oCli:cClave ) ) + "', " +  "'1', " +  "'" + hb_md5( AllTrim( ::oCli:Cod ) ) + "', " +  "'1', " +  "'0', " +  "'0', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "' )" )

                  nCodigoWeb           := ::oCon:GetInsertId()

                  ::oCli:fieldPutByName( "cCodWeb", nCodigoWeb )

                  ::SetText( "He insertado el cliente " + AllTrim( ::oCli:Titulo ) + " correctamente en la tabla ps_customer", 3 )

               else
                  ::SetText( "Error al insertar el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_customer", 3 )
               end









               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_customer_group ( id_customer, " +  "id_group )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'1' )" )


                  ::SetText( "He insertado el cliente " + AllTrim( ::oCli:Titulo ) + " correctamente en la tabla ps_customer_group", 3 )

               else
                  ::SetText( "Error al insertar el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_customer_group", 3 )
               end



































               if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_address ( id_country, " +  "id_customer, " +  "alias, " +  "lastname, " +  "firstname, " +  "address1, " +  "postcode, " +  "city, " +  "phone, " +  "phone_mobile, " +  "dni, " +  "date_add, " +  "date_upd, " +  "active, " +  "deleted )" +  " VALUES " +  "('6', " +  "'" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'" + AllTrim( cFirstName ) + AllTrim( cLastName ) + "', " +  "'" + AllTrim( cLastName ) + "', " +  "'" + AllTrim( cFirstName ) + "', " +  "'" + AllTrim( ::oCli:Domicilio ) + "', " +  "'" + AllTrim( ::oCli:CodPostal ) + "', " +  "'" + AllTrim( ::oCli:Poblacion ) + "', " +  "'" + AllTrim( ::oCli:Telefono ) + "', " +  "'" + AllTrim( ::oCli:Movil ) + "', " +  "'" + AllTrim( ::oCli:Nif ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'1', " +  "'0' )" )


                  ::SetText( "He insertado el cliente " + AllTrim( ::oCli:Titulo ) + " correctamente en la tabla ps_address", 3 )

               else
                  ::SetText( "Error al insertar el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_address", 3 )
               end

            else

               nSpace               := At( " ", ::oCli:Titulo )
               cFirstName           := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, 1, nSpace ) )
               cLastName            := ::oCon:EscapeStr( SubStr( ::oCli:Titulo, nSpace + 1 ) )

               if !::oCli:lWeb











                  if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_customer SET firstname='" + AllTrim( cFirstName ) +  "', lastname='" + AllTrim( cLastName ) +  "', email='" + AllTrim( ::oCli:cMeiInt ) +  "', passwd='" + hb_md5( AllTrim( ::Cookiekey ) + AllTrim( ::oCli:cClave ) ) +  "', secure_key='" + hb_md5( AllTrim( ::oCli:Cod ) ) +  "', date_upd='" + dtos( GetSysDate() ) +  "' WHERE id_customer=" + AllTrim( Str( ::oCli:cCodWeb ) ) )

                     ::SetText( "Actualizado correctamente el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_customer", 3 )
                  else
                     ::SetText( "Error al actualizar el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_customer", 3 )
                  end















                  if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_address SET alias='" + AllTrim( cFirstName ) + AllTrim( cLastName ) +  "', firstname='" + AllTrim( cFirstName ) +  "', lastname='" + AllTrim( cLastName ) +  "', address1='" + AllTrim( ::oCli:Domicilio ) +  "', postcode='" + AllTrim( ::oCli:CodPostal ) +  "', city='" + AllTrim( ::oCli:Poblacion ) +  "', phone='" + AllTrim( ::oCli:Telefono ) +  "', phone_mobile='" + AllTrim( ::oCli:Movil ) +  "', dni='" + AllTrim( ::oCli:Nif ) +  "', date_upd='" + dtos( GetSysDate() ) +  "' WHERE id_customer=" + AllTrim( Str( ::oCli:cCodWeb ) ) )

                     ::SetText( "Actualizado correctamente el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_address", 3 )
                  else
                     ::SetText( "Error al actualizar el cliente " + AllTrim( ::oCli:Titulo ) + " en la tabla ps_address", 3 )
                  end

               end

            end

         end

      end

      ::oCli:FieldPutByName( "lSndDoc", .F. )

      ::oCli:Skip()

   end

Return ( self )



UTILITY STATIC function TComercio_AppendFabricantesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n

   if ::lSincAll





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_manufacturer" )
         ::SetText ( "Tabla ps_manufacturer borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_manufacturer", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_manufacturer_shop" )
         ::SetText ( "Tabla ps_manufacturer_shop borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_manufacturer_shop", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_manufacturer_lang" )
         ::SetText ( "Tabla ps_manufacturer_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_manufacturer_lang", 3  )
      end





      ::DelIdFabricantePrestashop()

   end





   ::oFab:GoTop()

   while !::oFab:Eof()

      if ::oFab:lPubInt .AND. ( ::oFab:lSndDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando fabricantes" )





         ::AppFabricantesPrestashop()

      end

      ::oFab:FieldPutByName( "lSndDoc", .F. )

      ::oFab:Skip()

   end

Return ( self )



UTILITY STATIC function TComercio_AppFabricantesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local nCodigoWeb           := 0
   local nParent              := 1

   if ( ::oFab:cCodWeb == 0 .OR. ::lSincAll )













      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_manufacturer ( name, " +  "date_add, " +  "date_upd, " +  "active )" +  " VALUES " +  "('" + AllTrim( ::oFab:cNomFab ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'" + dtos( GetSysDate() ) + "', " +  "'1' )" )


         nCodigoWeb           := ::oCon:GetInsertId()

         ::oFab:fieldPutByName( "cCodWeb", nCodigoWeb )

         ::SetText( "He insertado el fabricante " + AllTrim( ::oFab:cNomFab ) + " correctamente en la tabla ps_manufacturer", 3 )

      else
         ::SetText( "Error al insertar el fabricante " + AllTrim( ::oFab:cNomFab ) + " en la tabla ps_manufacturer", 3 )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_manufacturer_shop ( id_manufacturer, " +  "id_shop )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'1' )" )


         ::SetText( "He insertado el fabricante " + AllTrim( ::oFab:cNomFab ) + " correctamente en la tabla ps_manufacturer_lang", 3 )

      else
         ::SetText( "Error al insertar el fabricante " + AllTrim( ::oFab:cNomFab ) + " en la tabla ps_manufacturer_lang", 3 )
      end





      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_manufacturer_lang ( id_manufacturer, " +  "id_lang )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoWeb ) ) + "', " +  "'" + Str( ::nLanguage ) + "' )" )


         ::SetText( "He insertado el fabricante " + AllTrim( ::oFab:cNomFab ) + " correctamente en la tabla ps_manufacturer_lang", 3 )

      else
         ::SetText( "Error al insertar el fabricante " + AllTrim( ::oFab:cNomFab ) + " en la tabla ps_manufacturer_lang", 3 )
      end

   else





      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_manufacturer SET name='" + AllTrim( ::oFab:cNomFab ) + "', date_upd='" + dtos( GetSysDate() ) + "' WHERE id_manufacturer=" + AllTrim( Str( ::oFab:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente el fabricante " + AllTrim( ::oFab:cNomFab ) + " en la tabla ps_manufacturer", 3 )
      else
         ::SetText( "Error al actualizar el fabricante " + AllTrim( ::oFab:cNomFab ) + " en la tabla ps_manufacturer", 3 )
      end

   end

return nCodigoWeb



UTILITY STATIC function TComercio_AppendPropiedadesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local n

   if ::lSincAll





      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_attribute" )
         ::SetText ( "Tabla ps_attribute borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_attribute", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_attribute_lang" )
         ::SetText ( "Tabla ps_attribute_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_attribute_lang", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_attribute_impact" )
         ::SetText ( "Tabla ps_attribute_impact borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_attribute_impact", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_attribute_group" )
         ::SetText ( "Tabla ps_attribute_group borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_attribute_group", 3  )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "TRUNCATE TABLE ps_attribute_group_lang" )
         ::SetText ( "Tabla ps_attribute_group_lang borrada correctamente", 3  )
      else
         ::SetText ( "Error al borrar la tabla ps_attribute_group_lang", 3  )
      end

   end





   ::oPro:GoTop()

   while !::oPro:Eof()

      if ::oPro:lPubInt .AND. ( ::oPro:lSndDoc .OR. ::lSincAll )

         ::MeterParticularText( "Actualizando propiedades de artculos" )

         ::AppPropiedadesPrestashop()

      end

      ::oPro:FieldPutByName( "lSndDoc", .F. )

      ::oPro:Skip()

   end

Return ( self )



UTILITY STATIC function TComercio_AppPropiedadesPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oImagen
   local nCodigoGrupo      := 0
   local nCodigoPropiedad  := 0
   local nParent           := 1
   local nRec              := ::oTblPro:Recno()
   local nOrdAnt           := ::oTblPro:OrdSetFocus( "CPRO" )

   if ( ::oPro:cCodWeb == 0 .OR. ::lSincAll )





      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_attribute_group ( is_color_group ) VALUES ( '" + if( ::oPro:lColor, "1", "0" ) + "' )" )


         nCodigoGrupo           := ::oCon:GetInsertId()

         ::oPro:fieldPutByName( "cCodWeb", nCodigoGrupo )

         ::SetText( "He insertado la propiedad " + AllTrim( ::oPro:cDesPro ) + " correctamente en la tabla ps_attribute_group", 3 )

      else
         ::SetText( "Error al insertar la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group", 3 )
      end









      if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_attribute_group_lang ( id_attribute_group, " +  "id_lang, " +  "name, " +  "public_name )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoGrupo ) ) + "', " +  "'" + Str( ::nLanguage ) + "', " +  "'" + AllTrim( ::oPro:cDesPro ) + "', " +  "'" + AllTrim( ::oPro:cDesPro ) + "' )" )

         ::SetText( "He insertado la propiedad " + AllTrim( ::oPro:cDesPro ) + " correctamente en la tabla ps_attribute_group_lang", 3 )

      else
         ::SetText( "Error al insertar la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group_lang", 3 )
      end

   else

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_attribute_group SET is_color_group='" + if( ::oPro:lColor, "1", "0" ) + "' WHERE id_attribute_group=" + AllTrim( Str( ::oPro:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group", 3 )
      else
         ::SetText( "Error al actualizar la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group", 3 )
      end

      if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_attribute_group_lang SET name='" + AllTrim( ::oPro:cDesPro ) + "', public_name='" + AllTrim( ::oPro:cDesPro ) + "' WHERE id_attribute_group=" + AllTrim( Str( ::oPro:cCodWeb ) ) )
         ::SetText( "Actualizada correctamente la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group_lang", 3 )
      else
         ::SetText( "Error al actualizar la propiedad " + AllTrim( ::oPro:cDesPro ) + " en la tabla ps_attribute_group_lang", 3 )
      end

   end





   if ::oTblPro:Seek( ::oPro:cCodPro )

      while ::oPro:cCodPro == ::oTblPro:cCodPro .AND. !::oTblPro:Eof()

         if ( ::oTblPro:cCodWeb == 0 .OR. ::lSincAll )





            if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_attribute ( id_attribute_group, " +  "color )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoGrupo ) ) + "', " +  "'" + AllTrim( RgbToRgbHex( ::oTblPro:nColor) ) + "' )" )


               nCodigoPropiedad   := ::oCon:GetInsertId()

               ::oTblPro:fieldPutByName( "cCodWeb", nCodigoPropiedad )

               ::SetText( "He insertado la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " correctamente en la tabla ps_attribute", 3 )

            else
               ::SetText( "Error al insertar la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute", 3 )
            end







            if TMSCommand():New( ::oCon ):ExecDirect( "INSERT INTO ps_attribute_lang ( id_attribute, " +  "id_lang, " +  "name )" +  " VALUES " +  "('" + AllTrim( Str( nCodigoPropiedad ) ) + "', " +  "'" + Str( ::nLanguage ) + "', " +  "'" + AllTrim( ::oTblPro:cDesTbl ) + "' )" )


               ::SetText( "He insertado la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " correctamente en la tabla ps_attribute_lang", 3 )

            else
               ::SetText( "Error al insertar la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute_lang", 3 )
            end

         else

            if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_attribute SET color='" + AllTrim( RgbToRgbHex( ::oTblPro:nColor ) ) + "' WHERE id_attribute=" + AllTrim( Str( ::oTblPro:cCodWeb ) ) )
               ::SetText( "Actualizada correctamente la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute", 3 )
            else
               ::SetText( "Error al actualizar la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute", 3 )
            end

            if TMSCommand():New( ::oCon ):ExecDirect( "UPDATE ps_attribute_lang SET name='" + AllTrim( ::oTblPro:cDesTbl ) + "' WHERE id_attribute=" + AllTrim( Str( ::oTblPro:cCodWeb ) ) )
               ::SetText( "Actualizada correctamente la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute_lang", 3 )
            else
               ::SetText( "Error al actualizar la propiedad " + AllTrim( ::oTblPro:cDesTbl ) + " en la tabla ps_attribute_lang", 3 )
            end

         end

         ::oTblPro:Skip()

      end

   end





   ::oTblPro:OrdSetFocus( nOrdAnt )

   ::oTblPro:GoTo( nRec )

return nCodigoGrupo



UTILITY STATIC function TComercio_GetColorDefault() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nIdColorDefault   := 0

   if !Empty( ::oArt:cCodPrp1 )

      if oRetFld( ::oArt:cCodPrp1, ::oPro, "lColor", "cCodPro" )

         nIdColorDefault   := oRetFld( ::oArt:cCodPrp1, ::oPro, "cCodWeb", "cCodPro" )

       end

   end


   if !Empty( ::oArt:cCodPrp2 )

       if oRetFld( ::oArt:cCodPrp2, ::oPro, "lColor", "cCodPro" )

         nIdColorDefault   := oRetFld( ::oArt:cCodPrp2, ::oPro, "cCodWeb", "cCodPro" )

       end

   end

return( nIdColorDefault )



UTILITY STATIC function TComercio_GetValPrp( nIdPrp, nProductAttibuteId) ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local oQuery1
   local oQuery2
   local nIdAttribute
   local nIdAttributeGroup
   local cValPrp                 := ""

   oQuery1                       := TMSQuery():New( ::oCon, "SELECT * FROM ps_product_attribute_combination where id_product_attribute=" + AllTrim( Str( nProductAttibuteId ) ) )

   if oQuery1:Open()





      if oQuery1:RecCount() > 0

         oQuery1:GoTop()

         while !oQuery1:Eof()

         nIdAttribute            := oQuery1:FieldGet( 1 )

         oQuery2                 := TMSQuery():New( ::oCon, "SELECT * FROM ps_attribute where id_attribute=" + AllTrim( Str( nIdAttribute ) ) )

         if oQuery2:Open()

            if oQuery2:RecCount() > 0

               nIdAttributeGroup := oQuery2:FieldGet( 2 )

               if nIdAttributeGroup == nIdPrp

                  if ::oTblPro:SeekInOrd( Str( nIdAttribute, 11 ), "cCodWeb" )

                     cValPrp     := ::oTblPro:cCodTbl

                  end

               end

            end

         end

         oQuery1:Skip()

         end

      end

   end

   oQuery1:Free()

return cValPrp



UTILITY STATIC function TComercio_DelIdFamiliasPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oFam:Recno()

   ::oFam:GoTop()

   while !::oFam:Eof()

      ::oFam:Load()
      ::oFam:cCodWeb := 0
      ::oFam:Save()

      ::oFam:Skip()

   end

   ::oFam:GoTo( nRec )

RETURN ( .T. )



UTILITY STATIC function TComercio_DelIdGrupoFamiliasPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oGrpFam:Recno()

   ::oGrpFam:GoTop()

   while !::oGrpFam:Eof()

      ::oGrpFam:Load()
      ::oGrpFam:cCodWeb := 0
      ::oGrpFam:Save()

      ::oGrpFam:Skip()

   end

   ::oGrpFam:GoTo( nRec )

RETURN ( .T. )



UTILITY STATIC function TComercio_DelIdTipoArticuloPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oTipArt:Recno()

   ::oTipArt:GoTop()

   while !::oTipArt:Eof()

      ::oTipArt:Load()
      ::oTipArt:cCodWeb := 0
      ::oTipArt:Save()

      ::oTipArt:Skip()

   end

   ::oTipArt:GoTo( nRec )

RETURN ( .T. )



UTILITY STATIC function TComercio_DelIdArticuloPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oArt:Recno()

   ::oArt:GoTop()

   while !::oArt:Eof()

      ::oArt:Load()
      ::oArt:cCodWeb := 0
      ::oArt:Save()

      ::oArt:Skip()

   end

   ::oArt:GoTo( nRec )

RETURN ( .T. )



UTILITY STATIC function TComercio_DelIdFabricantePrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oFab:Recno()

   ::oFab:GoTop()

   while !::oFab:Eof()

      ::oFab:Load()
      ::oFab:cCodWeb := 0
      ::oFab:Save()

      ::oFab:Skip()

   end

   ::oFab:GoTo( nRec )

RETURN ( .T. )



UTILITY STATIC function TComercio_DelIdIvaPrestashop() ; local Self AS CLASS TComercio := QSelf() AS CLASS TComercio

   local nRec  := ::oIva:Recno()

   ::oIva:GoTop()

   while !::oIva:Eof()

      ::oIva:Load()
      ::oIva:cCodWeb := 0
      ::oIva:Save()

      ::oIva:Skip()

   end

   ::oIva:GoTo( nRec )

RETURN ( .T. )








_HB_CLASS SImagen ; UTILITY FUNCTION SImagen(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "SImagen" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { cNombreImagen} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cNombreImagen" }, .F., .F. ), )
   _HB_MEMBER { nTipoImagen} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "nTipoImagen" }, .F., .F. ), )
   _HB_MEMBER { cCarpeta} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cCarpeta" }, .F., .F. ), )
   _HB_MEMBER { cPrefijoNombre} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cPrefijoNombre" }, .F., .F. ), )

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS SImagen ;



_HB_CLASS STipoImagen ; UTILITY FUNCTION STipoImagen(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "STipoImagen" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { cNombreTipo} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cNombreTipo" }, .F., .F. ), )
   _HB_MEMBER { nAnchoTipo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nAnchoTipo" }, .F., .F. ), )
   _HB_MEMBER { nAltoTipo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nAltoTipo" }, .F., .F. ), )
   _HB_MEMBER { lCategories} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lCategories" }, .F., .F. ), )
   _HB_MEMBER { lProducts} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lProducts" }, .F., .F. ), )
   _HB_MEMBER { lManufactures} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lManufactures" }, .F., .F. ), )
   _HB_MEMBER { lSuppliers} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lSuppliers" }, .F., .F. ), )
   _HB_MEMBER { lScenes} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lScenes" }, .F., .F. ), )
   _HB_MEMBER { lStores} ; IIF( !.F., s_oClass:AddMultiData(, .F., nScope + IIF( .F., 32, 0 ), { "lStores" }, .F., .F. ), )

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS STipoImagen ;



_HB_CLASS SPrePro ; UTILITY FUNCTION SPrePro(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "SPrePro" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { cCodArt} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cCodArt" }, .F., .F. ), )
   _HB_MEMBER { cCodPrp} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cCodPrp" }, .F., .F. ), )
   _HB_MEMBER { cValPrp} ; IIF( !.F., s_oClass:AddMultiData(, "", nScope + IIF( .F., 32, 0 ), { "cValPrp" }, .F., .F. ), )
   _HB_MEMBER { nPrecio} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nPrecio" }, .F., .F. ), )

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS SPrePro ;



_HB_CLASS SCategoria ; UTILITY FUNCTION SCategoria(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "SCategoria" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { id} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "id" }, .F., .F. ), )
   _HB_MEMBER { idParent} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "idParent" }, .F., .F. ), )
   _HB_MEMBER { nLeft} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nLeft" }, .F., .F. ), )
   _HB_MEMBER { nRight} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nRight" }, .F., .F. ), )
   _HB_MEMBER { nTipo} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nTipo" }, .F., .F. ), )

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS SCategoria ;



function cLinkRewrite( cLink )

Return( StrTran( AllTrim( cLink ), " ", "-" ) )
