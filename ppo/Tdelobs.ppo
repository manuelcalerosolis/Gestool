#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 8 ".\Prg\Tdelobs.prg"
_HB_CLASS TDeleleteObsoletos ; UTILITY FUNCTION TDeleleteObsoletos(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TDeleleteObsoletos" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { oDialog} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDialog" }, .F., .F. ), )
   _HB_MEMBER { oPages} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPages" }, .F., .F. ), )
   _HB_MEMBER { oBtnSiguiente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnSiguiente" }, .F., .F. ), )
   _HB_MEMBER { oBtnPrevio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnPrevio" }, .F., .F. ), )
   _HB_MEMBER { oMtrProceso} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMtrProceso" }, .F., .F. ), )
   _HB_MEMBER { nMtrProceso} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nMtrProceso" }, .F., .F. ), )
   _HB_MEMBER { oBrwArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwArticulos" }, .F., .F. ), )

   _HB_MEMBER { lNoCom} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lNoCom" }, .F., .F. ), )
   _HB_MEMBER { lNoPre} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lNoPre" }, .F., .F. ), )
   _HB_MEMBER { lNoVta} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lNoVta" }, .F., .F. ), )
   _HB_MEMBER { lNoMov} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lNoMov" }, .F., .F. ), )

   _HB_MEMBER { nAction} ; IIF( !.F., s_oClass:AddMultiData(, 1, nScope + IIF( .F., 32, 0 ), { "nAction" }, .F., .F. ), )

   _HB_MEMBER { nBmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nBmp" }, .F., .F. ), )

   _HB_MEMBER { aArticulos} ; IIF( !.F., s_oClass:AddMultiData(, { { .F., "", "" } }, nScope + IIF( .F., 32, 0 ), { "aArticulos" }, .F., .F. ), )

   _HB_MEMBER { dFechaInicial} ; IIF( !.F., s_oClass:AddMultiData(, CtoD( "01/01/" + Str( Year( Date() ) ) ), nScope + IIF( .F., 32, 0 ), { "dFechaInicial" }, .F., .F. ), )
   _HB_MEMBER { dFechaFinal} ; IIF( !.F., s_oClass:AddMultiData(, Date(), nScope + IIF( .F., 32, 0 ), { "dFechaFinal" }, .F., .F. ), )

   _HB_MEMBER { lTodasFamilias} ; IIF( !.F., s_oClass:AddMultiData(, .T., nScope + IIF( .F., 32, 0 ), { "lTodasFamilias" }, .F., .F. ), )
   _HB_MEMBER { cFamiliaOrigen} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFamiliaOrigen" }, .F., .F. ), )
   _HB_MEMBER { cFamiliaDestino} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFamiliaDestino" }, .F., .F. ), )

   _HB_MEMBER { oPedPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedPrvT" }, .F., .F. ), )
   _HB_MEMBER { oPedPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedPrvL" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvT" }, .F., .F. ), )
   _HB_MEMBER { oAlbPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbPrvL" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvT" }, .F., .F. ), )
   _HB_MEMBER { oFacPrvL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacPrvL" }, .F., .F. ), )
   _HB_MEMBER { oPreCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPreCliT" }, .F., .F. ), )
   _HB_MEMBER { oPreCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPreCliL" }, .F., .F. ), )
   _HB_MEMBER { oPedCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliT" }, .F., .F. ), )
   _HB_MEMBER { oPedCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedCliL" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliT" }, .F., .F. ), )
   _HB_MEMBER { oAlbCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliT" }, .F., .F. ), )
   _HB_MEMBER { oFacCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacCliL" }, .F., .F. ), )
   _HB_MEMBER { oFacRecT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecT" }, .F., .F. ), )
   _HB_MEMBER { oFacRecL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacRecL" }, .F., .F. ), )
   _HB_MEMBER { oTikCliT} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliT" }, .F., .F. ), )
   _HB_MEMBER { oTikCliL} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTikCliL" }, .F., .F. ), )
   _HB_MEMBER { oHisMov} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oHisMov" }, .F., .F. ), )
   _HB_MEMBER { oDbfFam} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfFam" }, .F., .F. ), )
   _HB_MEMBER { oDbfArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDbfArt" }, .F., .F. ), )
   _HB_MEMBER { oPrvArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPrvArt" }, .F., .F. ), )
   _HB_MEMBER { oArtDiv} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArtDiv" }, .F., .F. ), )
   _HB_MEMBER { oArtKit} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArtKit" }, .F., .F. ), )
   _HB_MEMBER { oCodeBar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCodeBar" }, .F., .F. ), )

   _HB_MEMBER New(); IIF( .F., s_oClass:ModMethod( "New", @TDeleleteObsoletos_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "New", @TDeleleteObsoletos_New(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OpenFiles(); IIF( .F., s_oClass:ModMethod( "OpenFiles", @TDeleleteObsoletos_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenFiles", @TDeleleteObsoletos_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CloseFiles(); IIF( .F., s_oClass:ModMethod( "CloseFiles", @TDeleleteObsoletos_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseFiles", @TDeleleteObsoletos_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Resource(); IIF( .F., s_oClass:ModMethod( "Resource", @TDeleleteObsoletos_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Resource", @TDeleleteObsoletos_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BtnPrevio(); IIF( .F., s_oClass:ModMethod( "BtnPrevio", @TDeleleteObsoletos_BtnPrevio(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BtnPrevio", @TDeleleteObsoletos_BtnPrevio(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BtnSiguiente(); IIF( .F., s_oClass:ModMethod( "BtnSiguiente", @TDeleleteObsoletos_BtnSiguiente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BtnSiguiente", @TDeleleteObsoletos_BtnSiguiente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Search(); IIF( .F., s_oClass:ModMethod( "Search", @TDeleleteObsoletos_Search(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Search", @TDeleleteObsoletos_Search(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lNoHayMovimientos(); IIF( .F., s_oClass:ModMethod( "lNoHayMovimientos", @TDeleleteObsoletos_lNoHayMovimientos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lNoHayMovimientos", @TDeleleteObsoletos_lNoHayMovimientos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BorraSeleccionados(); IIF( .F., s_oClass:ModMethod( "BorraSeleccionados", @TDeleleteObsoletos_BorraSeleccionados(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BorraSeleccionados", @TDeleleteObsoletos_BorraSeleccionados(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelDel(); IIF( .F., s_oClass:ModMethod( "SelDel", @TDeleleteObsoletos_SelDel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelDel", @TDeleleteObsoletos_SelDel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelAllDel( lOpcion); IIF( .F., s_oClass:ModMethod( "SelAllDel", @TDeleleteObsoletos_SelAllDel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelAllDel", @TDeleleteObsoletos_SelAllDel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TDeleleteObsoletos ;



UTILITY STATIC function TDeleleteObsoletos_New() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   ::OpenFiles()

   ::Resource()

   ::CloseFiles()

Return ( Self )



UTILITY STATIC function TDeleleteObsoletos_OpenFiles() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   ::oPedPrvT := DbfServer( "PEDPROVT.DBF", ):NewOpen( "PEDPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvT:AddBag( "PEDPROVT.CDX" ) ; ::oPedPrvT:AddBag( ) ; ::oPedPrvT:AutoIndex()
   ::oPedPrvL := DbfServer( "PEDPROVL.DBF", ):NewOpen( "PEDPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedPrvL:AddBag( "PEDPROVL.CDX" ) ; ::oPedPrvL:AddBag( ) ; ::oPedPrvL:AutoIndex()
   ::oPedPrvL:OrdSetFocus( "cRef" )

   ::oAlbPrvT := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvT:AddBag( "ALBPROVT.CDX" ) ; ::oAlbPrvT:AddBag( ) ; ::oAlbPrvT:AutoIndex()
   ::oAlbPrvL := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbPrvL:AddBag( "ALBPROVL.CDX" ) ; ::oAlbPrvL:AddBag( ) ; ::oAlbPrvL:AutoIndex()
   ::oAlbPrvL:OrdSetFocus( "cRef" )

   ::oFacPrvT := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvT:AddBag( "FACPRVT.CDX" ) ; ::oFacPrvT:AddBag( ) ; ::oFacPrvT:AutoIndex()
   ::oFacPrvL := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacPrvL:AddBag( "FACPRVL.CDX" ) ; ::oFacPrvL:AddBag( ) ; ::oFacPrvL:AutoIndex()
   ::oFacPrvL:OrdSetFocus( "cRef" )

   ::oPreCliT := DbfServer( "PRECLIT.DBF", ):NewOpen( "PRECLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliT:AddBag( "PRECLIT.CDX" ) ; ::oPreCliT:AddBag( ) ; ::oPreCliT:AutoIndex()
   ::oPreCliL := DbfServer( "PRECLIL.DBF", ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPreCliL:AddBag( "PRECLIL.CDX" ) ; ::oPreCliL:AddBag( ) ; ::oPreCliL:AutoIndex()
   ::oPreCliL:OrdSetFocus( "cRef" )

   ::oPedCliT := DbfServer( "PEDCLIT.DBF", ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliT:AddBag( "PEDCLIT.CDX" ) ; ::oPedCliT:AddBag( ) ; ::oPedCliT:AutoIndex()
   ::oPedCliL := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedCliL:AddBag( "PEDCLIL.CDX" ) ; ::oPedCliL:AddBag( ) ; ::oPedCliL:AutoIndex()
   ::oPedCliL:OrdSetFocus( "cRef" )

   ::oAlbCliT := DbfServer( "ALBCLIT.DBF", ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliT:AddBag( "ALBCLIT.CDX" ) ; ::oAlbCliT:AddBag( ) ; ::oAlbCliT:AutoIndex()
   ::oAlbCliL := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbCliL:AddBag( "ALBCLIL.CDX" ) ; ::oAlbCliL:AddBag( ) ; ::oAlbCliL:AutoIndex()
   ::oAlbCliL:OrdSetFocus( "cRef" )

   ::oFacCliT := DbfServer( "FACCLIT.DBF", ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliT:AddBag( "FACCLIT.CDX" ) ; ::oFacCliT:AddBag( ) ; ::oFacCliT:AutoIndex()
   ::oFacCliL := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacCliL:AddBag( "FACCLIL.CDX" ) ; ::oFacCliL:AddBag( ) ; ::oFacCliL:AutoIndex()
   ::oFacCliL:OrdSetFocus( "cRef" )

   ::oFacRecT := DbfServer( "FACRECT.DBF", ):NewOpen( "FACRECT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecT:AddBag( "FACRECT.CDX" ) ; ::oFacRecT:AddBag( ) ; ::oFacRecT:AutoIndex()
   ::oFacRecL := DbfServer( "FACRECL.DBF", ):NewOpen( "FACRECL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacRecL:AddBag( "FACRECL.CDX" ) ; ::oFacRecL:AddBag( ) ; ::oFacRecL:AutoIndex()
   ::oFacRecL:OrdSetFocus( "cRef" )

   ::oTikCliT := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliT:AddBag( "TIKET.CDX" ) ; ::oTikCliT:AddBag( ) ; ::oTikCliT:AutoIndex()
   ::oTikCliL := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTikCliL:AddBag( "TIKEL.CDX" ) ; ::oTikCliL:AddBag( ) ; ::oTikCliL:AutoIndex()
   ::oTikCliL:OrdSetFocus( "cCbaTil" )

   ::oHisMov := DbfServer( "HISMOV.DBF", ):NewOpen( "HISMOV.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oHisMov:AddBag( "HISMOV.CDX" ) ; ::oHisMov:AddBag( ) ; ::oHisMov:AutoIndex()
   ::oHisMov:OrdSetFocus( "cRefMov" )

   ::oDbfFam := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oDbfFam:AddBag( "FAMILIAS.CDX" ) ; ::oDbfFam:AddBag( ) ; ::oDbfFam:AutoIndex()

   ::oDbfArt := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oDbfArt:AddBag( "ARTICULO.CDX" ) ; ::oDbfArt:AddBag( ) ; ::oDbfArt:AutoIndex()

   ::oPrvArt := DbfServer( "PROVART.DBF", ):NewOpen( "PROVART.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oPrvArt:AddBag( "PROVART.CDX" ) ; ::oPrvArt:AddBag( ) ; ::oPrvArt:AutoIndex()
   ::oPrvArt:OrdSetFocus( "cCodArt" )

   ::oArtDiv := DbfServer( "ARTDIV.DBF", ):NewOpen( "ARTDIV.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArtDiv:AddBag( "ARTDIV.CDX" ) ; ::oArtDiv:AddBag( ) ; ::oArtDiv:AutoIndex()
   ::oArtDiv:OrdSetFocus( "cCodArt" )

   ::oArtKit := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArtKit:AddBag( "ARTKIT.CDX" ) ; ::oArtKit:AddBag( ) ; ::oArtKit:AutoIndex()
   ::oArtKit:OrdSetFocus( "cCodKit" )

   ::oCodeBar := DbfServer( "ARTCODEBAR.DBF", ):NewOpen( "ARTCODEBAR.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oCodeBar:AddBag( "ARTCODEBAR.CDX" ) ; ::oCodeBar:AddBag( ) ; ::oCodeBar:AutoIndex()
   ::oCodeBar:OrdSetFocus( "cCodArt" )

   ::nBmp               := LoadBitmap( 0, 32760 )


Return ( Self )



UTILITY STATIC function TDeleleteObsoletos_CloseFiles() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   ::oPedPrvT:End()
   ::oPedPrvL:End()
   ::oAlbPrvT:End()
   ::oAlbPrvL:End()
   ::oFacPrvT:End()
   ::oFacPrvL:End()
   ::oPreCliT:End()
   ::oPreCliL:End()
   ::oPedCliT:End()
   ::oPedCliL:End()
   ::oAlbCliT:End()
   ::oAlbCliL:End()
   ::oFacCliT:End()
   ::oFacCliL:End()
   ::oFacRecT:End()
   ::oFacRecL:End()
   ::oTikCliT:End()
   ::oTikCliL:End()
   ::oHisMov:End()
   ::oDbfFam:End()
   ::oDbfArt:End()
   ::oPrvArt:End()
   ::oArtDiv:End()
   ::oArtKit:End()
   ::oCodeBar:End()

   DeleteObject( ::nBmp )

Return ( Self )



UTILITY STATIC function TDeleleteObsoletos_Resource() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   local oFamiliaOrigen
   local oFamiliaDestino

   local oSayFamiliaOrigen
   local oSayFamiliaDestino
   local cSayFamiliaOrigen
   local cSayFamiliaDestino
   local oBmp

   ::cFamiliaOrigen     := dbFirst( ::oDbfFam, 1 )
   ::cFamiliaDestino    := dbLast ( ::oDbfFam, 1 )
   cSayFamiliaOrigen    := dbFirst( ::oDbfFam, 2 )
   cSayFamiliaDestino   := dbLast ( ::oDbfFam, 2 )





   ::oDialog = TDialog():New(,,,,, "ASS_EURO",, .F.,,,,,, .F.,,,,,, .F., )

   oBmp := TBitmap():ReDefine( 600, "EliminarArticulos",, ::oDialog,,, .F., .F.,,, .F.,,, .F. )


   ::oPages := TPages():Redefine( 110, ::oDialog, {"ASS_EURO01", "ASS_EURO02"},,,, )




   TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::dFechaInicial, ::dFechaInicial:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




   TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::dFechaFinal, ::dFechaFinal:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )



   TRadMenu():Redefine( { | u | If( PCount()==0, ::nAction, ::nAction:= u ) }, ::oPages:aDialogs[ 1 ],, { 200, 210 },,,,, .F.,, )



   TCheckBox():ReDefine( 120, { | u | If( PCount()==0, ::lTodasFamilias, ::lTodasFamilias:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )







   oFamiliaOrigen := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::cFamiliaOrigen, ::cFamiliaOrigen:= u ) }, ::oPages:aDialogs[ 1 ],,, {||    cFamilia( oFamiliaOrigen, ::oDbfFam:cAlias, oSayFamiliaOrigen )},,,,,, .F., {||     !::lTodasFamilias},, .F., .F.,,,,, {|Self|BrwFamilia( oFamiliaOrigen, oSayFamiliaDestino )}, nil, "LUPA",, )




   oSayFamiliaOrigen := TGetHlp():ReDefine( 131, { | u | If( PCount()==0, cSayFamiliaOrigen, cSayFamiliaOrigen:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )







   oFamiliaDestino := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::cFamiliaDestino, ::cFamiliaDestino:= u ) }, ::oPages:aDialogs[ 1 ],,, {||    cFamilia( oFamiliaDestino, ::oDbfFam:cAlias, oSayFamiliaDestino )},,,,,, .F., {||     !::lTodasFamilias},, .F., .F.,,,,, {|Self|BrwFamilia( oFamiliaDestino, oSayFamiliaDestino )}, nil, "LUPA",, )




   oSayFamiliaDestino := TGetHlp():ReDefine( 141, { | u | If( PCount()==0, cSayFamiliaDestino, cSayFamiliaDestino:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )



   TCheckBox():ReDefine( 160, { | u | If( PCount()==0, ::lNoCom, ::lNoCom:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 170, { | u | If( PCount()==0, ::lNoPre, ::lNoPre:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 180, { | u | If( PCount()==0, ::lNoVta, ::lNoVta:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )



   TCheckBox():ReDefine( 190, { | u | If( PCount()==0, ::lNoMov, ::lNoMov:= u ) }, ::oPages:aDialogs[ 1 ],,,,,,, .F.,, .F. )






   ::oMtrProceso := TMeter():ReDefine( 150, { | u | If( PCount()==0, ::nMtrProceso, ::nMtrProceso:= u ) }, 100, ::oPages:aDialogs[ 1 ], .F.,, "Procesando", .F.,,,, )

   ::oBrwArticulos                        := IXBrowse():New( ::oPages:aDialogs[ 2 ] )

   ::oBrwArticulos:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
   ::oBrwArticulos:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

   ::oBrwArticulos:SetArray( ::aArticulos, , , .F. )

   ::oBrwArticulos:nMarqueeStyle          := 5
   ::oBrwArticulos:lRecordSelector        := .F.
   ::oBrwArticulos:lHScroll               := .F.
   ::oBrwArticulos:cName                  := "Eliminar artículos sin movimientos"
   ::oBrwArticulos:bLDblClick             := {|| ::SelDel(), ::oBrwArticulos:Refresh() }

   ::oBrwArticulos:CreateFromResource( 100 )

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Se. seleccionado"
      :bStrData         := {|| "" }
      :bEditValue       := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ] }
      :nWidth           := 20
      :SetCheck( { "Sel16", "Nil16" } )
   end

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Código"
      :bStrData         := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 2 ] }
      :nWidth           := 80
   end

   with object ( ::oBrwArticulos:AddCol() )
      :cHeader          := "Nombre"
      :bStrData         := {|| ::aArticulos[ ::oBrwArticulos:nArrayAt, 3 ] }
      :nWidth           := 400
   end




   TButton():ReDefine( 130, {||( ::SelDel(), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   TButton():ReDefine( 110, {||( ::SelAllDel( .T. ), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   TButton():ReDefine( 120, {||( ::SelAllDel( .F. ), ::oBrwArticulos:Refresh() )}, ::oPages:aDialogs[ 2 ],,, .F.,,,, .F. )




   ::oBtnPrevio := TButton():ReDefine( 401, {||( ::BtnPrevio() )}, ::oDialog,,, .F.,,,, .F. )




   ::oBtnSiguiente := TButton():ReDefine( 402, {||( ::BtnSiguiente() )}, ::oDialog,,, .F.,,,, .F. )




   TButton():ReDefine( 403, {||( ::oDialog:end() )}, ::oDialog,,, .F.,,,, .F. )

   ::oDialog:bStart  := {|| ::oBtnPrevio:Hide(), ::oBrwArticulos:Load() }

   ::oDialog:Activate( ::oDialog:bLClicked, ::oDialog:bMoved, ::oDialog:bPainted, .T.,,,, ::oDialog:bRClicked,,, )

   oBmp:End()

RETURN ( Self )



UTILITY STATIC function TDeleleteObsoletos_BtnPrevio() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   if ::oPages:nOption == 2
      ::oPages:GoPrev()
      SetWindowText( ::oBtnSiguiente:hWnd, "Siguien&te >" )
      ::oBtnPrevio:Hide()
   end

RETURN ( Self )



UTILITY STATIC function TDeleleteObsoletos_BtnSiguiente() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   do case
      case ::oPages:nOption == 1
         if !::lNoCom .AND. !::lNoPre .AND. !::lNoVta .AND. !::lNoMov
            MsgStop( "Tienes que seleccionar alguna de las opciones a incluir en la búsqueda" )
            Return .F.
         end
         ::Search()
         ::oPages:GoNext()
         SetWindowText( ::oBtnSiguiente:hWnd, "&Proceder" )
         ::oBtnPrevio:Show()

      case ::oPages:nOption == 2
         ::BorraSeleccionados()
         ::oDialog:End()
   end

RETURN ( Self )



UTILITY STATIC function TDeleleteObsoletos_Search() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   ::oDialog:Disable()

   ::aArticulos               := {}

   aEval( ::oBrwArticulos:aArrayData, {|a,n| aDel( ::oBrwArticulos:aArrayData, n, .T. ), ::oBrwArticulos:Refresh() } )

   ::oMtrProceso:SetTotal( ::oDbfArt:Lastrec() )

   ::oDbfArt:GoTop()
   while !::oDbfArt:Eof()


      if ::lTodasFamilias  .OR. ( ::oDbfArt:Familia >= ::cFamiliaOrigen .AND. ::oDbfArt:Familia <= ::cFamiliaDestino )

         if ::lNoHayMovimientos()
            aAdd( ::aArticulos, { .T., ::oDbfArt:Codigo, ::oDbfArt:Nombre } )
         end

      end

      ::oMtrProceso:Set( ::oDbfArt:OrdKeyNo() )

      ::oDbfArt:Skip()

   end

   ::oMtrProceso:Set( ::oDbfArt:LastRec() )

   aEval( ::aArticulos, {|a| aAdd( ::oBrwArticulos:aArrayData, a ), ::oBrwArticulos:Refresh() } )

   ::oDialog:Enable()

Return ( Self )



UTILITY STATIC function TDeleleteObsoletos_lNoHayMovimientos() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   local dFecha
   local cCodArt     := ::oDbfArt:Codigo

   if ::lNoCom

      if ::oPedPrvL:Seek( cCodArt )

         while ::oPedPrvL:cRef == cCodArt .AND. !::oPedPrvL:Eof()

            dFecha   := dFecPedPrv( ::oPedPrvL:cSerPed + Str( ::oPedPrvL:nNumPed ) + ::oPedPrvL:cSufPed, ::oPedPrvT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oPedPrvL:Skip()

         end

      end

      if ::oAlbPrvL:Seek( cCodArt )

         while ::oAlbPrvL:cRef == cCodArt .AND. !::oAlbPrvL:Eof()

            dFecha   := dFecAlbPrv( ::oAlbPrvL:cSerAlb + Str( ::oAlbPrvL:nNumAlb ) + ::oAlbPrvL:cSufAlb, ::oAlbPrvT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oAlbPrvL:Skip()

         end

      end

      if ::oFacPrvL:Seek( cCodArt )

         while ::oFacPrvL:cRef == cCodArt .AND. !::oFacPrvL:Eof()

            dFecha   := dFecFacPrv( ::oFacPrvL:cSerFac + Str( ::oFacPrvL:nNumFac ) + ::oFacPrvL:cSufFac, ::oFacPrvT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oFacPrvL:Skip()

         end

      end

   end

   if ::lNoPre

      if ::oPreCliL:Seek( cCodArt )

         while ::oPreCliL:cRef == cCodArt .AND. !::oPreCliL:Eof()

            dFecha   := dFecPreCli( ::oPreCliL:cSerPre + Str( ::oPreCliL:nNumPre ) + ::oPreCliL:cSufPre, ::oPreCliT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oPreCliL:Skip()

         end

      end

   end

   if ::lNoVta

      if ::oPedCliL:Seek( cCodArt )

         while ::oPedCliL:cRef == cCodArt .AND. !::oPedCliL:Eof()

            dFecha   := dFecPedCli( ::oPedCliL:cSerPed + Str( ::oPedCliL:nNumPed ) + ::oPedCliL:cSufPed, ::oPedCliT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oPedCliL:Skip()

         end

      end

      if ::oAlbCliL:Seek( cCodArt )

         while ::oAlbCliL:cRef == cCodArt .AND. !::oAlbCliL:Eof()

            dFecha   := dFecAlbCli( ::oAlbCliL:cSerAlb + Str( ::oAlbCliL:nNumAlb ) + ::oAlbCliL:cSufAlb, ::oAlbCliT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oAlbCliL:Skip()

         end

      end

      if ::oFacCliL:Seek( cCodArt )

         while ::oFacCliL:cRef == cCodArt .AND. !::oFacCliL:Eof()

            dFecha   := dFecFacCli( ::oFacCliL:cSerie + Str( ::oFacCliL:nNumFac ) + ::oFacCliL:cSufFac, ::oFacCliT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oFacCliL:Skip()

         end

      end

      if ::oFacRecL:Seek( cCodArt )

         while ::oFacRecL:cRef == cCodArt .AND. !::oFacRecL:Eof()

            dFecha   := dFecFacRec( ::oFacRecL:cSerie + Str( ::oFacRecL:nNumFac ) + ::oFacRecL:cSufFac, ::oFacRecT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oFacRecL:Skip()

         end

      end

      if ::oTikCliL:Seek( cCodArt )

         while ::oTikCliL:cCbaTil == cCodArt .AND. !::oTikCliL:Eof()

            dFecha   := dFecTik( ::oTikCliL:cSerTil + ::oTikCliL:cNumTil + ::oTikCliL:cSufTil, ::oTikCliT:cAlias )

            if dFecha >= ::dFechaInicial .AND. dFecha <= ::dFechaFinal

               Return .F.

            end

            ::oTikCliL:Skip()

         end

      end

   end

   if ::lNoMov

      if ::oHisMov:Seek( cCodArt )

         while ::oHisMov:cRefMov == cCodArt .AND. !::oHisMov:Eof()

            if ::oHisMov:dFecMov >= ::dFechaInicial .AND. ::oHisMov:dFecMov <= ::dFechaFinal

               Return .F.

            end

            ::oHisMov:Skip()

         end

      end

   end

RETURN .T.



UTILITY STATIC function TDeleleteObsoletos_BorraSeleccionados() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   local n
   local cText       := "¡Atención!" + Chr(13)+Chr(10)
   local nBorrados   := 0

   for n := 1 to len( ::aArticulos )

      if ::aArticulos[ n, 1 ]
         nBorrados++
      end

   next

   if nBorrados > 0
      if ::nAction == 1
         cText       += "Se van a eliminar " + Alltrim( Str( nBorrados ) ) + " árticulos." + Chr(13)+Chr(10)
      else
         cText       += "Se van a marcar como obsoletos " + Alltrim( Str( nBorrados ) ) + " árticulos." + Chr(13)+Chr(10)
      end
   end

   if !ApoloMsgNoYes(cText, "Confirme proceso" )
      Return ( Self )
   end

   for n := 1 to len( ::aArticulos )

      do case

         case ::nAction == 1 .AND. ::aArticulos[ n, 1 ]

            while ::oPrvArt:Seek( ::aArticulos[ n, 2 ] )
               ::oPrvArt:Delete()
            end

            while ::oArtDiv:Seek( ::aArticulos[ n, 2 ] )
               ::oArtDiv:Delete()
            end

            while ::oArtKit:Seek( ::aArticulos[ n, 2 ] )
               ::oArtKit:Delete()
            end

            while ::oCodeBar:Seek( ::aArticulos[ n, 2 ] )
               ::oCodeBar:Delete()
            end

            while ::oDbfArt:Seek( ::aArticulos[ n, 2 ] )
               ::oDbfArt:Delete()
            end

         case ::nAction == 2 .AND. ::aArticulos[ n, 1 ]

            if ::oDbfArt:Seek( ::aArticulos[ n, 2 ] )
               ::oDbfArt:Load()
               if !::oDbfArt:lNevObs
                  ::oDbfArt:lObs := .T.
               end
               ::oDbfArt:Save()
            end

      end

   next

RETURN ( Self )



UTILITY STATIC function TDeleleteObsoletos_SelDel() ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   if len( ::aArticulos ) <> 0
      ::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ] := !::aArticulos[ ::oBrwArticulos:nArrayAt, 1 ]
   end

RETURN ( Self )



UTILITY STATIC function TDeleleteObsoletos_SelAllDel( lOpcion) ; local Self AS CLASS TDeleleteObsoletos := QSelf() AS CLASS TDeleleteObsoletos

   aEval( ::aArticulos, {|a| a[ 1 ] := lOpcion } )

RETURN ( Self )
