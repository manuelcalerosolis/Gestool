#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 40 ".\Prg\TpvTactil.prg"
static aResources                   := {}

static oThis



Function StartTpvTactil()

   local oTpvTactil

   oTpvTactil  := TpvTactil():New()

   if !Empty( oTpvTactil )
      oTpvTactil:Activate()
   end

Return ( nil )



_HB_CLASS TpvTactil ; UTILITY FUNCTION TpvTactil(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TpvTactil" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { oWnd} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oWnd" }, .F., .F. ), )
   _HB_MEMBER { oDlg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDlg" }, .F., .F. ), )
   _HB_MEMBER { nScreenHorzRes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nScreenHorzRes" }, .F., .F. ), )
   _HB_MEMBER { nScreenVertRes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nScreenVertRes" }, .F., .F. ), )

   _HB_MEMBER { lOpenfiles} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lOpenfiles" }, .F., .F. ), )

   _HB_MEMBER { nLevel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nLevel" }, .F., .F. ), )

   _HB_MEMBER { lAlone} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lAlone" }, .F., .F. ), )

   _HB_MEMBER { oTiketCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTiketCabecera" }, .F., .F. ), )
   _HB_MEMBER { oTiketLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTiketLinea" }, .F., .F. ), )
   _HB_MEMBER { oTiketCobro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTiketCobro" }, .F., .F. ), )
   _HB_MEMBER { oTiketMesa} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTiketMesa" }, .F., .F. ), )
   _HB_MEMBER { oTiketNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTiketNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCliente" }, .F., .F. ), )
   _HB_MEMBER { oCajaCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCajaCabecera" }, .F., .F. ), )
   _HB_MEMBER { oCajaLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCajaLinea" }, .F., .F. ), )
   _HB_MEMBER { oUsuario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oUsuario" }, .F., .F. ), )
   _HB_MEMBER { oArticulo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArticulo" }, .F., .F. ), )
   _HB_MEMBER { oCodigoBarraArticulo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCodigoBarraArticulo" }, .F., .F. ), )
   _HB_MEMBER { oArticulosEscandallos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArticulosEscandallos" }, .F., .F. ), )
   _HB_MEMBER { oOferta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oOferta" }, .F., .F. ), )
   _HB_MEMBER { oFormaPago} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFormaPago" }, .F., .F. ), )
   _HB_MEMBER { oPropiedadesLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPropiedadesLinea" }, .F., .F. ), )
   _HB_MEMBER { oFamilias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFamilias" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranClienteCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranClienteCabecera" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranClienteLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranClienteLinea" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranClienteSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranClienteSerie" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranClientePago} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranClientePago" }, .F., .F. ), )
   _HB_MEMBER { oFacturaClienteCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaClienteCabecera" }, .F., .F. ), )
   _HB_MEMBER { oFacturaClienteLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaClienteLinea" }, .F., .F. ), )
   _HB_MEMBER { oFacturaClienteSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaClienteSerie" }, .F., .F. ), )
   _HB_MEMBER { oFacturaClientePago} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaClientePago" }, .F., .F. ), )
   _HB_MEMBER { oAnticipoCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAnticipoCliente" }, .F., .F. ), )
   _HB_MEMBER { oObras} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oObras" }, .F., .F. ), )
   _HB_MEMBER { oAgentes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAgentes" }, .F., .F. ), )
   _HB_MEMBER { oRuta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRuta" }, .F., .F. ), )
   _HB_MEMBER { oAlmacen} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlmacen" }, .F., .F. ), )
   _HB_MEMBER { oArticuloDividido} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oArticuloDividido" }, .F., .F. ), )
   _HB_MEMBER { oTarifaPrecioLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTarifaPrecioLinea" }, .F., .F. ), )
   _HB_MEMBER { oTarifaPrecioLineaAgente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTarifaPrecioLineaAgente" }, .F., .F. ), )
   _HB_MEMBER { oDocument} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDocument" }, .F., .F. ), )
   _HB_MEMBER { oAtipicasCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAtipicasCliente" }, .F., .F. ), )
   _HB_MEMBER { oContadores} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oContadores" }, .F., .F. ), )
   _HB_MEMBER { oTipoIVA} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipoIVA" }, .F., .F. ), )
   _HB_MEMBER { oDivisas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDivisas" }, .F., .F. ), )
   _HB_MEMBER { oFiltroPorUsuario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFiltroPorUsuario" }, .F., .F. ), )
   _HB_MEMBER { oComisionesAgentes} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oComisionesAgentes" }, .F., .F. ), )
   _HB_MEMBER { oEmpresa} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oEmpresa" }, .F., .F. ), )
   _HB_MEMBER { oFactoresConversion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFactoresConversion" }, .F., .F. ), )
   _HB_MEMBER { oPedidoClienteCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedidoClienteCabecera" }, .F., .F. ), )
   _HB_MEMBER { oPedidoClienteLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedidoClienteLinea" }, .F., .F. ), )
   _HB_MEMBER { oPedidoClienteEntregaCuenta} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPedidoClienteEntregaCuenta" }, .F., .F. ), )
   _HB_MEMBER { oPresupuestoClienteCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPresupuestoClienteCabecera" }, .F., .F. ), )
   _HB_MEMBER { oPresupuestoClienteLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oPresupuestoClienteLinea" }, .F., .F. ), )
   _HB_MEMBER { oFacturaRectificativaCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaRectificativaCabecera" }, .F., .F. ), )
   _HB_MEMBER { oFacturaRectificativaLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaRectificativaLinea" }, .F., .F. ), )
   _HB_MEMBER { oFacturaRectificativaNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaRectificativaNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranProveedorCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranProveedorCabecera" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranProveedorLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranProveedorLinea" }, .F., .F. ), )
   _HB_MEMBER { oAlbaranProveedorNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oAlbaranProveedorNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oFacturaProveedorCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaProveedorCabecera" }, .F., .F. ), )
   _HB_MEMBER { oFacturaProveedorLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaProveedorLinea" }, .F., .F. ), )
   _HB_MEMBER { oFacturaProveedorNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFacturaProveedorNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oRectificativaProveedorCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRectificativaProveedorCabecera" }, .F., .F. ), )
   _HB_MEMBER { oRectificativaProveedorLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRectificativaProveedorLinea" }, .F., .F. ), )
   _HB_MEMBER { oRectificativaProveedorNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRectificativaProveedorNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oMovimientosAlmacen} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMovimientosAlmacen" }, .F., .F. ), )
   _HB_MEMBER { oMovimientosAlmacenNumeroSerie} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMovimientosAlmacenNumeroSerie" }, .F., .F. ), )
   _HB_MEMBER { oCategorias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCategorias" }, .F., .F. ), )
   _HB_MEMBER { oComentariosCabecera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oComentariosCabecera" }, .F., .F. ), )
   _HB_MEMBER { oComentariosLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oComentariosLinea" }, .F., .F. ), )
   _HB_MEMBER { oTipoImpresoraComandas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipoImpresoraComandas" }, .F., .F. ), )
   _HB_MEMBER { oTemporadas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTemporadas" }, .F., .F. ), )
   _HB_MEMBER { oParteProducionLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oParteProducionLinea" }, .F., .F. ), )
   _HB_MEMBER { oMaterialesProducion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMaterialesProducion" }, .F., .F. ), )
   _HB_MEMBER { oMaterialesProducionSeries} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMaterialesProducionSeries" }, .F., .F. ), )
   _HB_MEMBER { oMaterialesNumeroSeries} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMaterialesNumeroSeries" }, .F., .F. ), )
   _HB_MEMBER { oCaptura} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCaptura" }, .F., .F. ), )
   _HB_MEMBER { oTComandas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTComandas" }, .F., .F. ), )
   _HB_MEMBER { oBandera} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBandera" }, .F., .F. ), )
   _HB_MEMBER { oStock} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oStock" }, .F., .F. ), )
   _HB_MEMBER { oNewImp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oNewImp" }, .F., .F. ), )
   _HB_MEMBER { oVisor} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oVisor" }, .F., .F. ), )
   _HB_MEMBER { cVisor} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cVisor" }, .F., .F. ), )
   _HB_MEMBER { oImpresora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImpresora" }, .F., .F. ), )
   _HB_MEMBER { cImpresora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cImpresora" }, .F., .F. ), )
   _HB_MEMBER { oUndMedicion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oUndMedicion" }, .F., .F. ), )
   _HB_MEMBER { oRestaurante} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oRestaurante" }, .F., .F. ), )
   _HB_MEMBER { oBalanza} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBalanza" }, .F., .F. ), )
   _HB_MEMBER { cBalanza} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cBalanza" }, .F., .F. ), )
   _HB_MEMBER { oInvitacion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oInvitacion" }, .F., .F. ), )
   _HB_MEMBER { oFideliza} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFideliza" }, .F., .F. ), )
   _HB_MEMBER { oTipArt} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTipArt" }, .F., .F. ), )
   _HB_MEMBER { oFabricante} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFabricante" }, .F., .F. ), )

   _HB_MEMBER { oBrwFamilias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwFamilias" }, .F., .F. ), )
   _HB_MEMBER { oBrwLineas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwLineas" }, .F., .F. ), )

   _HB_MEMBER { oImgArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oImgArticulos" }, .F., .F. ), )
   _HB_MEMBER { oLstArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oLstArticulos" }, .F., .F. ), )

   _HB_MEMBER { lImagenArticulos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lImagenArticulos" }, .F., .F. ), )

   _HB_MEMBER { cResource} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cResource" }, .F., .F. ), )

   _HB_MEMBER { nImageViewWItem} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nImageViewWItem" }, .F., .F. ), )
   _HB_MEMBER { nImageViewHItem} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nImageViewHItem" }, .F., .F. ), )
   _HB_MEMBER { nImageViewVSep} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nImageViewVSep" }, .F., .F. ), )
   _HB_MEMBER { nImageViewHSep} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nImageViewHSep" }, .F., .F. ), )
   _HB_MEMBER { nImageViewTitle} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nImageViewTitle" }, .F., .F. ), )
   _HB_MEMBER { aImageViewTextMargin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aImageViewTextMargin" }, .F., .F. ), )

   _HB_MEMBER { oLstFavoritos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oLstFavoritos" }, .F., .F. ), )

   _HB_MEMBER { aFamilias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aFamilias" }, .F., .F. ), )
   _HB_MEMBER { aLineas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aLineas" }, .F., .F. ), )

   _HB_MEMBER { oBtnNum} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnNum" }, .F., .F. ), )
   _HB_MEMBER { oFntNum} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFntNum" }, .F., .F. ), )
   _HB_MEMBER { oFntEur} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFntEur" }, .F., .F. ), )
   _HB_MEMBER { oFntBrw} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFntBrw" }, .F., .F. ), )
   _HB_MEMBER { oFntDlg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFntDlg" }, .F., .F. ), )
   _HB_MEMBER { oFntDto} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFntDto" }, .F., .F. ), )

   _HB_MEMBER { oTurno} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTurno" }, .F., .F. ), )

   _HB_MEMBER { oBrwComentarios} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwComentarios" }, .F., .F. ), )
   _HB_MEMBER { oBrwLineasComentarios} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwLineasComentarios" }, .F., .F. ), )

   _HB_MEMBER { oGetUnidades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oGetUnidades" }, .F., .F. ), )
   _HB_MEMBER { cGetUnidades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cGetUnidades" }, .F., .F. ), )

   _HB_MEMBER { oProgressBar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oProgressBar" }, .F., .F. ), )
   _HB_MEMBER { nProgressBar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nProgressBar" }, .F., .F. ), )

   _HB_MEMBER { oBtnLineasTop} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLineasTop" }, .F., .F. ), )
   _HB_MEMBER { oBtnLineasBottom} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLineasBottom" }, .F., .F. ), )
   _HB_MEMBER { oBtnLineasDelete} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLineasDelete" }, .F., .F. ), )
   _HB_MEMBER { oBtnLineasComentarios} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLineasComentarios" }, .F., .F. ), )
   _HB_MEMBER { oBtnLineasEscandallos} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLineasEscandallos" }, .F., .F. ), )

   _HB_MEMBER { oOfficeBar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oOfficeBar" }, .F., .F. ), )

   _HB_MEMBER { cTemporalLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cTemporalLinea" }, .F., .F. ), )
   _HB_MEMBER { oTemporalLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTemporalLinea" }, .F., .F. ), )
   _HB_MEMBER { cTemporalComanda} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cTemporalComanda" }, .F., .F. ), )
   _HB_MEMBER { oTemporalComanda} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTemporalComanda" }, .F., .F. ), )
   _HB_MEMBER { cTemporalCobro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cTemporalCobro" }, .F., .F. ), )
   _HB_MEMBER { oTemporalCobro} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTemporalCobro" }, .F., .F. ), )

   _HB_MEMBER { oSayImporte} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSayImporte" }, .F., .F. ), )
   _HB_MEMBER { oSayPrecioPersona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSayPrecioPersona" }, .F., .F. ), )
   _HB_MEMBER { cSayPrecioPersona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cSayPrecioPersona" }, .F., .F. ), )
   _HB_MEMBER { oSayZona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSayZona" }, .F., .F. ), )
   _HB_MEMBER { cSayZona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cSayZona" }, .F., .F. ), )
   _HB_MEMBER { cSayInfo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cSayInfo" }, .F., .F. ), )
   _HB_MEMBER { oSayInfo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oSayInfo" }, .F., .F. ), )

   _HB_MEMBER { oTotalTicket} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalTicket" }, .F., .F. ), )
   _HB_MEMBER { oTotalPrecioPersona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTotalPrecioPersona" }, .F., .F. ), )
   _HB_MEMBER { nTotalTicket} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nTotalTicket" }, .F., .F. ), )
   _HB_MEMBER { nTotalPrecioPersona} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nTotalPrecioPersona" }, .F., .F. ), )

   _HB_MEMBER { cPictureImporte} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPictureImporte" }, .F., .F. ), )
   _HB_MEMBER { cPictureTotal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPictureTotal" }, .F., .F. ), )

   _HB_MEMBER { nDecimalesImporte} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nDecimalesImporte" }, .F., .F. ), )
   _HB_MEMBER { nDecimalesTotal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nDecimalesTotal" }, .F., .F. ), )

   _HB_MEMBER { cPictureUnidades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cPictureUnidades" }, .F., .F. ), )

   _HB_MEMBER { oFormatosImpresion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFormatosImpresion" }, .F., .F. ), )

   _HB_MEMBER { cGetDescripcion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cGetDescripcion" }, .F., .F. ), )
   _HB_MEMBER { nGetUnidades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nGetUnidades" }, .F., .F. ), )
   _HB_MEMBER { nGetImporte} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nGetImporte" }, .F., .F. ), )
   _HB_MEMBER { cGetImpresora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cGetImpresora" }, .F., .F. ), )

   _HB_MEMBER { oBtnUnaLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnUnaLinea" }, .F., .F. ), )
   _HB_MEMBER { oBtnTodasLineas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnTodasLineas" }, .F., .F. ), )

   _HB_MEMBER { oBtnArticulosPageUp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnArticulosPageUp" }, .F., .F. ), )
   _HB_MEMBER { oBtnArticulosPageDown} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnArticulosPageDown" }, .F., .F. ), )
   _HB_MEMBER { oBtnAgregarLibre} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnAgregarLibre" }, .F., .F. ), )
   _HB_MEMBER { oBtnCombinado} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCombinado" }, .F., .F. ), )
   _HB_MEMBER { oBtnCalculadora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCalculadora" }, .F., .F. ), )

   _HB_MEMBER { oCarpetaLineas} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCarpetaLineas" }, .F., .F. ), )
   _HB_MEMBER { oCarpetaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCarpetaInicio" }, .F., .F. ), )

   _HB_MEMBER { oGrpSalones} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oGrpSalones" }, .F., .F. ), )

   _HB_MEMBER { oBtnSala} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnSala" }, .F., .F. ), )
   _HB_MEMBER { oBtnGeneral} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnGeneral" }, .F., .F. ), )
   _HB_MEMBER { oBtnLlevar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnLlevar" }, .F., .F. ), )
   _HB_MEMBER { oBtnRecoger} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnRecoger" }, .F., .F. ), )
   _HB_MEMBER { oBtnEncargar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnEncargar" }, .F., .F. ), )

   _HB_MEMBER { oBtnUsuario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnUsuario" }, .F., .F. ), )
   _HB_MEMBER { lGetUsuario} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lGetUsuario" }, .F., .F. ), )

   _HB_MEMBER { oBtnRenombrar} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnRenombrar" }, .F., .F. ), )

   _HB_MEMBER { oBtnCliente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCliente" }, .F., .F. ), )
   _HB_MEMBER { oBtnDireccion} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnDireccion" }, .F., .F. ), )
   _HB_MEMBER { oBtnTelefono} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnTelefono" }, .F., .F. ), )

   _HB_MEMBER { sTotal} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "sTotal" }, .F., .F. ), )

   _HB_MEMBER { lGuardaNuevoTiket} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lGuardaNuevoTiket" }, .F., .F. ), )

   _HB_MEMBER { oTpvCobros} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTpvCobros" }, .F., .F. ), )
   _HB_MEMBER { oTpvListaTicket} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oTpvListaTicket" }, .F., .F. ), )

   _HB_MEMBER { oFastReport} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFastReport" }, .F., .F. ), )

   _HB_MEMBER { cFormato} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFormato" }, .F., .F. ), )
   _HB_MEMBER { cImpresora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cImpresora" }, .F., .F. ), )
   _HB_MEMBER { nDispositivo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nDispositivo" }, .F., .F. ), )
   _HB_MEMBER { nCopias} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nCopias" }, .F., .F. ), )
   _HB_MEMBER { lComanda} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lComanda" }, .F., .F. ), )

   _HB_MEMBER { lCombinando} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lCombinando" }, .F., .F. ), )
   _HB_MEMBER { cCodigoFamilia} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cCodigoFamilia" }, .F., .F. ), )

   _HB_MEMBER { nTarifaSolo} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nTarifaSolo" }, .F., .F. ), )
   _HB_MEMBER { nTarifaCombinado} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nTarifaCombinado" }, .F., .F. ), )

   _HB_MEMBER { lKillResource} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lKillResource" }, .F., .F. ), )

   _HB_MEMBER { lHideCalculadora} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "lHideCalculadora" }, .F., .F. ), )

   _HB_MEMBER { oBtnFamiliasTop} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnFamiliasTop" }, .F., .F. ), )
   _HB_MEMBER { oBtnFamiliasUp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnFamiliasUp" }, .F., .F. ), )
   _HB_MEMBER { oBtnFamiliasDown} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnFamiliasDown" }, .F., .F. ), )
   _HB_MEMBER { oBtnFamiliasEnd} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnFamiliasEnd" }, .F., .F. ), )

   _HB_MEMBER { oHorizontalSplitterTop} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oHorizontalSplitterTop" }, .F., .F. ), )
   _HB_MEMBER { oVerticalSplitterRight} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oVerticalSplitterRight" }, .F., .F. ), )
   _HB_MEMBER { oVerticalSplitterCenter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oVerticalSplitterCenter" }, .F., .F. ), )

   _HB_MEMBER { nDialogWidth} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nDialogWidth" }, .F., .F. ), )
   _HB_MEMBER { nDialogHeight} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nDialogHeight" }, .F., .F. ), )

   _HB_MEMBER { nNumeroLinea} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nNumeroLinea" }, .F., .F. ), )

   _HB_MEMBER New( oMenuItem, oWnd) AS CLASS TpvTactil; IIF( .F., s_oClass:ModMethod( "New", @TpvTactil_New(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "New", @TpvTactil_New(), nScope + IIF( .T., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Activate( lAlone); IIF( .F., s_oClass:ModMethod( "Activate", @TpvTactil_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Activate", @TpvTactil_Activate(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER End(); IIF( .F., s_oClass:ModMethod( "End", @TpvTactil_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "End", @TpvTactil_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OpenFiles(); IIF( .F., s_oClass:ModMethod( "OpenFiles", @TpvTactil_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OpenFiles", @TpvTactil_OpenFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CloseFiles(); IIF( .F., s_oClass:ModMethod( "CloseFiles", @TpvTactil_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CloseFiles", @TpvTactil_CloseFiles(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER Resource(); IIF( .F., s_oClass:ModMethod( "Resource", @TpvTactil_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Resource", @TpvTactil_Resource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ResizedResource(); IIF( .F., s_oClass:ModMethod( "ResizedResource", @TpvTactil_ResizedResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ResizedResource", @TpvTactil_ResizedResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER StartResource(); IIF( .F., s_oClass:ModMethod( "StartResource", @TpvTactil_StartResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "StartResource", @TpvTactil_StartResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EndResource(); IIF( .F., s_oClass:ModMethod( "EndResource", @TpvTactil_EndResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EndResource", @TpvTactil_EndResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER PaintResource(); IIF( .F., s_oClass:ModMethod( "PaintResource", @TpvTactil_PaintResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PaintResource", @TpvTactil_PaintResource(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaBrowseFamilias(); IIF( .F., s_oClass:ModMethod( "CargaBrowseFamilias", @TpvTactil_CargaBrowseFamilias(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaBrowseFamilias", @TpvTactil_CargaBrowseFamilias(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaArticulosFamilia( cCodFam); IIF( .F., s_oClass:ModMethod( "CargaArticulosFamilia", @TpvTactil_CargaArticulosFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaArticulosFamilia", @TpvTactil_CargaArticulosFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ChangeFamilias(); IIF( .F., s_oClass:ModMethod( "ChangeFamilias", @TpvTactil_ChangeFamilias(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ChangeFamilias", @TpvTactil_ChangeFamilias(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SetFamilia(); IIF( .F., s_oClass:ModMethod( "SetFamilia", @TpvTactil_SetFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetFamilia", @TpvTactil_SetFamilia(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER KeyChar( cKey); IIF( .F., s_oClass:ModMethod( "KeyChar", @TpvTactil_KeyChar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "KeyChar", @TpvTactil_KeyChar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER oDlgKeyDown( o, nKey, nFlag); IIF( .F., s_oClass:ModMethod( "oDlgKeyDown", @TpvTactil_oDlgKeyDown(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "oDlgKeyDown", @TpvTactil_oDlgKeyDown(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CreateTemporal(); IIF( .F., s_oClass:ModMethod( "CreateTemporal", @TpvTactil_CreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CreateTemporal", @TpvTactil_CreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DestroyTemporal(); IIF( .F., s_oClass:ModMethod( "DestroyTemporal", @TpvTactil_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DestroyTemporal", @TpvTactil_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaValoresDefecto( nUbicacion); IIF( .F., s_oClass:ModMethod( "CargaValoresDefecto", @TpvTactil_CargaValoresDefecto(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaValoresDefecto", @TpvTactil_CargaValoresDefecto(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaContador(); IIF( .F., s_oClass:ModMethod( "CargaContador", @TpvTactil_CargaContador(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaContador", @TpvTactil_CargaContador(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER CargaArticulos(); IIF( .F., s_oClass:ModMethod( "CargaArticulos", @TpvTactil_CargaArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaArticulos", @TpvTactil_CargaArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SeleccionaArticulos(); IIF( .F., s_oClass:ModMethod( "SeleccionaArticulos", @TpvTactil_SeleccionaArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SeleccionaArticulos", @TpvTactil_SeleccionaArticulos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SeleccionaFavoritos(); IIF( .F., s_oClass:ModMethod( "SeleccionaFavoritos", @TpvTactil_SeleccionaFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SeleccionaFavoritos", @TpvTactil_SeleccionaFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cFileBmpName( cFile, lEmptyImage); IIF( .F., s_oClass:ModMethod( "cFileBmpName", @TpvTactil_cFileBmpName(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "cFileBmpName", @TpvTactil_cFileBmpName(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lFileBmpName(cFile); IIF( .F., s_oClass:ModInline( "lFileBmpName", {|Self,cFile | Self, ( File( ::cFileBmpName( cFile ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lFileBmpName", {|Self,cFile | Self, ( File( ::cFileBmpName( cFile ) ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER CargaFavoritos(); IIF( .F., s_oClass:ModMethod( "CargaFavoritos", @TpvTactil_CargaFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaFavoritos", @TpvTactil_CargaFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AgregarLineas(); IIF( .F., s_oClass:ModMethod( "AgregarLineas", @TpvTactil_AgregarLineas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarLineas", @TpvTactil_AgregarLineas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lAcumulaArticulo(); IIF( .F., s_oClass:ModMethod( "lAcumulaArticulo", @TpvTactil_lAcumulaArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lAcumulaArticulo", @TpvTactil_lAcumulaArticulo(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AgregarKit(); IIF( .F., s_oClass:ModMethod( "AgregarKit", @TpvTactil_AgregarKit(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarKit", @TpvTactil_AgregarKit(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER MultiplicarLineas( nUnidades); IIF( .F., s_oClass:ModMethod( "MultiplicarLineas", @TpvTactil_MultiplicarLineas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "MultiplicarLineas", @TpvTactil_MultiplicarLineas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AgregarPLU(); IIF( .F., s_oClass:ModMethod( "AgregarPLU", @TpvTactil_AgregarPLU(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarPLU", @TpvTactil_AgregarPLU(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self|;

      if ( ::oTemporalLinea:ordKeyCount() <> 0 ) .AND. ( Val( ::cGetUnidades ) <> 0 )

         if ApoloMsgNoYes( "¿Desea cambiar el precio del artículo seleccionado?", "Confirme", .T. )

            ::oTemporalLinea:nPvpTil   := Val( ::cGetUnidades )

            ::oGetUnidades:cText( "" )

            ::oBrwLineas:Refresh()

         end

      end

      RETURN ( Self )

   >; _HB_MEMBER CambiarPrecio(); IIF( .F., s_oClass:ModInline( "CambiarPrecio", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "CambiarPrecio", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER AgregarLibre(); IIF( .F., s_oClass:ModMethod( "AgregarLibre", @TpvTactil_AgregarLibre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarLibre", @TpvTactil_AgregarLibre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER AgregarLineasLibres(); IIF( .F., s_oClass:ModMethod( "AgregarLineasLibres", @TpvTactil_AgregarLineasLibres(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarLineasLibres", @TpvTactil_AgregarLineasLibres(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ValidarAgregarLibre( oGetDescripcion, oDlg); IIF( .F., s_oClass:ModMethod( "ValidarAgregarLibre", @TpvTactil_ValidarAgregarLibre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ValidarAgregarLibre", @TpvTactil_ValidarAgregarLibre(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AgregarFavoritos( cNombreArticulo); IIF( .F., s_oClass:ModMethod( "AgregarFavoritos", @TpvTactil_AgregarFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AgregarFavoritos", @TpvTactil_AgregarFavoritos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SeleccionarDefecto( cDefCom, oBrwLineasComentarios, oBrwComentarios); IIF( .F., s_oClass:ModMethod( "SeleccionarDefecto", @TpvTactil_SeleccionarDefecto(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SeleccionarDefecto", @TpvTactil_SeleccionarDefecto(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER cNumeroTicket(); IIF( .F., s_oClass:ModInline( "cNumeroTicket", {|Self | Self, ( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cNumeroTicket", {|Self | Self, ( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER lEmptyNumeroTicket(); IIF( .F., s_oClass:ModInline( "lEmptyNumeroTicket", {|Self | Self, Empty( ::oTiketCabecera:cNumTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lEmptyNumeroTicket", {|Self | Self, Empty( ::oTiketCabecera:cNumTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER EditFamilia(); IIF( .F., s_oClass:ModInline( "EditFamilia", {|Self | Self, ( if( EdtFamilia( ::aFamilias[ ::oBrwFamilias:nArrayAt, 2 ] ), ( ::CargaBrowseFamilias(), ::ChangeFamilias(), ::oBrwFamilias:Refresh() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "EditFamilia", {|Self | Self, ( if( EdtFamilia( ::aFamilias[ ::oBrwFamilias:nArrayAt, 2 ] ), ( ::CargaBrowseFamilias(), ::ChangeFamilias(), ::oBrwFamilias:Refresh() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )



   WITH OBJECT <|Self, nRow, nCol|;

      local nOpt

      if !Empty( ::oLstArticulos )

         ::oLstArticulos:nOption       := ::oLstArticulos:GetOption( nRow, nCol )
         ::oLstArticulos:Refresh()

         nOpt                          := ::oLstArticulos:nOption

         if Empty( nOpt )
            RETURN ( .F. )
         end

         if !Empty( ::oLstArticulos:oVScroll )
            ::oLstArticulos:oVScroll:SetPos( ::oLstArticulos:nCurLine() )
         end

         nOpt                          := Max( Min( nOpt, len( ::oLstArticulos:aItems ) ), 1 )

         if nOpt > 0 .AND. nOpt <= len( ::oLstArticulos:aItems )

            if EdtArticulo( ::oLstArticulos:aItems[ nOpt ]:Cargo )

               ::CargaBrowseFamilias()

               ::ChangeFamilias()

            end

         end

      end

      RETURN ( .T. )

   >; _HB_MEMBER EditArticulo(); IIF( .F., s_oClass:ModInline( "EditArticulo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "EditArticulo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER OnClickInvitacion(); IIF( .F., s_oClass:ModMethod( "OnClickInvitacion", @TpvTactil_OnClickInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickInvitacion", @TpvTactil_OnClickInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EndInvitacion( nOpt, oLstInv, oDlg); IIF( .F., s_oClass:ModMethod( "EndInvitacion", @TpvTactil_EndInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EndInvitacion", @TpvTactil_EndInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER InitInvitacion( oDlg, oImgInv, oLstInv); IIF( .F., s_oClass:ModMethod( "InitInvitacion", @TpvTactil_InitInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "InitInvitacion", @TpvTactil_InitInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnClickDescuento(); IIF( .F., s_oClass:ModMethod( "OnClickDescuento", @TpvTactil_OnClickDescuento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickDescuento", @TpvTactil_OnClickDescuento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelectUnaLineaInvitacion(); IIF( .F., s_oClass:ModMethod( "SelectUnaLineaInvitacion", @TpvTactil_SelectUnaLineaInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectUnaLineaInvitacion", @TpvTactil_SelectUnaLineaInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SelectTodasLineasInvitacion(); IIF( .F., s_oClass:ModMethod( "SelectTodasLineasInvitacion", @TpvTactil_SelectTodasLineasInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectTodasLineasInvitacion", @TpvTactil_SelectTodasLineasInvitacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelecionaCliente(); IIF( .F., s_oClass:ModMethod( "SelecionaCliente", @TpvTactil_SelecionaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelecionaCliente", @TpvTactil_SelecionaCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SetCliente(); IIF( .F., s_oClass:ModMethod( "SetCliente", @TpvTactil_SetCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetCliente", @TpvTactil_SetCliente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER SetUbicacion(); IIF( .F., s_oClass:ModInline( "SetUbicacion", {|Self | Self, ( if( !Empty( ::oSayZona ), ::oSayZona:SetText( ::cUbicacion() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetUbicacion", {|Self | Self, ( if( !Empty( ::oSayZona ), ::oSayZona:SetText( ::cUbicacion() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER SetInfo(); IIF( .F., s_oClass:ModInline( "SetInfo", {|Self | Self, ( if( !Empty( ::oSayInfo ), ::oSayInfo:SetText( ::cInfo() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetInfo", {|Self | Self, ( if( !Empty( ::oSayInfo ), ::oSayInfo:SetText( ::cInfo() ), ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER SetOptionGeneral( ); IIF( !.F., s_oClass:AddVirtual( "SetOptionGeneral" ), )
   _HB_MEMBER SetOptionLineas( ); IIF( !.F., s_oClass:AddVirtual( "SetOptionLineas" ), )

   _HB_MEMBER nNuevoNumeroTicket(); IIF( .F., s_oClass:ModInline( "nNuevoNumeroTicket", {|Self | Self, ( Str( nNewDoc( ::oTiketCabecera:cSerTik, ::oTiketCabecera:cAlias, "nTikCli", 10, ::oContadores:cAlias ), 10 ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nNuevoNumeroTicket", {|Self | Self, ( Str( nNewDoc( ::oTiketCabecera:cSerTik, ::oTiketCabecera:cAlias, "nTikCli", 10, ::oContadores:cAlias ), 10 ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )





   _HB_MEMBER OnClickCobro(); IIF( .F., s_oClass:ModMethod( "OnClickCobro", @TpvTactil_OnClickCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickCobro", @TpvTactil_OnClickCobro(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickSalaVenta(); IIF( .F., s_oClass:ModMethod( "OnClickSalaVenta", @TpvTactil_OnClickSalaVenta(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickSalaVenta", @TpvTactil_OnClickSalaVenta(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickCambiaUbicacion(); IIF( .F., s_oClass:ModMethod( "OnClickCambiaUbicacion", @TpvTactil_OnClickCambiaUbicacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickCambiaUbicacion", @TpvTactil_OnClickCambiaUbicacion(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickGeneral(); IIF( .F., s_oClass:ModMethod( "OnClickGeneral", @TpvTactil_OnClickGeneral(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickGeneral", @TpvTactil_OnClickGeneral(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickParaLlevar(); IIF( .F., s_oClass:ModMethod( "OnClickParaLlevar", @TpvTactil_OnClickParaLlevar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickParaLlevar", @TpvTactil_OnClickParaLlevar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickParaRecoger(); IIF( .F., s_oClass:ModMethod( "OnClickParaRecoger", @TpvTactil_OnClickParaRecoger(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickParaRecoger", @TpvTactil_OnClickParaRecoger(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickEncargar(); IIF( .F., s_oClass:ModMethod( "OnClickEncargar", @TpvTactil_OnClickEncargar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickEncargar", @TpvTactil_OnClickEncargar(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnClickEntrega(); IIF( .F., s_oClass:ModMethod( "OnClickEntrega", @TpvTactil_OnClickEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickEntrega", @TpvTactil_OnClickEntrega(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnClickLista( nOption); IIF( .F., s_oClass:ModMethod( "OnClickLista", @TpvTactil_OnClickLista(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickLista", @TpvTactil_OnClickLista(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER OnClickPendientes(); IIF( .F., s_oClass:ModMethod( "OnClickPendientes", @TpvTactil_OnClickPendientes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickPendientes", @TpvTactil_OnClickPendientes(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnClickUsuarios(); IIF( .F., s_oClass:ModMethod( "OnClickUsuarios", @TpvTactil_OnClickUsuarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickUsuarios", @TpvTactil_OnClickUsuarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnclickEntrdaSalida(); IIF( .F., s_oClass:ModInline( "OnclickEntrdaSalida", {|Self | Self, ( AppEntSal() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "OnclickEntrdaSalida", {|Self | Self, ( AppEntSal() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER OnClickSeleccionarCajas(); IIF( .F., s_oClass:ModInline( "OnClickSeleccionarCajas", {|Self | Self, ( SelCajTactil() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "OnClickSeleccionarCajas", {|Self | Self, ( SelCajTactil() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )





   WITH OBJECT <|Self|;

      if BrwBigUser()

         ::oBtnUsuario:cBmp( if( oUser():lAdministrador(), "Security_Agent_32", "Dude4_32" ) )

         ::oBtnUsuario:cCaption( Capitalize( oUser():cNombre() ) )

      else

         RETURN ( .F. )

      end

      RETURN ( .T. )

   >; _HB_MEMBER ShowUsuario(); IIF( .F., s_oClass:ModInline( "ShowUsuario", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "ShowUsuario", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, lForced|;

      IIF( lForced == nil, lForced := .F., ) ;

      if ( lForced ) .OR. ( ::lGetUsuario .AND. lRecogerUsuario() )

         if !::ShowUsuario()

            ::KillResource()

            RETURN ( .F. )

         else

            ::lGetUsuario              := .F.

         end

      end

      RETURN ( .T. )

   >; _HB_MEMBER GetUsuario(); IIF( .F., s_oClass:ModInline( "GetUsuario", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GetUsuario", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      if ( uFieldEmpresa( "lShowSala" ) )

         ::OnClickSalaVenta()

      end

      RETURN ( Self )

   >; _HB_MEMBER GetUbicacion(); IIF( .F., s_oClass:ModInline( "GetUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GetUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER OnClickCopiaComanda(); IIF( .F., s_oClass:ModMethod( "OnClickCopiaComanda", @TpvTactil_OnClickCopiaComanda(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickCopiaComanda", @TpvTactil_OnClickCopiaComanda(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER OnClickCloseTurno( lParcial); IIF( .F., s_oClass:ModMethod( "OnClickCloseTurno", @TpvTactil_OnClickCloseTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "OnClickCloseTurno", @TpvTactil_OnClickCloseTurno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self|;

      if ::oTurno:OpenFiles()
         ::oTurno:lNowOpen( oWnd() )
         ::oTurno:CloseFiles()
      end

      RETURN ( Self )

   >; _HB_MEMBER OnClickIniciarSesion(); IIF( .F., s_oClass:ModInline( "OnClickIniciarSesion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "OnClickIniciarSesion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      ::oTiketCabecera:nNumCom         := nVirtualNumKey( "Users1_32", "Número comensales", ::oTiketCabecera:nNumCom )

      ::TotalTemporal()

      RETURN ( .T. )

   >; _HB_MEMBER OnClickComensales(); IIF( .F., s_oClass:ModInline( "OnClickComensales", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "OnClickComensales", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END







   _HB_MEMBER InitComentarios( cDefCom); IIF( .F., s_oClass:ModMethod( "InitComentarios", @TpvTactil_InitComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "InitComentarios", @TpvTactil_InitComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER EndComentarios( oDlg, oGetComentario); IIF( .F., s_oClass:ModMethod( "EndComentarios", @TpvTactil_EndComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EndComentarios", @TpvTactil_EndComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ChangeComentarios( oBrwLineasComentarios); IIF( .F., s_oClass:ModMethod( "ChangeComentarios", @TpvTactil_ChangeComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ChangeComentarios", @TpvTactil_ChangeComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER ChangeLineasComentarios( oGetComentario, cComentariosL); IIF( .F., s_oClass:ModMethod( "ChangeLineasComentarios", @TpvTactil_ChangeLineasComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ChangeLineasComentarios", @TpvTactil_ChangeLineasComentarios(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self|;

      if !::lEditableDocumento()
         MsgStop( "El documento ya está cerrado" )
         Return ( .T. )
      end

      if ApoloMsgNoYes( "¿Desea eliminar el registro en curso?", "Confirme supresión", .T. )

         ::oTemporalLinea:Delete()

         ::oBrwLineas:Refresh()

      end

      ::TotalTemporal()

      Return ( .T. )

   >; _HB_MEMBER EliminarLinea(); IIF( .F., s_oClass:ModInline( "EliminarLinea", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "EliminarLinea", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END







   _HB_MEMBER lLineaValida( lExcluirContadores); IIF( .F., s_oClass:ModMethod( "lLineaValida", @TpvTactil_lLineaValida(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lLineaValida", @TpvTactil_lLineaValida(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nUnidadesLinea( uTmpL, lPicture); IIF( .F., s_oClass:ModMethod( "nUnidadesLinea", @TpvTactil_nUnidadesLinea(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nUnidadesLinea", @TpvTactil_nUnidadesLinea(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER nUnidadesImpresas( uTmpL, lPicture); IIF( .F., s_oClass:ModMethod( "nUnidadesImpresas", @TpvTactil_nUnidadesImpresas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nUnidadesImpresas", @TpvTactil_nUnidadesImpresas(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nPrecioLinea(); IIF( .F., s_oClass:ModInline( "nPrecioLinea", {|Self | Self, ( Round( ::oTiketLinea:nPvpTil, ::nDecimalesImporte ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nPrecioLinea", {|Self | Self, ( Round( ::oTiketLinea:nPvpTil, ::nDecimalesImporte ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER nTotalLinea( uTmpL, lPic); IIF( .F., s_oClass:ModMethod( "nTotalLinea", @TpvTactil_nTotalLinea(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalLinea", @TpvTactil_nTotalLinea(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER nTotalLineaUno( uTmpL, nVdv); IIF( .F., s_oClass:ModMethod( "nTotalLineaUno", @TpvTactil_nTotalLineaUno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalLineaUno", @TpvTactil_nTotalLineaUno(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER nTotalLineaDos( uTmpL, nVdv); IIF( .F., s_oClass:ModMethod( "nTotalLineaDos", @TpvTactil_nTotalLineaDos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalLineaDos", @TpvTactil_nTotalLineaDos(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalImpuestosEspeciales( uTmpL, nVdv); IIF( .F., s_oClass:ModMethod( "nTotalImpuestosEspeciales", @TpvTactil_nTotalImpuestosEspeciales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalImpuestosEspeciales", @TpvTactil_nTotalImpuestosEspeciales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nTotalCobrosTemporales(); IIF( .F., s_oClass:ModMethod( "nTotalCobrosTemporales", @TpvTactil_nTotalCobrosTemporales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "nTotalCobrosTemporales", @TpvTactil_nTotalCobrosTemporales(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER sTotalCobros( cNumero); IIF( .F., s_oClass:ModMethod( "sTotalCobros", @TpvTactil_sTotalCobros(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "sTotalCobros", @TpvTactil_sTotalCobros(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER sTotalTiket(); IIF( .F., s_oClass:ModMethod( "sTotalTiket", @TpvTactil_sTotalTiket(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "sTotalTiket", @TpvTactil_sTotalTiket(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nUnidadesLineaComanda(); IIF( .F., s_oClass:ModInline( "nUnidadesLineaComanda", {|Self | Self, ( ::nUnidadesLinea( ::oTemporalComanda ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nUnidadesLineaComanda", {|Self | Self, ( ::nUnidadesLinea( ::oTemporalComanda ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER nUnidadesImpresasComanda(); IIF( .F., s_oClass:ModInline( "nUnidadesImpresasComanda", {|Self | Self, ( if( !Empty( ::oTemporalComanda ), ( ::oTemporalComanda:nImpCom ), 0 ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nUnidadesImpresasComanda", {|Self | Self, ( if( !Empty( ::oTemporalComanda ), ( ::oTemporalComanda:nImpCom ), 0 ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER cDescripcionComanda( uTmpL); IIF( .F., s_oClass:ModMethod( "cDescripcionComanda", @TpvTactil_cDescripcionComanda(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "cDescripcionComanda", @TpvTactil_cDescripcionComanda(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   _HB_MEMBER lEmptyDocumento(); IIF( .F., s_oClass:ModInline( "lEmptyDocumento", {|Self | Self, ( Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lEmptyDocumento", {|Self | Self, ( Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER lEditableDocumento(); IIF( .F., s_oClass:ModInline( "lEditableDocumento", {|Self | Self, ( !::oTiketCabecera:lCloTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lEditableDocumento", {|Self | Self, ( !::oTiketCabecera:lCloTik ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )
   _HB_MEMBER lEmptyLineas(); IIF( .F., s_oClass:ModInline( "lEmptyLineas", {|Self | Self, ( !Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lEmptyLineas", {|Self | Self, ( !Empty( ::oTiketCabecera:cNumTik ) .AND. Empty( ::oTemporalLinea:OrdKeyCount() ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   WITH OBJECT <|Self|;

      if !Empty( ::oTiketCabecera:cNumTik )
         Return ( .F. )
      end

      if ( ::oTiketCabecera:nUbiTik == 0 .OR. ::oTiketCabecera:nUbiTik == 3 ) .AND. Empty( ::oTiketCabecera:cPntVenta ) .AND. Empty( ::oTiketCabecera:cAliasTik ) .AND. !Empty( ::oTemporalLinea:OrdKeyCount() )
         Return ( .T. )
      end

      RETURN ( .F. )

   >; _HB_MEMBER lEmptyAlias(); IIF( .F., s_oClass:ModInline( "lEmptyAlias", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lEmptyAlias", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END






   _HB_MEMBER GuardaDocumento(); IIF( .F., s_oClass:ModMethod( "GuardaDocumento", @TpvTactil_GuardaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GuardaDocumento", @TpvTactil_GuardaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self, nSave|;

      IIF( nSave == nil, nSave := "1", ) ;

      ::oTiketCabecera:cTipTik      := nSave
      ::oTiketCabecera:lPgdTik      := .F.

      ::GuardaDocumento( nil, nSave )

      RETURN ( .T. )

   >; _HB_MEMBER GuardaDocumentoPendiente(); IIF( .F., s_oClass:ModInline( "GuardaDocumentoPendiente", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GuardaDocumentoPendiente", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      do case
         case ::oTpvCobros:nEstado == 1
            ::oTiketCabecera:lPgdTik   := .F.
            ::oTiketCabecera:lAbierto  := .T.

         case ::oTpvCobros:nEstado == 2
            ::oTiketCabecera:lPgdTik   := .T.
            ::oTiketCabecera:lAbierto  := .F.

      end

      ::GuardaDocumento()

      RETURN ( Self )

   >; _HB_MEMBER GuardaDocumentoPagado(); IIF( .F., s_oClass:ModInline( "GuardaDocumentoPagado", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GuardaDocumentoPagado", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER CargaDocumento(); IIF( .F., s_oClass:ModMethod( "CargaDocumento", @TpvTactil_CargaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "CargaDocumento", @TpvTactil_CargaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EliminaDocumento(); IIF( .F., s_oClass:ModMethod( "EliminaDocumento", @TpvTactil_EliminaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EliminaDocumento", @TpvTactil_EliminaDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER GetTotalDocumento(uValue); IIF( .F., s_oClass:ModInline( "GetTotalDocumento", {|Self,uValue | Self, ( oSend( ::sTotal, uValue ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "GetTotalDocumento", {|Self,uValue | Self, ( oSend( ::sTotal, uValue ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER ImprimeDocumento(); IIF( .F., s_oClass:ModMethod( "ImprimeDocumento", @TpvTactil_ImprimeDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ImprimeDocumento", @TpvTactil_ImprimeDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self, cImpresora|;

      ::cFormato        := cFormatoComandaEnCaja( oUser():cCaja(), cImpresora, ::oCajaCabecera:cAlias, ::oCajaLinea:cAlias )
      ::cImpresora      := AllTrim( cNombreImpresoraComanda( oUser():cCaja(), cImpresora, ::oCajaLinea:cAlias ) )
      ::nDispositivo    := 1
      ::nCopias         := 1
      ::lComanda        := .T.

      ::ImprimeDocumento()

      RETURN ( Self )

   >; _HB_MEMBER ImprimeComanda(); IIF( .F., s_oClass:ModInline( "ImprimeComanda", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "ImprimeComanda", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      ::cFormato        := ::oFormatosImpresion:cFormatoTiket
      ::cImpresora      := ::oFormatosImpresion:cPrinterTik
      ::nDispositivo    := 1
      ::nCopias         := 1
      ::lComanda        := .F.

      ::ImprimeDocumento()

      RETURN ( Self )

   >; _HB_MEMBER ImprimeTicket(); IIF( .F., s_oClass:ModInline( "ImprimeTicket", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "ImprimeTicket", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      ::cFormato        := ::oFormatosImpresion:cFormatoEntrega
      ::cImpresora      := ::oFormatosImpresion:cPrinterEntrega
      ::nDispositivo    := 1
      ::nCopias         := 1
      ::lComanda        := .F.

      ::ImprimeDocumento()

      RETURN ( Self )

   >; _HB_MEMBER ImprimeEntrega(); IIF( .F., s_oClass:ModInline( "ImprimeEntrega", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "ImprimeEntrega", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      ::cFormato        := ::oFormatosImpresion:cFormatoRegalo
      ::cImpresora      := ::oFormatosImpresion:cPrinterRegalo
      ::nDispositivo    := 1
      ::nCopias         := 1
      ::lComanda        := .F.

      ::ImprimeDocumento()

      RETURN ( Self )

   >; _HB_MEMBER ImprimeRegalo(); IIF( .F., s_oClass:ModInline( "ImprimeRegalo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "ImprimeRegalo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, cImpresora|;

      local cWav        := AllTrim( cWavImpresoraComanda( oUser():cCaja(), cImpresora, ::oCajaLinea:cAlias ) )

      if !Empty( cWav ) .AND. File( cWav )
         SndPlaySound( cWav )
      end

      RETURN ( Self )

   >; _HB_MEMBER SonidoComanda(); IIF( .F., s_oClass:ModInline( "SonidoComanda", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SonidoComanda", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER SetAliasDocumento(); IIF( .F., s_oClass:ModMethod( "SetAliasDocumento", @TpvTactil_SetAliasDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetAliasDocumento", @TpvTactil_SetAliasDocumento(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BuildReport( nDevice, nCopies, cPrinter, lComanda, lAnulacion); IIF( .F., s_oClass:ModMethod( "BuildReport", @TpvTactil_BuildReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BuildReport", @TpvTactil_BuildReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER DataReport(); IIF( .F., s_oClass:ModMethod( "DataReport", @TpvTactil_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DataReport", @TpvTactil_DataReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER VariableReport(); IIF( .F., s_oClass:ModMethod( "VariableReport", @TpvTactil_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "VariableReport", @TpvTactil_VariableReport(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER nPrecioPorPersona(); IIF( .F., s_oClass:ModInline( "nPrecioPorPersona", {|Self | Self, ( ::sTotal:nTotalDocumento / NotCero( ::oTiketCabecera:nNumCom ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "nPrecioPorPersona", {|Self | Self, ( ::sTotal:nTotalDocumento / NotCero( ::oTiketCabecera:nNumCom ) ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )



   WITH OBJECT <|Self, nUbicacion|;





      CursorWait()

      ::oTiketCabecera:Blank()
      ::oTiketCabecera:SetDefault()





      ::CargaValoresDefecto( nUbicacion, .T. )

      CursorWE()

      RETURN ( Self )

   >; _HB_MEMBER InitDocumento(); IIF( .F., s_oClass:ModInline( "InitDocumento", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "InitDocumento", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      if !Empty( ::oSayImporte )
         ::oSayImporte:SetText( "Último cambio" )
      end

      if !Empty( ::oTotalTicket )
         ::oTotalTicket:SetText( ::oTpvCobros:sTotalesCobros:nCambio )
      end

      RETURN ( Self )

   >; _HB_MEMBER UltimoCambio(); IIF( .F., s_oClass:ModInline( "UltimoCambio", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "UltimoCambio", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      ::sTotal    := ::sTotalTiket()

      if !Empty( ::oSayImporte )
         ::oSayImporte:SetText( "Total" )
      end

      if !Empty( ::oTotalTicket )
         ::oTotalTicket:SetText( ::sTotal:nTotalDocumento )
      end

      if !Empty( ::oSayPrecioPersona )
         if !Empty( ::oTiketCabecera:nNumCom )
            ::oSayPrecioPersona:SetText( Alltrim( Trans( ::oTiketCabecera:nNumCom, "999" ) ) + " pax. x " + Alltrim( Trans( ::sTotal:nTotalPersona, ::cPictureTotal ) ) )
         else
            ::oSayPrecioPersona:SetText( "" )
         end
      end

      RETURN ( Self )

   >; _HB_MEMBER TotalTemporal(); IIF( .F., s_oClass:ModInline( "TotalTemporal", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "TotalTemporal", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cUbicacion  := ""

      if Empty( ::oTiketCabecera )
         Return ( cUbicacion )
      end

      do case
         case ::oTiketCabecera:nUbiTik == 2

            cUbicacion  := ::oRestaurante:cTextoSala( ::oTiketCabecera:cCodSala ) + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cPntVenta )

         case ::oTiketCabecera:nUbiTik == 0

            cUbicacion  := "General " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cAliasTik )

         case ::oTiketCabecera:nUbiTik == 3

            cUbicacion  := "Para recoger " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cAliasTik )

         case ::oTiketCabecera:nUbiTik == 1

            cUbicacion  := "Para llevar " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cNomTik )

         case ::oTiketCabecera:nUbiTik == 4

            cUbicacion  := "Encargo " + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cNomTik )

      end

      RETURN ( cUbicacion )

   >; _HB_MEMBER cTxtUbicacion(); IIF( .F., s_oClass:ModInline( "cTxtUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTxtUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cUbicacion  := ::cTxtUbicacion()

      if !Empty( ::oGrpSalones )
         aSend( ::oGrpSalones:aItems, "UnSelected" )
      end

      do case
         case ::oTiketCabecera:nUbiTik == 2

            if !Empty( ::oBtnSala )
               ::oBtnSala:Selected()
            end

            if !Empty( ::oBtnGeneral )
               ::oBtnGeneral:UnSelected()
            end

            if !Empty( ::oBtnLlevar )
               ::oBtnLlevar:UnSelected()
            end

            if !Empty( ::oBtnRecoger )
               ::oBtnRecoger:UnSelected()
            end

            if !Empty( ::oBtnEncargar )
               ::oBtnEncargar:UnSelected()
            end

         case ::oTiketCabecera:nUbiTik == 0

            if !Empty( ::oBtnSala )
               ::oBtnSala:UnSelected()
            end

            if !Empty( ::oBtnGeneral )
               ::oBtnGeneral:Selected()
            end

            if !Empty( ::oBtnLlevar )
               ::oBtnLlevar:UnSelected()
            end

            if !Empty( ::oBtnRecoger )
               ::oBtnRecoger:UnSelected()
            end

            if !Empty( ::oBtnEncargar )
               ::oBtnEncargar:UnSelected()
            end

         case ::oTiketCabecera:nUbiTik == 3

            if !Empty( ::oBtnSala )
               ::oBtnSala:UnSelected()
            end

            if !Empty( ::oBtnGeneral )
               ::oBtnGeneral:UnSelected()
            end

            if !Empty( ::oBtnLlevar )
               ::oBtnLlevar:UnSelected()
            end

            if !Empty( ::oBtnRecoger )
               ::oBtnRecoger:UnSelected()
            end

            if !Empty( ::oBtnEncargar )
               ::oBtnEncargar:UnSelected()
            end

         case ::oTiketCabecera:nUbiTik == 1

            if !Empty( ::oBtnSala )
               ::oBtnSala:UnSelected()
            end

            if !Empty( ::oBtnGeneral )
               ::oBtnGeneral:UnSelected()
            end

            if !Empty( ::oBtnLlevar )
               ::oBtnLlevar:Selected()
            end

            if !Empty( ::oBtnRecoger )
               ::oBtnRecoger:UnSelected()
            end

            if !Empty( ::oBtnEncargar )
               ::oBtnEncargar:UnSelected()
            end

         case ::oTiketCabecera:nUbiTik == 4

            if !Empty( ::oBtnSala )
               ::oBtnSala:UnSelected()
            end

            if !Empty( ::oBtnGeneral )
               ::oBtnGeneral:UnSelected()
            end

            if !Empty( ::oBtnLlevar )
               ::oBtnLlevar:UnSelected()
            end

            if !Empty( ::oBtnRecoger )
               ::oBtnRecoger:UnSelected()
            end

            if !Empty( ::oBtnEncargar )
               ::oBtnEncargar:Selected()
            end

      end

      if !Empty( ::oGrpSalones )
         ::oGrpSalones:Refresh()
      end

      RETURN ( cUbicacion )

   >; _HB_MEMBER cUbicacion(); IIF( .F., s_oClass:ModInline( "cUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cUbicacion", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cInfo       := ""

      if !Empty( ::oTiketCabecera:cNumTik )
         cInfo          += "Ticket : " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + Space( 1 )
      end

      if !Empty( ::oTiketCabecera:dFecCre )
         cInfo          += Dtoc( ::oTiketCabecera:dFecCre ) + Space( 1 )
      end

      if !Empty( ::oTiketCabecera:cTimCre )
         cInfo          += ( ::oTiketCabecera:cTimCre ) + Space( 1 )
      end

      RETURN ( cInfo )

   >; _HB_MEMBER cInfo(); IIF( .F., s_oClass:ModInline( "cInfo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cInfo", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cInfo       := ""

      do case
         case ::oTiketCabecera:nUbiTik == 2
            cInfo       := ::oRestaurante:cTextoSala( ::oTiketCabecera:cCodSala ) + Space( 1 ) + ":" + Space( 1 ) + Rtrim( ::oTiketCabecera:cPntVenta ) + Chr(13)+Chr(10) + Space( 1 )

         case ::oTiketCabecera:nUbiTik == 0
            cInfo       := Rtrim( ::oTiketCabecera:cAliasTik ) + Chr(13)+Chr(10) + Space( 1 )

         case ::oTiketCabecera:nUbiTik == 3
            cInfo       := Rtrim( ::oTiketCabecera:cAliasTik ) + Chr(13)+Chr(10) + Space( 1 )

         case ::oTiketCabecera:nUbiTik == 1
            cInfo       := Rtrim( ::oTiketCabecera:cNomTik )   + Chr(13)+Chr(10) + Space( 1 )

         case ::oTiketCabecera:nUbiTik == 4
            cInfo       := Rtrim( ::oTiketCabecera:cNomTik )   + Chr(13)+Chr(10) + Space( 1 )

      end

      if !Empty( ::oTiketCabecera:nTotTik )
         cInfo          += Alltrim( Trans( ::oTiketCabecera:nTotTik, ::cPictureTotal ) )
      end

      RETURN ( cInfo )

   >; _HB_MEMBER cInfoPendiente(); IIF( .F., s_oClass:ModInline( "cInfoPendiente", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cInfoPendiente", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cEstado     := ""

      if ::oTiketCabecera:lAbierto
         cEstado        := "Abierto"
      else
         cEstado        := "Cerrado"
      end

      RETURN ( cEstado )

   >; _HB_MEMBER cEstado(); IIF( .F., s_oClass:ModInline( "cEstado", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cEstado", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, lCombinando|;

      local cCodigoFamilia       := ""
      local cCodigoCombinada     := ""

      IIF( lCombinando == nil, lCombinando := !::lCombinando, ) ;

      ::lCombinando              := lCombinando

      if ::lCombinando .AND. ::lEmptyDocumento()
         MsgInfo( "No hay producto para combinar." )
         ::lCombinando           := .F.
      end

      if ::lCombinando

         ::oBtnCombinado:LoadBitmap( "Cocktail_red_32" )

         cCodigoFamilia          := ::oTemporalLinea:cCodFam

         if Empty( cCodigoFamilia )
            cCodigoFamilia       := ::oTemporalLinea:cFamTil
         end

         if !Empty( cCodigoFamilia )

            ::cCodigoFamilia     := cCodigoFamilia

            if ::oFamilias:SeekInOrd( cCodigoFamilia, "cCodFam" )
               cCodigoCombinada  := ::oFamilias:cFamCmb
            end

            if !Empty( cCodigoCombinada )
               ::SetFamilia( cCodigoCombinada )
            end

         end

      else

         ::oBtnCombinado:LoadBitmap( "Cocktail_32" )

         if !Empty( ::cCodigoFamilia )
            ::SetFamilia( ::cCodigoFamilia )
            ::cCodigoFamilia     := ""
         end

      end

      RETURN ( Self )

   >; _HB_MEMBER SetCombinando(); IIF( .F., s_oClass:ModInline( "SetCombinando", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "SetCombinando", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   _HB_MEMBER SetCalculadora(); IIF( .F., s_oClass:ModMethod( "SetCalculadora", @TpvTactil_SetCalculadora(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SetCalculadora", @TpvTactil_SetCalculadora(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER KillResource(); IIF( .F., s_oClass:ModInline( "KillResource", {|Self | Self, ( ::lKillResource   := .T., ::oDlg:End() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "KillResource", {|Self | Self, ( ::lKillResource   := .T., ::oDlg:End() ) }, nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) )

   _HB_MEMBER GeneraVale(); IIF( .F., s_oClass:ModMethod( "GeneraVale", @TpvTactil_GeneraVale(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "GeneraVale", @TpvTactil_GeneraVale(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER lLiquidaVale( sCobro); IIF( .F., s_oClass:ModMethod( "lLiquidaVale", @TpvTactil_lLiquidaVale(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lLiquidaVale", @TpvTactil_lLiquidaVale(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));



   WITH OBJECT <|Self, cNumeroTicket|;

      local cValeTicket := ""

      ::oTiketCabecera:GetStatus()

      if ::oTiketCabecera:SeekInOrd( cNumeroTicket, "cTikVal" )
         cValeTicket    := ::cNumeroTicket()
      end

      ::oTiketCabecera:SetStatus()

      RETURN ( cValeTicket )

   >; _HB_MEMBER cValeTicket(); IIF( .F., s_oClass:ModInline( "cValeTicket", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cValeTicket", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, oPunto|;

      if !::oTiketMesa:Seek( oPunto:cPunto )
         ::oTiketMesa:Append()
         ::oTiketMesa:cCodSala   := oPunto:cCodigoSala
         ::oTiketMesa:cPntVenta  := oPunto:cPuntoVenta
         ::oTiketMesa:Save()
      end

      RETURN ( ::oTiketMesa:RecLock() )

   >; _HB_MEMBER lLockMesa(); IIF( .F., s_oClass:ModInline( "lLockMesa", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lLockMesa", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self, oPunto|;

      if ::oTiketMesa:Seek( oPunto:cPunto )





         ::oTiketMesa:UnLock()





         if ::oTiketMesa:RecLock()
            ::oTiketMesa:Delete()
         end

      end

      RETURN ( ::oTiketMesa:RecLock() )

   >; _HB_MEMBER lFreeMesa(); IIF( .F., s_oClass:ModInline( "lFreeMesa", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lFreeMesa", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cTexto

      cTexto         := Rtrim( ::oTemporalLinea:cNomTil )

      if !Empty( ::oTemporalLinea:cComent )
         cTexto      := "[*] " + cTexto
      end

      if !Empty( ::oTemporalLinea:cNcmTil )
         cTexto      += " con " + Chr(13)+Chr(10) + ::oTemporalLinea:cNcmTil
      end

      if !Empty( ::oTemporalLinea:lKitChl )
         cTexto      := Space( 3 ) + "<" + cTexto + ">"
      end

      RETURN ( cTexto )

   >; _HB_MEMBER cTextoLinea(); IIF( .F., s_oClass:ModInline( "cTextoLinea", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "cTextoLinea", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



   WITH OBJECT <|Self|;

      local cFocus

      cFocus         := Upper( ::oTemporalLinea:OrdSetFocus() )

      if ( cFocus == Upper( "nRecNum" ) )
         ::oTemporalLinea:OrdSetFocus( "lRecNum" )
      else
         ::oTemporalLinea:OrdSetFocus( "nRecNum" )
      end

      ::oBrwLineas:GoTop()
      ::oBrwLineas:Refresh()

      RETURN ( Self )

   >; _HB_MEMBER lShowEscandallos(); IIF( .F., s_oClass:ModInline( "lShowEscandallos", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddInline( "lShowEscandallos", HB_QWith(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ) ); END



; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TpvTactil ;










UTILITY STATIC function TpvTactil_New( oMenuItem, oWnd) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   IIF( oMenuItem == nil, oMenuItem := "01064", ) ;
   IIF( oWnd == nil, oWnd := oWnd(), ) ;

   ::oWnd                     := oWnd

   if oMenuItem <> nil
      ::nLevel                := nLevelUsr( oMenuItem )
   else
      ::nLevel                := 0
   end

   ::nScreenHorzRes           := GetSysMetrics( 0 )
   ::nScreenVertRes           := GetSysMetrics( 1 )
   ::nScreenVertRes           := 752

   ::lOpenFiles               := .F.
   ::lKillResource            := .F.
   ::lHideCalculadora         := .T.

   ::cResource                := "TpvTactil"

   ::lImagenArticulos         := !uFieldEmpresa( "lImgArt" )

   if ::lImagenArticulos

      do case
         case ::nScreenVertRes == 560

            ::nImageViewWItem := 71 + 4
            ::nImageViewHItem := 67 + 38

         case ::nScreenVertRes == 752

            ::nImageViewWItem := 95 + 4
            ::nImageViewHItem := 81 + 38

         case ::nScreenVertRes == 768

            ::nImageViewWItem := 86 + 4
            ::nImageViewHItem := 97 + 38

         otherwise

            ::nImageViewWItem := 86 + 4
            ::nImageViewHItem := 97 + 38

      end

      ::nImageViewVSep        := 0
      ::nImageViewHSep        := 4
      ::nImageViewTitle       := 38
      ::aImageViewTextMargin  := { 2, 2, 0, 2 }

   else

      do case
         case ::nScreenVertRes == 560

            ::nImageViewWItem := 96 + 6
            ::nImageViewHItem := 50 + 28

         case ::nScreenVertRes == 752

            ::nImageViewWItem := 145 + 6
            ::nImageViewHItem := 65 + 28

         case ::nScreenVertRes == 768

            ::nImageViewWItem := 122 + 6
            ::nImageViewHItem := 60 + 28

         otherwise

            ::nImageViewWItem := 122 + 6
            ::nImageViewHItem := 60 + 28

      end

      ::nImageViewVSep        := 5
      ::nImageViewHSep        := 4
      ::nImageViewTitle       := 38
      ::aImageViewTextMargin  := { 2, 2, 32, 2 }

   end

   ::aFamilias                := {}
   ::aLineas                  := {}

   ::oBtnNum                  := Array( 15 )

   ::oFntNum                  := TFont():New( "Segoe UI",  0, 46, .F., .F. )
   ::oFntEur                  := TFont():New( "Segoe UI",  0, 30, .F., .F. )
   ::oFntBrw                  := TFont():New( "Segoe UI",  0, 20, .F., .T. )
   ::oFntDlg                  := TFont():New( "Segoe UI", 12, 32, .F., .F. )
   ::oFntDto                  := TFont():New( "Segoe UI",  0, 40, .F., .F. )

   ::cSayZona                 := "Zona"
   ::cSayInfo                 := ""

   ::nTotalTicket             := 0
   ::nTotalPrecioPersona      := 0

   ::cGetDescripcion          := Space( 100 )
   ::nGetUnidades             := 1
   ::nGetImporte              := 0
   ::cGetImpresora            := Space( 254 )

   ::cGetUnidades             := Space( 100 )

   ::nTarifaSolo              := Max( uFieldEmpresa( "nPreTPro" ), 1 )
   ::nTarifaCombinado         := Max( uFieldEmpresa( "nPreTCmb" ), 1 )

   ::lCombinando              := .F.

   oThis                      := Self

Return Self



UTILITY STATIC function TpvTactil_End() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( ::oFntNum )
      ::oFntNum:End()
   end

   if !Empty( ::oFntEur )
      ::oFntEur:End()
   end

   if !Empty( ::oFntBrw )
      ::oFntBrw:End()
   end

   if !Empty( ::oFntDlg )
      ::oFntDlg:End()
   end

   if !Empty( ::oFntDto )
      ::oFntDto:End()
   end

   if !Empty( ::oLstArticulos )
      ::oLstArticulos:End()
   end

   if !Empty( ::oLstFavoritos )
      ::oLstFavoritos:End()
   end

   if !Empty( ::oTpvCobros )
      ::oTpvCobros:End()
   end

   if !Empty( ::oTpvListaTicket )
      ::oTpvListaTicket:End()
   end

   if !Empty( ::oFastReport )
      ::oFastReport:DestroyFr()
   end

   if !Empty( ::oTurno )
      ::oTurno:End()
   end

   if !Empty( ::oOfficeBar )
      ::oOfficeBar:End()
   end

   if !Empty( ::oBrwFamilias )
      ::oBrwFamilias:End()
   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:End()
   end

   if ::lOpenFiles
      ::CloseFiles()
   end

   ::oFastReport     := nil

   ::oTpvCobros      := nil
   ::oTpvListaTicket := nil

   ::oTurno          := nil

   ::oOfficeBar      := nil

   ::oLstArticulos   := nil
   ::oLstFavoritos   := nil

   ::oFntNum         := nil
   ::oFntEur         := nil
   ::oFntBrw         := nil
   ::oFntDlg         := nil
   ::oFntDto         := nil

   Self              := nil







Return .T.



UTILITY STATIC function TpvTactil_Activate( lAlone) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   IIF( lAlone == nil, lAlone := .F., ) ;

   if nAnd( ::nLevel, 1 ) <> 0
      msgStop( "Acceso no permitido." )
      Return .F.
   end

   if oWnd() <> nil
      SysRefresh(); oWnd():CloseAll(); SysRefresh()
   end

   if !( ::nScreenHorzRes >= 1024 )
      MsgStop( "Gestool" + Space( 1 ) + "2K13" + "táctil solo permite resoluciones de 1024 o superiores" )
      Return .F.
   end

   if !lCajaOpen( oUser():cCaja() ) .AND. !oUser():lMaster()
      msgStop( "Esta caja " + oUser():cCaja() + " esta cerrada." )
      Return .F.
   end





   if !::OpenFiles()
      Return .F.
   end





   ::oTpvCobros               := TpvCobros():New( Self )

   ::oTpvListaTicket          := TpvListaTicket():New( Self )

   ::oFastReport              := frReportManager():New()
   ::oFastReport:LoadLangRes( "Spanish.Xml" )

   ::oTurno                   := TTurno():New( cPatEmp(), oWnd(), "01001" )
   ::oTurno:lArqueoTactil     := .T.

   ::oTurno:SetFastReport( ::oFastReport )

   if lFamInTpv( ::oFamilias:cAlias )

      ::lAlone       := lAlone
      ::lGetUsuario  := !lAlone





      ::CreateTemporal()





      ::CargaBrowseFamilias()





      ::InitDocumento( 0 )





      ::Resource()

   else

      MsgStop( "No hay familias de artículos seleccionadas para trabajar con el TPV táctil", uFieldEmpresa( "CodEmp" ) + " - " + Rtrim( uFieldEmpresa( "cNombre" ) ) )

   end





   ::DestroyTemporal()





   ::End()

Return ( Self )



UTILITY STATIC function TpvTactil_OpenFiles() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBlock
   local oError

   if ::lOpenFiles
      MsgStop( "Imposible abrir ficheros de tickets de clientes" )
      Return ( .F. )
   end

   oBlock                     := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::lOpenFiles               := .T.

   ::oTiketCabecera := DbfServer( "TIKET.DBF", ):NewOpen( "TIKET.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketCabecera:AddBag( "TIKET.CDX" ) ; ::oTiketCabecera:AddBag( ) ; ::oTiketCabecera:AutoIndex()

   ::oTiketLinea := DbfServer( "TIKEL.DBF", ):NewOpen( "TIKEL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketLinea:AddBag( "TIKEL.CDX" ) ; ::oTiketLinea:AddBag( ) ; ::oTiketLinea:AutoIndex()

   ::oTiketCobro := DbfServer( "TIKEP.DBF", ):NewOpen( "TIKEP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketCobro:AddBag( "TIKEP.CDX" ) ; ::oTiketCobro:AddBag( ) ; ::oTiketCobro:AutoIndex()

   ::oTiketMesa := DbfServer( "TIKEM.DBF", ):NewOpen( "TIKEM.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketMesa:AddBag( "TIKEM.CDX" ) ; ::oTiketMesa:AddBag( ) ; ::oTiketMesa:AutoIndex()

   ::oTiketNumeroSerie := DbfServer( "TIKES.DBF", ):NewOpen( "TIKES.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oTiketNumeroSerie:AddBag( "TIKES.CDX" ) ; ::oTiketNumeroSerie:AddBag( ) ; ::oTiketNumeroSerie:AutoIndex()

   ::oCliente := DbfServer( "CLIENT.DBF", ):NewOpen( "CLIENT.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oCliente:AddBag( "CLIENT.CDX" ) ; ::oCliente:AddBag( ) ; ::oCliente:AutoIndex()

   ::oCajaCabecera := DbfServer( "Cajas.DBF", ):NewOpen( "Cajas.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCajaCabecera:AddBag( "Cajas.CDX" ) ; ::oCajaCabecera:AddBag( ) ; ::oCajaCabecera:AutoIndex()

   ::oCajaLinea := DbfServer( "CajasL.DBF", ):NewOpen( "CajasL.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oCajaLinea:AddBag( "CAJASL.CDX" ) ; ::oCajaLinea:AddBag( ) ; ::oCajaLinea:AutoIndex()

   ::oUsuario := DbfServer( "USERS.DBF", ):NewOpen( "USERS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oUsuario:AddBag( "USERS.CDX" ) ; ::oUsuario:AddBag( ) ; ::oUsuario:AutoIndex()

   ::oArticulo := DbfServer( "ARTICULO.DBF", ):NewOpen( "ARTICULO.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArticulo:AddBag( "ARTICULO.CDX" ) ; ::oArticulo:AddBag( ) ; ::oArticulo:AutoIndex()

   ::oCodigoBarraArticulo := DbfServer( "ArtCodebar.DBF", ):NewOpen( "ArtCodebar.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oCodigoBarraArticulo:AddBag( "ArtCodebar.CDX" ) ; ::oCodigoBarraArticulo:AddBag( ) ; ::oCodigoBarraArticulo:AutoIndex()

   ::oArticulosEscandallos := DbfServer( "ARTKIT.DBF", ):NewOpen( "ARTKIT.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArticulosEscandallos:AddBag( "ARTKIT.CDX" ) ; ::oArticulosEscandallos:AddBag( ) ; ::oArticulosEscandallos:AutoIndex()

   ::oOferta := DbfServer( "OFERTA.DBF", ):NewOpen( "OFERTA.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oOferta:AddBag( "OFERTA.CDX" ) ; ::oOferta:AddBag( ) ; ::oOferta:AutoIndex()

   ::oFormaPago := DbfServer( "FPAGO.DBF", ):NewOpen( "FPAGO.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oFormaPago:AddBag( "FPAGO.CDX" ) ; ::oFormaPago:AddBag( ) ; ::oFormaPago:AutoIndex()

   ::oPropiedadesLinea := DbfServer( "TBLPRO.DBF", ):NewOpen( "TBLPRO.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oPropiedadesLinea:AddBag( "TBLPRO.CDX" ) ; ::oPropiedadesLinea:AddBag( ) ; ::oPropiedadesLinea:AutoIndex()

   ::oFamilias := DbfServer( "FAMILIAS.DBF", ):NewOpen( "FAMILIAS.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oFamilias:AddBag( "FAMILIAS.CDX" ) ; ::oFamilias:AddBag( ) ; ::oFamilias:AutoIndex()

   ::oAlbaranClienteCabecera := DbfServer( "ALBCLIT.DBF", ):NewOpen( "ALBCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteCabecera:AddBag( "ALBCLIT.CDX" ) ; ::oAlbaranClienteCabecera:AddBag( ) ; ::oAlbaranClienteCabecera:AutoIndex()

   ::oAlbaranClienteLinea := DbfServer( "ALBCLIL.DBF", ):NewOpen( "ALBCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteLinea:AddBag( "ALBCLIL.CDX" ) ; ::oAlbaranClienteLinea:AddBag( ) ; ::oAlbaranClienteLinea:AutoIndex()

   ::oAlbaranClienteSerie := DbfServer( "ALBCLIS.DBF", ):NewOpen( "ALBCLIS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClienteSerie:AddBag( "ALBCLIS.CDX" ) ; ::oAlbaranClienteSerie:AddBag( ) ; ::oAlbaranClienteSerie:AutoIndex()

   ::oAlbaranClientePago := DbfServer( "ALBCLIP.DBF", ):NewOpen( "ALBCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranClientePago:AddBag( "ALBCLIP.CDX" ) ; ::oAlbaranClientePago:AddBag( ) ; ::oAlbaranClientePago:AutoIndex()

   ::oFacturaClienteCabecera := DbfServer( "FACCLIT.DBF", ):NewOpen( "FACCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteCabecera:AddBag( "FACCLIT.CDX" ) ; ::oFacturaClienteCabecera:AddBag( ) ; ::oFacturaClienteCabecera:AutoIndex()

   ::oFacturaClienteLinea := DbfServer( "FACCLIL.DBF", ):NewOpen( "FACCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteLinea:AddBag( "FACCLIL.CDX" ) ; ::oFacturaClienteLinea:AddBag( ) ; ::oFacturaClienteLinea:AutoIndex()

   ::oFacturaClienteSerie := DbfServer( "FACCLIS.DBF", ):NewOpen( "FACCLIS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClienteSerie:AddBag( "FACCLIS.CDX" ) ; ::oFacturaClienteSerie:AddBag( ) ; ::oFacturaClienteSerie:AutoIndex()

   ::oFacturaClientePago := DbfServer( "FACCLIP.DBF", ):NewOpen( "FACCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaClientePago:AddBag( "FACCLIP.CDX" ) ; ::oFacturaClientePago:AddBag( ) ; ::oFacturaClientePago:AutoIndex()

   ::oAnticipoCliente := DbfServer( "AntCliT.DBF", ):NewOpen( "AntCliT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAnticipoCliente:AddBag( "AntCliT.CDX" ) ; ::oAnticipoCliente:AddBag( ) ; ::oAnticipoCliente:AutoIndex()

   ::oObras := DbfServer( "ObrasT.DBF", ):NewOpen( "ObrasT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oObras:AddBag( "ObrasT.CDX" ) ; ::oObras:AddBag( ) ; ::oObras:AutoIndex()

   ::oAgentes := DbfServer( "AGENTES.DBF", ):NewOpen( "AGENTES.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oAgentes:AddBag( "AGENTES.CDX" ) ; ::oAgentes:AddBag( ) ; ::oAgentes:AutoIndex()

   ::oRuta := DbfServer( "RUTA.DBF", ):NewOpen( "RUTA.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oRuta:AddBag( "RUTA.CDX" ) ; ::oRuta:AddBag( ) ; ::oRuta:AutoIndex()

   ::oAlmacen := DbfServer( "ALMACEN.DBF", ):NewOpen( "ALMACEN.DBF",, ( cDriver() ),, ( cPatAlm() ), .F., .T., .F., .F. ) ; ::oAlmacen:AddBag( "ALMACEN.CDX" ) ; ::oAlmacen:AddBag( ) ; ::oAlmacen:AutoIndex()

   ::oArticuloDividido := DbfServer( "ARTDIV.DBF", ):NewOpen( "ARTDIV.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oArticuloDividido:AddBag( "ARTDIV.CDX" ) ; ::oArticuloDividido:AddBag( ) ; ::oArticuloDividido:AutoIndex()

   ::oTarifaPrecioLinea := DbfServer( "TARPREL.DBF", ):NewOpen( "TARPREL.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTarifaPrecioLinea:AddBag( "TARPREL.CDX" ) ; ::oTarifaPrecioLinea:AddBag( ) ; ::oTarifaPrecioLinea:AutoIndex()

   ::oTarifaPrecioLineaAgente := DbfServer( "TARPRES.DBF", ):NewOpen( "TARPRES.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTarifaPrecioLineaAgente:AddBag( "TARPRES.CDX" ) ; ::oTarifaPrecioLineaAgente:AddBag( ) ; ::oTarifaPrecioLineaAgente:AutoIndex()

   ::oDocument := DbfServer( "RDOCUMEN.DBF", ):NewOpen( "RDOCUMEN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oDocument:AddBag( "RDOCUMEN.CDX" ) ; ::oDocument:AddBag( ) ; ::oDocument:AutoIndex()

   ::oAtipicasCliente := DbfServer( "CliAtp.DBF", ):NewOpen( "CliAtp.DBF",, ( cDriver() ),, ( cPatCli() ), .F., .T., .F., .F. ) ; ::oAtipicasCliente:AddBag( "CliAtp.CDX" ) ; ::oAtipicasCliente:AddBag( ) ; ::oAtipicasCliente:AutoIndex()

   ::oContadores := DbfServer( "NCOUNT.DBF", ):NewOpen( "NCOUNT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oContadores:AddBag( "NCOUNT.CDX" ) ; ::oContadores:AddBag( ) ; ::oContadores:AutoIndex()

   ::oTipoIVA := DbfServer( "TIVA.DBF", ):NewOpen( "TIVA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oTipoIVA:AddBag( "TIVA.CDX" ) ; ::oTipoIVA:AddBag( ) ; ::oTipoIVA:AutoIndex()

   ::oDivisas := DbfServer( "DIVISAS.DBF", ):NewOpen( "DIVISAS.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oDivisas:AddBag( "DIVISAS.CDX" ) ; ::oDivisas:AddBag( ) ; ::oDivisas:AutoIndex()

   ::oFiltroPorUsuario := DbfServer( "CNFFLT.DBF", ):NewOpen( "CNFFLT.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oFiltroPorUsuario:AddBag( "CNFFLT.CDX" ) ; ::oFiltroPorUsuario:AddBag( ) ; ::oFiltroPorUsuario:AutoIndex()

   ::oComisionesAgentes := DbfServer( "AGECOM.DBF", ):NewOpen( "AGECOM.DBF",, ( cDriver() ),, ( cPatGrp() ), .F., .T., .F., .F. ) ; ::oComisionesAgentes:AddBag( "AGECOM.CDX" ) ; ::oComisionesAgentes:AddBag( ) ; ::oComisionesAgentes:AutoIndex()

   ::oEmpresa := DbfServer( "EMPRESA.DBF", ):NewOpen( "EMPRESA.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oEmpresa:AddBag( "EMPRESA.CDX" ) ; ::oEmpresa:AddBag( ) ; ::oEmpresa:AutoIndex()

   ::oFactoresConversion := DbfServer( "TBLCNV.DBF", ):NewOpen( "TBLCNV.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oFactoresConversion:AddBag( "TBLCNV.CDX" ) ; ::oFactoresConversion:AddBag( ) ; ::oFactoresConversion:AutoIndex()

   ::oPedidoClienteCabecera := DbfServer( "PEDCLIT.DBF", ):NewOpen( "PEDCLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteCabecera:AddBag( "PEDCLIT.CDX" ) ; ::oPedidoClienteCabecera:AddBag( ) ; ::oPedidoClienteCabecera:AutoIndex()

   ::oPedidoClienteLinea := DbfServer( "PEDCLIL.DBF", ):NewOpen( "PEDCLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteLinea:AddBag( "PEDCLIL.CDX" ) ; ::oPedidoClienteLinea:AddBag( ) ; ::oPedidoClienteLinea:AutoIndex()

   ::oPedidoClienteEntregaCuenta := DbfServer( "PEDCLIP.DBF", ):NewOpen( "PEDCLIP.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPedidoClienteEntregaCuenta:AddBag( "PEDCLIP.CDX" ) ; ::oPedidoClienteEntregaCuenta:AddBag( ) ; ::oPedidoClienteEntregaCuenta:AutoIndex()

   ::oPresupuestoClienteCabecera := DbfServer( "PRECLIT.DBF", ):NewOpen( "PRECLIT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPresupuestoClienteCabecera:AddBag( "PRECLIT.CDX" ) ; ::oPresupuestoClienteCabecera:AddBag( ) ; ::oPresupuestoClienteCabecera:AutoIndex()

   ::oPresupuestoClienteLinea := DbfServer( "PRECLIL.DBF", ):NewOpen( "PRECLIL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oPresupuestoClienteLinea:AddBag( "PRECLIL.CDX" ) ; ::oPresupuestoClienteLinea:AddBag( ) ; ::oPresupuestoClienteLinea:AutoIndex()

   ::oFacturaRectificativaCabecera := DbfServer( "FACRECT.DBF", ):NewOpen( "FACRECT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaCabecera:AddBag( "FACRECT.CDX" ) ; ::oFacturaRectificativaCabecera:AddBag( ) ; ::oFacturaRectificativaCabecera:AutoIndex()

   ::oFacturaRectificativaLinea := DbfServer( "FACRECL.DBF", ):NewOpen( "FACRECL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaLinea:AddBag( "FACRECL.CDX" ) ; ::oFacturaRectificativaLinea:AddBag( ) ; ::oFacturaRectificativaLinea:AutoIndex()

   ::oFacturaRectificativaNumeroSerie := DbfServer( "FACRECS.DBF", ):NewOpen( "FACRECS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaRectificativaNumeroSerie:AddBag( "FACRECS.CDX" ) ; ::oFacturaRectificativaNumeroSerie:AddBag( ) ; ::oFacturaRectificativaNumeroSerie:AutoIndex()

   ::oAlbaranProveedorCabecera := DbfServer( "ALBPROVT.DBF", ):NewOpen( "ALBPROVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorCabecera:AddBag( "ALBPROVT.CDX" ) ; ::oAlbaranProveedorCabecera:AddBag( ) ; ::oAlbaranProveedorCabecera:AutoIndex()

   ::oAlbaranProveedorLinea := DbfServer( "ALBPROVL.DBF", ):NewOpen( "ALBPROVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorLinea:AddBag( "ALBPROVL.CDX" ) ; ::oAlbaranProveedorLinea:AddBag( ) ; ::oAlbaranProveedorLinea:AutoIndex()

   ::oAlbaranProveedorNumeroSerie := DbfServer( "AlbPrvS.DBF", ):NewOpen( "AlbPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oAlbaranProveedorNumeroSerie:AddBag( "AlbPrvS.CDX" ) ; ::oAlbaranProveedorNumeroSerie:AddBag( ) ; ::oAlbaranProveedorNumeroSerie:AutoIndex()

   ::oFacturaProveedorCabecera := DbfServer( "FACPRVT.DBF", ):NewOpen( "FACPRVT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorCabecera:AddBag( "FACPRVT.CDX" ) ; ::oFacturaProveedorCabecera:AddBag( ) ; ::oFacturaProveedorCabecera:AutoIndex()

   ::oFacturaProveedorLinea := DbfServer( "FACPRVL.DBF", ):NewOpen( "FACPRVL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorLinea:AddBag( "FACPRVL.CDX" ) ; ::oFacturaProveedorLinea:AddBag( ) ; ::oFacturaProveedorLinea:AutoIndex()

   ::oFacturaProveedorNumeroSerie := DbfServer( "FACPRVS.DBF", ):NewOpen( "FACPRVS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oFacturaProveedorNumeroSerie:AddBag( "FACPRVS.CDX" ) ; ::oFacturaProveedorNumeroSerie:AddBag( ) ; ::oFacturaProveedorNumeroSerie:AutoIndex()

   ::oRectificativaProveedorCabecera := DbfServer( "RctPrvT.DBF", ):NewOpen( "RctPrvT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorCabecera:AddBag( "RctPrvT.CDX" ) ; ::oRectificativaProveedorCabecera:AddBag( ) ; ::oRectificativaProveedorCabecera:AutoIndex()

   ::oRectificativaProveedorLinea := DbfServer( "RctPrvL.DBF", ):NewOpen( "RctPrvL.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorLinea:AddBag( "RctPrvL.CDX" ) ; ::oRectificativaProveedorLinea:AddBag( ) ; ::oRectificativaProveedorLinea:AutoIndex()

   ::oRectificativaProveedorNumeroSerie := DbfServer( "RctPrvS.DBF", ):NewOpen( "RctPrvS.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oRectificativaProveedorNumeroSerie:AddBag( "RctPrvS.CDX" ) ; ::oRectificativaProveedorNumeroSerie:AddBag( ) ; ::oRectificativaProveedorNumeroSerie:AutoIndex()

   ::oMovimientosAlmacen := DbfServer( "HISMOV.DBF", ):NewOpen( "HISMOV.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMovimientosAlmacen:AddBag( "HISMOV.CDX" ) ; ::oMovimientosAlmacen:AddBag( ) ; ::oMovimientosAlmacen:AutoIndex()

   ::oMovimientosAlmacenNumeroSerie := DbfServer( "MOVSER.DBF", ):NewOpen( "MOVSER.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMovimientosAlmacenNumeroSerie:AddBag( "MOVSER.CDX" ) ; ::oMovimientosAlmacenNumeroSerie:AddBag( ) ; ::oMovimientosAlmacenNumeroSerie:AutoIndex()

   ::oCategorias := DbfServer( "CATEGORIAS.DBF", ):NewOpen( "CATEGORIAS.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oCategorias:AddBag( "CATEGORIAS.CDX" ) ; ::oCategorias:AddBag( ) ; ::oCategorias:AutoIndex()

   ::oComentariosCabecera := DbfServer( "COMENTARIOST.DBF", ):NewOpen( "COMENTARIOST.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oComentariosCabecera:AddBag( "COMENTARIOST.CDX" ) ; ::oComentariosCabecera:AddBag( ) ; ::oComentariosCabecera:AutoIndex()

   ::oComentariosLinea := DbfServer( "COMENTARIOSL.DBF", ):NewOpen( "COMENTARIOSL.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oComentariosLinea:AddBag( "COMENTARIOSL.CDX" ) ; ::oComentariosLinea:AddBag( ) ; ::oComentariosLinea:AutoIndex()

   if uFieldEmpresa( "lOrdNomTpv" )

      ::oComentariosCabecera:OrdSetFocus( "cDescri" )
      ::oComentariosCabecera:GoTop()

      ::oComentariosLinea:OrdSetFocus( "cCodDes" )
      ::oComentariosLinea:GoTop()

   end

   ::oTipoImpresoraComandas := DbfServer( "TIPIMP.DBF", ):NewOpen( "TIPIMP.DBF",, ( cDriver() ),, ( cPatDat() ), .F., .T., .F., .F. ) ; ::oTipoImpresoraComandas:AddBag( "TIPIMP.CDX" ) ; ::oTipoImpresoraComandas:AddBag( ) ; ::oTipoImpresoraComandas:AutoIndex()

   ::oTemporadas := DbfServer( "Temporadas.DBF", ):NewOpen( "Temporadas.DBF",, ( cDriver() ),, ( cPatArt() ), .F., .T., .F., .F. ) ; ::oTemporadas:AddBag( "Temporadas.CDX" ) ; ::oTemporadas:AddBag( ) ; ::oTemporadas:AutoIndex()

   ::oParteProducionLinea := DbfServer( "PROLIN.DBF", ):NewOpen( "PROLIN.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oParteProducionLinea:AddBag( "PROLIN.CDX" ) ; ::oParteProducionLinea:AddBag( ) ; ::oParteProducionLinea:AutoIndex()

   ::oMaterialesProducion := DbfServer( "PROMAT.DBF", ):NewOpen( "PROMAT.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesProducion:AddBag( "PROMAT.CDX" ) ; ::oMaterialesProducion:AddBag( ) ; ::oMaterialesProducion:AutoIndex()

   ::oMaterialesProducionSeries := DbfServer( "PROSER.DBF", ):NewOpen( "PROSER.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesProducionSeries:AddBag( "PROSER.CDX" ) ; ::oMaterialesProducionSeries:AddBag( ) ; ::oMaterialesProducionSeries:AutoIndex()

   ::oMaterialesNumeroSeries := DbfServer( "MatSer.DBF", ):NewOpen( "MatSer.DBF",, ( cDriver() ),, ( cPatEmp() ), .F., .T., .F., .F. ) ; ::oMaterialesNumeroSeries:AddBag( "MatSer.CDX" ) ; ::oMaterialesNumeroSeries:AddBag( ) ; ::oMaterialesNumeroSeries:AutoIndex()

   ::oCaptura             := TCaptura():New( cPatDat() )
   ::oCaptura:OpenFiles()

   ::oTComandas           := TComandas():Create( cPatArt() )
   ::oTComandas:OpenFiles()

   ::oBandera             := TBandera():New()

   ::oStock               := TStock():Create( cPatGrp() )

   if !::oStock:lOpenFiles()

      ::lOpenFiles        := .F.

   else

      ::oStock:cKit       := ::oArticulosEscandallos:cAlias

      ::oStock:cAlbCliT   := ::oAlbaranClienteCabecera:cAlias
      ::oStock:cAlbCliL   := ::oAlbaranClienteLinea:cAlias
      ::oStock:cAlbCliS   := ::oAlbaranClienteSerie:cAlias

      ::oStock:cFacCliT   := ::oFacturaClienteCabecera:cAlias
      ::oStock:cFacCliL   := ::oFacturaClienteLinea:cAlias
      ::oStock:cFacCliS   := ::oFacturaClienteSerie:cAlias
      ::oStock:cFacCliP   := ::oFacturaClientePago:cAlias

      ::oStock:cFacRecT   := ::oFacturaRectificativaCabecera:cAlias
      ::oStock:cFacRecL   := ::oFacturaRectificativaLinea:cAlias
      ::oStock:cFacRecS   := ::oFacturaRectificativaNumeroSerie:cAlias

      ::oStock:cAntCliT   := ::oAnticipoCliente:cAlias

      ::oStock:cTikT      := ::oTiketCabecera:cAlias
      ::oStock:cTikL      := ::oTiketLinea:cAlias
      ::oStock:cTikS      := ::oTiketMesa:cAlias

      ::oStock:cHisMov    := ::oMovimientosAlmacen:cAlias
      ::oStock:cHisMovS   := ::oMovimientosAlmacenNumeroSerie:cAlias

      ::oStock:cAlbPrvT   := ::oAlbaranProveedorCabecera:cAlias
      ::oStock:cAlbPrvL   := ::oAlbaranProveedorLinea:cAlias
      ::oStock:cAlbPrvS   := ::oAlbaranProveedorNumeroSerie:cAlias

      ::oStock:cFacPrvT   := ::oFacturaProveedorCabecera:cAlias
      ::oStock:cFacPrvL   := ::oFacturaProveedorLinea:cAlias
      ::oStock:cFacPrvS   := ::oFacturaProveedorNumeroSerie:cAlias

      ::oStock:cRctPrvT   := ::oRectificativaProveedorCabecera:cAlias
      ::oStock:cRctPrvL   := ::oRectificativaProveedorLinea:cAlias
      ::oStock:cRctPrvS   := ::oRectificativaProveedorNumeroSerie:cAlias

      ::oStock:cProducL   := ::oParteProducionLinea:cAlias
      ::oStock:cProducM   := ::oMaterialesProducion:cAlias
      ::oStock:cProducS   := ::oMaterialesProducionSeries:cAlias
      ::oStock:cProducP   := ::oMaterialesNumeroSeries:cAlias

   end

   ::oNewImp                  := TNewImp():New( cPatEmp() )
   if !::oNewImp:OpenFiles()
         ::lOpenFiles         := .F.
   end

   ::cVisor                   := cVisorEnCaja( oUser():cCaja(), ::oCajaCabecera )
   if !Empty( ::cVisor )
   ::oVisor                   := TVisor():Create( ::cVisor )
      if !Empty( ::oVisor )
      ::oVisor:Wellcome()
      end
   end

   ::cImpresora               := cImpresoraTicketEnCaja( oUser():cCaja(), ::oCajaCabecera )
   if !Empty( ::cImpresora )
   ::oImpresora               := TImpresoraTiket():Create( ::cImpresora )
   end

   ::oUndMedicion             := UniMedicion():Create( cPatGrp() )
   if !::oUndMedicion:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oRestaurante             := TTpvRestaurante():New( cPatEmp() )
   if !::oRestaurante:OpenFiles()
      ::lOpenFiles            := .F.
   else
      ::oRestaurante:SetSender( Self )
      ::oRestaurante:BuildSalas()
   end

   ::cBalanza                 := cBalanzaEnCaja( oUser():cCaja(), ::oCajaCabecera )
   if !Empty( ::cBalanza )
      ::oBalanza              := TCommPort():Create( ::cBalanza )
   end

   ::oInvitacion              := TInvitacion():Create( cPatGrp() )
   if !::oInvitacion:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oFideliza                := TFideliza():CreateInit( cPatArt() )
   if !::oFideliza:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oTipArt                  := TTipArt():Create( cPatArt() )
   if !::oTipArt:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::oFabricante              := TFabricantes():Create( cPatArt() )
   if !::oFabricante:OpenFiles()
      ::lOpenFiles            := .F.
   end

   ::cPictureImporte          := cPouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::cPictureTotal            := cPorDiv( cDivEmp(), ::oDivisas:cAlias )
   ::nDecimalesImporte        := nDouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::nDecimalesTotal          := nRouDiv( cDivEmp(), ::oDivisas:cAlias )
   ::cPictureUnidades         := MasUnd()





   ::oFormatosImpresion       := TFormatosImpresion():Load( ::oCajaCabecera:cAlias )

   ::cFormato                 := ::oFormatosImpresion:cFormatoEntrega
   ::cImpresora               := ::oFormatosImpresion:cPrinterEntrega
   ::nDispositivo             := 1
   ::nCopias                  := 1

   RECOVER USING oError

      ::lOpenFiles            := .F.

      EnableAcceso()

      msgStop( ErrorMessage( oError ), "Imposible abrir las bases de datos de terminal punto de venta" )

   end

   ErrorBlock( oBlock )

   if !::lOpenFiles
      ::CloseFiles()
   end

Return ( ::lOpenfiles )



UTILITY STATIC function TpvTactil_CloseFiles() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oTiketCabecera <> nil .AND. ::oTiketCabecera:Used()
      ::oTiketCabecera:End()
   end

   if ::oTiketLinea <> nil .AND. ::oTiketLinea:Used()
      ::oTiketLinea:End()
   end

   if ::oTiketCobro <> nil .AND. ::oTiketCobro:Used()
      ::oTiketCobro:End()
   end

   if ::oTiketMesa <> nil .AND. ::oTiketMesa:Used()
      ::oTiketMesa:End()
   end

   if ::oTiketNumeroSerie <> nil .AND. ::oTiketNumeroSerie:Used()
      ::oTiketNumeroSerie:End()
   end

   if ::oCliente <> nil .AND. ::oCliente:Used()
      ::oCliente:End()
   end

   if ::oCajaCabecera <> nil .AND. ::oCajaCabecera:Used()
      ::oCajaCabecera:End()
   end

   if ::oCajaLinea <> nil .AND. ::oCajaLinea:Used()
      ::oCajaLinea:End()
   end

   if ::oUsuario <> nil .AND. ::oUsuario:Used()
      ::oUsuario:End()
   end

   if ::oArticulo <> nil .AND. ::oArticulo:Used()
      ::oArticulo:End()
   end

   if ::oCodigoBarraArticulo <> nil .AND. ::oCodigoBarraArticulo:Used()
      ::oCodigoBarraArticulo:End()
   end

   if ::oArticulosEscandallos <> nil .AND. ::oArticulosEscandallos:Used()
      ::oArticulosEscandallos:End()
   end

   if ::oOferta <> nil .AND. ::oOferta:Used()
      ::oOferta:End()
   end

   if ::oFormaPago <> nil .AND. ::oFormaPago:Used()
      ::oFormaPago:End()
   end

   if ::oPropiedadesLinea <> nil .AND. ::oPropiedadesLinea:Used()
      ::oPropiedadesLinea:End()
   end

   if ::oFamilias <> nil .AND. ::oFamilias:Used()
      ::oFamilias:End()
   end

   if ::oAlbaranClienteCabecera <> nil .AND. ::oAlbaranClienteCabecera:Used()
      ::oAlbaranClienteCabecera:End()
   end

   if ::oAlbaranClienteLinea <> nil .AND. ::oAlbaranClienteLinea:Used()
      ::oAlbaranClienteLinea:End()
   end

   if ::oAlbaranClienteSerie <> nil .AND. ::oAlbaranClienteSerie:Used()
      ::oAlbaranClienteSerie:End()
   end

   if ::oAlbaranClientePago <> nil .AND. ::oAlbaranClientePago:Used()
      ::oAlbaranClientePago:End()
   end

   if ::oFacturaClienteCabecera <> nil .AND. ::oFacturaClienteCabecera:Used()
      ::oFacturaClienteCabecera:End()
   end

   if ::oFacturaClienteLinea <> nil .AND. ::oFacturaClienteLinea:Used()
      ::oFacturaClienteLinea:End()
   end

   if ::oFacturaClienteSerie <> nil .AND. ::oFacturaClienteSerie:Used()
      ::oFacturaClienteSerie:End()
   end

   if ::oFacturaClientePago <> nil .AND. ::oFacturaClientePago:Used()
      ::oFacturaClientePago:End()
   end

   if ::oAnticipoCliente <> nil .AND. ::oAnticipoCliente:Used()
      ::oAnticipoCliente:End()
   end

   if ::oObras <> nil .AND. ::oObras:Used()
      ::oObras:End()
   end

   if ::oAgentes <> nil .AND. ::oAgentes:Used()
      ::oAgentes:End()
   end

   if ::oRuta <> nil .AND. ::oRuta:Used()
      ::oRuta:End()
   end

   if ::oAlmacen <> nil .AND. ::oAlmacen:Used()
      ::oAlmacen:End()
   end

   if ::oArticuloDividido <> nil .AND. ::oArticuloDividido:Used()
      ::oArticuloDividido:End()
   end

   if ::oTarifaPrecioLinea <> nil .AND. ::oTarifaPrecioLinea:Used()
      ::oTarifaPrecioLinea:End()
   end

   if ::oTarifaPrecioLineaAgente <> nil .AND. ::oTarifaPrecioLineaAgente:Used()
      ::oTarifaPrecioLineaAgente:End()
   end

   if ::oDocument <> nil .AND. ::oDocument:Used()
      ::oDocument:End()
   end

   if ::oAtipicasCliente <> nil .AND. ::oAtipicasCliente:Used()
      ::oAtipicasCliente:End()
   end

   if ::oContadores <> nil .AND. ::oContadores:Used()
      ::oContadores:End()
   end

   if ::oTipoIVA <> nil .AND. ::oTipoIVA:Used()
      ::oTipoIVA:End()
   end

   if ::oDivisas <> nil .AND. ::oDivisas:Used()
      ::oDivisas:End()
   end

   if ::oFiltroPorUsuario <> nil .AND. ::oFiltroPorUsuario:Used()
      ::oFiltroPorUsuario:End()
   end

   if ::oComisionesAgentes <> nil .AND. ::oComisionesAgentes:Used()
      ::oComisionesAgentes:End()
   end

   if ::oEmpresa <> nil .AND. ::oEmpresa:Used()
      ::oEmpresa:End()
   end

   if ::oFactoresConversion <> nil .AND. ::oFactoresConversion:Used()
      ::oFactoresConversion:End()
   end

   if ::oPedidoClienteCabecera <> nil .AND. ::oPedidoClienteCabecera:Used()
      ::oPedidoClienteCabecera:End()
   end

   if ::oPedidoClienteLinea <> nil .AND. ::oPedidoClienteLinea:Used()
      ::oPedidoClienteLinea:End()
   end

   if ::oPedidoClienteEntregaCuenta <> nil .AND. ::oPedidoClienteEntregaCuenta:Used()
      ::oPedidoClienteEntregaCuenta:End()
   end

   if ::oPresupuestoClienteCabecera <> nil .AND. ::oPresupuestoClienteCabecera:Used()
      ::oPresupuestoClienteCabecera:End()
   end

   if ::oPresupuestoClienteLinea <> nil .AND. ::oPresupuestoClienteLinea:Used()
      ::oPresupuestoClienteLinea:End()
   end

   if ::oFacturaRectificativaCabecera <> nil .AND. ::oFacturaRectificativaCabecera:Used()
      ::oFacturaRectificativaCabecera:End()
   end

   if ::oFacturaRectificativaLinea <> nil .AND. ::oFacturaRectificativaLinea:Used()
      ::oFacturaRectificativaLinea:End()
   end

   if ::oFacturaRectificativaNumeroSerie <> nil .AND. ::oFacturaRectificativaNumeroSerie:Used()
      ::oFacturaRectificativaNumeroSerie:End()
   end

   if ::oAlbaranProveedorCabecera <> nil .AND. ::oAlbaranProveedorCabecera:Used()
      ::oAlbaranProveedorCabecera:End()
   end

   if ::oAlbaranProveedorLinea <> nil .AND. ::oAlbaranProveedorLinea:Used()
      ::oAlbaranProveedorLinea:End()
   end

   if ::oAlbaranProveedorNumeroSerie <> nil .AND. ::oAlbaranProveedorNumeroSerie:Used()
      ::oAlbaranProveedorNumeroSerie:End()
   end

   if ::oFacturaProveedorCabecera <> nil .AND. ::oFacturaProveedorCabecera:Used()
      ::oFacturaProveedorCabecera:End()
   end

   if ::oFacturaProveedorLinea <> nil .AND. ::oFacturaProveedorLinea:Used()
      ::oFacturaProveedorLinea:End()
   end

   if ::oFacturaProveedorNumeroSerie <> nil .AND. ::oFacturaProveedorNumeroSerie:Used()
      ::oFacturaProveedorNumeroSerie:End()
   end

   if ::oRectificativaProveedorCabecera <> nil .AND. ::oRectificativaProveedorCabecera:Used()
      ::oRectificativaProveedorCabecera:End()
   end

   if ::oRectificativaProveedorLinea <> nil .AND. ::oRectificativaProveedorLinea:Used()
      ::oRectificativaProveedorLinea:End()
   end

   if ::oRectificativaProveedorNumeroSerie <> nil .AND. ::oRectificativaProveedorNumeroSerie:Used()
      ::oRectificativaProveedorNumeroSerie:End()
   end

   if ::oMovimientosAlmacen <> nil .AND. ::oMovimientosAlmacen:Used()
      ::oMovimientosAlmacen:End()
   end

   if ::oMovimientosAlmacenNumeroSerie <> nil .AND. ::oMovimientosAlmacenNumeroSerie:Used()
      ::oMovimientosAlmacenNumeroSerie:End()
   end

   if ::oCategorias <> nil .AND. ::oCategorias:Used()
      ::oCategorias:End()
   end

   if ::oComentariosCabecera <> nil .AND. ::oComentariosCabecera:Used()
      ::oComentariosCabecera:End()
   end

   if ::oComentariosLinea <> nil .AND. ::oComentariosLinea:Used()
      ::oComentariosLinea:End()
   end

   if ::oTipoImpresoraComandas <> nil .AND. ::oTipoImpresoraComandas:Used()
      ::oTipoImpresoraComandas:End()
   end

   if ::oTemporadas <> nil .AND. ::oTemporadas:Used()
      ::oTemporadas:End()
   end

   if ::oParteProducionLinea <> nil .AND. ::oParteProducionLinea:Used()
      ::oParteProducionLinea:End()
   end

   if ::oMaterialesProducion <> nil .AND. ::oMaterialesProducion:Used()
      ::oMaterialesProducion:End()
   end

   if ::oMaterialesProducionSeries <> nil .AND. ::oMaterialesProducionSeries:Used()
      ::oMaterialesProducionSeries:End()
   end

   if ::oMaterialesNumeroSeries <> nil .AND. ::oMaterialesNumeroSeries:Used()
      ::oMaterialesNumeroSeries:End()
   end

   if !Empty( ::oCaptura )
      ::oCaptura:End()
   end

   if !Empty( ::oTComandas )
      ::oTComandas:End()
   end

   if !Empty( ::oBandera )
      ::oBandera:End()
   end

   if !Empty( ::oStock )
      ::oStock:end()
   end

   if !Empty( ::oNewImp )
      ::oNewImp:End()
   end

   if !Empty( ::oVisor )
      ::oVisor:End()
   end

   if !Empty( ::oImpresora )
      ::oImpresora:End()
   end

   if !Empty( ::oUndMedicion )
      ::oUndMedicion:end()
   end

   if !Empty( ::oRestaurante )
      ::oRestaurante:End()
   end

   if !Empty( ::oBalanza )
      ::oBalanza:End()
   end

   if !Empty( ::oInvitacion )
      ::oInvitacion:End()
   end

   if !Empty( ::oFideliza )
      ::oFideliza:End()
   end

   if !Empty( ::oTipArt )
      ::oTipArt:End()
   end

   if !Empty( ::oFabricante )
      ::oFabricante:End()
   end

   ::oTiketCabecera                          := nil
   ::oTiketLinea                             := nil
   ::oTiketCobro                             := nil
   ::oTiketMesa                              := nil
   ::oTiketNumeroSerie                       := nil
   ::oCliente                                := nil
   ::oCajaCabecera                           := nil
   ::oCajaLinea                              := nil
   ::oUsuario                                := nil
   ::oArticulo                               := nil
   ::oCodigoBarraArticulo                    := nil
   ::oArticulosEscandallos                   := nil
   ::oOferta                                 := nil
   ::oFormaPago                              := nil
   ::oPropiedadesLinea                       := nil
   ::oFamilias                               := nil
   ::oAlbaranClienteCabecera                 := nil
   ::oAlbaranClienteLinea                    := nil
   ::oAlbaranClienteSerie                    := nil
   ::oAlbaranClientePago                     := nil
   ::oFacturaClienteCabecera                 := nil
   ::oFacturaClienteLinea                    := nil
   ::oFacturaClienteSerie                    := nil
   ::oFacturaClientePago                     := nil
   ::oAnticipoCliente                        := nil
   ::oObras                                  := nil
   ::oAgentes                                := nil
   ::oRuta                                   := nil
   ::oAlmacen                                := nil
   ::oArticuloDividido                       := nil
   ::oTarifaPrecioLinea                      := nil
   ::oTarifaPrecioLineaAgente                := nil
   ::oDocument                               := nil
   ::oAtipicasCliente                        := nil
   ::oContadores                             := nil
   ::oTipoIVA                                := nil
   ::oDivisas                                := nil
   ::oFiltroPorUsuario                       := nil
   ::oComisionesAgentes                      := nil
   ::oEmpresa                                := nil
   ::oFactoresConversion                     := nil
   ::oPedidoClienteCabecera                  := nil
   ::oPedidoClienteLinea                     := nil
   ::oPedidoClienteEntregaCuenta             := nil
   ::oPresupuestoClienteCabecera             := nil
   ::oPresupuestoClienteLinea                := nil
   ::oFacturaRectificativaCabecera           := nil
   ::oFacturaRectificativaLinea              := nil
   ::oFacturaRectificativaNumeroSerie        := nil
   ::oAlbaranProveedorCabecera               := nil
   ::oAlbaranProveedorLinea                  := nil
   ::oAlbaranProveedorNumeroSerie            := nil
   ::oFacturaProveedorCabecera               := nil
   ::oFacturaProveedorLinea                  := nil
   ::oFacturaProveedorNumeroSerie            := nil
   ::oRectificativaProveedorCabecera         := nil
   ::oRectificativaProveedorLinea            := nil
   ::oRectificativaProveedorNumeroSerie      := nil
   ::oMovimientosAlmacen                     := nil
   ::oMovimientosAlmacenNumeroSerie          := nil
   ::oCategorias                             := nil
   ::oComentariosCabecera                    := nil
   ::oComentariosLinea                       := nil
   ::oTipoImpresoraComandas                  := nil
   ::oTemporadas                             := nil
   ::oParteProducionLinea                    := nil
   ::oMaterialesProducion                    := nil
   ::oMaterialesProducionSeries              := nil
   ::oMaterialesNumeroSeries                 := nil
   ::oCaptura                                := nil
   ::oTComandas                              := nil
   ::oBandera                                := nil
   ::oStock                                  := nil
   ::oNewImp                                 := nil
   ::oVisor                                  := nil
   ::oImpresora                              := nil
   ::oUndMedicion                            := nil
   ::oRestaurante                            := nil
   ::oBalanza                                := nil
   ::oInvitacion                             := nil
   ::oFideliza                               := nil
   ::oTipArt                                 := nil
   ::oFabricante                             := nil
   ::oOfficeBar                              := nil

Return .T.



UTILITY STATIC function TpvTactil_Resource() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   ::oDlg = TDialog():New(,,,,, ( ::cResource ),, .F.,,,,,, .F.,,,,,, .F., )





   ::oBrwFamilias                         := TXBrowse():New( ::oDlg )

   ::oBrwFamilias:lRecordSelector         := .F.
   ::oBrwFamilias:lHScroll                := .F.
   ::oBrwFamilias:lVScroll                := .T.
   ::oBrwFamilias:lHeader                 := .F.
   ::oBrwFamilias:lTransparent            := .F.
   ::oBrwFamilias:lAutoSort               := .F.
   ::oBrwFamilias:nDataLines              := 1
   ::oBrwFamilias:oFont                   := ::oFntBrw
   ::oBrwFamilias:nRowHeight              := 48

   ::oBrwFamilias:nMarqueeStyle           := 5

   ::oBrwFamilias:bClrSel                 := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }
   ::oBrwFamilias:bClrSelFocus            := {|| { 16777215, ( 53 + ( 142 * 256 ) + ( 182 * 65536 ) ) } }

   ::oBrwFamilias:bLClicked               := {|| ::oBrwFamilias:Refresh() }

   ::oBrwFamilias:bChange                 := {|| ::ChangeFamilias() }
   ::oBrwFamilias:bRClicked               := {|| ::EditFamilia() }

   ::oBrwFamilias:CreateFromResource( 300 )

   ::oBrwFamilias:SetArray( ::aFamilias, , , .F. )

   with object ( ::oBrwFamilias:AddCol() )
      :nEditType        := -1
      :lBmpStretch      := .T.
      :nDataBmpAlign    := 0
      :nWidth           := 48
      :bStrImage        := {|| ::aFamilias[ ::oBrwFamilias:nArrayAt, 4 ] }
   end

   with object ( ::oBrwFamilias:AddCol() )
      :bStrData         := {|| ::aFamilias[ ::oBrwFamilias:nArrayAt, 1 ] }
      :nWidth           := 260
      :nDataStrAlign    := 0
   end






   ::oBtnFamiliasUp     := TButtonBmp():ReDefine( 302, {|| ::oBrwFamilias:PageUp() },     ::oDlg, , , .F., , , , .F., "Navigate_up2" )
   ::oBtnFamiliasDown   := TButtonBmp():ReDefine( 303, {|| ::oBrwFamilias:PageDown() },   ::oDlg, , , .F., , , , .F., "Navigate_down2" )






   ::oLstArticulos               := C5ImageView():Redefine( 200, ::oDlg )
   ::oLstArticulos:oFont         := ::oFntBrw
   ::oLstArticulos:nWItem        := ::nImageViewWItem
   ::oLstArticulos:nHItem        := ::nImageViewHItem
   ::oLstArticulos:nVSep         := ::nImageViewVSep
   ::oLstArticulos:nHSep         := ::nImageViewHSep
   ::oLstArticulos:aTextMargin   := ::aImageViewTextMargin
   ::oLstArticulos:lTitle        := ::lImagenArticulos
   ::oLstArticulos:nHTitle       := ::nImageViewTitle
   ::oLstArticulos:lShowOption   := .F.
   ::oLstArticulos:lxVScroll     := .F.
   ::oLstArticulos:lxHScroll     := .F.
   ::oLstArticulos:lAdjust       := .F.
   ::oLstArticulos:nClrTextSel   := 0
   ::oLstArticulos:nClrPane      := 16777215
   ::oLstArticulos:nClrPaneSel   := 16777215
   ::oLstArticulos:nAlignText    := nOr( 0x00000000, 0x00000001, 0x00000010 )

   ::oLstArticulos:nOption       := 0
   ::oLstArticulos:bAction       := {|| ::SeleccionaArticulos() }
   ::oLstArticulos:bRClicked     := {|nRow, nCol| ::EditArticulo( nRow, nCol ) }

   if ::lImagenArticulos
      ::oLstArticulos:cAlphaBmp     := "Alpha"
      ::oLstArticulos:nAlphaLevel   := 150
   end





   ::oBtnArticulosPageUp         := TButtonBmp():ReDefine( 500, {|| ::oLstArticulos:PageUp() },    ::oDlg, , , .F., , , , .F., "Navigate_up2" )
   ::oBtnArticulosPageDown       := TButtonBmp():ReDefine( 501, {|| ::oLstArticulos:PageDown() },  ::oDlg, , , .F., , , , .F., "Navigate_down2" )
   ::oBtnAgregarLibre            := TButtonBmp():ReDefine( 502, {|| ::AgregarLibre() },            ::oDlg, , , .F., , , , .F., "Free_Bullet_32" )
   ::oBtnCombinado               := TButtonBmp():ReDefine( 503, {|| ::SetCombinando() },           ::oDlg, , , .F., , , , .F., "Cocktail_32" )
   ::oBtnCalculadora             := TButtonBmp():ReDefine( 504, {|| ::SetCalculadora() },          ::oDlg, , , .F., , , , .F., "Calculator_32" )









   ::oSayImporte := TSay():ReDefine( 210, {||   "Importe"}, ::oDlg,,,, .F., ::oFntDlg, .F., .F. )

   ::oSayImporte:lWantClick      := .T.
   ::oSayImporte:OnClick         := {|| ::OnClickCobro() }






   ::oTotalTicket := TSay():ReDefine( 240, {||   ::nTotalTicket}, ::oDlg, ::cPictureTotal,,, .F., ::oFntDlg, .F., .F. )

   ::oTotalTicket:lWantClick     := .T.
   ::oTotalTicket:OnClick        := {|| ::OnClickCobro() }





   ::oSayPrecioPersona := TSay():ReDefine( 260, {||   ::cSayPrecioPersona}, ::oDlg,,,, .F., ::oFntBrw, .F., .F. )





   ::oSayZona := TSay():ReDefine( 270, {||   ::cSayZona}, ::oDlg,,,, .F., ::oFntBrw, .F., .F. )

   ::oSayZona:lWantClick         := .T.
   ::oSayZona:OnClick            := {|| ::OnClickCambiaUbicacion() }





   ::oSayInfo := TSay():ReDefine( 280, {||   ::cSayInfo}, ::oDlg,,,, .F., ::oFntBrw, .F., .F. )

   ::oSayInfo:lWantClick         := .T.
   ::oSayInfo:OnClick            := {|| ::OnClickCambiaUbicacion() }





   ::oBrwLineas                        := IXBrowse():New( ::oDlg )

   ::oBrwLineas:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
   ::oBrwLineas:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

   ::oBrwLineas:nClrText               := {|| if( ::oTemporalLinea:lKitChl, 8421504, 0 ) }

   ::oBrwLineas:lRecordSelector        := .F.
   ::oBrwLineas:lHScroll               := .F.
   ::oBrwLineas:lVScroll               := .F.
   ::oBrwLineas:oFont                  := ::oFntBrw

   ::oBrwLineas:nMarqueeStyle          := 5
   ::oBrwLineas:nRowHeight             := 36
   ::oBrwLineas:cName                  := "Tactil.Lineas"

   ::oTemporalLinea:SetBrowse( ::oBrwLineas )

   ::oBrwLineas:CreateFromResource( 100 )

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Nº"
      :bEditValue             := {|| ::oTemporalLinea:nNumLin }
      :lHide                  := .T.
      :nWidth                 := 20
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Inv."
      :bStrData               := {|| "" }
      :lHide                  := .T.
      :bEditValue             := {|| !Empty( ::oTemporalLinea:cCodInv ) }
      :nWidth                 := 16
      :SetCheck( { "Sel16", "Nil16" } )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Prm."
      :bStrData               := {|| "" }
      :lHide                  := .T.
      :bEditValue             := {|| ::oTemporalLinea:lInPromo }
      :nWidth                 := 16
      :SetCheck( { "Star_Blue_16", "Nil16" } )
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Und"
      :bEditValue             := {|| ::nUnidadesLinea( ::oTemporalLinea, .T. ) }
      :nWidth                 := 50
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Factor"
      :bEditValue             := {|| Trans( ::oTemporalLinea:nFacCnv, "@EZ 999,999.999999" ) }
      :nWidth                 := 50
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
      :lHide                  := .T.
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Detalle"
      :bEditValue             := {|| ::cTextoLinea() }
      :nWidth                 := 200
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "%Dto"
      :bEditValue             := {|| Trans( ::oTemporalLinea:nDtoLin, "@EZ 999.99" ) }
      :lHide                  := .T.
      :nWidth                 := 45
   end

   with object ( ::oBrwLineas:AddCol() )
      :cHeader                := "Total"
      :bEditValue             := {|| ::nTotalLinea( ::oTemporalLinea, .T. ) }
      :nWidth                 := 60
      :nDataStrAlign          := 1
      :nHeadStrAlign          := 1
   end





   ::oBtnLineasTop            := TButtonBmp():ReDefine( 120, {|| ::oBrwLineas:GoUp() },    ::oDlg, , , .F., , , , .F., "Navigate_up" )
   ::oBtnLineasBottom         := TButtonBmp():ReDefine( 121, {|| ::oBrwLineas:GoDown() },  ::oDlg, , , .F., , , , .F., "Navigate_down" )
   ::oBtnLineasDelete         := TButtonBmp():ReDefine( 122, {|| ::EliminarLinea() },      ::oDlg, , , .F., , , , .F., "Garbage_Empty_32" )
   ::oBtnLineasComentarios    := TButtonBmp():ReDefine( 123, {|| ::InitComentarios() },    ::oDlg, , , .F., , , , .F., "Message_32" )
   ::oBtnLineasEscandallos    := TButtonBmp():ReDefine( 124, {|| ::lShowEscandallos() },   ::oDlg, , , .F., , , , .F., "Text_code_32" )














   ::oGetUnidades := TGetHlp():ReDefine( 600, { | u | If( PCount()==0, ::cGetUnidades, ::cGetUnidades:= u ) }, ::oDlg,,,,,, ::oFntEur,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )

   ::oGetUnidades:OnKeyDown   := {|| 0 }










   ::oBtnNum[ 1 ] := TButton():ReDefine( 101, {||( ::KeyChar( "1" ) )}, ::oDlg,,, .F.,,, "1", .F. )
   ::oBtnNum[ 1 ]:oFont   := ::oFntNum






   ::oBtnNum[ 2 ] := TButton():ReDefine( 102, {||( ::KeyChar( "2" ) )}, ::oDlg,,, .F.,,, "2", .F. )
   ::oBtnNum[ 2 ]:oFont   := ::oFntNum






   ::oBtnNum[ 3 ] := TButton():ReDefine( 103, {||( ::KeyChar( "3" ) )}, ::oDlg,,, .F.,,, "3", .F. )
   ::oBtnNum[ 3 ]:oFont   := ::oFntNum






   ::oBtnNum[ 4 ] := TButton():ReDefine( 104, {||( ::KeyChar( "4" ) )}, ::oDlg,,, .F.,,, "4", .F. )
   ::oBtnNum[ 4 ]:oFont   := ::oFntNum






   ::oBtnNum[ 5 ] := TButton():ReDefine( 105, {||( ::KeyChar( "5" ) )}, ::oDlg,,, .F.,,, "5", .F. )
   ::oBtnNum[ 5 ]:oFont   := ::oFntNum






   ::oBtnNum[ 6 ] := TButton():ReDefine( 106, {||( ::KeyChar( "6" ) )}, ::oDlg,,, .F.,,, "6", .F. )
   ::oBtnNum[ 6 ]:oFont   := ::oFntNum






   ::oBtnNum[ 7 ] := TButton():ReDefine( 107, {||( ::KeyChar( "7" ) )}, ::oDlg,,, .F.,,, "7", .F. )
   ::oBtnNum[ 7 ]:oFont   := ::oFntNum






   ::oBtnNum[ 8 ] := TButton():ReDefine( 108, {||( ::KeyChar( "8" ) )}, ::oDlg,,, .F.,,, "8", .F. )
   ::oBtnNum[ 8 ]:oFont   := ::oFntNum






   ::oBtnNum[ 9 ] := TButton():ReDefine( 109, {||( ::KeyChar( "9" ) )}, ::oDlg,,, .F.,,, "9", .F. )
   ::oBtnNum[ 9 ]:oFont   := ::oFntNum






   ::oBtnNum[ 10 ] := TButton():ReDefine( 110, {||( ::KeyChar( "0" ) )}, ::oDlg,,, .F.,,, "0", .F. )
   ::oBtnNum[ 10 ]:oFont  := ::oFntNum










   ::oBtnNum[ 11 ] := TButton():ReDefine( 111, {||( ::KeyChar( "." ) )}, ::oDlg,,, .F.,,, ",", .F. )
   ::oBtnNum[ 11 ]:oFont  := ::oFntNum










   ::oBtnNum[ 12 ] := TButton():ReDefine( 112, {||( ::KeyChar( "C" ) )}, ::oDlg,,, .F.,,, "C", .F. )
   ::oBtnNum[ 12 ]:oFont  := ::oFntNum










   ::oBtnNum[ 13 ] := TButton():ReDefine( 113, {||( ::KeyChar( "=" ) )}, ::oDlg,,, .F.,,, "=", .F. )
   ::oBtnNum[ 13 ]:oFont  := ::oFntNum










   ::oBtnNum[ 14 ] := TButton():ReDefine( 114, {||( ::KeyChar( "-" ) )}, ::oDlg,,, .F.,,, "-", .F. )
   ::oBtnNum[ 14 ]:oFont  := ::oFntNum










   ::oBtnNum[ 15 ] := TButton():ReDefine( 115, {||( ::KeyChar( "*" ) )}, ::oDlg,,, .F.,,, "x", .F. )
   ::oBtnNum[ 15 ]:oFont  := ::oFntNum





   ::oProgressBar             := TMeter():ReDefine( 400, { | u | If( pCount() == 0, ::nProgressBar, ::nProgressBar := u ) },, ::oDlg, .F.,,, .T., ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) ), , ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) ) )





   ::oDlg:bStart              := {|| ::StartResource() }

   ::oDlg:bResized            := {|| ::ResizedResource() }


   ::oDlg:OnKeyDown           := {| o, nKey, nFlag | ::oDlgKeyDown( o, nKey, nFlag ) }






   ::oDlg:Activate( , , , .T., {|| ::EndResource() } )

Return .T.



UTILITY STATIC function TpvTactil_StartResource() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBoton
   local oGrupo
   local oCarpeta
   local nLen                 := 126
   local nPos                 := 3

   CursorWait()

   if Empty( ::oOfficeBar )





      if uFieldEmpresa( "lLlevar" )
         nLen                 += 60
      end

      if uFieldEmpresa( "lRecoger" )
         nLen                 += 60
      end

      if uFieldEmpresa( "lEncargar" )
         nLen                 += 60
      end

      ::oOfficeBar            := TDotNetBar():New( 0, 0, 2020, 120, ::oDlg, 1 )

      ::oOfficeBar:lPaintAll  := .F.
      ::oOfficeBar:lDisenio   := .F.

      ::oOfficeBar:SetStyle( 1 )

      ::oDlg:oTop             := ::oOfficeBar

      oCarpeta                := TCarpeta():New( ::oOfficeBar, "TPV táctil" )





      ::oGrpSalones           := TDotNetGroup():New( oCarpeta, nLen, "Salones", .F., , "Cup_32" )
         ::oBtnSala           := TDotNetButton():New( 60, ::oGrpSalones, "Cup_32",                 "Mesas",        1, {|| ::OnClickSalaVenta() }, , , .F., .F., .F. )
         ::oBtnGeneral        := TDotNetButton():New( 60, ::oGrpSalones, "Cashier_32",             "General",      2, {|| ::OnClickGeneral() }, , , .F., .F., .F. )

         if uFieldEmpresa( "lRecoger" )
            ::oBtnRecoger     := TDotNetButton():New( 60, ::oGrpSalones, "shoppingbasket_full_32", "Para recoger", nPos++, {|| ::OnClickParaRecoger() }, , , .F., .F., .F. )
         end

         if uFieldEmpresa( "lLlevar" )
            ::oBtnLlevar      := TDotNetButton():New( 60, ::oGrpSalones, "Wheel_32",               "Para llevar",  nPos++, {|| ::OnClickParaLlevar() }, , , .F., .F., .F. )
         end

         if uFieldEmpresa( "lEncargar" )
            ::oBtnEncargar    := TDotNetButton():New( 60, ::oGrpSalones, "address_book2_32",       "Encargar",     nPos++, {|| ::OnClickEncargar() }, , , .F., .F., .F. )
         end

      oGrupo                     := TDotNetGroup():New( oCarpeta, 226, "Datos de cliente", .F., , "User1_32" )
         ::oBtnCliente           := TDotNetButton():New( 220, oGrupo, "User1_16",                     "...",             1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )
         ::oBtnDireccion         := TDotNetButton():New( 220, oGrupo, "Home_16",                      "...",             1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )
         ::oBtnTelefono          := TDotNetButton():New( 220, oGrupo, "Mobilephone3_16",              "...",             1, {|| ::SelecionaCliente() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Nota", .F., , "Printer_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Printer_32",                    "Entregar nota",   1, {|| ::OnClickEntrega() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Cobrar", .F., , "Money2_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Money2_32",                     "Cobrar",          1, {|| ::OnClickCobro() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Cajón", .F., , "Diskdrive_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Diskdrive_32",                  "Abrir cajón",     1, {|| oUser():OpenCajon() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Comanda", .F., , "Printer_comanda_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Printer_comanda_32",            "Copia comanda",   1, {|| ::OnClickCopiaComanda( .T. ) }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Comensales", .F., , "Users1_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Users1_32",                     "Comensales",      1, {|| ::OnClickComensales() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 126, "Tickets", .F., , "Index_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Tickets_pendientes_32",         "Pendientes",      1, {|| ::OnClickSalaVenta() }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Index_32",                      "Lista",           2, {|| ::OnClickLista() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 126, "Invitaciones", .F., , "Masks_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Percent_32",                    "Descuentos",      1, {|| ::OnClickDescuento() }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Masks_32",                      "Invitaciones",    2, {|| ::OnClickInvitacion() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Usuario", .F., , "Security_Agent_32" )
         ::oBtnUsuario           := TDotNetButton():New( 60, oGrupo, "Security_Agent_32",             Capitalize( Rtrim( oUser():cNombre() ) ), 1, {|| ::OnClickUsuarios() }, , , .F., .F., .F. )







      oGrupo                     := TDotNetGroup():New( oCarpeta, 186, "Otros", .F., , "Cashier_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Media_stop_replace2_32",        "Cambiar ubicación", 1, {|| ::OnClickCambiaUbicacion() }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Cashier_32",                    "Seleccionar cajas", 2, {|| ::OnClickSeleccionarCajas() }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Cashier_replace_32",            "Entrada y salida",  3, {|| ::OnclickEntrdaSalida() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 186, "Arqueos/Sesiones", .F., , "Stopwatch_stop_32" )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Stopwatch_refresh_32",          "Arqueo parcial [X]",   1, {|| ::OnClickCloseTurno( .T. ) }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Stopwatch_stop_32",             "Arqueo total [Z]",     2, {|| ::OnClickCloseTurno( .F. ) }, , , .F., .F., .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "Stopwatch_run_32",              "Iniciar sesión",       3, {|| ::OnClickIniciarSesion() }, , , .F., .F., .F. )

      oGrupo                     := TDotNetGroup():New( oCarpeta, 66, "Salida", .F. )
         oBoton                  := TDotNetButton():New( 60, oGrupo, "End32",                         "Salida",            1, {|| ::oDlg:End() }, , , .F., .F., .F. )




























   end





   if !Empty( ::oBtnGeneral )
      ::oBtnGeneral:bRAction  := {|| ::OnClickSalaVenta( 0 ) }
   end

   if !Empty( ::oBtnLlevar )
      ::oBtnLlevar:bRAction   := {|| ::OnClickSalaVenta( 1 ) }
   end

   if !Empty( ::oBtnSala )
      ::oBtnSala:bRAction     := {|| ::OnClickSalaVenta( 2 ) }
   end

   if !Empty( ::oBtnRecoger )
      ::oBtnRecoger:bRAction  := {|| ::OnClickSalaVenta( 3 ) }
   end

   if !Empty( ::oBtnEncargar )
      ::oBtnEncargar:bRAction := {|| ::OnClickSalaVenta( 4 ) }
   end





   ::nDialogWidth          := ::oDlg:nWidth()
   ::nDialogHeight         := ::oDlg:nHeight()





   ::oBrwLineas:Load()





   ::CargaFavoritos()





   ::SetCliente()





   ::SetUbicacion()





   ::SetInfo()





   ::ChangeFamilias()





   ::oDlg:Maximize()

   CursorWE()





   ::GetUsuario()





   ::GetUbicacion()







Return ( nil )



UTILITY STATIC function TpvTactil_ResizedResource() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nDialogWidth
   local nDialogHeight





   ::oDlg:CoorsUpdate()

   nDialogWidth            := ( ::oDlg:nWidth() - ::nDialogWidth )
   nDialogHeight           := ( ::oDlg:nHeight() - ::nDialogHeight )





   ::oBrwLineas:Move( , , , ::oBrwLineas:nHeight() + nDialogHeight, .F. )

   ::oSayImporte:Move( ::oSayImporte:nTop + nDialogHeight, , , , .F. )
   ::oTotalTicket:Move( ::oTotalTicket:nTop + nDialogHeight, , , , .F. )
   ::oSayPrecioPersona:Move( ::oSayPrecioPersona:nTop + nDialogHeight, , , , .F. )

   ::oSayInfo:Move( ::oSayInfo:nTop + nDialogHeight, , , , .F. )
   ::oSayZona:Move( ::oSayZona:nTop + nDialogHeight, , , , .F. )

   ::oBtnLineasTop:Move( ::oBtnLineasTop:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasBottom:Move( ::oBtnLineasBottom:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasDelete:Move( ::oBtnLineasDelete:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasComentarios:Move( ::oBtnLineasComentarios:nTop + nDialogHeight, , , , .F. )
   ::oBtnLineasEscandallos:Move( ::oBtnLineasEscandallos:nTop + nDialogHeight, , , , .F. )

   ::oBtnArticulosPageUp:Move( ::oBtnArticulosPageUp:nTop + nDialogHeight, , , , .F. )
   ::oBtnArticulosPageDown:Move( ::oBtnArticulosPageDown:nTop + nDialogHeight, , , , .F. )

   ::oBtnAgregarLibre:Move( ::oBtnAgregarLibre:nTop + nDialogHeight, ::oBtnAgregarLibre:nLeft + nDialogWidth, , , .F. )
   ::oBtnCombinado:Move( ::oBtnCombinado:nTop + nDialogHeight, ::oBtnCombinado:nLeft + nDialogWidth, , , .F. )
   ::oBtnCalculadora:Move( ::oBtnCalculadora:nTop + nDialogHeight, ::oBtnCalculadora:nLeft + nDialogWidth, , , .F. )





   ::oLstArticulos:Move( , , ::oLstArticulos:nWidth() + nDialogWidth, ::oLstArticulos:nHeight() + nDialogHeight, .F. )





   ::oBrwFamilias:Move( , ::oBrwFamilias:nLeft + nDialogWidth, , ::oBrwFamilias:nHeight() + nDialogHeight, .F. )

   ::oBtnFamiliasUp:Move( ::oBtnFamiliasUp:nTop + nDialogHeight, ::oBtnFamiliasUp:nLeft + nDialogWidth, , , .F. )
   ::oBtnFamiliasDown:Move( ::oBtnFamiliasDown:nTop + nDialogHeight, ::oBtnFamiliasDown:nLeft + nDialogWidth, , , .F. )

   ::oGetUnidades:Move( ::oGetUnidades:nTop + nDialogHeight, ::oGetUnidades:nLeft + nDialogWidth, , , .F. )

   aEval( ::oBtnNum, {|o| o:Move( o:nTop + nDialogHeight, o:nLeft + nDialogWidth, , , .F. ) } )

   ::oProgressBar:Move( ::oProgressBar:nTop + nDialogHeight, , ::oProgressBar:nWidth() + nDialogWidth, , .F. )

   ::oDlg:Refresh()





   ::nDialogWidth          := ::oDlg:nWidth()
   ::nDialogHeight         := ::oDlg:nHeight()

Return ( nil )



UTILITY STATIC function TpvTactil_EndResource() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lEnd           := .T.

   if !::lKillResource

      if ( !::lEmptyDocumento() .OR. ::lAlone )
         lEnd           := ApoloMsgNoYes( "¿ Desea salir del TPV táctil ?", "Atención", .T. )
      end

   end

   if lEnd
      ::End()
   end

Return ( lEnd )



UTILITY STATIC function TpvTactil_PaintResource() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ArtBeep()



Return ( Self )



UTILITY STATIC function TpvTactil_CargaArticulos() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oBmp
   local nUser          := 0
   local nRecArt        := ::oArticulo:Recno()
   local aTctFam
   local nItemFamilia   := nil
   local nImg           := -1

   if !Empty( ::oImgArticulos ) .AND. !Empty( ::oLstArticulos )

      ::oLstArticulos:SetImageList( ::oImgArticulos )

      ::oLstArticulos:EnableGroupView()

      ::oLstArticulos:SetIconSpacing( 90, 135 )





      for each aTctFam in ::aFamilias()
         ::oLstArticulos:InsertGroup( aTctFam[3], aTctFam[1] )
      next

      ::oArticulo:GoTop()

      while !::oArticulo:Eof()

         nItemFamilia      := aScan( ::aFamilias, {|a| a[2] == ::oArticulo:Familia } )

         if nItemFamilia <> 0 .AND. ::oArticulo:lIncTcl

            oBmp           := TBitmap():Define( , Rtrim( ::cFileBmpName( ::oArticulo:cImagen, .T. ) ) )

            ::oImgArticulos:Add( oBmp )

            nImg++

            ::oLstArticulos:aAddItemGroup( nImg, AllTrim( Capitalize( ::oArticulo:Nombre ) ), ::aFamilias[ nItemFamilia, 3 ] )

         end

         ::oArticulo:Skip()

      end

   end

   ::oArticulo:GoTo( nRecArt )

RETURN ( .T. )



UTILITY STATIC function TpvTactil_SeleccionaArticulos() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nOpt

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      Return ( .T. )
   end

   if !Empty( ::oLstArticulos )

      nOpt     := ::oLstArticulos:nOption

      if Empty( nOpt )
         MsgStop( "Seleccione un artículo" )
         Return .F.
      end

      nOpt     := Max( Min( nOpt, len( ::oLstArticulos:aItems ) ), 1 )

      if nOpt > 0 .AND. nOpt <= len( ::oLstArticulos:aItems )
         ::AgregarLineas( ::oLstArticulos:aItems[ nOpt ]:Cargo )
      end

   end



Return ( .T. )



UTILITY STATIC function TpvTactil_SeleccionaFavoritos() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nOpt

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      Return ( .T. )
   end

   if !Empty( ::oLstFavoritos )

      nOpt        := ::oLstFavoritos:nOption

      if Empty( nOpt )
         MsgStop( "Seleccione un favorito" )
         Return .F.
      end

      nOpt        := Max( Min( nOpt, len( ::oLstFavoritos:aItems ) ), 1 )

      if nOpt > 0 .AND. nOpt <= len( ::oLstFavoritos:aItems )
         ::AgregarLineas( ::oLstFavoritos:aItems[ nOpt ]:Cargo )
      end

   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

Return ( .T. )



UTILITY STATIC function TpvTactil_AgregarLibre() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oGetDescripcion
   local oGetUnidades
   local oGetImporte
   local oGetImpresora

   ::cGetDescripcion          := Space( 100 )
   ::nGetUnidades             := 1
   ::nGetImporte              := 0
   ::cGetImpresora            := Space( 254 )

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      Return ( .T. )
   end

   oDlg = TDialog():New(,,,,, "Libre",, .F.,,,,,, .F.,,,,,, .F., )




      oGetDescripcion := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cGetDescripcion, ::cGetDescripcion:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 110, {||( VirtualKey( .F., oGetDescripcion ) )}, oDlg,,, .F.,,,, .F., "Keyboard2_32",, )





      oGetUnidades := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::nGetUnidades, ::nGetUnidades:= u ) }, oDlg,, ::cPictureUnidades,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 130, {||( Calculadora( 0, oGetUnidades ) )}, oDlg,,, .F.,,,, .F., "Calculator_32",, )





      oGetImporte := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, ::nGetImporte, ::nGetImporte:= u ) }, oDlg,, ::cPictureTotal,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 150, {||( Calculadora( 0, oGetImporte ) )}, oDlg,,, .F.,,,, .F., "Calculator_32",, )




      oGetImpresora := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::cGetImpresora, ::cGetImpresora:= u ) }, oDlg,,,,,,,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 170, {||( BrwTipoImpresora( oGetImpresora, .T. ) )}, oDlg,,, .F.,,,, .F., "Lupa_32",, )





      TButtonBmp():ReDefine( 1, {||( ::ValidarAgregarLibre( oGetDescripcion, oDlg ) )}, oDlg,,, .F.,,,, .F., "Check_32",, )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",, )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if ( oDlg:nResult == 1 )

      ::AgregarLineasLibres()

      if !Empty( ::oBrwLineas )
         ::oBrwLineas:Refresh()
      end

   end

   ::oGetUnidades:SetFocus()

Return ( oDlg:nResult == 1 )



UTILITY STATIC function TpvTactil_ValidarAgregarLibre( oGetDescripcion, oDlg) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( oGetDescripcion:VarGet() )
      MsgStop( "Descripción no puede estar vacia" )
      Return .F.
   end

   oDlg:End( 1 )

Return .T.



UTILITY STATIC function TpvTactil_CargaBrowseFamilias() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::oFamilias )
      Return .T.
   end





   ::aFamilias          := {}





   aAdd( ::aFamilias, { "Favoritos", nil, ::CargaFavoritos(), "Star_Red_Alpha_48" } )





   ::oFamilias:GetStatus()
   ::oFamilias:OrdSetFocus( "nPosTpv" )

   ::oFamilias:GoTop()
   while !::oFamilias:Eof()

      aAdd( ::aFamilias, { Capitalize( AllTrim( ::oFamilias:cNomFam ) ), ::oFamilias:cCodFam, ::CargaArticulosFamilia(), cFileBmpName( ::oFamilias:cImgBtn ) } )

      ::oFamilias:Skip()

   end

   ::oFamilias:SetStatus()

Return .T.



UTILITY STATIC function TpvTactil_CargaArticulosFamilia( cCodFam, nColBtn) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aItems                  := {}

   ::oArticulo:GetStatus()

   if uFieldEmpresa( "lOrdNomTpv" )
      ::oArticulo:OrdSetFocus( "nNomTpv" )
   else
      ::oArticulo:OrdSetFocus( "nPosTpv" )
   end

   if ::oArticulo:Seek( ::oFamilias:cCodFam )

      while ( ::oArticulo:Familia == ::oFamilias:cCodFam ) .AND. !::oArticulo:Eof()

         if !::oArticulo:lObs

            with object ( C5ImageViewItem() )

               :cText            := AllTrim( Capitalize( ::oArticulo:Nombre ) )

               if ( ::lImagenArticulos ) .AND. ( ::lFileBmpName( ::oArticulo:cImagen ) )

                  :cImage        := ::cFileBmpName( ::oArticulo:cImagen )

               else

                  if ::oFamilias:nColBtn == ( 255 + ( 255 * 256 ) + ( 255 * 65536 ) )
                     :nClrPane   := GetSysColor( 15 )
                  else
                     :nClrPane   := ::oFamilias:nColBtn
                  end

               end

               :Cargo            := ::oArticulo:Codigo

               :Add( aItems )

            end

         end

         ::oArticulo:Skip()

      end

   end

   ::oArticulo:SetStatus()

Return ( aItems )



UTILITY STATIC function TpvTactil_CargaFavoritos() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aItems               := {}
   local nCount               := 1

   if Empty( ::oArticulo )
      Return ( aItems )
   end

   ::oArticulo:GetStatus()
   ::oArticulo:OrdSetFocus( "nPosTcl" )

   ::oArticulo:GoTop()





   ::oArticulo:GoTop()
   while nCount < 50 .AND. !::oArticulo:Eof()

      if ::oArticulo:lIncTcl .AND. !::oArticulo:lObs

         with object ( C5ImageViewItem() )

            :cText         := AllTrim( Capitalize( ::oArticulo:Nombre ) )

            if ( ::lImagenArticulos ) .AND. ( ::lFileBmpName( ::oArticulo:cImagen ) )
               :cImage     := ::cFileBmpName( ::oArticulo:cImagen )
            else
               :nClrPane   := oRetFld( ::oArticulo:Familia, ::oFamilias, "nColBtn", "cCodFam" )
            end

            :Cargo         := ::oArticulo:Codigo

            :Add( aItems )

         end

      end

      ::oArticulo:Skip()

      nCount ++

   end

   ::oArticulo:SetStatus()

Return ( aItems )



UTILITY STATIC function TpvTactil_ChangeFamilias() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nAt
   local aRow

   if !Empty( ::oBrwFamilias ) .AND. !Empty( ::oLstArticulos )

      aRow     := ::oBrwFamilias:aRow

      if !Empty( aRow )
         ::oLstArticulos:SetItems( aRow[ 3 ] )
      end









   end

Return .T.



UTILITY STATIC function TpvTactil_SetFamilia( cCodigoFamilia) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nAt

   CursorWait()

   if !Empty( ::oBrwFamilias ) .AND. !Empty( ::oLstArticulos )

      nAt                        := aScan( ::aFamilias, {|a| a[ 2 ] == cCodigoFamilia } )

      if nAt > 0 .AND. nAt <= len( ::aFamilias )

         ::oBrwFamilias:nArrayAt := nAt
         ::oBrwFamilias:Refresh()

         ::oLstArticulos:SetItems( ::aFamilias[ nAt, 3 ] )

      end

   end

   CursorWE()

Return .T.



UTILITY STATIC function TpvTactil_KeyChar( cKey) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      RETURN ( .T. )
   end

   do case
      case At( cKey, "0123456789" ) > 0
         ::cGetUnidades     += cKey

      case cKey == "." .AND. !( At( ".", ::cGetUnidades ) > 0 )
         ::cGetUnidades     += cKey

      case cKey == "-"

         if !( At( "-", ::cGetUnidades ) > 0 )
            ::cGetUnidades  := cKey + ::cGetUnidades
         else
            ::cGetUnidades  := StrTran( ::cGetUnidades, "-", "" )
         end

      case cKey == "C"
         ::cGetUnidades     := ""





      case cKey == "*"

         ::MultiplicarLineas()





      case cKey == "="

         ::CambiarPrecio()

   end

   ::oGetUnidades:cText( AllTrim ( ::cGetUnidades ) )

   ::TotalTemporal()

Return ( nil )



UTILITY STATIC function TpvTactil_oDlgKeyDown( o, nKey, nFlag) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   do case
      case ( nKey == 96 )
         ::KeyChar( Chr( 48 ) )

      case ( nKey == 97 )
         ::KeyChar( Chr( 49 ) )

      case ( nKey == 98 )
         ::KeyChar( Chr( 50 ) )

      case ( nKey == 99 )
         ::KeyChar( Chr( 51 ) )

      case ( nKey == 100 )
         ::KeyChar( Chr( 52 ) )

      case ( nKey == 101 )
         ::KeyChar( Chr( 53 ) )

      case ( nKey == 102 )
         ::KeyChar( Chr( 54 ) )

      case ( nKey == 103 )
         ::KeyChar( Chr( 55 ) )

      case ( nKey == 104 )
         ::KeyChar( Chr( 56 ) )

      case ( nKey == 105 )
         ::KeyChar( Chr( 57 ) )

      case ( nKey == 106 )
         ::KeyChar( Chr( 42 ) )

      case ( nKey == 13 )
         ::AgregarPLU()

      case ( nKey == 16 )
         ::CambiarPrecio()

      case ( nKey == 67 )
         ::KeyChar( "C" )

      case ( nKey == 109 .OR. nKey == 189 )
         ::MultiplicarLineas( -1 )

      case ( nKey == 107 .OR. nKey == 187 )
         ::MultiplicarLineas( 1 )

      case ( nKey == 110 .OR. nKey == 190 )
         ::KeyChar( "." )

      otherwise
         ::KeyChar( Chr( nKey ) )

   end

Return ( 0 )



UTILITY STATIC function TpvTactil_CreateTemporal() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local aFieldCol





   ::cTemporalLinea        := cGetNewFileName( cPatTmp() + "TikL" )

   ::oTemporalLinea := DbfServer( ( ::cTemporalLinea ), "TikL" ):New( ( ::cTemporalLinea ), "TikL", ( cLocalDriver() ), "Lineas ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalLinea:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next

      ::oTemporalLinea:AddIndex( "nRecNum", ( ::cTemporalLinea ), "Str( Recno() )", "!Deleted() .and. !Field->lKitChl",, .F., .F., "Recno",,, .F., .F. )
      ::oTemporalLinea:AddIndex( "lRecNum", ( ::cTemporalLinea ), "Str( Recno() )",,, .F., .F., "Recno",,, .T., .F. )
      ::oTemporalLinea:AddIndex( "cCbaTil", ( ::cTemporalLinea ), "Field->cCbaTil",,, .F., .F., "Código",,, .T., .F. )
      ::oTemporalLinea:AddIndex( "nNumLin", ( ::cTemporalLinea ), "Str( Field->nNumLin )",,, .F., .F., "Linea",,, .T., .F. )



   ::oTemporalLinea:Activate( .F., .F. )





   ::cTemporalComanda      := cGetNewFileName( cPatTmp() + "TikC" )

   ::oTemporalComanda := DbfServer( ( ::cTemporalComanda ), "TikC" ):New( ( ::cTemporalComanda ), "TikC", ( cLocalDriver() ), "Comandas ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aColTik()
         ::oTemporalComanda:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], aFieldCol[ 6 ], , , , aFieldCol[ 5 ] )
      next

      ::oTemporalComanda:AddIndex( ( Str( ::oTemporalComanda:Recno() ) ), ( ::cTemporalComanda ), ( Str( ::oTemporalComanda:Recno() ) ),,, .F., .F., "Orden",,, .T., .F. )



   ::oTemporalComanda:Activate( .F., .F. )





   ::cTemporalCobro         := cGetNewFileName( cPatTmp() + "TikP" )

   ::oTemporalCobro := DbfServer( ( ::cTemporalCobro ), "TikP" ):New( ( ::cTemporalCobro ), "TikP", ( cLocalDriver() ), "Pagos de ticket cliente", ( cPatTmp() ) )

      for each aFieldCol in aPgoTik()
         ::oTemporalCobro:AddField( aFieldCol[ 1 ], aFieldCol[ 2 ], aFieldCol[ 3 ], aFieldCol[ 4 ], "", , , , aFieldCol[ 5 ] )
      next

      ::oTemporalCobro:AddIndex( ( Str( ::oTemporalCobro:Recno() ) ), ( ::cTemporalCobro ), ( Str( ::oTemporalCobro:Recno() ) ),,, .F., .F., "Orden",,, .T., .F. )




   ::oTemporalCobro:Activate( .F., .F. )

 RETURN .T.



UTILITY STATIC function TpvTactil_DestroyTemporal() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oTemporalLinea <> nil .AND. ::oTemporalLinea:Used()
      ::oTemporalLinea:End()
   end

   ::oTemporalLinea         := nil

   dbfErase( ::cTemporalLinea )

   if ::oTemporalComanda <> nil .AND. ::oTemporalComanda:Used()
      ::oTemporalComanda:End()
   end

   ::oTemporalComanda       := nil

   dbfErase( ::cTemporalComanda )

   if ::oTemporalCobro <> nil .AND. ::oTemporalCobro:Used()
      ::oTemporalCobro:End()
   end

   ::oTemporalCobro         := nil

   dbfErase( ::cTemporalCobro )

 Return .T.



UTILITY STATIC function TpvTactil_cFileBmpName( cFile, lEmptyImage) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   IIF( lEmptyImage == nil, lEmptyImage := .F., ) ;

   if At( ":", cFile ) == 0 .AND. !Empty( cPatImg() )
      cFile             := Rtrim( cPatImg() ) + Rtrim( cFile )
   else
      cFile             := Rtrim( cFile )
   end

RETURN ( cFile )



UTILITY STATIC function TpvTactil_AgregarLineas( cCodigoArticulo) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if ::oArticulo:Seek( cCodigoArticulo )





      if !::lCombinando

         if !::lAcumulaArticulo()

            CursorWait()

            ::nNumeroLinea                := nLastNum( ::oTemporalLinea )

            ::oTemporalLinea:Append()
            ::oTemporalLinea:Blank()

            ::oTemporalLinea:nNumLin      := ::nNumeroLinea
            ::oTemporalLinea:cCbaTil      := ::oArticulo:Codigo
            ::oTemporalLinea:cNomTil      := if( !Empty( ::oArticulo:cDesTik ), ::oArticulo:cDesTik, ::oArticulo:Nombre )
            ::oTemporalLinea:nCosDiv      := nCosto( ::oArticulo:Codigo, ::oArticulo:cAlias, ::oArticulosEscandallos:cAlias )
            ::oTemporalLinea:cLote        := ::oArticulo:cLote
            ::oTemporalLinea:cCodFam      := ::oArticulo:Familia
            ::oTemporalLinea:cFamTil      := ::oArticulo:Familia
            ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock
            ::oTemporalLinea:nUntTil      := 1

            if ( ::oArticulo:lFacCnv )
               ::oTemporalLinea:nFacCnv   := NotCero( ::oArticulo:nFacCnv )
            end

            ::oTemporalLinea:nPvpTil      := cRetPreArt( ::oArticulo:Codigo, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
            ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )
            ::oTemporalLinea:cAlmLin      := oUser():cAlmacen()
            ::oTemporalLinea:cImpCom1     := ::oArticulo:cTipImp1
            ::oTemporalLinea:cImpCom2     := ::oArticulo:cTipImp2
            ::oTemporalLinea:cComent      := ""

            ::oTemporalLinea:lInPromo     := ::oFideliza:InPrograma( ::oArticulo:Codigo, ::oTiketCabecera:dFecTik, ::oArticulo )

            ::oTemporalLinea:Save()





            ::AgregarKit( cCodigoArticulo )

            CursorWE()

            if oRetFld( ::oTemporalLinea:cCodFam, ::oFamilias, "lMostrar", "cCodFam" )
               ::InitComentarios()
            end

         end

      else

         CursorWait()

         ::oTemporalLinea:Load()

         ::oTemporalLinea:cComTil      := ::oArticulo:Codigo
         ::oTemporalLinea:cNcmTil      := if( !Empty( ::oArticulo:cDesTik ), ::oArticulo:cDesTik, ::oArticulo:Nombre )
         ::oTemporalLinea:cFcmTil      := ::oArticulo:Familia
         if ( ::oArticulo:lFacCnv )
            ::oTemporalLinea:nFcmCnv   := NotCero( ::oArticulo:nFacCnv )
         end
         ::oTemporalLinea:nPcmTil      := cRetPreArt( ::oArticulo:Codigo,        ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
         ::oTemporalLinea:nPvpTil      := cRetPreArt( ::oTemporalLinea:cCbaTil,  ::nTarifaCombinado, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
         ::oTemporalLinea:nCosTil      := ::oArticulo:pCosto

         ::oTemporalLinea:Save()

         ::SetCombinando( .F. )

         CursorWE()

      end

      ::oBrwLineas:Refresh()

      ::TotalTemporal()

   else

      Return ( .F. )

   end


Return ( .T. )



UTILITY STATIC function TpvTactil_lAcumulaArticulo() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lReturn        := .F.
   local cOrdSetFocus
   local nPrecioLinea

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      Return ( .F. )
   end





   if oRetFld( ::oArticulo:Familia, ::oFamilias, "lAcum", "cCodFam" )
      Return .F.
   end

   CursorWait()





   cOrdSetFocus         := ::oTemporalLinea:OrdSetFocus( "cCbaTil" )

   if ::oTemporalLinea:Seek( ::oArticulo:Codigo )

      while ( ::oTemporalLinea:cCbaTil == ::oArticulo:Codigo ) .AND. !( ::oTemporalLinea:Eof() )

         nPrecioLinea   := cRetPreArt( ::oArticulo:Codigo, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )















         if Empty( ::oTemporalLinea:cComTil )                              .AND.  !::oTemporalLinea:lKitChl                                      .AND.  ::oTemporalLinea:nPvpTil == nPrecioLinea                       .AND.  ::oTemporalLinea:nDtoLin == 0                                  .AND.  Empty( ::oTemporalLinea:cComent )                              .AND.  Rtrim( ::oTemporalLinea:cNomTil ) == Rtrim( ::oArticulo:Nombre )





            ::MultiplicarLineas( 1 )





            lReturn  := .T.

            exit

         end

         ::oTemporalLinea:Skip()

      end

   end

   ::oTemporalLinea:OrdSetFocus( cOrdSetFocus )

   CursorWE()

   ::oBrwLineas:Refresh()

Return ( lReturn )



UTILITY STATIC function TpvTactil_AgregarKit( cCodigoArticulo) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if ::oArticulosEscandallos:Seek( cCodigoArticulo )

      ::oTemporalLinea:GetStatus()

      while ( ::oArticulosEscandallos:cCodKit == cCodigoArticulo ) .AND. !( ::oArticulosEscandallos:eof() )

         if ::oArticulo:Seek( ::oArticulosEscandallos:cRefKit )

            ::oTemporalLinea:Append()
            ::oTemporalLinea:Blank()

            ::oTemporalLinea:cCbaTil      := ::oArticulo:Codigo
            ::oTemporalLinea:cNomTil      := if( !Empty( ::oArticulo:cDesTik ), ::oArticulo:cDesTik, ::oArticulo:Nombre )
            ::oTemporalLinea:nCosDiv      := ::oArticulo:pCosto
            ::oTemporalLinea:cLote        := ::oArticulo:cLote
            ::oTemporalLinea:cCodFam      := ::oArticulo:Familia
            ::oTemporalLinea:cFamTil      := ::oArticulo:Familia
            ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock
            ::oTemporalLinea:nUntTil      := ::oArticulosEscandallos:nUndKit

            if ( ::oArticulo:lFacCnv )
               ::oTemporalLinea:nFacCnv   := NotCero( ::oArticulo:nFacCnv )
            end

            ::oTemporalLinea:nIvaTil      := nIva( ::oTipoIva, ::oArticulo:TipoIva )
            ::oTemporalLinea:cAlmLin      := oUser():cAlmacen()
            ::oTemporalLinea:cImpCom1     := ::oArticulo:cTipImp1
            ::oTemporalLinea:cImpCom2     := ::oArticulo:cTipImp2
            ::oTemporalLinea:cComent      := ""

            ::oTemporalLinea:lInPromo     := ::oFideliza:InPrograma( ::oArticulo:Codigo, ::oTiketCabecera:dFecTik, ::oArticulo )





            ::oTemporalLinea:lKitChl      := !lKitAsociado( ::oArticulo:Codigo, ::oArticulo )
            ::oTemporalLinea:lImpLin      := lImprimirComponente( ::oArticulo:Codigo, ::oArticulo )
            ::oTemporalLinea:lKitPrc      := lPreciosComponentes( ::oArticulo:Codigo, ::oArticulo )





            if ::oTemporalLinea:lKitChl
               ::oTemporalLinea:nNumLin   := ::nNumeroLinea
            else
               ::nNumeroLinea             := nLastNum( ::oTemporalLinea )
            end





            if ::oTemporalLinea:lKitPrc
               ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oArticulo:Codigo, ::nTarifaSolo, cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
            end





            ::oTemporalLinea:nCtlStk      := ::oArticulo:nCtlStock

            ::oTemporalLinea:Save()







         end

         ::oArticulosEscandallos:Skip()

      end

      ::oTemporalLinea:SetStatus()

   end

Return ( .T. )



UTILITY STATIC function TpvTactil_MultiplicarLineas( nNuevasUnidades) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nNumeroLinea
   local nUnidadesAnterior
   local nUnidadesActuales

   if ( ::oTemporalLinea:ordKeyCount() == 0 )
      Return ( .T. )
   end

   if IsNum( nNuevasUnidades )
      nUnidadesActuales                := ::oTemporalLinea:nUntTil + nNuevasUnidades
   else
      nUnidadesActuales                := Val( ::cGetUnidades )
   end

   if !Empty( nUnidadesActuales )



      nNumeroLinea                     := ::oTemporalLinea:nNumLin
      nUnidadesAnterior                := ::oTemporalLinea:nUntTil

      ::oTemporalLinea:GetStatus()
      ::oTemporalLinea:OrdSetFocus( "nNumLin" )

      if ::oTemporalLinea:Seek( Str( nNumeroLinea ) )
         while ( ::oTemporalLinea:nNumLin == nNumeroLinea ) .AND. !( ::oTemporalLinea:eof() )

            ::oTemporalLinea:nUntTil   := ( ::oTemporalLinea:nUntTil / nUnidadesAnterior ) * ( nUnidadesActuales )

            ::oTemporalLinea:Skip()

         end
      end

      ::oTemporalLinea:SetStatus()

      ::cGetUnidades                   := ""

      ::TotalTemporal()

      ::oBrwLineas:Refresh()



   end

Return ( .T. )



UTILITY STATIC function TpvTactil_AgregarLineasLibres() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

      ::oTemporalLinea:Append()
      ::oTemporalLinea:cNomTil     := ::cGetDescripcion
      ::oTemporalLinea:nUntTil     := ::nGetUnidades
      ::oTemporalLinea:nPvpTil     := ::nGetImporte
      ::oTemporalLinea:nIvaTil     := nIva( ::oTipoIVA, cDefIva() )
      ::oTemporalLinea:cAlmLin     := oUser():cAlmacen()
      ::oTemporalLinea:cImpCom1    := ::cGetImpresora
      ::oTemporalLinea:nNumLin     := nLastNum( ::oTemporalLinea )
      ::oTemporalLinea:Save()

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::TotalTemporal()

   CursorWE()

Return ( .T. )



UTILITY STATIC function TpvTactil_AgregarFavoritos( cNombreArticulo) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oArticulo:GetStatus()
   ::oArticulo:OrdSetFocus( "Nombre" )

   CursorWait()





   if ::oArticulo:Seek( Upper( Padr( cNombreArticulo, 100 ) ) )

      ::oTemporalLinea:Append()
      ::oTemporalLinea:cCbaTil   := ::oArticulo:Codigo
      ::oTemporalLinea:cNomTil   := ::oArticulo:Nombre
      ::oTemporalLinea:nCosDiv   := ::oArticulo:pCosto
      ::oTemporalLinea:cLote     := ::oArticulo:cLote
      ::oTemporalLinea:cCodFam   := ::oArticulo:Familia
      ::oTemporalLinea:nCtlStk   := ::oArticulo:nCtlStock
      ::oTemporalLinea:nUntTil   := 1
      ::oTemporalLinea:nPvpTil   := cRetPreArt( ::oArticulo:Codigo, Max( ::oTiketCabecera:nTarifa, 1 ), cDivEmp(), .T., ::oArticulo:cAlias, ::oDivisas:cAlias, ::oArticulosEscandallos:cAlias, ::oTipoIVA:cAlias )
      ::oTemporalLinea:nIvaTil   := nIva( ::oTipoIVA, ::oArticulo:TipoIVA )
      ::oTemporalLinea:cAlmLin   := oUser():cAlmacen()
      ::oTemporalLinea:cImpCom1  := ::oArticulo:cTipImp1
      ::oTemporalLinea:cImpCom2  := ::oArticulo:cTipImp2
      ::oTemporalLinea:cComent   := ""
      ::oTemporalLinea:Save()

   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::oArticulo:SetStatus()

   ::TotalTemporal()

   CursorWE()

Return .T.



UTILITY STATIC function TpvTactil_AgregarPLU() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCodigoArticulo





   cCodigoArticulo               := cSeekCodebar( ::cGetUnidades, ::oCodigoBarraArticulo, ::oArticulo )

   if !::AgregarLineas( cCodigoArticulo )
      MsgBeepStop( "Artículo " + Alltrim( cCodigoArticulo ) + " no encontrado." )
   end

   ::oGetUnidades:cText( "" )

Return .T.



UTILITY STATIC function TpvTactil_InitComentarios() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oCbxOrd
   local cNumPed
   local oGetComentario
   local cGetComentario
   local cComentarioFamilia
   local oBrwComentarios
   local oBrwLineasComentarios
   local oDlgComentarios

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      RETURN ( .T. )
   end





   if ::oTemporalLinea:ordKeyCount() == 0
      MsgStop( "No puede añadir un comentario." )
      return .F.
   end





   cComentarioFamilia         := oRetFld( ::oTemporalLinea:cCodFam, ::oFamilias, "cComFam", "cCodFam" )





   cGetComentario             := ::oTemporalLinea:cComent





   oDlgComentarios = TDialog():New(,,,,, "TPVComentarios",, .F.,,,,,, .F.,,,,,, .F., )




      oGetComentario := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, cGetComentario, cGetComentario:= u ) }, oDlgComentarios,,,,,, ::oFntDlg,,, .F.,,, .F., .F.,,,,,, nil,,, )





      TButtonBmp():ReDefine( 160, {||( VirtualKey( .F., oGetComentario ) )}, oDlgComentarios,,, .F.,,,, .F., "Keyboard2_32",, )





      TButtonBmp():ReDefine( 161, {||( oGetComentario:cText( Space( 254 ) ) )}, oDlgComentarios,,, .F.,,,, .F., "Garbage_Empty_32",, )





      TButtonBmp():ReDefine( 170, {||( oBrwComentarios:Select( 0 ), oBrwComentarios:GoUp(), oBrwComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "Navigate_up",, )





      TButtonBmp():ReDefine( 171, {||( oBrwComentarios:Select( 0 ), oBrwComentarios:GoDown(), oBrwComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "Navigate_down",, )





      TButtonBmp():ReDefine( 180, {||( oBrwLineasComentarios:Select( 0 ), oBrwLineasComentarios:GoUp(), oBrwLineasComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "Navigate_up",, )





      TButtonBmp():ReDefine( 181, {||( oBrwLineasComentarios:Select( 0 ), oBrwLineasComentarios:GoDown(), oBrwLineasComentarios:Select( 1 ) )}, oDlgComentarios,,, .F.,,,, .F., "Navigate_down",, )





      TButtonBmp():ReDefine( 1, {||( ::EndComentarios( oDlgComentarios, oGetComentario ) )}, oDlgComentarios,,, .F.,,,, .F., "Check_32",, )





      TButtonBmp():ReDefine( 2, {||( oDlgComentarios:End() )}, oDlgComentarios,,, .F.,,,, .F., "Delete_32",, )

      oBrwComentarios                        := IXBrowse():New( oDlgComentarios )

      oBrwComentarios:bClrSel                := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwComentarios:bClrSelFocus           := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      oBrwComentarios:nMarqueeStyle          := 5
      oBrwComentarios:cName                  := "Comentarios de artículos"
      oBrwComentarios:nRowHeight             := 48
      oBrwComentarios:oFont                  := ::oFntBrw
      oBrwComentarios:lHeader                := .F.
      oBrwComentarios:lHScroll               := .F.

      oBrwComentarios:CreateFromResource( 100 )

      ::oComentariosCabecera:SetBrowse( oBrwComentarios )

      oBrwComentarios:bChange                := {|| ::ChangeComentarios( oBrwLineasComentarios ) }

      with object ( oBrwComentarios:AddCol() )
         :bEditValue                         := {|| ::oComentariosCabecera:cDescri }
      end

      oBrwLineasComentarios                  := IXBrowse():New( oDlgComentarios )

      oBrwLineasComentarios:bClrSel          := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwLineasComentarios:bClrSelFocus     := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
      oBrwLineasComentarios:nMarqueeStyle    := 5
      oBrwLineasComentarios:cName            := "Lineas comentarios de artículos"
      oBrwLineasComentarios:lHeader          := .F.
      oBrwLineasComentarios:lHScroll         := .F.
      oBrwLineasComentarios:nRowHeight       := 48
      oBrwLineasComentarios:oFont            := ::oFntBrw

      oBrwLineasComentarios:CreateFromResource( 110 )

      ::oComentariosLinea:SetBrowse( oBrwLineasComentarios )

      with object ( oBrwLineasComentarios:AddCol() )
         :bEditValue                         := {|| ::oComentariosLinea:cDescri }
      end

      oBrwLineasComentarios:bLClicked        := {|| ::ChangeLineasComentarios( oGetComentario ) }

      oDlgComentarios:bStart                 := {|| ::SeleccionarDefecto( cComentarioFamilia, oBrwLineasComentarios, oBrwComentarios ) }

   oDlgComentarios:Activate( oDlgComentarios:bLClicked, oDlgComentarios:bMoved, oDlgComentarios:bPainted, .T.,,,, oDlgComentarios:bRClicked,,, )

   ::oBrwLineas:Refresh()

Return ( nil )



UTILITY STATIC function TpvTactil_EndComentarios( oDlg, oGetComentario) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cText                := Alltrim( oGetComentario:VarGet() )

   ::oTemporalLinea:FieldPutByName( "cComent", cText )

   oDlg:End( 1 )

Return ( nil )



UTILITY STATIC function TpvTactil_ChangeComentarios( oBrwLineasComentarios) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oComentariosLinea:OrdScope( ::oComentariosCabecera:cCodigo )

   oBrwLineasComentarios:GoTop()
   oBrwLineasComentarios:Refresh( .T. )

Return ( nil )



UTILITY STATIC function TpvTactil_ChangeLineasComentarios( oGetComentario) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cText    := AllTrim( oGetComentario:VarGet() )





   if Empty( cText )
      cText       := AllTrim( ::oComentariosLinea:cDescri )
   else
      cText       += ", " + AllTrim( ::oComentariosLinea:cDescri )
   end

   oGetComentario:cText( Padr( cText, 250 ) )

   oGetComentario:Refresh()

Return ( nil )



UTILITY STATIC function TpvTactil_SeleccionarDefecto( cComentarioFamilia, oBrwLineasComentarios, oBrwComentarios) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if !Empty( cComentarioFamilia )

      if ::oComentariosCabecera:SeekinOrd( cComentarioFamilia, "cCodigo" )

         oBrwComentarios:Select( 0 )
         oBrwComentarios:Select( 1 )

         ::ChangeComentarios( oBrwLineasComentarios )

      end

   end

return .T.



UTILITY STATIC function TpvTactil_OnClickInvitacion() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local nRec
   local oBtnCancel
   local oImgInv
   local oLstInv

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      RETURN ( .T. )
   end





   oDlg = TDialog():New(,,,,, "INV_TCT",, .F.,,,,,, .F.,,,,,, .F., )

      ::oBtnTodasLineas := ApoloBtnBmp():ReDefine( 100, "Row_All_32", , , , , {|| ::SelectTodasLineasInvitacion() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )
      ::oBtnUnaLinea    := ApoloBtnBmp():ReDefine( 110, "Row_32", , , , ,     {|| ::SelectUnaLineaInvitacion() },    oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )

      oImgInv           := TImageList():New( 48, 48 )

      oLstInv           := TListView():Redefine( 120, oDlg )
      oLstInv:nOption   := 0
      oLstInv:bClick    := {| nOpt | ::EndInvitacion( nOpt, oLstInv, oDlg ) }





      oBtnCancel := TButtonBmp():ReDefine( 550, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete2_48",, )

      oDlg:bStart       := {|| ::InitInvitacion( oDlg, oImgInv, oLstInv ) }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   if !Empty( oImgInv )
      oImgInv:end()
   end

   if !Empty( oLstInv )
      oLstInv:end()
   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

   ::TotalTemporal()

Return ( nil )



UTILITY STATIC function TpvTactil_SelectUnaLineaInvitacion() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oBtnTodasLineas:GoUp()
   ::oBtnUnaLinea:GoDown()

Return ( nil )



UTILITY STATIC function TpvTactil_SelectTodasLineasInvitacion() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oBtnUnaLinea:GoUp()
   ::oBtnTodasLineas:GoDown()

Return ( nil )



UTILITY STATIC function TpvTactil_EndInvitacion( nOpt, oLstInv, oDlg) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nRec





   if nOpt == 0

      msgStop( "Debe seleccionar una opción válida." )

   else

      if ::oInvitacion:oDbf:OrdKeyGoTo( nOpt )

         if ::oBtnUnaLinea:lPressed

            if ::oInvitacion:oDbf:lPreInv
               ::oTemporalLinea:nPvpTil    := ::oInvitacion:oDbf:nPreInv
            else
               ::oTemporalLinea:nPvpTil    := 0
            end

            ::oTemporalLinea:nPcmTil       := 0
            ::oTemporalLinea:cCodInv       := ::oInvitacion:oDbf:cCodInv

         else

            CursorWait()

            nRec     := ::oTemporalLinea:Recno()

            ::oTemporalLinea:GoTop()
            while !::oTemporalLinea:Eof()

               if ::oInvitacion:oDbf:lPreInv
                  ::oTemporalLinea:nPvpTil := ::oInvitacion:oDbf:nPreInv
               else
                  ::oTemporalLinea:nPvpTil := 0
               end

               ::oTemporalLinea:nPcmTil    := 0
               ::oTemporalLinea:cCodInv    := ::oInvitacion:oDbf:cCodInv

               ::oTemporalLinea:Skip()

            end

            ::oTemporalLinea:GoTo( nRec )

            CursorWE()

         end

      end

      oDlg:End( 1 )

   end

return ( .T. )



UTILITY STATIC function TpvTactil_InitInvitacion( oDlg, oImgInv, oLstInv) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nInvi := 0

   if !Empty( oImgInv ) .AND. !Empty( oLstInv ) .AND. !Empty( ::oInvitacion )

      oLstInv:SetImageList( oImgInv )

      ::oInvitacion:oDbf:GoTop()

      while !::oInvitacion:oDbf:Eof()

         oImgInv:AddMasked( TBitmap():Define( ::oInvitacion:cBigResource() ), ( 255 + ( 0 * 256 ) + ( 255 * 65536 ) ) )

         oLstInv:InsertItem( nInvi, Capitalize( ::oInvitacion:oDbf:cNomInv ) )

         ::oInvitacion:oDbf:Skip()

         nInvi++

      end

   end

   ::oBtnUnaLinea:GoDown()

RETURN ( nil )



UTILITY STATIC function TpvTactil_OnClickDescuento() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local nRec
   local oGetPorcentaje
   local nGetPorcentaje := 10

   if !::lEditableDocumento()
      MsgStop( "El documento ya está cerrado" )
      RETURN ( .T. )
   end





   oDlg = TDialog():New(,,,,, "DTO_TCT",, .F.,,,,,, .F.,,,,,, .F., )

      ::oBtnUnaLinea      := ApoloBtnBmp():ReDefine( 100, "Row_32",,,,,    {|| ::oBtnUnaLinea:GoDown(), ::oBtnTodasLineas:GoUp() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )
      ::oBtnTodasLineas   := ApoloBtnBmp():ReDefine( 110, "Row_All_32",,,,,{|| ::oBtnUnaLinea:GoUp(), ::oBtnTodasLineas:GoDown() }, oDlg, .F., , .F., .F., "", , , , .T., "TOP", .T., , , .F. )




      TButton():ReDefine( 200, {||( oGetPorcentaje:cText( 10 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 210, {||( oGetPorcentaje:cText( 20 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 220, {||( oGetPorcentaje:cText( 30 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 230, {||( oGetPorcentaje:cText( 40 ) )}, oDlg,,, .F.,,,, .F. )




      TButton():ReDefine( 240, {||( oGetPorcentaje:cText( 50 ) )}, oDlg,,, .F.,,,, .F. )





      TButtonBmp():ReDefine( 300, {||( oGetPorcentaje++ )}, oDlg,,, .F.,,,, .F., "Navigate_Plus_32",, )





      TButtonBmp():ReDefine( 310, {||( oGetPorcentaje-- )}, oDlg,,, .F.,,,, .F., "Navigate_Minus_32",, )










      oGetPorcentaje := TGetHlp():ReDefine( 320, { | u | If( PCount()==0, nGetPorcentaje, nGetPorcentaje:= u ) }, oDlg,, "@E 999.99",,,, ::oFntDto,,, .F.,,, .F., .T.,,, {||      0}, {||      100},, nil,,, )




      TButtonBmp():ReDefine( 1, {||( oDlg:End( 1 ) )}, oDlg,,, .F.,,,, .F., "Check_32",, )





      TButtonBmp():ReDefine( 2, {||( oDlg:End() )}, oDlg,,, .F.,,,, .F., "Delete_32",, )

      oDlg:bStart := {|| ::oBtnUnaLinea:GoDown() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )





   if oDlg:nResult == 1

      CursorWait()

      if ::oBtnUnaLinea:lPressed

         ::oTemporalLinea:nDtoLin := nGetPorcentaje

      else

         nRec     := ::oTemporalLinea:Recno()

         ::oTemporalLinea:GoTop()
         while !::oTemporalLinea:Eof()
            ::oTemporalLinea:nDtoLin := nGetPorcentaje
            ::oTemporalLinea:Skip()
         end

         ::oTemporalLinea:GoTo( nRec )

      end

      CursorWE()

   end

   if !Empty( ::oBrwLineas )
      ::oBrwLineas:Refresh()
   end

Return ( nil )



UTILITY STATIC function TpvTactil_SelecionaCliente() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cCliente

   do case
      case ::oTiketCabecera:nUbiTik == 1
         cCliente    := BrwCliTactil( nil, nil, nil, .T., "Selecione un cliente para llevar", "wheel_48_alpha" )
      case ::oTiketCabecera:nUbiTik == 4
         cCliente    := BrwCliTactil( nil, nil, nil, .T., "Selecione un cliente para encargar", "address_book2_alpha_48" )
      otherwise
         cCliente    := BrwCliTactil( nil, nil, nil, .T. )
   end





   if !Empty( cCliente )

      ::oTiketCabecera:cCliTik      := cCliente
      ::oTiketCabecera:cNomTik      := oRetFld( cCliente, ::oCliente, "Titulo" )
      ::oTiketCabecera:cDirCli      := oRetFld( cCliente, ::oCliente, "Domicilio" )
      ::oTiketCabecera:cPobCli      := oRetFld( cCliente, ::oCliente, "Poblacion" )
      ::oTiketCabecera:cPrvCli      := oRetFld( cCliente, ::oCliente, "Provincia" )
      ::oTiketCabecera:cPosCli      := oRetFld( cCliente, ::oCliente, "CodPostal" )
      ::oTiketCabecera:cDniCli      := oRetFld( cCliente, ::oCliente, "Nif" )
      ::oTiketCabecera:nTarifa      := Max( oRetFld( cCliente, ::oCliente, "nTarifa" ), 1 )

      if Empty( oRetFld( cCliente, ::oCliente, "CodPago" ) )
         ::oTiketCabecera:cFpgTik   := cDefFpg()
      else
         ::oTiketCabecera:cFpgTik   := oRetFld( cCliente, ::oCliente, "CodPago" )
      end

      ::SetCliente()

   end

Return .T.



UTILITY STATIC function TpvTactil_SetCliente() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local uValor

   if !Empty( ::oBtnCliente )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Titulo" ) )

      ::oBtnCliente:cCaption( if( !Empty( uValor ), uValor, "..." ) )
      ::oBtnCliente:Refresh()

   end

   if !Empty( ::oBtnDireccion )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Domicilio" ) )

      ::oBtnDireccion:cCaption( if( !Empty( uValor ), uValor, "..." ) )

   end

   if !Empty( ::oBtnTelefono )

      uValor         := AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "Telefono" ) ) + Space( 1 ) + AllTrim( oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "cMeiInt" ) )

      ::oBtnTelefono:cCaption( if( !Empty( uValor ), uValor, "..." ) )

   end

Return nil



UTILITY STATIC function TpvTactil_OnClickUsuarios() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario( .T. )





         ::InitDocumento( 0 )

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( .T. )



UTILITY STATIC function TpvTactil_sTotalTiket() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local uTotal
   local nTotal            := 0

   local bCond
   local nRecLin
   local cCodDiv
   local nVdvDiv
   local cTipTik
   local nOrdAnt
   local nTotLin           := 0
   local nBasLin           := 0
   local nBrtLin           := 0
   local nIvmLin           := 0
   local nComensales       := 0
   local nDtoEsp           := 0
   local nDpp              := 0
   local nDescuentoEsp     := 0
   local nDescuentoPp      := 0

   ::sTotal                := sTotal()

   cCodDiv                 := ::oTiketCabecera:cDivTik
   nVdvDiv                 := ::oTiketCabecera:nVdvTik
   cTipTik                 := ::oTiketCabecera:cTipTik
   nComensales             := ::oTiketCabecera:nNumCom
   nDtoEsp                 := ::oTiketCabecera:nDtoEsp
   nDpp                    := ::oTiketCabecera:nDpp

   nRecLin                 := ::oTemporalLinea:Recno()

   ::oTemporalLinea:GoTop()
   while !( ::oTemporalLinea:eof() )

      if ::lLineaValida()

         nTotLin           := ::nTotalLinea( ::oTemporalLinea )

         if nDtoEsp <> 0
            nDescuentoEsp  := ( nTotLin * nDtoEsp ) / 100
         else
            nDescuentoEsp  := 0
         end

         if nDpp <> 0
            nDescuentoPp   := ( nTotLin * nDpp ) / 100
         else
            nDescuentoPp   := 0
         end

         nBasLin           := nTotLin
         nBasLin           -= nDescuentoEsp
         nBasLin           -= nDescuentoPp

         nIvmLin           := ::nTotalImpuestosEspeciales( ::oTemporalLinea )

         if ::oTemporalLinea:nIvaTil <> 0
            nBasLin        := nTotLin / ( 1 + ( ::oTemporalLinea:nIvaTil / 100 ) )
         else
            nBasLin        := nTotLin
         end

         do case
            case ::sTotal:aPorcentajeIva[ 1 ] == nil .OR. ::sTotal:aPorcentajeIva[ 1 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 1 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 1 ]                 += nTotLin
               ::sTotal:aTotalBase[ 1 ]                  += nBasLin
               ::sTotal:aTotalIva[ 1 ]                   += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 1 ] += nIvmLin

            case ::sTotal:aPorcentajeIva[ 2 ] == nil .OR. ::sTotal:aPorcentajeIva[ 2 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 2 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 2 ]                 += nTotLin
               ::sTotal:aTotalBase[ 2 ]                  += nBasLin
               ::sTotal:aTotalIva[ 2 ]                   += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 2 ] += nIvmLin

            case ::sTotal:aPorcentajeIva[ 3 ] == nil .OR. ::sTotal:aPorcentajeIva[ 3 ] == ::oTemporalLinea:nIvaTil

               ::sTotal:aPorcentajeIva[ 3 ]              := ::oTemporalLinea:nIvaTil
               ::sTotal:aTotalBruto[ 3 ]                 += nTotLin
               ::sTotal:aTotalBase[ 3 ]                  += nBasLin
               ::sTotal:aTotalIva[ 3 ]                   += ( nTotLin - nBasLin )
               ::sTotal:aTotalImpuestoHidrocarburos[ 3 ] += nIvmLin

         end

         ::sTotal:nTotalDocumento                        += nTotLin
         ::sTotal:nTotalDescuentoGeneral                 += nDescuentoEsp
         ::sTotal:nTotalDescuentoProntoPago              += nDescuentoPp

         if !Empty( ::oStock )
            ::sTotal:nTotalCosto                         += ::oStock:nCostoMedio( ::oTemporalLinea:cCbaTil, ::oTemporalLinea:cAlmLin, ::oTemporalLinea:cCodPr1, ::oTemporalLinea:cValPr1, ::oTemporalLinea:cCodPr2, ::oTemporalLinea:cValPr2 ) * ::nUnidadesLinea( ::oTemporalLinea )
         end

         if ::oTemporalLinea:lInPromo
            ::sTotal:nPromocion                          += nTotLin - nDescuentoEsp - nDescuentoPp
         end

      end

      ::oTemporalLinea:Skip()

   end





   ::sTotal:nTotalDocumento                              -= ::sTotal:nTotalDescuentoGeneral
   ::sTotal:nTotalDocumento                              -= ::sTotal:nTotalDescuentoProntoPago





   if !Empty( nComensales )
      ::sTotal:nTotalPersona                             := ::sTotal:nTotalDocumento / NotCero( nComensales )
   else
      ::sTotal:nTotalPersona                             := 0
   end





   if !Empty( nOrdAnt )
      ::oTemporalLinea:OrdSetFocus( nOrdAnt )
   end

   ::oTemporalLinea:GoTo( nRecLin )





   ::sTotal:nCobrado    := ::oTpvCobros:nTotalCobro()
   ::sTotal:nCambio     := ::oTpvCobros:nTotalCambio()

Return ( ::sTotal )



UTILITY STATIC function TpvTactil_lLineaValida( lExcluirContadores) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local lLineaValida   := .T.

   if ::oTiketLinea:lControl
      Return .F.
   end

   if ::oTiketLinea:lKitArt .OR. ::oTiketLinea:lKitChl
      lLineaValida      := ::oTiketLinea:lKitPrc
   end

   lLineaValida         := lLineaValida .AND. ( lExcluirContadores == nil .OR. ( lExcluirContadores .AND. ::oTiketLinea:nCtlStk <> 2 ) .OR. ( !lExcluirContadores .AND. ::oTiketLinea:nCtlStk == 2 ) )

Return ( lLineaValida )







UTILITY STATIC function TpvTactil_nUnidadesLinea( uTmpL, lPicture) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidadesLinea    := 0

   IIF( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   IIF( lPicture == nil, lPicture := .F., ) ;

   if Empty( uTmpL )
      Return ( nUnidadesLinea )
   end

   nUnidadesLinea          := uTmpL:nUntTil
   nUnidadesLinea          *= NotCero( uTmpL:nUndKit )

RETURN ( if( lPicture, Trans( nUnidadesLinea, ::cPictureUnidades ), nUnidadesLinea ) )



UTILITY STATIC function TpvTactil_nUnidadesImpresas( uTmpL, lPicture) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nUnidadesLinea

   IIF( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   IIF( lPicture == nil, lPicture := .F., ) ;

   nUnidadesLinea    := uTmpL:nImpCom

RETURN ( if( lPicture, Trans( nUnidadesLinea, ::cPictureUnidades ), nUnidadesLinea ) )



UTILITY STATIC function TpvTactil_nTotalLinea( uTmpL, lPicture) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalLinea

   IIF( uTmpL == nil, uTmpL := ::oTiketLinea, ) ;
   IIF( lPicture == nil, lPicture := .F., ) ;

   nTotalLinea       := ::nTotalLineaUno( uTmpL )
   nTotalLinea       += ::nTotalLineaDos( uTmpL )

RETURN ( if( lPicture, Trans( nTotalLinea, ::cPictureTotal ), nTotalLinea ) )



UTILITY STATIC function TpvTactil_nTotalLineaUno( uTmpL, nVdv) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   IIF( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   IIF( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil
      nCalculo       := Round( uTmpL:nPvpTil, ::nDecimalesImporte )

      if uTmpL:nDtoLin <> 0
         nCalculo    -= uTmpL:nDtoLin * nCalculo / 100
      end

      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



UTILITY STATIC function TpvTactil_nTotalLineaDos( uTmpL, nVdv) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   IIF( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   IIF( nVdv == nil, nVdv := 0, ) ;

   if !uTmpL:lFreTil
      nCalculo       := Round( uTmpL:nPcmTil, ::nDecimalesImporte )

      if uTmpL:nDtoLin <> 0
         nCalculo    -= uTmpL:nDtoLin * nCalculo / 100
      end

      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



UTILITY STATIC function TpvTactil_nTotalImpuestosEspeciales( uTmpL, nVdv) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nCalculo    := 0

   IIF( uTmpL == nil, uTmpL := ::oTemporalLinea, ) ;
   IIF( nVdv == nil, nVdv := 0, ) ;





   if !uTmpL:lFreTil
      nCalculo       := uTmpL:nValImp
      nCalculo       *= ::nUnidadesLinea( uTmpL )
   end

   if nVdv <> 0
      nCalculo       := nCalculo / nVdv
   end

RETURN ( Round( nCalculo, ::nDecimalesTotal ) )



UTILITY STATIC function TpvTactil_cDescripcionComanda( uTmpL) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cReturn     := ""

   IIF( uTmpL == nil, uTmpL := ::oTemporalComanda, ) ;

   if Empty( ::oTemporalComanda )
      Return ( cReturn )
   end

   if !Empty( ::oTemporalComanda:cNomCmd )
      cReturn        := Rtrim( ::oTemporalComanda:cNomCmd )
   else
      cReturn        := Rtrim( ::oTemporalComanda:cNomTil )
   end

   if !Empty( ::oTemporalComanda:cComent )
      cReturn        += "[*]" + Space( 1 ) + Alltrim( ::oTemporalComanda:cComent )
   end

RETURN ( cReturn )



UTILITY STATIC function TpvTactil_nTotalCobrosTemporales() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nTotalCobrosTemporales  := 0

   ::oTemporalCobro:GetStatus()

   ::oTemporalCobro:GoTop()
   while !::oTemporalCobro:Eof()
      nTotalCobrosTemporales     += ::oTemporalCobro:nImpTik
      ::oTemporalCobro:Skip()
   end

   ::oTemporalCobro:SetStatus()

RETURN ( nTotalCobrosTemporales )



UTILITY STATIC function TpvTactil_sTotalCobros( cNumero) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local sTotalCobros            := sTotalCobros()

   IIF( cNumero == nil, cNumero := ::oTiketCabacera:cSerTik + ::oTiketCabacera:cNumTik + ::oTiketCabacera:cSufTik, ) ;

   ::oTiketCobro:Seek( cNumero )
   while ::oTiketCobro:cSerTik + ::oTiketCobro:cNumTik + ::oTiketCobro:cSufTik .AND. !::oTiketCobro:Eof()
      sTotalCobros:Load( ::oTiketCobro )
      ::oTiketCobro:Skip()
   end

RETURN ( sTotalCobros )



UTILITY STATIC function TpvTactil_OnClickCobro() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   if Empty( ::oTemporalLinea ) .OR. Empty( ::oTemporalLinea:RecCount() )

      MsgStop( "No puede almacenar un documento sin línea" )

      Return .F.

   else

      if ::oTpvCobros:lResource()





         ::GuardaDocumentoPagado()





         ::GeneraVale()





         ::UltimoCambio()





         oUser():OpenCajon()





         do case
            case ::oTpvCobros:nExit == 1
               ::ImprimeRegalo()

            case ::oTpvCobros:nExit == 2
               ::ImprimeTicket()

         end





         ::InitDocumento( 0 )





         ::SetUbicacion()





         ::SetInfo()





         ::GetUsuario()

      end

   end

Return .T.



UTILITY STATIC function TpvTactil_OnClickPendientes() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::oTiketCabecera:Cancel()

      if ::oTpvListaTicket:lPendientes() .AND. !Empty( ::oTpvListaTicket:cSelectedTicket() )

         ::CargaDocumento( ::oTpvListaTicket:cSelectedTicket() )

      else

         ::InitDocumento()

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la lista de tickets pendientes" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return .T.



UTILITY STATIC function TpvTactil_OnClickLista() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::oTiketCabecera:Cancel()

      if ::oTpvListaTicket:lResource() .AND. !Empty( ::oTpvListaTicket:cSelectedTicket() )

         ::CargaDocumento( ::oTpvListaTicket:cSelectedTicket() )

      else

         ::InitDocumento()

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la lista de tickets" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return .T.



UTILITY STATIC function TpvTactil_OnClickEntrega() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil





   if ::lEmptyDocumento()
      Return ( .T. )
   end





   if ::lEmptyAlias() .AND. !::SetAliasDocumento()
      Return ( .T. )
   end





   ::GuardaDocumento( .F. )

   ::oTiketCabecera:lAbierto  := .F.





   ::ImprimeEntrega()

RETURN ( Self )



UTILITY STATIC function TpvTactil_OnClickCloseTurno( lParcial) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.

   IIF( lParcial == nil, lParcial := .T., ) ;





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )

      ::InitDocumento()

      if ::oTurno:OpenFiles()
         ::oTurno:lArqueoTurno( .F., .T., lParcial )
      else
         ::oTurno:CloseFiles()
      end

   end

   RECOVER USING oError

      msgStop( "Error al cerrar sesión" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return .T.



UTILITY STATIC function TpvTactil_GuardaDocumento( lZap, nSave) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local sCobro

   CursorWait()

   IIF( lZap == nil, lZap := .T., ) ;
   IIF( nSave == nil, nSave := "1", ) ;

   ::oDlg:Disable()

   ::CargaValoresDefecto()

   oBlock                           := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





      if !Empty( ::oTiketCabecera:cNumTik ) .AND. !Empty( ::oTemporalLinea:OrdKeyCount() )
         while ( ::oTiketLinea:Seek( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik ) )
            ::oTiketLinea:Delete()
         end
      end





      if Empty( ::oTiketCabecera:cNumTik )

         ::oTiketCabecera:cNumTik   := ::nNuevoNumeroTicket()
         ::oTiketCabecera:Insert()

      else

         ::oTiketCabecera:Save()

      end





      ::oTemporalLinea:GetStatus()
      ::oTemporalLinea:OrdSetFocus( "lRecNum" )

      ::oProgressBar:SetTotal( ::oTemporalLinea:RecCount() )

      ::oTemporalLinea:GoTop()
      while !::oTemporalLinea:eof()

         ::oTemporalLinea:cSerTil   := ::oTiketCabecera:cSerTik
         ::oTemporalLinea:cNumTil   := ::oTiketCabecera:cNumTik
         ::oTemporalLinea:cSufTil   := ::oTiketCabecera:cSufTik
         ::oTemporalLinea:cTipTil   := ::oTiketCabecera:cTipTik
         ::oTemporalLinea:dFecTik   := ::oTiketCabecera:dFecTik

         ::oTiketLinea:AppendFromObject( ::oTemporalLinea )

         ::oProgressBar:Set( ::oTemporalLinea:RecNo() )

         ::oTemporalLinea:Skip()

      end





      ::oTpvCobros:EliminaCobros()





      ::oTpvCobros:GuardaCobros()





      ::oTpvCobros:InitCobros()





      ::oTemporalLinea:SetStatus()

      if !lZap
         ::oTiketCabecera:Load()
      else
         ::oTemporalLinea:Zap()
      end





      ::oBrwLineas:Refresh()





      ::oProgressBar:Set( 0 )
      ::oProgressBar:Refresh()





      if nSave == "1"
         ::OnClickCopiaComanda()
      end





      ::lGetUsuario                 := .T.

      ::SetCliente()

   RECOVER USING oError

      msgStop( "Error al grabar el ticket" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )





   ::oDlg:Enable()

   CursorWE()

Return .T.



UTILITY STATIC function TpvTactil_CargaDocumento( cNumeroTicket) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   ::oTpvCobros:InitCobros()

   ::oDlg:Disable()

   if ::oTiketCabecera:Seek( cNumeroTicket )

      ::oTiketCabecera:Load()





      if ::oTiketLinea:Seek( cNumeroTicket )

         while ( ::oTiketLinea:cSerTil + ::oTiketLinea:cNumTil + ::oTiketLinea:cSufTil == cNumeroTicket ) .AND. !( ::oTiketLinea:Eof() )

            ::oTemporalLinea:AppendFromObject( ::oTiketLinea )

            ::oTiketLinea:Skip()

         end

         ::oTemporalLinea:GoTop()

      end





      ::oTpvCobros:CargaCobros( cNumeroTicket )

   end





   ::oBrwLineas:Refresh()





   ::TotalTemporal()





   ::SetUbicacion()





   ::SetInfo()





   ::oDlg:Enable()

   CursorWE()

Return .T.



UTILITY STATIC function TpvTactil_EliminaDocumento( cNumeroTicket) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   CursorWait()

   ::oDlg:Disable()

   if ::oTiketCabecera:Seek( cNumeroTicket )
      ::oTiketCabecera:Delete()
   end

   while ( ::oTiketLinea:Seek( cNumeroTicket ) )
      ::oTiketLinea:Delete()
   end

   ::oDlg:Enable()

   CursorWE()

Return .T.



UTILITY STATIC function TpvTactil_CargaValoresDefecto( nUbicacion, lInit) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   IIF( lInit == nil, lInit := .F., ) ;





   if Empty( ::oTiketCabecera:cTipTik )
      ::oTiketCabecera:cTipTik   := "1"
   end





   if Empty( ::oTiketCabecera:cSerTik )
      ::oTiketCabecera:cSerTik   := "A"
   end





   if Empty( ::oTiketCabecera:cFpgTik )
      ::oTiketCabecera:cFpgTik   := cDefFpg()
   end





   if Empty( ::oTiketCabecera:cTurTik )
      ::oTiketCabecera:cTurTik   := cCurSesion()
   end





   if Empty( ::oTiketCabecera:cCcjTik )
      ::oTiketCabecera:cCcjTik   := oUser():cCodigo()
   end





   if Empty( ::oTiketCabecera:cNcjTik )
      ::oTiketCabecera:cNcjTik   := oUser():cCaja()
   end





   if Empty( ::oTiketCabecera:nTarifa )
      ::oTiketCabecera:nTarifa   := Max( uFieldEmpresa( "nPreVta" ), 1 )
   end





   if Empty( ::oTiketCabecera:cSufTik )
      ::oTiketCabecera:cSufTik   := RetSufEmp()
   end





   if Empty( ::oTiketCabecera:dFecTik )
      ::oTiketCabecera:dFecTik   := GetSysDate()
   end





   if Empty( ::oTiketCabecera:cAlmTik )
      ::oTiketCabecera:cAlmTik   := oUser():cAlmacen()
   end





   if Empty( ::oTiketCabecera:cCliTik )
      ::oTiketCabecera:cCliTik   := cDefCli()
   end

   if Empty( ::oTiketCabecera:cNomTik )
      ::oTiketCabecera:cNomTik   := RetFld( cDefCli(), ::oCliente:cAlias, "Titulo" )
   end

   if Empty( ::oTiketCabecera:cDirCli )
      ::oTiketCabecera:cDirCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Domicilio" )
   end

   if Empty( ::oTiketCabecera:cPobCli )
      ::oTiketCabecera:cPobCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Poblacion" )
   end

   if Empty( ::oTiketCabecera:cPrvCli )
      ::oTiketCabecera:cPrvCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Provincia" )
   end

   if Empty( ::oTiketCabecera:cPosCli )
      ::oTiketCabecera:cPosCli   := RetFld( cDefCli(), ::oCliente:cAlias, "CodPostal" )
   end

   if Empty( ::oTiketCabecera:cPosCli )
      ::oTiketCabecera:cPosCli   := RetFld( cDefCli(), ::oCliente:cAlias, "CodPostal" )
   end

   if Empty( ::oTiketCabecera:cDniCli )
      ::oTiketCabecera:cDniCli   := RetFld( cDefCli(), ::oCliente:cAlias, "Nif" )
   end

   if Empty( ::oTiketCabecera:dFecCre )
      ::oTiketCabecera:dFecCre   := Date()
   end

   if Empty( ::oTiketCabecera:cTimCre )
      ::oTiketCabecera:cTimCre   := SubStr( Time(), 1, 5 )
   end

   if Empty( ::oTiketCabecera:cHorTik )
      ::oTiketCabecera:cHorTik   := Substr( Time(), 1, 5 )
   end

   if IsNum( nUbicacion )
      ::oTiketCabecera:nUbiTik   := nUbicacion
   end

   if lInit
      ::oTiketCabecera:lAbierto  := .T.
      ::oTiketCabecera:lCloTik   := .F.
      ::oTiketCabecera:lSndDoc   := .T.
   end

   if !Empty( ::sTotal )
      ::oTiketCabecera:nTotNet   := ::sTotal:TotalBase()
      ::oTiketCabecera:nTotIva   := ::sTotal:TotalIva()
      ::oTiketCabecera:nTotTik   := ::sTotal:TotalDocumento()
   end

Return ( Self )



UTILITY STATIC function TpvTactil_OnClickSalaVenta( nSelectOption) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.

   IIF( nSelectOption == nil, nSelectOption := 2, ) ;





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario()





         if ::oRestaurante:Sala( nil, .T., nSelectOption )

            if !Empty( ::oRestaurante:cSelectedTicket() )

               ::CargaDocumento( ::oRestaurante:cSelectedTicket() )

            else

               if !Empty( ::oRestaurante:cSelectedSala )





                  ::InitDocumento( 2 )





                  ::nTarifaSolo              := ::oRestaurante:nSelectedPrecio
                  ::nTarifaCombinado         := ::oRestaurante:nSelectedCombinado

                  ::oTiketCabecera:nTarifa   := ::oRestaurante:nSelectedPrecio
                  ::oTiketCabecera:cCodSala  := ::oRestaurante:cSelectedSala
                  ::oTiketCabecera:cPntVenta := ::oRestaurante:cSelectedPunto





                  ::SetUbicacion()





                  ::SetInfo()

               end

            end

         else





            ::InitDocumento( 0 )

         end

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_OnClickGeneral() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario()





         ::InitDocumento( 0 )





         ::nTarifaSolo           := Max( uFieldEmpresa( "nPreTPro" ), 1 )
         ::nTarifaCombinado      := Max( uFieldEmpresa( "nPreTCmb" ), 1 )





         ::SetUbicacion()





         ::SetInfo()

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar abrir la ubicación general" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_OnClickParaRecoger() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario()





         ::InitDocumento( 3 )





         ::nTarifaSolo           := Max( uFieldEmpresa( "nPreTPro" ), 1 )
         ::nTarifaCombinado      := Max( uFieldEmpresa( "nPreTCmb" ), 1 )





         ::SetUbicacion()





         ::SetInfo()

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar abrir la ubicación general" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_OnClickParaLlevar() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario()





         ::InitDocumento( 1 )





         ::nTarifaSolo        := Max( uFieldEmpresa( "nPreTPro" ), 1 )
         ::nTarifaCombinado   := Max( uFieldEmpresa( "nPreTCmb" ), 1 )





         ::SelecionaCliente()

      end

   end





   ::SetUbicacion()





   ::SetInfo()

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_OnClickEncargar() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local lGuardaDocumento  := .T.





   if ::lEmptyDocumento()
      lGuardaDocumento     := .F.
   end





   if ::lEmptyAlias()
      if ::SetAliasDocumento()
         lGuardaDocumento  := .T.
      else
         Return ( .T. )
      end
   end





   if ::lEmptyLineas()
      if ApoloMsgNoYes( "¿ Desea realmente eliminar el ticket " + ::oTiketCabecera:cSerTik + "/" + Alltrim( ::oTiketCabecera:cNumTik ) + "/" + Alltrim( ::oTiketCabecera:cSufTik ) + " ?", "Atención", .T. )
         ::EliminaDocumento( ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik )
      end
      lGuardaDocumento     := .F.
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   if ( !lGuardaDocumento .OR. ::GuardaDocumentoPendiente() )





      if ::GetUsuario()





         ::InitDocumento( 4 )





         ::nTarifaSolo        := Max( uFieldEmpresa( "nPreTPro" ), 1 )
         ::nTarifaCombinado   := Max( uFieldEmpresa( "nPreTCmb" ), 1 )





         ::SelecionaCliente()

      end

   end





   ::SetUbicacion()





   ::SetInfo()

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_OnClickCambiaUbicacion() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local lReturn           := .T.
   local cNumeroDocumento





   if ::lEmptyDocumento() .OR. ::lEmptyLineas()
      MsgStop( "El documento esta vacio" )
      Return ( .T. )
   end

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   if ::lEmptyNumeroTicket()

      if ::oRestaurante:Sala( .F., .F. )

         ::oTiketCabecera:nUbiTik   := 2
         ::oTiketCabecera:cCodSala  := ::oRestaurante:cSelectedSala
         ::oTiketCabecera:cPntVenta := ::oRestaurante:cSelectedPunto



         ::SetUbicacion()



         ::SetInfo()



         MsgInfo( "El ticket ha sido movido a la ubicación " + ::cUbicacion() )

      end

   else

      cNumeroDocumento     := ::cNumeroTicket()



      if ( ::GuardaDocumentoPendiente() )

         if ::oRestaurante:Sala( .F., .F. )

            if ::oTiketCabecera:Seek( cNumeroDocumento )
               ::oTiketCabecera:FieldPutByName( "nUbiTik",     2 )
               ::oTiketCabecera:FieldPutByName( "cCodSala",    ::oRestaurante:cSelectedSala )
               ::oTiketCabecera:FieldPutByName( "cPntVenta",   ::oRestaurante:cSelectedPunto )
            end

            ::CargaDocumento( cNumeroDocumento )



            ::SetUbicacion()



            ::SetInfo()



            MsgInfo( "El ticket ha sido movido a la ubicación " + ::cUbicacion() )

         end

      end

   end

   RECOVER USING oError

      msgStop( "Error al montar la salas de venta" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lReturn )



UTILITY STATIC function TpvTactil_CargaContador() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oTiketCabecera:cNumTik      := ::nNuevoNumeroTicket()
   ::oTiketCabecera:cSufTik      := RetSufEmp()
   ::oTiketCabecera:dFecCre      := Date()
   ::oTiketCabecera:cTimCre      := SubStr( Time(), 1, 5 )
   ::oTiketCabecera:cHorTik      := Substr( Time(), 1, 5 )
   ::oTiketCabecera:lAbierto     := .F.
   ::oTiketCabecera:lCloTik      := .F.

Return ( Self )



UTILITY STATIC function TpvTactil_SetCalculadora() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local nGetUnidadesTop      := ::oGetUnidades:nTop
   local nBtnFamiliasTop      := ::oBtnFamiliasUp:nTop
   local nBrwFamiliasHeight   := ::oBrwFamilias:nHeight

   ::lHideCalculadora         := !::lHideCalculadora

   if ::lHideCalculadora

      aEval( ::oBtnNum, {|o| o:Hide() } )

      ::oBrwFamilias:Move( , , , nBrwFamiliasHeight + 240, .T. )

      ::oGetUnidades:Move(       nGetUnidadesTop + 240, , , , .T. )

      ::oBtnFamiliasUp:Move(     nBtnFamiliasTop + 240, , , , .T. )
      ::oBtnFamiliasDown:Move(   nBtnFamiliasTop + 240, , , , .T. )

   else

      aEval( ::oBtnNum, {|o| o:Show() } )

      ::oBrwFamilias:Move( , , , nBrwFamiliasHeight - 240, .T. )

      ::oGetUnidades:Move(       nGetUnidadesTop - 240, , , , .T. )

      ::oBtnFamiliasUp:Move(     nBtnFamiliasTop - 240, , , , .T. )
      ::oBtnFamiliasDown:Move(   nBtnFamiliasTop - 240, , , , .T. )

   end

Return ( Self )



UTILITY STATIC function TpvTactil_SetAliasDocumento( cTexto) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cNombreUbicacion

   IIF( cTexto == nil, cTexto := "Asignar nombre", ) ;

   cNombreUbicacion                 := VirtualKey( .F., ::oTiketCabecera:cAliasTik, cTexto )

   if !Empty( cNombreUbicacion )

      ::oTiketCabecera:cAliasTik    := cNombreUbicacion

      ::SetUbicacion()





      ::SetInfo()

      Return ( .T. )

   end

Return ( .F. )



UTILITY STATIC function TpvTactil_ImprimeDocumento() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oDlg
   local oBmpPrinter

   CursorWait()

   oDlg = TDialog():New(,,,,, "Printing",, .F.,,,,,, .F.,,,,,, .F., )

      oBmpPrinter := TBitmap():ReDefine( 500, "Printer_48",, oDlg,,, .F., .F.,,, .F.,,, .T. )

      oDlg:bStart       := {|| ::BuildReport(), oDlg:end() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   CursorWE()

   oBmpPrinter:End()

Return ( Self )



UTILITY STATIC function TpvTactil_OnClickCopiaComanda( lCopia) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local cImp
   local aImp           := {}
   local cWav           := ""
   local lAppend

   IIF( lCopia == nil, lCopia := .F., ) ;













   CursorWait()





   if ::oTiketLinea:Seek( ::cNumeroTicket() )

      while ( ::oTiketLinea:cSerTil + ::oTiketLinea:cNumTil + ::oTiketLinea:cSufTil == ::cNumeroTicket() ) .AND. !( ::oTiketLinea:Eof() )

         lAppend        := .F.

         if lCopia .OR. ( ::nUnidadesImpresas() < ::nUnidadesLinea() )





            if !Empty( ::oTiketLinea:cImpCom1 ) .AND. AllTrim( ::oTiketLinea:cImpCom1 ) <> "No imprimir"

               if aScan( aImp, ::oTiketLinea:cImpCom1 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom1 )
               end

               lAppend  := .T.

            end





            if !Empty( ::oTiketLinea:cImpCom2 ) .AND. AllTrim( ::oTiketLinea:cImpCom2 ) <> "No imprimir"

               if aScan( aImp, ::oTiketLinea:cImpCom2 ) == 0
                  aAdd( aImp, ::oTiketLinea:cImpCom2 )
               end

               lAppend  := .T.

            end






            if lAppend

               ::oTemporalComanda:AppendFromObject( ::oTiketLinea )

               if !lCopia
                  ::oTemporalComanda:FieldPutByName( "nUntTil", ( ::nUnidadesLinea() - ::nUnidadesImpresas() ) )
               end

            end

         end





         ::oTiketLinea:Skip()

      end

   end





   for each cImp in aImp





      ::oTemporalComanda:SetFilter( "Rtrim( Field->cImpCom1 ) == '" + Rtrim( cImp ) + "' .or. Rtrim( Field->cImpCom2 ) == '" + Rtrim( cImp ) + "'" )





      ::ImprimeComanda( cImp )





      ::SonidoComanda( cImp )





      ::oTemporalComanda:SetFilter()

   next





   if !lCopia

      if ::oTiketLinea:Seek( ::cNumeroTicket() )

         while ( ::oTiketLinea:cSerTil + ::oTiketLinea:cNumTil + ::oTiketLinea:cSufTil == ::cNumeroTicket() ) .AND. !( ::oTiketLinea:Eof() )

            ::oTiketLinea:FieldPutByName( "nImpCom", ::nUnidadesLinea() )

            ::oTiketLinea:Skip()

         end

      end

   end






























   ::oTemporalComanda:Zap()

   CursorWE()

Return ( Self )



UTILITY STATIC function TpvTactil_BuildReport() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   SysRefresh()





   ::DataReport()





   if lExisteDocumento( ::cFormato, ::oDocument ) .AND. !Empty( ::oDocument:mReport )

      ::oFastReport:LoadFromBlob( ::oDocument:nArea, "mReport")





      ::VariableReport()





      ::oFastReport:PrepareReport()





      do case
         case ::nDispositivo == 2

            ::oFastReport:ShowPreparedReport()

         case ::nDispositivo == 1

            ::oFastReport:PrintOptions:SetPrinter( ::cImpresora )
            ::oFastReport:PrintOptions:SetCopies( ::nCopias )
            ::oFastReport:PrintOptions:SetShowDialog( .F. )
            ::oFastReport:Print()

         case ::nDispositivo == 3

            ::oFastReport:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            ::oFastReport:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            ::oFastReport:SetProperty(  "PDFExport", "Outline",          .T. )
            ::oFastReport:DoExport(     "PDFExport" )

      end

   end

   ::oFastReport:ClearDataSets()

Return .T.



UTILITY STATIC function TpvTactil_DataReport( lComanda, lAnulacion) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   IIF( lComanda == nil, lComanda := .F., ) ;
   IIF( lAnulacion == nil, lAnulacion := .F., ) ;





   ::oFastReport:ClearDataSets()

   ::oFastReport:SetWorkArea(       "Tickets", ::oTiketCabecera:nArea, .F., { 1, 1, 0 } )
   ::oFastReport:SetFieldAliases(   "Tickets", cItemsToReport( aItmTik() ) )

   if ::lComanda
      ::oFastReport:SetWorkArea(    "Lineas de tickets", ::oTemporalComanda:nArea )
   else
      ::oFastReport:SetWorkArea(    "Lineas de tickets", ::oTiketLinea:nArea )
   end
   ::oFastReport:SetFieldAliases(   "Lineas de tickets", cItemsToReport( aColTik() ) )

   ::oFastReport:SetWorkArea(       "Lineas de albaranes", ::oAlbaranClienteLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de albaranes", cItemsToReport( aColAlbCli() ) )

   ::oFastReport:SetWorkArea(       "Lineas de facturas", ::oFacturaClienteLinea:nArea )
   ::oFastReport:SetFieldAliases(   "Lineas de facturas", cItemsToReport( aColFacCli() ) )

   ::oFastReport:SetWorkArea(       "Pagos de tickets", ::oTiketCobro:nArea )
   ::oFastReport:SetFieldAliases(   "Pagos de tickets", cItemsToReport( aPgoTik() ) )

   ::oFastReport:SetWorkArea(       "Empresa", ::oEmpresa:nArea )
   ::oFastReport:SetFieldAliases(   "Empresa", cItemsToReport( aItmEmp() ) )

   ::oFastReport:SetWorkArea(       "Clientes", ::oCliente:nArea )
   ::oFastReport:SetFieldAliases(   "Clientes", cItemsToReport( aItmCli() ) )

   ::oFastReport:SetWorkArea(       "Obras", ::oObras:nArea )
   ::oFastReport:SetFieldAliases(   "Obras",  cItemsToReport( aItmObr() ) )

   ::oFastReport:SetWorkArea(       "Almacenes", ::oAlmacen:nArea )
   ::oFastReport:SetFieldAliases(   "Almacenes", cItemsToReport( aItmAlm() ) )

   ::oFastReport:SetWorkArea(       "Rutas", ::oRuta:nArea )
   ::oFastReport:SetFieldAliases(   "Rutas", cItemsToReport( aItmRut() ) )

   ::oFastReport:SetWorkArea(       "Agentes", ::oAgentes:nArea )
   ::oFastReport:SetFieldAliases(   "Agentes", cItemsToReport( aItmAge() ) )

   ::oFastReport:SetWorkArea(       "Formas de pago", ::oFormaPago:nArea )
   ::oFastReport:SetFieldAliases(   "Formas de pago", cItemsToReport( aItmFPago() ) )

   ::oFastReport:SetWorkArea(       "Usuarios", ::oUsuario:nArea )
   ::oFastReport:SetFieldAliases(   "Usuarios", cItemsToReport( aItmUsr() ) )

   ::oFastReport:SetWorkArea(       "Artículos", ::oArticulo:nArea )
   ::oFastReport:SetFieldAliases(   "Artículos", cItemsToReport( aItmArt() ) )

   ::oFastReport:SetWorkArea(       "Familias", ::oFamilias:nArea )
   ::oFastReport:SetFieldAliases(   "Familias", cItemsToReport( aItmFam() ) )

   ::oFastReport:SetWorkArea(       "Sala venta", ::oRestaurante:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Sala venta", cObjectsToReport( ::oRestaurante:oDbf ) )

   ::oFastReport:SetWorkArea(       "Orden comanda", ::oTComandas:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Orden comanda", cObjectsToReport( ::oTComandas:oDbf ) )

   ::oFastReport:SetWorkArea(       "Unidades de medición",  ::oUndMedicion:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Unidades de medición",  cObjectsToReport( ::oUndMedicion:oDbf ) )

   ::oFastReport:SetWorkArea(       "Categorías", ::oCategorias:nArea )
   ::oFastReport:SetFieldAliases(   "Categorías", cItemsToReport( aItmCategoria() ) )

   ::oFastReport:SetWorkArea(       "Tipos de artículos",  ::oTipArt:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Tipos de artículos",  cObjectsToReport( ::oTipArt:oDbf ) )

   ::oFastReport:SetWorkArea(       "Fabricantes",  ::oFabricante:oDbf:nArea )
   ::oFastReport:SetFieldAliases(   "Fabricantes",  cObjectsToReport( ::oFabricante:oDbf ) )

   ::oFastReport:SetWorkArea(       "Temporadas", ::oTemporadas:nArea )
   ::oFastReport:SetFieldAliases(   "Temporadas", cItemsToReport( aItmTemporada() ) )



   ::oFastReport:SetMasterDetail( "Tickets", "Empresa",            {|| cCodigoEmpresaEnUso() } )
   ::oFastReport:SetMasterDetail( "Tickets", "Lineas de tickets",  {|| ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik } )
   ::oFastReport:SetMasterDetail( "Tickets", "Pagos de tickets",   {|| ::oTiketCabecera:cSerTik + ::oTiketCabecera:cNumTik + ::oTiketCabecera:cSufTik } )
   ::oFastReport:SetMasterDetail( "Tickets", "Lineas de albaranes",{|| ::oTiketCabecera:cNumDoc } )
   ::oFastReport:SetMasterDetail( "Tickets", "Lineas de facturas", {|| ::oTiketCabecera:cNumDoc } )
   ::oFastReport:SetMasterDetail( "Tickets", "Clientes",           {|| ::oTiketCabecera:cCliTik } )
   ::oFastReport:SetMasterDetail( "Tickets", "Obras",              {|| ::oTiketCabecera:cCliTik + ::oTiketCabecera:cCodObr } )
   ::oFastReport:SetMasterDetail( "Tickets", "Almacen",            {|| ::oTiketCabecera:cAlmTik } )
   ::oFastReport:SetMasterDetail( "Tickets", "Rutas",              {|| ::oTiketCabecera:cCodRut } )
   ::oFastReport:SetMasterDetail( "Tickets", "Agentes",            {|| ::oTiketCabecera:cCodAge } )
   ::oFastReport:SetMasterDetail( "Tickets", "Usuarios",           {|| ::oTiketCabecera:cCcjTik } )
   ::oFastReport:SetMasterDetail( "Tickets", "SalaVenta",          {|| ::oTiketCabecera:cCodSala } )

   if ::lComanda
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Artículos",           {|| ::oTemporalComanda:cCbaTil } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Familia",             {|| ::oTemporalComanda:cFamTil } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Orden comanda",       {|| ::oTemporalComanda:cCodTImp } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Unidades de medición",{|| ::oTemporalComanda:cUnidad } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Categorías",          {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodCate" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Tipos de artículos",  {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodTip" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Fabricantes",         {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodFab" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Temporadas",          {|| RetFld( ::oTemporalComanda:cCbaTil, ::oArticulo:cAlias, "cCodTemp" ) } )
   else
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Artículos",           {|| ::oTiketLinea:cCbaTil } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Familia",             {|| ::oTiketLinea:cFamTil } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Orden comanda",       {|| ::oTiketLinea:cCodTImp } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Unidades de medición",{|| ::oTiketLinea:cUnidad } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Categorías",          {|| RetFld( ::oTiketLinea:cCbaTil, ::oArticulo:cAlias, "cCodCate" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Tipos de artículos",  {|| RetFld( ::oTiketLinea:cCbaTil, ::oArticulo:cAlias, "cCodTip" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Fabricantes",         {|| RetFld( ::oTiketLinea:cCbaTil, ::oArticulo:cAlias, "cCodFab" ) } )
      ::oFastReport:SetMasterDetail( "Lineas de tickets", "Temporadas",          {|| RetFld( ::oTiketLinea:cCbaTil, ::oArticulo:cAlias, "cCodTemp" ) } )
   end

   ::oFastReport:SetMasterDetail( "Pagos de tickets", "Formas de pago",          {|| ::oTiketCobro:cFpgPgo } )



   ::oFastReport:SetResyncPair(  "Tickets", "Lineas de tickets" )
   ::oFastReport:SetResyncPair(  "Tickets", "Lineas de albaranes" )
   ::oFastReport:SetResyncPair(  "Tickets", "Lineas de facturas" )
   ::oFastReport:SetResyncPair(  "Tickets", "Empresa" )
   ::oFastReport:SetResyncPair(  "Tickets", "Clientes" )
   ::oFastReport:SetResyncPair(  "Tickets", "Obras" )
   ::oFastReport:SetResyncPair(  "Tickets", "Almacenes" )
   ::oFastReport:SetResyncPair(  "Tickets", "Rutas" )
   ::oFastReport:SetResyncPair(  "Tickets", "Agentes" )
   ::oFastReport:SetResyncPair(  "Tickets", "Usuarios" )
   ::oFastReport:SetResyncPair(  "Tickets", "SalaVenta" )

   ::oFastReport:SetResyncPair(  "Pagos de tickets", "Formas de pago" )

   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Artículos" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Familias" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Orden comanda" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Unidades de medición" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Categorías" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Tipos de artículos" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Fabricantes" )
   ::oFastReport:SetResyncPair(  "Lineas de tickets", "Temporadas" )

Return nil



UTILITY STATIC function TpvTactil_VariableReport() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   ::oFastReport:DeleteCategory(  "Tickets" )
   ::oFastReport:DeleteCategory(  "Lineas de tickets" )
   ::oFastReport:DeleteCategory(  "Lineas de comandas" )
   ::oFastReport:DeleteCategory(  "Lineas de albaranes" )
   ::oFastReport:DeleteCategory(  "Lineas de facturas" )





   ::oFastReport:AddVariable(     "Tickets",             "Ubicación del ticket",              "CallHbFunc( 'oTpvTactil', [ 'cTxtUbicacion()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Total ticket",                      "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDocumento' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Precio por pax.",                   "CallHbFunc( 'oTpvTactil', [ 'nPrecioPorPersona()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Total descuento general",           "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoGeneral' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Total descuento pronto pago",       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuentoProntoPago' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Total descuento",                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalDescuento()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Bruto primer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerBruto()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Bruto segundo tipo de " + cImp(),   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoBruto()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Bruto tercer tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerBruto()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Total bruto",                       "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBruto()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Base primer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimeraBase()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Base segundo tipo de " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundaBase()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Base tercer tipo de " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTerceraBase()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Total neto",                        "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalBase()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Porcentaje primer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajePrimerIva()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Porcentaje segundo tipo " + cImp(), "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeSegundoIva()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Porcentaje tercer tipo " + cImp(),  "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nPorcentajeTercerIva()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Importe primer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerIva()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Importe segundo tipo " + cImp(),    "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoIva()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Importe tercer tipo " + cImp(),     "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerIva()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Total " + cImp(),                   "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalIVA()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Importe primer tipo IVMH",          "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalPrimerImpuestoHidrocarburos()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Importe segundo tipo IVMH",         "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalSegundoImpuestoHidrocarburos()' ] )" )
   ::oFastReport:AddVariable(     "Tickets",             "Importe tercer tipo IVMH",          "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'nTotalTercerImpuestoHidrocarburos()' ] )" )

   ::oFastReport:AddVariable(     "Tickets",             "Total IVMH",                        "CallHbFunc( 'oTpvTactil', [ 'GetTotalDocumento', 'TotalImpuestoHidrocarburos()' ] )" )








   ::oFastReport:AddVariable(     "Lineas de tickets",   "Total unidades artículo",                      "CallHbFunc( 'oTpvTactil', [ 'nUnidadesLinea()' ] )" )
   ::oFastReport:AddVariable(     "Lineas de tickets",   "Precio unitario del artículo",                 "CallHbFunc( 'oTpvTactil', [ 'nPrecioLinea()' ] )" )
   ::oFastReport:AddVariable(     "Lineas de tickets",   "Total línea de factura",                       "CallHbFunc( 'oTpvTactil', [ 'nTotalLinea()' ] )" )

   ::oFastReport:AddVariable(     "Lineas de tickets",   "Precio unitario con descuentos",               "CallHbFunc('nNetLTpv')" )
   ::oFastReport:AddVariable(     "Lineas de tickets",   "Importe descuento línea del factura",          "CallHbFunc('nDtoUTpv')" )
   ::oFastReport:AddVariable(     "Lineas de tickets",   "Total " + cImp() + " línea de factura",        "CallHbFunc('nIvaLTpv')" )
   ::oFastReport:AddVariable(     "Lineas de tickets",   "Total IVMH línea de factura",                  "CallHbFunc('nIvmLTpv')" )

   ::oFastReport:AddVariable(     "Lineas de comandas",  "Total unidades en comanda",                    "CallHbFunc( 'oTpvTactil', [ 'nUnidadesLineaComanda()' ] )" )
   ::oFastReport:AddVariable(     "Lineas de comandas",  "Total unidades impresas en comanda",           "CallHbFunc( 'oTpvTactil', [ 'nUnidadesImpresasComanda()' ] )" )
   ::oFastReport:AddVariable(     "Lineas de comandas",  "Detalle del artículo en comanda",              "CallHbFunc( 'oTpvTactil', [ 'cDescripcionComanda()' ] )" )

   ::oFastReport:AddVariable(     "Lineas de albaranes", "Detalle del artículo del albarán",             "CallHbFunc('cTpvDesAlbCli')"  )
   ::oFastReport:AddVariable(     "Lineas de albaranes", "Total unidades artículo del albarán",          "CallHbFunc('nTpvTotNAlbCli')" )
   ::oFastReport:AddVariable(     "Lineas de albaranes", "Precio unitario del artículo del albarán",     "CallHbFunc('nTpvTotUAlbCli')" )
   ::oFastReport:AddVariable(     "Lineas de albaranes", "Total línea de albarán",                       "CallHbFunc('nTpvTotLAlbCli')" )

   ::oFastReport:AddVariable(     "Lineas de facturas",  "Detalle del artículo de la factura",           "CallHbFunc('cTpvDesFacCli')" )
   ::oFastReport:AddVariable(     "Lineas de facturas",  "Total unidades artículo de la factura",        "CallHbFunc('nTpvTotNFacCli')" )
   ::oFastReport:AddVariable(     "Lineas de facturas",  "Precio unitario del artículo de la factura",   "CallHbFunc('nTpvTotUFacCli')" )
   ::oFastReport:AddVariable(     "Lineas de facturas",  "Total línea de factura.",                      "CallHbFunc('nTpvTotLFacCli')" )

Return nil



Function oTpvTactil( cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )

   local uReturn  := ""

   if !Empty( oThis ) .AND. !Empty( cMsg )
      uReturn     := oSend( oThis, cMsg, u1, u2, u3, u4, u5, u6, u7, u8, u9, u10 )
   end

Return ( uReturn )



UTILITY STATIC function TpvTactil_GeneraVale() ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   local oError
   local oBlock
   local cNumeroTicket
   local cValeTicket
   local lValePromocion
   local nValePromocion             := 0
   local nPorcentajePromocion       := 0

   if Empty( ::oTiketCabecera:cCliTik )
      Return ( .F. )
   end





   nPorcentajePromocion             := ::oFideliza:nPorcentajePrograma( ::sTotal:nPromocion )

   if ( nPorcentajePromocion == 0 )
      Return ( .F. )
   end

   if ( ::sTotal:nPromocion == 0 )
      Return ( .F. )
   end

   ::oDlg:Disable()

   oBlock                           := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      cNumeroTicket                 := ::cNumeroTicket()

      lValePromocion                := !oRetFld( ::oTiketCabecera:cCliTik, ::oCliente, "lExcFid" )
      if lValePromocion
         nValePromocion             := Round( ::sTotal:nPromocion * nPorcentajePromocion / 100, ::nDecimalesTotal )
      end

      cValeTicket                   := ::cValeTicket( cNumeroTicket )





      if !Empty( cValeTicket ) .AND. ::oTiketCabecera:Seek( cValeTicket )

         ::oTiketCabecera:Load()
         ::oTiketCabecera:nTotNet   := nValePromocion
         ::oTiketCabecera:nTotTik   := nValePromocion
         ::oTiketCabecera:Save()

      else

         ::oTiketCabecera:Load()
         ::oTiketCabecera:cNumTik   := ::nNuevoNumeroTicket()
         ::oTiketCabecera:cTipTik   := "6"
         ::oTiketCabecera:lCloTik   := .F.
         ::oTiketCabecera:nTotNet   := nValePromocion
         ::oTiketCabecera:nTotTik   := nValePromocion
         ::oTiketCabecera:cTikVal   := cNumeroTicket
         ::oTiketCabecera:Insert()

      end





      while ::oTiketLinea:Seek( ::cNumeroTicket() )
         ::oTiketLinea:Delete()
      end

      ::oTiketLinea:Blank()
      ::oTiketLinea:cSerTil         := ::oTiketCabecera:cSerTik
      ::oTiketLinea:cNumTil         := ::oTiketCabecera:cNumTik
      ::oTiketLinea:cSufTil         := ::oTiketCabecera:cSufTik
      ::oTiketLinea:cTipTil         := ::oTiketCabecera:cTipTik
      ::oTiketLinea:dFecTik         := ::oTiketCabecera:dFecTik
      ::oTiketLinea:nUntTil         := 1
      ::oTiketLinea:nNumLin         := 1
      ::oTiketLinea:cNomTil         := "Vale por promoción"
      ::oTiketLinea:nPvpTil         := nValePromocion
      ::oTiketLinea:Insert()

   RECOVER USING oError

      msgStop( ErrorMessage( oError ), "Error al generar vale" )

   end

   ErrorBlock( oBlock )

   ::oDlg:Enable()

Return ( Self )



UTILITY STATIC function TpvTactil_lLiquidaVale( sCobro) ; local Self AS CLASS TpvTactil := QSelf() AS CLASS TpvTactil

   WQout( { sCobro:nImporte } )

Return ( Self )












function SetResDebug( lOnOff )

return nil



function FWAddResource( nHResource, cType )

   local n := 3, cInfo := ""

   while ! Empty( ProcName( n ) )
      cInfo += ProcName( n ) + "(" + Alltrim( Str( ProcLine( n ) ) ) + ")->"
      n++
   end

   if ! Empty( cInfo )
      cInfo = SubStr( cInfo, 1, Len( cInfo ) - 2 )
   endif

   AAdd( aResources, { cType, nHResource, cInfo } )

return nil



function FWDelResource( nHResource )

   local nAt

   if ( nAt := AScan( aResources, { | aRes | aRes[ 2 ] == nHResource } ) ) <> 0
      ADel( aResources, nAt )
      ASize( aResources, Len( aResources ) - 1 )
   endif

return nil



function CheckRes()

   local cInfo := "", n

   for n = 1 to Len( aResources )
      if aResources[ n, 2 ] <> 0
         cInfo = aResources[ n, 1 ] + "," + AllTrim( Str( aResources[ n, 2 ] ) ) + "," + aResources[ n, 3 ] + Chr(13)+Chr(10)
         LogFile( "checkres.txt", { cInfo } )
      endif
   next

   LogFile( "checkres.txt", { Replicate( "=", 100 ) } )

return nil



#pragma BEGINDUMP

#include <windows.h>
#include <hbapiitm.h>
#include <hbvm.h>

void RegisterResource( HANDLE hRes, LPSTR szType )
{
   PHB_ITEM pRet = hb_itemNew( hb_param( -1, HB_IT_ANY ) );

   hb_vmPushSymbol( hb_dynsymGetSymbol( "FWADDRESOURCE" ) );
   hb_vmPushNil();
   hb_vmPushLong( ( LONG ) hRes );
   hb_vmPushString( szType, strlen( szType ) );
   hb_vmFunction( 2 );

   hb_itemReturnRelease( pRet );
}

void pascal DelResource( HANDLE hResource )
{
   PHB_ITEM pRet = hb_itemNew( hb_param( -1, HB_IT_ANY ) );

   hb_vmPushSymbol( hb_dynsymGetSymbol( "FWDELRESOURCE" ) );
   hb_vmPushNil();
   hb_vmPushLong( ( LONG ) hResource );
   hb_vmFunction( 1 );

   hb_itemReturnRelease( pRet );
}

#pragma ENDDUMP
